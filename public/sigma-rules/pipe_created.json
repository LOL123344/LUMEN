[{"path":"pipe_created\\pipe_created_sysinternals_psexec_default_pipe_susp_location.yml","content":"title: PsExec Tool Execution From Suspicious Locations - PipeName\nid: 41504465-5e3a-4a5b-a5b4-2a0baadd4463\nrelated:\n    - id: f3f3a972-f982-40ad-b63c-bca6afdfad7c\n      type: derived\nstatus: test\ndescription: Detects PsExec default pipe creation where the image executed is located in a suspicious location. Which could indicate that the tool is being used in an attack\nreferences:\n    - https://www.jpcert.or.jp/english/pub/sr/ir_research.html\n    - https://jpcertcc.github.io/ToolAnalysisResultSheet\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-08-04\nmodified: 2023-09-20\ntags:\n    - attack.execution\n    - attack.t1569.002\n    - attack.s0029\nlogsource:\n    category: pipe_created\n    product: windows\n    definition: 'Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (https://github.com/SwiftOnSecurity/sysmon-config), but it is worth verifying. You can also use other repo, e.g. https://github.com/Neo23x0/sysmon-config, https://github.com/olafhartong/sysmon-modular. How to test detection? You can check powershell script from this site https://svch0st.medium.com/guide-to-named-pipes-and-hunting-for-cobalt-strike-pipes-dc46b2c5f575'\ndetection:\n    selection:\n        PipeName: '\\PSEXESVC'\n        Image|contains: # Add or remove locations depending on how and if you execute Psexec in your env\n            - ':\\Users\\Public\\'\n            - ':\\Windows\\Temp\\'\n            - '\\AppData\\Local\\Temp\\'\n            - '\\Desktop\\'\n            - '\\Downloads\\'\n    condition: selection\nfalsepositives:\n    - Rare legitimate use of psexec from the locations mentioned above. This will require initial tuning based on your environment.\nlevel: medium\n"},{"path":"pipe_created\\pipe_created_susp_malicious_namedpipes.yml","content":"title: Malicious Named Pipe Created\nid: fe3ac066-98bb-432a-b1e7-a5229cb39d4a\nstatus: test\ndescription: Detects the creation of a named pipe seen used by known APTs or malware.\nreferences:\n    - https://securelist.com/wild-neutron-economic-espionage-threat-actor-returns-with-new-tricks/71275/\n    - https://securelist.com/faq-the-projectsauron-apt/75533/\n    - https://web.archive.org/web/20180725233601/https://www.pwc.co.uk/cyber-security/pdf/cloud-hopper-annex-b-final.pdf\n    - https://www.us-cert.gov/ncas/alerts/TA17-117A\n    - https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html\n    - https://thedfirreport.com/2020/06/21/snatch-ransomware/\n    - https://github.com/RiccardoAncarani/LiquidSnake\n    - https://www.accenture.com/us-en/blogs/cyber-defense/turla-belugasturgeon-compromises-government-entity\n    - https://us-cert.cisa.gov/ncas/analysis-reports/ar19-304a\n    - https://download.bitdefender.com/resources/files/News/CaseStudies/study/115/Bitdefender-Whitepaper-PAC-A4-en-EN1.pdf\n    - https://unit42.paloaltonetworks.com/emissary-panda-attacks-middle-east-government-sharepoint-servers/\n    - https://thedfirreport.com/2022/02/21/qbot-and-zerologon-lead-to-full-domain-compromise/\nauthor: Florian Roth (Nextron Systems), blueteam0ps, elhoim\ndate: 2017-11-06\nmodified: 2023-08-07\ntags:\n    - attack.defense-evasion\n    - attack.privilege-escalation\n    - attack.t1055\nlogsource:\n    product: windows\n    category: pipe_created\n    definition: 'Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (https://github.com/SwiftOnSecurity/sysmon-config), but it is worth verifying. You can also use other repo, e.g. https://github.com/Neo23x0/sysmon-config, https://github.com/olafhartong/sysmon-modular. How to test detection? You can check powershell script from this site https://svch0st.medium.com/guide-to-named-pipes-and-hunting-for-cobalt-strike-pipes-dc46b2c5f575'\ndetection:\n    selection:\n        PipeName:\n            - '\\46a676ab7f179e511e30dd2dc41bd388'  # Project Sauron\n            - '\\583da945-62af-10e8-4902-a8f205c72b2e'  # SolarWinds SUNBURST malware\n            - '\\6e7645c4-32c5-4fe3-aabf-e94c2f4370e7'  # LiquidSnake\n            - '\\9f81f59bc58452127884ce513865ed20'  # Project Sauron\n            - '\\adschemerpc'  # Turla HyperStack\n            - '\\ahexec'  # Sofacy group malware\n            - '\\AnonymousPipe'  # Hidden Cobra Hoplight\n            - '\\bc31a7'  # Pacifier\n            - '\\bc367'  # Pacifier\n            - '\\bizkaz'  # Snatch Ransomware\n            - '\\csexecsvc' # CSEXEC default\n            - '\\dce_3d' # Qbot\n            - '\\e710f28d59aa529d6792ca6ff0ca1b34'  # Project Sauron\n            - '\\gruntsvc' # Covenant default\n            - '\\isapi_dg'  # Uroburos Malware\n            - '\\isapi_dg2'  # Uroburos Malware\n            - '\\isapi_http'  # Uroburos Malware\n            - '\\jaccdpqnvbrrxlaf' # PoshC2 default\n            - '\\lsassw'  # Wild Neutron APT malware\n            - '\\NamePipe_MoreWindows'  # Cloud Hopper - RedLeaves\n            - '\\pcheap_reuse'  # Pipe used by Equation Group malware\n            - '\\Posh*' # PoshC2 default\n            - '\\rpchlp_3'  # Project Sauron\n            - '\\sdlrpc'  # Cobra Trojan\n            - '\\svcctl' # Crackmapexec smbexec default\n            - '\\testPipe'  # Emissary Panda Hyperbro\n            - '\\winsession'  # Wild Neutron APT malware\n            # - '\\status_*' # CS default  https://github.com/SigmaHQ/sigma/issues/253\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: critical\n"},{"path":"pipe_created\\pipe_created_scrcons_wmi_consumer_namedpipe.yml","content":"title: WMI Event Consumer Created Named Pipe\nid: 493fb4ab-cdcc-4c4f-818c-0e363bd1e4bb\nstatus: test\ndescription: Detects the WMI Event Consumer service scrcons.exe creating a named pipe\nreferences:\n    - https://github.com/RiccardoAncarani/LiquidSnake\nauthor: Florian Roth (Nextron Systems)\ndate: 2021-09-01\nmodified: 2023-11-30\ntags:\n    - attack.t1047\n    - attack.execution\nlogsource:\n    product: windows\n    category: pipe_created\n    definition: 'Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (https://github.com/SwiftOnSecurity/sysmon-config), but it is worth verifying. You can also use other repo, e.g. https://github.com/Neo23x0/sysmon-config, https://github.com/olafhartong/sysmon-modular. How to test detection? You can check powershell script from this site https://svch0st.medium.com/guide-to-named-pipes-and-hunting-for-cobalt-strike-pipes-dc46b2c5f575'\ndetection:\n    selection:\n        Image|endswith: '\\scrcons.exe'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"pipe_created\\pipe_created_pua_remcom_default_pipe.yml","content":"title: PUA - RemCom Default Named Pipe\nid: d36f87ea-c403-44d2-aa79-1a0ac7c24456\nrelated:\n    - id: 9e77ed63-2ecf-4c7b-b09d-640834882028\n      type: obsolete\nstatus: test\ndescription: Detects default RemCom pipe creation\nreferences:\n    - https://drive.google.com/file/d/1lKya3_mLnR3UQuCoiYruO3qgu052_iS_/view\n    - https://github.com/kavika13/RemCom\nauthor: Nikita Nazarov, oscd.community, Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-08-07\nmodified: 2023-11-30\ntags:\n    - attack.lateral-movement\n    - attack.t1021.002\n    - attack.execution\n    - attack.t1569.002\nlogsource:\n    product: windows\n    category: pipe_created\n    definition: 'Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (https://github.com/SwiftOnSecurity/sysmon-config), but it is worth verifying. You can also use other repo, e.g. https://github.com/Neo23x0/sysmon-config, https://github.com/olafhartong/sysmon-modular. How to test detection? You can check powershell script from this site https://svch0st.medium.com/guide-to-named-pipes-and-hunting-for-cobalt-strike-pipes-dc46b2c5f575'\ndetection:\n    selection:\n        PipeName|contains: '\\RemCom'\n    condition: selection\nfalsepositives:\n    - Legitimate Administrator activity\nlevel: medium\n"},{"path":"pipe_created\\pipe_created_pua_paexec_default_pipe.yml","content":"title: PUA - PAExec Default Named Pipe\nid: f6451de4-df0a-41fa-8d72-b39f54a08db5\nstatus: test\ndescription: Detects PAExec default named pipe\nreferences:\n    - https://github.com/microsoft/Microsoft-365-Defender-Hunting-Queries/blob/efa17a600b43c897b4b7463cc8541daa1987eeb4/Command%20and%20Control/C2-NamedPipe.md\n    - https://github.com/poweradminllc/PAExec\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-10-26\ntags:\n    - attack.execution\n    - attack.t1569.002\nlogsource:\n    category: pipe_created\n    product: windows\n    definition: 'Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (https://github.com/SwiftOnSecurity/sysmon-config), but it is worth verifying. You can also use other repo, e.g. https://github.com/Neo23x0/sysmon-config, https://github.com/olafhartong/sysmon-modular. How to test detection? You can check powershell script from this site https://svch0st.medium.com/guide-to-named-pipes-and-hunting-for-cobalt-strike-pipes-dc46b2c5f575'\ndetection:\n    selection:\n        PipeName|startswith: '\\PAExec'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"pipe_created\\pipe_created_pua_csexec_default_pipe.yml","content":"title: PUA - CSExec Default Named Pipe\nid: f318b911-ea88-43f4-9281-0de23ede628e\nrelated:\n    - id: 9e77ed63-2ecf-4c7b-b09d-640834882028\n      type: obsolete\nstatus: test\ndescription: Detects default CSExec pipe creation\nreferences:\n    - https://drive.google.com/file/d/1lKya3_mLnR3UQuCoiYruO3qgu052_iS_/view\n    - https://github.com/malcomvetter/CSExec\nauthor: Nikita Nazarov, oscd.community, Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-08-07\nmodified: 2023-11-30\ntags:\n    - attack.lateral-movement\n    - attack.t1021.002\n    - attack.execution\n    - attack.t1569.002\nlogsource:\n    product: windows\n    category: pipe_created\n    definition: 'Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (https://github.com/SwiftOnSecurity/sysmon-config), but it is worth verifying. You can also use other repo, e.g. https://github.com/Neo23x0/sysmon-config, https://github.com/olafhartong/sysmon-modular. How to test detection? You can check powershell script from this site https://svch0st.medium.com/guide-to-named-pipes-and-hunting-for-cobalt-strike-pipes-dc46b2c5f575'\ndetection:\n    selection:\n        PipeName|contains: '\\csexecsvc'\n    condition: selection\nfalsepositives:\n    - Legitimate Administrator activity\nlevel: medium\n"},{"path":"pipe_created\\pipe_created_powershell_execution_pipe.yml","content":"title: New PowerShell Instance Created\nid: ac7102b4-9e1e-4802-9b4f-17c5524c015c\nrelated:\n    - id: 58cb02d5-78ce-4692-b3e1-dce850aae41a\n      type: derived\nstatus: test\ndescription: Detects the execution of PowerShell via the creation of a named pipe starting with PSHost\nreferences:\n    - https://threathunterplaybook.com/hunts/windows/190610-PwshAlternateHosts/notebook.html\n    - https://threathunterplaybook.com/hunts/windows/190410-LocalPwshExecution/notebook.html\nauthor: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)\ndate: 2019-09-12\nmodified: 2023-11-30\ntags:\n    - attack.execution\n    - attack.t1059.001\nlogsource:\n    product: windows\n    category: pipe_created\n    definition: 'Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (https://github.com/SwiftOnSecurity/sysmon-config), but it is worth verifying. You can also use other repo, e.g. https://github.com/Neo23x0/sysmon-config, https://github.com/olafhartong/sysmon-modular. How to test detection? You can check powershell script from this site https://svch0st.medium.com/guide-to-named-pipes-and-hunting-for-cobalt-strike-pipes-dc46b2c5f575'\ndetection:\n    selection:\n        PipeName|startswith: '\\PSHost'\n    condition: selection\nfalsepositives:\n    - Likely\nlevel: informational\n"},{"path":"pipe_created\\pipe_created_powershell_alternate_host_pipe.yml","content":"title: Alternate PowerShell Hosts Pipe\nid: 58cb02d5-78ce-4692-b3e1-dce850aae41a\nrelated:\n    - id: ac7102b4-9e1e-4802-9b4f-17c5524c015c\n      type: derived\nstatus: test\ndescription: Detects alternate PowerShell hosts potentially bypassing detections looking for powershell.exe\nreferences:\n    - https://threathunterplaybook.com/hunts/windows/190610-PwshAlternateHosts/notebook.html\n    - https://threathunterplaybook.com/hunts/windows/190410-LocalPwshExecution/notebook.html\nauthor: Roberto Rodriguez @Cyb3rWard0g, Tim Shelton\ndate: 2019-09-12\nmodified: 2025-10-07\ntags:\n    - attack.execution\n    - attack.t1059.001\nlogsource:\n    product: windows\n    category: pipe_created\n    definition: 'Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (https://github.com/SwiftOnSecurity/sysmon-config), but it is worth verifying. You can also use other repo, e.g. https://github.com/Neo23x0/sysmon-config, https://github.com/olafhartong/sysmon-modular. How to test detection? You can check powershell script from this site https://svch0st.medium.com/guide-to-named-pipes-and-hunting-for-cobalt-strike-pipes-dc46b2c5f575'\ndetection:\n    selection:\n        PipeName|startswith: '\\PSHost'\n    filter_main_generic:\n        - Image|contains:\n              - ':\\Program Files\\PowerShell\\7-preview\\pwsh.exe' # Powershell 7\n              - ':\\Program Files\\PowerShell\\7\\pwsh.exe' # Powershell 7\n              - ':\\Windows\\system32\\dsac.exe'\n              - ':\\Windows\\system32\\inetsrv\\w3wp.exe'   # this is sad :,( but it triggers FPs on Exchange servers\n              - ':\\Windows\\System32\\sdiagnhost.exe'\n              - ':\\Windows\\system32\\ServerManager.exe'\n              - ':\\Windows\\system32\\wbem\\wmiprvse.exe'\n              - ':\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell_ise.exe'\n              - ':\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe'\n              - ':\\Windows\\System32\\wsmprovhost.exe'\n              - ':\\Windows\\SysWOW64\\WindowsPowerShell\\v1.0\\powershell_ise.exe'\n              - ':\\Windows\\SysWOW64\\WindowsPowerShell\\v1.0\\powershell.exe'\n        - Image|contains|all:\n              - 'C:\\Program Files\\WindowsApps\\Microsoft.PowerShellPreview'\n              - '\\pwsh.exe'\n        - Image|contains|all:\n              - '\\AppData\\Local\\Microsoft\\WindowsApps\\Microsoft.PowerShellPreview'\n              - '\\pwsh.exe'\n    filter_optional_sqlserver: # Microsoft SQL Server\\130\\Tools\\\n        Image|startswith:\n            - 'C:\\Program Files (x86)\\'\n            - 'C:\\Program Files\\'\n        Image|contains: '\\Microsoft SQL Server\\'\n        Image|endswith: '\\Tools\\Binn\\SQLPS.exe'\n    filter_optional_azure_connected_machine_agent:\n        # Azure Connected Machine Agent (https://devblogs.microsoft.com/powershell/azure-policy-guest-configuration-client/)\n        Image|startswith: 'C:\\Program Files\\AzureConnectedMachineAgent\\GCArcService'\n        Image|endswith: '\\GC\\gc_worker.exe'\n    filter_optional_citrix:\n        Image|startswith: 'C:\\Program Files\\Citrix\\'\n    filter_optional_exchange:\n        Image|startswith: 'C:\\Program Files\\Microsoft\\Exchange Server\\'\n    filter_main_null:\n        Image: null\n    condition: selection and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Programs using PowerShell directly without invocation of a dedicated interpreter.\nlevel: medium\n"},{"path":"pipe_created\\pipe_created_hktl_koh_default_pipe.yml","content":"title: HackTool - Koh Default Named Pipe\nid: 0adc67e0-a68f-4ffd-9c43-28905aad5d6a\nstatus: test\ndescription: Detects creation of default named pipes used by the Koh tool\nreferences:\n    - https://github.com/GhostPack/Koh/blob/0283d9f3f91cf74732ad377821986cfcb088e20a/Clients/BOF/KohClient.c#L12\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-07-08\nmodified: 2023-08-07\ntags:\n    - attack.defense-evasion\n    - attack.privilege-escalation\n    - attack.credential-access\n    - attack.t1528\n    - attack.t1134.001\nlogsource:\n    product: windows\n    category: pipe_created\n    definition: 'Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (https://github.com/SwiftOnSecurity/sysmon-config), but it is worth verifying. You can also use other repo, e.g. https://github.com/Neo23x0/sysmon-config, https://github.com/olafhartong/sysmon-modular. How to test detection? You can check powershell script from this site https://svch0st.medium.com/guide-to-named-pipes-and-hunting-for-cobalt-strike-pipes-dc46b2c5f575'\ndetection:\n    selection:\n        PipeName|contains:\n            - '\\imposecost'\n            - '\\imposingcost'\n    condition: selection\nfalsepositives:\n    - Unlikely\nlevel: critical\n"},{"path":"pipe_created\\pipe_created_hktl_generic_cred_dump_tools_pipes.yml","content":"title: HackTool - Credential Dumping Tools Named Pipe Created\nid: 961d0ba2-3eea-4303-a930-2cf78bbfcc5e\nstatus: test\ndescription: Detects well-known credential dumping tools execution via specific named pipe creation\nreferences:\n    - https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment\n    - https://image.slidesharecdn.com/zeronights2017kheirkhabarov-171118103000/75/hunting-for-credentials-dumping-in-windows-environment-57-2048.jpg?cb=1666035799\nauthor: Teymur Kheirkhabarov, oscd.community\ndate: 2019-11-01\nmodified: 2023-08-07\ntags:\n    - attack.credential-access\n    - attack.t1003.001\n    - attack.t1003.002\n    - attack.t1003.004\n    - attack.t1003.005\nlogsource:\n    product: windows\n    category: pipe_created\n    definition: 'Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (https://github.com/SwiftOnSecurity/sysmon-config), but it is worth verifying. You can also use other repo, e.g. https://github.com/Neo23x0/sysmon-config, https://github.com/olafhartong/sysmon-modular. How to test detection? You can check powershell script from this site https://svch0st.medium.com/guide-to-named-pipes-and-hunting-for-cobalt-strike-pipes-dc46b2c5f575'\ndetection:\n    selection:\n        PipeName|contains:\n            - '\\cachedump'\n            - '\\lsadump'\n            - '\\wceservicepipe'\n    condition: selection\nfalsepositives:\n    - Legitimate Administrator using tool for password recovery\nlevel: critical\n"},{"path":"pipe_created\\pipe_created_hktl_efspotato.yml","content":"title: HackTool - EfsPotato Named Pipe Creation\nid: 637f689e-b4a5-4a86-be0e-0100a0a33ba2\nstatus: test\ndescription: Detects the pattern of a pipe name as used by the hack tool EfsPotato\nreferences:\n    - https://twitter.com/SBousseaden/status/1429530155291193354?s=20\n    - https://github.com/zcgonvh/EfsPotato\nauthor: Florian Roth (Nextron Systems)\ndate: 2021-08-23\nmodified: 2023-12-21\ntags:\n    - attack.defense-evasion\n    - attack.privilege-escalation\n    - attack.t1055\nlogsource:\n    product: windows\n    category: pipe_created\n    definition: 'Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (https://github.com/SwiftOnSecurity/sysmon-config), but it is worth verifying. You can also use other repo, e.g. https://github.com/Neo23x0/sysmon-config, https://github.com/olafhartong/sysmon-modular. How to test detection? You can check powershell script from this site https://svch0st.medium.com/guide-to-named-pipes-and-hunting-for-cobalt-strike-pipes-dc46b2c5f575'\ndetection:\n    selection:\n        PipeName|contains:\n            - '\\pipe\\'\n            - '\\pipe\\srvsvc'  # more specific version (use only this one if the other causes too many false positives)\n    filter_optional_ctx:\n        PipeName|contains: '\\CtxShare'\n    filter_optional_default:\n        PipeName|startswith: '\\pipe\\' # excludes pipes that start with \\pipe\\*\n    condition: selection and not 1 of filter_optional_*\nfalsepositives:\n    - \\pipe\\LOCAL\\Monitorian # https://github.com/emoacht/Monitorian\nlevel: high\n"},{"path":"pipe_created\\pipe_created_hktl_diagtrack_eop.yml","content":"title: HackTool - DiagTrackEoP Default Named Pipe\nid: 1f7025a6-e747-4130-aac4-961eb47015f1\nstatus: test\ndescription: Detects creation of default named pipe used by the DiagTrackEoP POC, a tool that abuses \"SeImpersonate\" privilege.\nreferences:\n    - https://github.com/Wh04m1001/DiagTrackEoP/blob/3a2fc99c9700623eb7dc7d4b5f314fd9ce5ef51f/main.cpp#L22\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-08-03\nmodified: 2023-08-07\ntags:\n    - attack.privilege-escalation\nlogsource:\n    product: windows\n    category: pipe_created\n    definition: 'Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (https://github.com/SwiftOnSecurity/sysmon-config), but it is worth verifying. You can also use other repo, e.g. https://github.com/Neo23x0/sysmon-config, https://github.com/olafhartong/sysmon-modular. How to test detection? You can check powershell script from this site https://svch0st.medium.com/guide-to-named-pipes-and-hunting-for-cobalt-strike-pipes-dc46b2c5f575'\ndetection:\n    selection:\n        PipeName|contains: 'thisispipe' # Based on source code\n    condition: selection\nfalsepositives:\n    - Unlikely\nlevel: critical\n"},{"path":"pipe_created\\pipe_created_hktl_coercedpotato.yml","content":"title: HackTool - CoercedPotato Named Pipe Creation\nid: 4d0083b3-580b-40da-9bba-626c19fe4033\nstatus: test\ndescription: Detects the pattern of a pipe name as used by the hack tool CoercedPotato\nreferences:\n    - https://blog.hackvens.fr/articles/CoercedPotato.html\n    - https://github.com/hackvens/CoercedPotato\nauthor: Florian Roth (Nextron Systems)\ndate: 2023-10-11\ntags:\n    - attack.defense-evasion\n    - attack.privilege-escalation\n    - attack.t1055\nlogsource:\n    product: windows\n    category: pipe_created\n    definition: 'Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (https://github.com/SwiftOnSecurity/sysmon-config), but it is worth verifying. You can also use other repo, e.g. https://github.com/Neo23x0/sysmon-config, https://github.com/olafhartong/sysmon-modular. How to test detection? You can check powershell script from this site https://svch0st.medium.com/guide-to-named-pipes-and-hunting-for-cobalt-strike-pipes-dc46b2c5f575'\ndetection:\n    selection:\n        PipeName|contains: '\\coerced\\'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"pipe_created\\pipe_created_hktl_cobaltstrike_susp_pipe_patterns.yml","content":"title: CobaltStrike Named Pipe Patterns\nid: 85adeb13-4fc9-4e68-8a4a-c7cb2c336eb7\nrelated:\n    - id: 0e7163d4-9e19-4fa7-9be6-000c61aad77a # Regex\n      type: similar\n    - id: d5601f8c-b26f-4ab0-9035-69e11a8d4ad2 # Generic\n      type: similar\nstatus: test\ndescription: Detects the creation of a named pipe with a pattern found in CobaltStrike malleable C2 profiles\nreferences:\n    - https://svch0st.medium.com/guide-to-named-pipes-and-hunting-for-cobalt-strike-pipes-dc46b2c5f575\n    - https://gist.github.com/MHaggis/6c600e524045a6d49c35291a21e10752\nauthor: Florian Roth (Nextron Systems), Christian Burkard (Nextron Systems)\ndate: 2021-07-30\nmodified: 2024-01-26\ntags:\n    - attack.defense-evasion\n    - attack.privilege-escalation\n    - attack.t1055\n    - stp.1k\nlogsource:\n    product: windows\n    category: pipe_created\n    definition: 'Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (https://github.com/SwiftOnSecurity/sysmon-config), but it is worth verifying. You can also use other repo, e.g. https://github.com/Neo23x0/sysmon-config, https://github.com/olafhartong/sysmon-modular You can also use other repo, e.g. https://github.com/Neo23x0/sysmon-config, https://github.com/olafhartong/sysmon-modular. How to test detection? You can always use Cobalt Strike, but also you can check powershell script from this site https://svch0st.medium.com/guide-to-named-pipes-and-hunting-for-cobalt-strike-pipes-dc46b2c5f575'\ndetection:\n    selection_malleable_profile_generic:\n        - PipeName|startswith:\n              - '\\DserNamePipe'\n              - '\\f4c3'\n              - '\\f53f'\n              - '\\fullduplex_'\n              - '\\mojo.5688.8052.183894939787088877'\n              - '\\mojo.5688.8052.35780273329370473'\n              - '\\MsFteWds'\n              - '\\msrpc_'\n              - '\\mypipe-f'\n              - '\\mypipe-h'\n              - '\\ntsvcs'\n              - '\\PGMessagePipe'\n              - '\\rpc_'\n              - '\\scerpc'\n              - '\\SearchTextHarvester'\n              - '\\spoolss'\n              - '\\win_svc'\n              - '\\win\\msrpc_'\n              - '\\windows.update.manager'\n              - '\\wkssvc'\n        - PipeName:\n              - '\\demoagent_11'\n              - '\\demoagent_22'\n    selection_malleable_profile_catalog_change_listener:\n        PipeName|startswith: '\\Winsock2\\CatalogChangeListener-'\n        PipeName|endswith: '-0,'\n    filter_main_generic:\n        PipeName:\n            - '\\wkssvc'\n            - '\\spoolss'\n            - '\\scerpc'\n            - '\\ntsvcs'\n            - '\\SearchTextHarvester'\n            - '\\PGMessagePipe'\n            - '\\MsFteWds'\n    filter_optional_websense:\n        Image|contains:\n            - ':\\Program Files\\Websense\\'\n            - ':\\Program Files (x86)\\Websense\\'\n        PipeName|startswith:\n            - '\\DserNamePipeR'\n            - '\\DserNamePipeW'\n    condition: 1 of selection_malleable_profile_* and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Chrome instances using the exact same pipe name \"mojo.xxx\"\n    - Websense Endpoint using the pipe name \"DserNamePipe(R|W)\\d{1,5}\"\nlevel: high\n"},{"path":"pipe_created\\pipe_created_hktl_cobaltstrike_re.yml","content":"title: CobaltStrike Named Pipe Pattern Regex\nid: 0e7163d4-9e19-4fa7-9be6-000c61aad77a\nrelated:\n    - id: 85adeb13-4fc9-4e68-8a4a-c7cb2c336eb7 # Patterns\n      type: similar\n    - id: d5601f8c-b26f-4ab0-9035-69e11a8d4ad2 # Generic\n      type: similar\nstatus: test\ndescription: Detects the creation of a named pipe matching a pattern used by CobaltStrike Malleable C2 profiles\nreferences:\n    - https://svch0st.medium.com/guide-to-named-pipes-and-hunting-for-cobalt-strike-pipes-dc46b2c5f575\n    - https://gist.github.com/MHaggis/6c600e524045a6d49c35291a21e10752\nauthor: Florian Roth (Nextron Systems)\ndate: 2021-07-30\nmodified: 2022-12-31\ntags:\n    - attack.defense-evasion\n    - attack.privilege-escalation\n    - attack.t1055\nlogsource:\n    product: windows\n    category: pipe_created\n    definition: 'Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (https://github.com/SwiftOnSecurity/sysmon-config), but it is worth verifying. You can also use other repo, e.g. https://github.com/Neo23x0/sysmon-config, https://github.com/olafhartong/sysmon-modular You can also use other repo, e.g. https://github.com/Neo23x0/sysmon-config, https://github.com/olafhartong/sysmon-modular. How to test detection? You can always use Cobalt Strike, but also you can check powershell script from this site https://svch0st.medium.com/guide-to-named-pipes-and-hunting-for-cobalt-strike-pipes-dc46b2c5f575'\ndetection:\n    selection:\n        - PipeName|re: '\\\\mojo\\.5688\\.8052\\.(?:183894939787088877|35780273329370473)[0-9a-f]{2}'\n        - PipeName|re: '\\\\wkssvc_?[0-9a-f]{2}'\n        - PipeName|re: '\\\\ntsvcs[0-9a-f]{2}'\n        - PipeName|re: '\\\\DserNamePipe[0-9a-f]{2}'\n        - PipeName|re: '\\\\SearchTextHarvester[0-9a-f]{2}'\n        - PipeName|re: '\\\\mypipe-(?:f|h)[0-9a-f]{2}'\n        - PipeName|re: '\\\\windows\\.update\\.manager[0-9a-f]{2,3}'\n        - PipeName|re: '\\\\ntsvcs_[0-9a-f]{2}'\n        - PipeName|re: '\\\\scerpc_?[0-9a-f]{2}'\n        - PipeName|re: '\\\\PGMessagePipe[0-9a-f]{2}'\n        - PipeName|re: '\\\\MsFteWds[0-9a-f]{2}'\n        - PipeName|re: '\\\\f4c3[0-9a-f]{2}'\n        - PipeName|re: '\\\\fullduplex_[0-9a-f]{2}'\n        - PipeName|re: '\\\\msrpc_[0-9a-f]{4}'\n        - PipeName|re: '\\\\win\\\\msrpc_[0-9a-f]{2}'\n        - PipeName|re: '\\\\f53f[0-9a-f]{2}'\n        - PipeName|re: '\\\\rpc_[0-9a-f]{2}'\n        - PipeName|re: '\\\\spoolss_[0-9a-f]{2}'\n        - PipeName|re: '\\\\Winsock2\\\\CatalogChangeListener-[0-9a-f]{3}-0,'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: critical\n"},{"path":"pipe_created\\pipe_created_hktl_cobaltstrike.yml","content":"title: CobaltStrike Named Pipe\nid: d5601f8c-b26f-4ab0-9035-69e11a8d4ad2\nrelated:\n    - id: 85adeb13-4fc9-4e68-8a4a-c7cb2c336eb7 # Patterns\n      type: similar\n    - id: 0e7163d4-9e19-4fa7-9be6-000c61aad77a # Regex\n      type: similar\nstatus: test\ndescription: Detects the creation of a named pipe as used by CobaltStrike\nreferences:\n    - https://twitter.com/d4rksystem/status/1357010969264873472\n    - https://labs.f-secure.com/blog/detecting-cobalt-strike-default-modules-via-named-pipe-analysis/\n    - https://github.com/SigmaHQ/sigma/issues/253\n    - https://blog.cobaltstrike.com/2021/02/09/learn-pipe-fitting-for-all-of-your-offense-projects/\n    - https://redcanary.com/threat-detection-report/threats/cobalt-strike/\nauthor: Florian Roth (Nextron Systems), Wojciech Lesicki\ndate: 2021-05-25\nmodified: 2022-10-31\ntags:\n    - attack.defense-evasion\n    - attack.privilege-escalation\n    - attack.t1055\nlogsource:\n    product: windows\n    category: pipe_created\n    definition: 'Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (https://github.com/SwiftOnSecurity/sysmon-config), but it is worth verifying. You can also use other repo, e.g. https://github.com/Neo23x0/sysmon-config, https://github.com/olafhartong/sysmon-modular. How to test detection? You can always use Cobalt Strike, but also you can check powershell script from this site https://svch0st.medium.com/guide-to-named-pipes-and-hunting-for-cobalt-strike-pipes-dc46b2c5f575'\ndetection:\n    selection_MSSE:\n        PipeName|contains|all:\n            - '\\MSSE-'\n            - '-server'\n    selection_postex:\n        PipeName|startswith: '\\postex_' # Also include the pipe \"\\postex_ssh_\"\n    selection_status:\n        PipeName|startswith: '\\status_'\n    selection_msagent:\n        PipeName|startswith: '\\msagent_'\n    selection_mojo:\n        PipeName|startswith: '\\mojo_'\n    selection_interprocess:\n        PipeName|startswith: '\\interprocess_'\n    selection_samr:\n        PipeName|startswith: '\\samr_'\n    selection_netlogon:\n        PipeName|startswith: '\\netlogon_'\n    selection_srvsvc:\n        PipeName|startswith: '\\srvsvc_'\n    selection_lsarpc:\n        PipeName|startswith: '\\lsarpc_'\n    selection_wkssvc:\n        PipeName|startswith: '\\wkssvc_'\n    condition: 1 of selection*\nfalsepositives:\n    - Unknown\nlevel: critical\n"},{"path":"pipe_created\\pipe_created_adfs_namedpipe_connection_uncommon_tool.yml","content":"title: ADFS Database Named Pipe Connection By Uncommon Tool\nid: 1ea13e8c-03ea-409b-877d-ce5c3d2c1cb3\nstatus: test\ndescription: |\n    Detects suspicious local connections via a named pipe to the AD FS configuration database (Windows Internal Database).\n    Used to access information such as the AD FS configuration settings which contains sensitive information used to sign SAML tokens.\nreferences:\n    - https://github.com/Azure/Azure-Sentinel/blob/f99542b94afe0ad2f19a82cc08262e7ac8e1428e/Detections/SecurityEvent/ADFSDBNamedPipeConnection.yaml\n    - https://o365blog.com/post/adfs/\n    - https://github.com/Azure/SimuLand\nauthor: Roberto Rodriguez @Cyb3rWard0g\ndate: 2021-10-08\nmodified: 2023-11-30\ntags:\n    - attack.collection\n    - attack.t1005\nlogsource:\n    product: windows\n    category: pipe_created\n    definition: 'Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (https://github.com/SwiftOnSecurity/sysmon-config), but it is worth verifying. You can also use other repo, e.g. https://github.com/Neo23x0/sysmon-config, https://github.com/olafhartong/sysmon-modular. How to test detection? You can check powershell script from this site https://svch0st.medium.com/guide-to-named-pipes-and-hunting-for-cobalt-strike-pipes-dc46b2c5f575'\ndetection:\n    selection:\n        PipeName: '\\MICROSOFT##WID\\tsql\\query'\n    filter_main_generic:\n        Image|endswith:\n            - ':\\Windows\\System32\\mmc.exe'\n            - ':\\Windows\\system32\\svchost.exe'\n            - ':\\Windows\\System32\\wsmprovhost.exe'\n            - ':\\Windows\\SysWOW64\\mmc.exe'\n            - ':\\Windows\\SysWOW64\\wsmprovhost.exe'\n            - ':\\Windows\\WID\\Binn\\sqlwriter.exe'\n            - '\\AzureADConnect.exe'\n            - '\\Microsoft.Identity.Health.Adfs.PshSurrogate.exe'\n            - '\\Microsoft.IdentityServer.ServiceHost.exe'\n            - '\\Microsoft.Tri.Sensor.exe'\n            - '\\sqlservr.exe'\n            - '\\tssdis.exe'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Unknown\nlevel: medium\n"}]