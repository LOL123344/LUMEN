[{"path":"network_connection\\net_connection_win_wuauclt_network_connection.yml","content":"title: Potentially Suspicious Wuauclt Network Connection\nid: c649a6c7-cd8c-4a78-9c04-000fc76df954\nstatus: test\ndescription: |\n    Detects the use of the Windows Update Client binary (wuauclt.exe) to proxy execute code and making network connections.\n    One could easily make the DLL spawn a new process and inject to it to proxy the network connection and bypass this rule.\nreferences:\n    - https://dtm.uk/wuauclt/\nauthor: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)\ndate: 2020-10-12\nmodified: 2024-03-12\ntags:\n    - attack.defense-evasion\n    - attack.t1218\nlogsource:\n    category: network_connection\n    product: windows\n    definition: 'Requirements: The CommandLine field enrichment is required in order for this rule to be used.'\ndetection:\n    selection:\n        Image|contains: 'wuauclt'\n        CommandLine|contains: ' /RunHandlerComServer'\n    # \"C:\\WINDOWS\\uus\\AMD64\\wuauclt.exe\" /DeploymentHandlerFullPath \\\\?\\C:\\Windows\\UUS\\AMD64\\UpdateDeploy.dll /ClassId aaa256e1-5b21-4993-9188-18f07ccb3b98 /RunHandlerComServer\n    filter_main_ip:\n        DestinationIp|cidr: # Ranges excluded based on https://github.com/SigmaHQ/sigma/blob/0f176092326ab9d1e19384d30224e5f29f760d82/rules/windows/network_connection/net_connection_win_dllhost_net_connections.yml\n            - '127.0.0.0/8'\n            - '10.0.0.0/8'\n            - '169.254.0.0/16'  # link-local address\n            - '172.16.0.0/12'\n            - '192.168.0.0/16'\n            - '::1/128'  # IPv6 loopback\n            - 'fe80::/10'  # IPv6 link-local addresses\n            - 'fc00::/7'  # IPv6 private addresses\n    filter_main_msrange:  # Sysmon\n        DestinationIp|cidr:\n            - '20.184.0.0/13' # Microsoft Corporation\n            - '20.192.0.0/10' # Microsoft Corporation\n            - '23.79.0.0/16' # Microsoft Corporation\n            - '51.10.0.0/15'\n            - '51.103.0.0/16' # Microsoft Corporation\n            - '51.104.0.0/15' # Microsoft Corporation\n            - '52.224.0.0/11' # Microsoft Corporation\n    filter_main_uus:\n        CommandLine|contains:\n            - ':\\Windows\\UUS\\Packages\\Preview\\amd64\\updatedeploy.dll /ClassId'\n            - ':\\Windows\\UUS\\amd64\\UpdateDeploy.dll /ClassId'\n    filter_main_winsxs:\n        CommandLine|contains|all:\n            - ':\\Windows\\WinSxS\\'\n            - '\\UpdateDeploy.dll /ClassId '\n    filter_main_cli_null:\n        CommandLine: null\n    filter_main_cli_empty:\n        CommandLine: ''\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"network_connection\\net_connection_win_wscript_cscript_outbound_connection.yml","content":"title: Outbound Network Connection Initiated By Script Interpreter\nid: 992a6cae-db6a-43c8-9cec-76d7195c96fc\nrelated:\n    - id: 08249dc0-a28d-4555-8ba5-9255a198e08c\n      type: derived\nstatus: test\ndescription: Detects a script interpreter wscript/cscript opening a network connection to a non-local network. Adversaries may use script to download malicious payloads.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/28d190330fe44de6ff4767fc400cc10fa7cd6540/atomics/T1105/T1105.md\nauthor: frack113, Florian Roth (Nextron Systems)\ndate: 2022-08-28\nmodified: 2024-03-13\ntags:\n    - attack.command-and-control\n    - attack.t1105\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Initiated: 'true'\n        Image|endswith:\n            - '\\wscript.exe'\n            - '\\cscript.exe'\n    filter_main_local_ranges:\n        DestinationIp|cidr:\n            - '127.0.0.0/8'\n            - '10.0.0.0/8'\n            - '172.16.0.0/12'\n            - '192.168.0.0/16'\n            - '169.254.0.0/16'\n            - '::1/128'  # IPv6 loopback\n            - 'fe80::/10'  # IPv6 link-local addresses\n            - 'fc00::/7'  # IPv6 private addresses\n    filter_main_ms_ranges:\n        DestinationIp|cidr: '20.0.0.0/11' # Microsoft range, caused some FPs\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Legitimate scripts\nlevel: high\n"},{"path":"network_connection\\net_connection_win_wscript_cscript_local_connection.yml","content":"title: Local Network Connection Initiated By Script Interpreter\nid: 08249dc0-a28d-4555-8ba5-9255a198e08c\nrelated:\n    - id: 992a6cae-db6a-43c8-9cec-76d7195c96fc\n      type: derived\nstatus: test\ndescription: |\n    Detects a script interpreter (Wscript/Cscript) initiating a local network connection to download or execute a script hosted on a shared folder.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/28d190330fe44de6ff4767fc400cc10fa7cd6540/atomics/T1105/T1105.md\nauthor: frack113\ndate: 2022-08-28\nmodified: 2024-05-31\ntags:\n    - attack.command-and-control\n    - attack.t1105\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Initiated: 'true'\n        Image|endswith:\n            - '\\wscript.exe'\n            - '\\cscript.exe'\n        # Note: This list is added to avoid duplicate alerting with 992a6cae-db6a-43c8-9cec-76d7195c96fc\n        DestinationIp|cidr:\n            - '127.0.0.0/8'\n            - '10.0.0.0/8'\n            - '172.16.0.0/12'\n            - '192.168.0.0/16'\n            - '169.254.0.0/16'\n            - '::1/128'  # IPv6 loopback\n            - 'fe80::/10'  # IPv6 link-local addresses\n            - 'fc00::/7'  # IPv6 private addresses\n    condition: selection\nfalsepositives:\n    - Legitimate scripts\nlevel: medium\n"},{"path":"network_connection\\net_connection_win_wordpad_uncommon_ports.yml","content":"title: Suspicious Wordpad Outbound Connections\nid: 786cdae8-fefb-4eb2-9227-04e34060db01\nstatus: test\ndescription: |\n    Detects a network connection initiated by \"wordpad.exe\" over uncommon destination ports.\n    This might indicate potential process injection activity from a beacon or similar mechanisms.\nreferences:\n    - https://blogs.blackberry.com/en/2023/07/romcom-targets-ukraine-nato-membership-talks-at-nato-summit\nauthor: X__Junior (Nextron Systems)\ndate: 2023-07-12\nmodified: 2023-12-15\ntags:\n    - attack.defense-evasion\n    - attack.command-and-control\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Initiated: 'true'\n        Image|endswith: '\\wordpad.exe'\n    filter_main_ports:\n        DestinationPort:\n            - 80\n            - 139\n            - 443\n            - 445\n            - 465\n            - 587\n            - 993\n            - 995\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Other ports can be used, apply additional filters accordingly\nlevel: medium\n"},{"path":"network_connection\\net_connection_win_winlogon_net_connections.yml","content":"title: Outbound Network Connection To Public IP Via Winlogon\nid: 7610a4ea-c06d-495f-a2ac-0a696abcfd3b\nstatus: test\ndescription: Detects a \"winlogon.exe\" process that initiate network communications with public IP addresses\nreferences:\n    - https://www.microsoft.com/en-us/security/blog/2023/04/11/guidance-for-investigating-attacks-using-cve-2022-21894-the-blacklotus-campaign/\nauthor: Christopher Peacock @securepeacock, SCYTHE @scythe_io\ndate: 2023-04-28\nmodified: 2024-03-12\ntags:\n    - attack.defense-evasion\n    - attack.execution\n    - attack.command-and-control\n    - attack.t1218.011\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Image|endswith: '\\winlogon.exe'\n        Initiated: 'true'\n    filter_main_local_ranges:\n        DestinationIp|cidr:\n            - '127.0.0.0/8'\n            - '10.0.0.0/8'\n            - '172.16.0.0/12'\n            - '192.168.0.0/16'\n            - '169.254.0.0/16'\n            - '::1/128'  # IPv6 loopback\n            - 'fe80::/10'  # IPv6 link-local addresses\n            - 'fc00::/7'  # IPv6 private addresses\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Communication to other corporate systems that use IP addresses from public address spaces\nlevel: medium\n"},{"path":"network_connection\\net_connection_win_susp_remote_powershell_session.yml","content":"title: Potential Remote PowerShell Session Initiated\nid: c539afac-c12a-46ed-b1bd-5a5567c9f045\nstatus: test\ndescription: |\n    Detects a process that initiated a network connection over ports 5985 or 5986 from a non-network service account.\n    This could potentially indicates a remote PowerShell connection.\nreferences:\n    - https://threathunterplaybook.com/hunts/windows/190511-RemotePwshExecution/notebook.html\nauthor: Roberto Rodriguez @Cyb3rWard0g\ndate: 2019-09-12\nmodified: 2024-02-02\ntags:\n    - attack.execution\n    - attack.t1059.001\n    - attack.lateral-movement\n    - attack.t1021.006\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        DestinationPort:\n            - 5985\n            - 5986\n        Initiated: 'true' # only matches of the initiating system can be evaluated\n        SourceIsIpv6: 'false'\n    filter_main_service_users:\n        - User|contains: # covers many language settings for Network Service. Please expand\n              - 'NETWORK SERVICE'\n              - 'NETZWERKDIENST'\n              - 'SERVICIO DE RED'\n              - 'SERVIZIO DI RETE'\n        - User|contains|all:\n              - 'SERVICE R'\n              - 'SEAU'\n    filter_main_localhost:\n        SourceIp:\n            - '::1'\n            - '127.0.0.1'\n        DestinationIp:\n            - '::1'\n            - '127.0.0.1'\n    filter_optional_avast:\n        Image:\n            - 'C:\\Program Files\\Avast Software\\Avast\\AvastSvc.exe'\n            - 'C:\\Program Files (x86)\\Avast Software\\Avast\\AvastSvc.exe'\n    condition: selection and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Legitimate usage of remote PowerShell, e.g. remote administration and monitoring.\n    - Network Service user name of a not-covered localization\nlevel: high\n"},{"path":"network_connection\\net_connection_win_susp_outbound_smtp_connections.yml","content":"title: Suspicious Outbound SMTP Connections\nid: 9976fa64-2804-423c-8a5b-646ade840773\nstatus: test\ndescription: |\n    Adversaries may steal data by exfiltrating it over an un-encrypted network protocol other than that of the existing command and control channel.\n    The data may also be sent to an alternate network location from the main command and control server.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1048.003/T1048.003.md#atomic-test-5---exfiltration-over-alternative-protocol---smtp\n    - https://www.ietf.org/rfc/rfc2821.txt\nauthor: frack113\ndate: 2022-01-07\nmodified: 2022-09-21\ntags:\n    - attack.exfiltration\n    - attack.t1048.003\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        DestinationPort:\n            - 25\n            - 587\n            - 465\n            - 2525\n        Initiated: 'true'\n    filter_clients:\n        Image|endswith:\n            - \\thunderbird.exe\n            - \\outlook.exe\n    filter_mailserver:\n        Image|startswith: 'C:\\Program Files\\Microsoft\\Exchange Server\\'\n    filter_outlook:\n        Image|startswith: 'C:\\Program Files\\WindowsApps\\microsoft.windowscommunicationsapps_'\n        Image|endswith: '\\HxTsr.exe'\n    condition: selection and not 1 of filter_*\nfalsepositives:\n    - Other SMTP tools\nlevel: medium\n"},{"path":"network_connection\\net_connection_win_susp_outbound_mobsync_connection.yml","content":"title: Microsoft Sync Center Suspicious Network Connections\nid: 9f2cc74d-78af-4eb2-bb64-9cd1d292b87b\nstatus: test\ndescription: Detects suspicious connections from Microsoft Sync Center to non-private IPs.\nreferences:\n    - https://redcanary.com/blog/intelligence-insights-november-2021/\nauthor: elhoim\ndate: 2022-04-28\nmodified: 2024-03-12\ntags:\n    - attack.privilege-escalation\n    - attack.t1055\n    - attack.t1218\n    - attack.execution\n    - attack.defense-evasion\nlogsource:\n    product: windows\n    category: network_connection\ndetection:\n    selection:\n        Image|endswith: '\\mobsync.exe'\n    filter_main_local_ranges:\n        DestinationIp|cidr:\n            - '127.0.0.0/8'\n            - '10.0.0.0/8'\n            - '172.16.0.0/12'\n            - '192.168.0.0/16'\n            - '169.254.0.0/16'\n            - '::1/128'  # IPv6 loopback\n            - 'fe80::/10'  # IPv6 link-local addresses\n            - 'fc00::/7'  # IPv6 private addresses\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"network_connection\\net_connection_win_susp_outbound_kerberos_connection.yml","content":"title: Uncommon Outbound Kerberos Connection\nid: e54979bd-c5f9-4d6c-967b-a04b19ac4c74\nrelated:\n    - id: eca91c7c-9214-47b9-b4c5-cb1d7e4f2350\n      type: similar\nstatus: test\ndescription: |\n    Detects uncommon outbound network activity via Kerberos default port indicating possible lateral movement or first stage PrivEsc via delegation.\nreferences:\n    - https://github.com/GhostPack/Rubeus\nauthor: Ilyas Ochkov, oscd.community\ndate: 2019-10-24\nmodified: 2024-03-15\ntags:\n    - attack.defense-evasion\n    - attack.credential-access\n    - attack.t1558\n    - attack.lateral-movement\n    - attack.t1550.003\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        DestinationPort: 88\n        Initiated: 'true'\n    filter_main_lsass:\n        Image: 'C:\\Windows\\System32\\lsass.exe'\n    filter_optional_chrome:\n        Image:\n            - 'C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe'\n            - 'C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe'\n    filter_optional_firefox:\n        Image:\n            - 'C:\\Program Files (x86)\\Mozilla Firefox\\firefox.exe'\n            - 'C:\\Program Files\\Mozilla Firefox\\firefox.exe'\n    filter_optional_tomcat:\n        Image|endswith: '\\tomcat\\bin\\tomcat8.exe'\n    condition: selection and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Web Browsers and third party application might generate similar activity. An initial baseline is required.\nlevel: medium\n"},{"path":"network_connection\\net_connection_win_susp_malware_callback_ports_uncommon.yml","content":"title: Communication To Uncommon Destination Ports\nid: 6d8c3d20-a5e1-494f-8412-4571d716cf5c\nrelated:\n    - id: 4b89abaa-99fe-4232-afdd-8f9aa4d20382\n      type: similar\nstatus: test\ndescription: Detects programs that connect to uncommon destination ports\nreferences:\n    - https://docs.google.com/spreadsheets/d/17pSTDNpa0sf6pHeRhusvWG6rThciE8CsXTSlDUAZDyo\nauthor: Florian Roth (Nextron Systems)\ndate: 2017-03-19\nmodified: 2024-03-12\ntags:\n    - attack.persistence\n    - attack.command-and-control\n    - attack.t1571\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Initiated: 'true'\n        DestinationPort:\n            - 8080\n            - 8888\n    filter_main_local_ranges:\n        DestinationIp|cidr:\n            - '127.0.0.0/8'\n            - '10.0.0.0/8'\n            - '172.16.0.0/12'\n            - '192.168.0.0/16'\n            - '169.254.0.0/16'\n            - '::1/128'  # IPv6 loopback\n            - 'fe80::/10'  # IPv6 link-local addresses\n            - 'fc00::/7'  # IPv6 private addresses\n    filter_optional_sys_directories:\n        Image|startswith:\n            - 'C:\\Program Files\\'\n            - 'C:\\Program Files (x86)\\'\n    condition: selection and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"network_connection\\net_connection_win_susp_malware_callback_port.yml","content":"title: Potentially Suspicious Malware Callback Communication\nid: 4b89abaa-99fe-4232-afdd-8f9aa4d20382\nrelated:\n    - id: 6d8c3d20-a5e1-494f-8412-4571d716cf5c\n      type: similar\nstatus: test\ndescription: |\n    Detects programs that connect to known malware callback ports based on statistical analysis from two different sandbox system databases\nreferences:\n    - https://docs.google.com/spreadsheets/d/17pSTDNpa0sf6pHeRhusvWG6rThciE8CsXTSlDUAZDyo\nauthor: Florian Roth (Nextron Systems)\ndate: 2017-03-19\nmodified: 2024-03-12\ntags:\n    - attack.persistence\n    - attack.command-and-control\n    - attack.t1571\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Initiated: 'true'\n        DestinationPort:\n            - 100\n            - 198\n            - 200\n            - 243\n            - 473\n            - 666\n            - 700\n            - 743\n            - 777\n            - 1443\n            - 1515\n            - 1777\n            - 1817\n            - 1904\n            - 1960\n            - 2443\n            - 2448\n            - 3360\n            - 3675\n            - 3939\n            - 4040\n            - 4433\n            - 4438\n            - 4443\n            - 4444\n            - 4455\n            - 5445\n            - 5552\n            - 5649\n            - 6625\n            - 7210\n            - 7777\n            - 8143\n            - 8843\n            - 9631\n            - 9943\n            - 10101\n            - 12102\n            - 12103\n            - 12322\n            - 13145\n            - 13394\n            - 13504\n            - 13505\n            - 13506\n            - 13507\n            - 14102\n            - 14103\n            - 14154\n            - 49180\n            - 65520\n            - 65535\n    filter_main_local_ranges:\n        DestinationIp|cidr:\n            - '127.0.0.0/8'\n            - '10.0.0.0/8'\n            - '172.16.0.0/12'\n            - '192.168.0.0/16'\n            - '169.254.0.0/16'\n            - '::1/128'  # IPv6 loopback\n            - 'fe80::/10'  # IPv6 link-local addresses\n            - 'fc00::/7'  # IPv6 private addresses\n    filter_optional_sys_directories:\n        Image|startswith:\n            - 'C:\\Program Files\\'\n            - 'C:\\Program Files (x86)\\'\n    condition: selection and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"network_connection\\net_connection_win_susp_initiated_uncommon_or_suspicious_locations.yml","content":"title: Network Connection Initiated From Process Located In Potentially Suspicious Or Uncommon Location\nid: 7b434893-c57d-4f41-908d-6a17bf1ae98f\nstatus: test\ndescription: |\n    Detects a network connection initiated by programs or processes running from suspicious or uncommon files system locations.\nreferences:\n    - https://docs.google.com/spreadsheets/d/17pSTDNpa0sf6pHeRhusvWG6rThciE8CsXTSlDUAZDyo\nauthor: Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)\ndate: 2017-03-19\nmodified: 2024-08-22\ntags:\n    - attack.command-and-control\n    - attack.t1105\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Initiated: 'true'\n        Image|contains:\n            - ':\\$Recycle.bin'\n            - ':\\Perflogs\\'\n            - ':\\Temp\\'\n            - ':\\Users\\Default\\'\n            - ':\\Windows\\Fonts\\'\n            - ':\\Windows\\IME\\'\n            - ':\\Windows\\System32\\Tasks\\'\n            - ':\\Windows\\Tasks\\'\n            - '\\config\\systemprofile\\'\n            - '\\Windows\\addins\\'\n    filter_main_domains:\n        # Note: We exclude these domains to avoid duplicate filtering from e0f8ab85-0ac9-423b-a73a-81b3c7b1aa97\n        DestinationHostname|endswith:\n            - '.githubusercontent.com'       # Includes both gists and github repositories / Michael Haag (idea)\n            - 'anonfiles.com'\n            - 'cdn.discordapp.com'\n            - 'ddns.net'\n            - 'dl.dropboxusercontent.com'\n            - 'ghostbin.co'\n            - 'glitch.me'\n            - 'gofile.io'\n            - 'hastebin.com'\n            - 'mediafire.com'\n            - 'mega.co.nz'\n            - 'mega.nz'\n            - 'onrender.com'\n            - 'pages.dev'\n            - 'paste.ee'\n            - 'pastebin.com'\n            - 'pastebin.pl'\n            - 'pastetext.net'\n            - 'portmap.io'  # https://pro.twitter.com/JaromirHorejsi/status/1795001037746761892/photo/2\n            - 'privatlab.com'\n            - 'privatlab.net'\n            - 'send.exploit.in'\n            - 'sendspace.com'\n            - 'storage.googleapis.com'\n            - 'storjshare.io'\n            - 'supabase.co'\n            - 'temp.sh'\n            - 'transfer.sh'\n            - 'trycloudflare.com'\n            - 'ufile.io'\n            - 'w3spaces.com'\n            - 'workers.dev'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"network_connection\\net_connection_win_susp_file_sharing_domains_susp_folders.yml","content":"title: Network Communication Initiated To File Sharing Domains From Process Located In Suspicious Folder\nid: e0f8ab85-0ac9-423b-a73a-81b3c7b1aa97\nrelated:\n    - id: 635dbb88-67b3-4b41-9ea5-a3af2dd88153\n      type: obsolete\nstatus: test\ndescription: Detects executables located in potentially suspicious directories initiating network connections towards file sharing domains.\nreferences:\n    - https://twitter.com/M_haggis/status/900741347035889665\n    - https://twitter.com/M_haggis/status/1032799638213066752\n    - https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/ransomware-hive-conti-avoslocker\n    - https://www.cisa.gov/uscert/ncas/alerts/aa22-321a\n    - https://github.com/EmpireProject/Empire/blob/e37fb2eef8ff8f5a0a689f1589f424906fe13055/data/module_source/exfil/Invoke-ExfilDataToGitHub.ps1\nauthor: Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)\ndate: 2018-08-30\nmodified: 2024-10-21\ntags:\n    - attack.command-and-control\n    - attack.t1105\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection_paths:\n        Image|contains:\n            - ':\\$Recycle.bin'\n            - ':\\Perflogs\\'\n            - ':\\Temp\\'\n            - ':\\Users\\Default\\'\n            - ':\\Users\\Public\\'\n            - ':\\Windows\\Fonts\\'\n            - ':\\Windows\\IME\\'\n            - ':\\Windows\\System32\\Tasks\\'\n            - ':\\Windows\\Tasks\\'\n            - ':\\Windows\\Temp\\'\n            - '\\AppData\\Temp\\'\n            - '\\config\\systemprofile\\'\n            - '\\Windows\\addins\\'\n    selection_domains:\n        Initiated: 'true'\n        DestinationHostname|endswith:\n            - '.githubusercontent.com'       # Includes both gists and github repositories / Michael Haag (idea)\n            - 'anonfiles.com'\n            - 'cdn.discordapp.com'\n            - 'ddns.net'\n            - 'dl.dropboxusercontent.com'\n            - 'ghostbin.co'\n            - 'glitch.me'\n            - 'gofile.io'\n            - 'hastebin.com'\n            - 'mediafire.com'\n            - 'mega.co.nz'\n            - 'mega.nz'\n            - 'onrender.com'\n            - 'pages.dev'\n            - 'paste.ee'\n            - 'pastebin.com'\n            - 'pastebin.pl'\n            - 'pastetext.net'\n            - 'pixeldrain.com'\n            - 'privatlab.com'\n            - 'privatlab.net'\n            - 'send.exploit.in'\n            - 'sendspace.com'\n            - 'storage.googleapis.com'\n            - 'storjshare.io'\n            - 'supabase.co'\n            - 'temp.sh'\n            - 'transfer.sh'\n            - 'trycloudflare.com'\n            - 'ufile.io'\n            - 'w3spaces.com'\n            - 'workers.dev'\n    condition: all of selection_*\nfalsepositives:\n    - Some installers located in the temp directory might communicate with the Github domains in order to download additional software. Baseline these cases or move the github domain to a lower level hunting rule.\nlevel: high\n"},{"path":"network_connection\\net_connection_win_susp_binary_no_cmdline.yml","content":"title: Suspicious Network Connection Binary No CommandLine\nid: 20384606-a124-4fec-acbb-8bd373728613\nstatus: test\ndescription: Detects suspicious network connections made by a well-known Windows binary run with no command line parameters\nreferences:\n    - https://redcanary.com/blog/raspberry-robin/\nauthor: Florian Roth (Nextron Systems)\ndate: 2022-07-03\ntags:\n    - attack.defense-evasion\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Initiated: 'true'\n        Image|endswith:\n            - '\\regsvr32.exe'\n            - '\\rundll32.exe'\n            - '\\dllhost.exe'\n        CommandLine|endswith:\n            - '\\regsvr32.exe'\n            - '\\rundll32.exe'\n            - '\\dllhost.exe'\n    filter_no_cmdline:\n        CommandLine: ''\n    filter_null: # e.g. Sysmon has no CommandLine field in network events with ID 3\n        CommandLine: null\n    condition: selection and not 1 of filter*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"network_connection\\net_connection_win_silenttrinity_stager_msbuild_activity.yml","content":"title: Silenttrinity Stager Msbuild Activity\nid: 50e54b8d-ad73-43f8-96a1-5191685b17a4\nstatus: test\ndescription: Detects a possible remote connections to Silenttrinity c2\nreferences:\n    - https://www.blackhillsinfosec.com/my-first-joyride-with-silenttrinity/\nauthor: Kiran kumar s, oscd.community\ndate: 2020-10-11\nmodified: 2022-10-05\ntags:\n    - attack.execution\n    - attack.defense-evasion\n    - attack.t1127.001\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Image|endswith: '\\msbuild.exe'\n    filter:\n        DestinationPort:\n            - 80\n            - 443\n        Initiated: 'true'\n    condition: selection and filter\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"network_connection\\net_connection_win_rundll32_net_connections.yml","content":"title: Rundll32 Internet Connection\nid: cdc8da7d-c303-42f8-b08c-b4ab47230263\nstatus: test\ndescription: Detects a rundll32 that communicates with public IP addresses\nreferences:\n    - https://www.hybrid-analysis.com/sample/759fb4c0091a78c5ee035715afe3084686a8493f39014aea72dae36869de9ff6?environmentId=100\nauthor: Florian Roth (Nextron Systems)\ndate: 2017-11-04\nmodified: 2024-03-13\ntags:\n    - attack.defense-evasion\n    - attack.t1218.011\n    - attack.execution\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Image|endswith: '\\rundll32.exe'\n        Initiated: 'true'\n    filter_main_local_ranges:\n        DestinationIp|cidr:\n            - '127.0.0.0/8'\n            - '10.0.0.0/8'\n            - '172.16.0.0/12'\n            - '192.168.0.0/16'\n            - '169.254.0.0/16'\n            - '::1/128'  # IPv6 loopback\n            - 'fe80::/10'  # IPv6 link-local addresses\n            - 'fc00::/7'  # IPv6 private addresses\n    filter_main_ms_ranges:\n        DestinationIp|cidr:\n            - '20.0.0.0/8' # Microsoft range, caused some FPs\n            - '51.103.0.0/16' # Microsoft AS8075 range, caused some FPs\n            - '51.104.0.0/16' # Microsoft AS8075 range, caused some FPs\n            - '51.105.0.0/16' # Microsoft AS8075 range, caused some FPs\n    filter_main_app_sdb:\n        CommandLine|endswith: '\\system32\\PcaSvc.dll,PcaPatchSdbTask'\n    filter_main_azure_managed:\n        SourceHostname|endswith: '.internal.cloudapp.net'\n    filter_main_svchost_update_processes:\n        # Note: This require \"ParentImage\" data enrichment.\n        ParentImage: 'C:\\Windows\\System32\\svchost.exe'\n        DestinationPort: 443\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Communication to other corporate systems that use IP addresses from public address spaces\nlevel: medium\n"},{"path":"network_connection\\net_connection_win_remote_access_tools_anydesk_incoming_connection.yml","content":"title: Remote Access Tool - AnyDesk Incoming Connection\nid: d58ba5c6-0ed7-4b9d-a433-6878379efda9\nstatus: experimental\ndescription: |\n    Detects incoming connections to AnyDesk. This could indicate a potential remote attacker trying to connect to a listening instance of AnyDesk and use it as potential command and control channel.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1219/T1219.md#atomic-test-2---anydesk-files-detected-test-on-windows\n    - https://asec.ahnlab.com/en/40263/\nauthor: '@d4ns4n_ (Wuerth-Phoenix)'\ndate: 2024-09-02\nmodified: 2025-02-24\ntags:\n    - attack.persistence\n    - attack.command-and-control\n    - attack.t1219.002\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Image|endswith:\n            - '\\AnyDesk.exe'\n            - '\\AnyDeskMSI.exe'\n        Initiated: 'false' # If the network connection is initiated remotely (incoming), the field is set to false.\n    condition: selection\nfalsepositives:\n    - Legitimate incoming connections (e.g. sysadmin activity). Most of the time I would expect outgoing connections (initiated locally).\nlevel: medium\n"},{"path":"network_connection\\net_connection_win_regsvr32_network_activity.yml","content":"title: Network Connection Initiated By Regsvr32.EXE\nid: c7e91a02-d771-4a6d-a700-42587e0b1095\nstatus: test\ndescription: Detects a network connection initiated by \"Regsvr32.exe\"\nreferences:\n    - https://pentestlab.blog/2017/05/11/applocker-bypass-regsvr32/\n    - https://oddvar.moe/2017/12/13/applocker-case-study-how-insecure-is-it-really-part-1/\nauthor: Dmitriy Lifanov, oscd.community\ndate: 2019-10-25\nmodified: 2023-09-18\ntags:\n    - attack.execution\n    - attack.t1559.001\n    - attack.defense-evasion\n    - attack.t1218.010\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Initiated: 'true'\n        Image|endswith: '\\regsvr32.exe'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"network_connection\\net_connection_win_regasm_network_activity.yml","content":"title: RegAsm.EXE Initiating Network Connection To Public IP\nid: 0531e43a-d77d-47c2-b89f-5fe50321c805\nstatus: test\ndescription: Detects \"RegAsm.exe\" initiating a network connection to public IP adresses\nreferences:\n    - https://app.any.run/tasks/ec207948-4916-47eb-a0f4-4c6abb2e7668/\n    - https://research.splunk.com/endpoint/07921114-6db4-4e2e-ae58-3ea8a52ae93f/\n    - https://lolbas-project.github.io/lolbas/Binaries/Regasm/\nauthor: frack113\ndate: 2024-04-25\ntags:\n    - attack.defense-evasion\n    - attack.t1218.009\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Initiated: 'true'\n        Image|endswith: '\\regasm.exe'\n    filter_main_local_ranges:\n        DestinationIp|cidr:\n            - '127.0.0.0/8'\n            - '10.0.0.0/8'\n            - '172.16.0.0/12'\n            - '192.168.0.0/16'\n            - '169.254.0.0/16'\n            - '::1/128'  # IPv6 loopback\n            - 'fe80::/10'  # IPv6 link-local addresses\n            - 'fc00::/7'  # IPv6 private addresses\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"network_connection\\net_connection_win_rdp_to_http.yml","content":"title: RDP to HTTP or HTTPS Target Ports\nid: b1e5da3b-ca8e-4adf-915c-9921f3d85481\nstatus: test\ndescription: Detects svchost hosting RDP termsvcs communicating to target systems on TCP port 80 or 443\nreferences:\n    - https://twitter.com/tekdefense/status/1519711183162556416?s=12&t=OTsHCBkQOTNs1k3USz65Zg\n    - https://www.mandiant.com/resources/bypassing-network-restrictions-through-rdp-tunneling\nauthor: Florian Roth (Nextron Systems)\ndate: 2022-04-29\nmodified: 2022-07-14\ntags:\n    - attack.command-and-control\n    - attack.t1572\n    - attack.lateral-movement\n    - attack.t1021.001\n    - car.2013-07-002\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Image|endswith: '\\svchost.exe'\n        Initiated: 'true'\n        SourcePort: 3389\n        DestinationPort:\n            - 80\n            - 443\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"network_connection\\net_connection_win_rdp_reverse_tunnel.yml","content":"title: RDP Over Reverse SSH Tunnel\nid: 5f699bc5-5446-4a4a-a0b7-5ef2885a3eb4\nstatus: test\ndescription: Detects svchost hosting RDP termsvcs communicating with the loopback address and on TCP port 3389\nreferences:\n    - https://twitter.com/cyb3rops/status/1096842275437625346\nauthor: Samir Bousseaden\ndate: 2019-02-16\nmodified: 2024-03-12\ntags:\n    - attack.command-and-control\n    - attack.t1572\n    - attack.lateral-movement\n    - attack.t1021.001\n    - car.2013-07-002\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection_img:\n        Image|endswith: '\\svchost.exe'\n        Initiated: 'true'\n        SourcePort: 3389\n    selection_destination:\n        DestinationIp|cidr:\n            - '127.0.0.0/8'\n            - '::1/128'\n    condition: all of selection_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"network_connection\\net_connection_win_rdp_outbound_over_non_standard_tools.yml","content":"title: Outbound RDP Connections Over Non-Standard Tools\nid: ed74fe75-7594-4b4b-ae38-e38e3fd2eb23\nstatus: test\ndescription: |\n    Detects Non-Standard tools initiating a connection over port 3389 indicating possible lateral movement.\n    An initial baseline is required before using this utility to exclude third party RDP tooling that you might use.\nreferences:\n    - https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-0708\nauthor: Markus Neis\ndate: 2019-05-15\nmodified: 2024-02-09\ntags:\n    - attack.lateral-movement\n    - attack.t1021.001\n    - car.2013-07-002\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        DestinationPort: 3389\n        Initiated: 'true'\n    filter_main_mstsc:\n        Image:\n            - 'C:\\Windows\\System32\\mstsc.exe'\n            - 'C:\\Windows\\SysWOW64\\mstsc.exe'\n    filter_optional_dns:\n        # Note: https://github.com/SigmaHQ/sigma/pull/2249\n        Image: 'C:\\Windows\\System32\\dns.exe'\n        SourcePort: 53\n        Protocol: 'udp'\n    filter_optional_avast:\n        Image|endswith:\n            - '\\Avast Software\\Avast\\AvastSvc.exe'\n            - '\\Avast\\AvastSvc.exe'\n    filter_optional_sysinternals_rdcman:\n        Image|endswith: '\\RDCMan.exe'\n    filter_optional_chrome:\n        Image: 'C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe'\n    filter_optional_third_party:\n        Image|endswith:\n            - '\\FSAssessment.exe'\n            - '\\FSDiscovery.exe'\n            - '\\MobaRTE.exe'\n            - '\\mRemote.exe'\n            - '\\mRemoteNG.exe'\n            - '\\Passwordstate.exe'\n            - '\\RemoteDesktopManager.exe'\n            - '\\RemoteDesktopManager64.exe'\n            - '\\RemoteDesktopManagerFree.exe'\n            - '\\RSSensor.exe'\n            - '\\RTS2App.exe'\n            - '\\RTSApp.exe'\n            - '\\spiceworks-finder.exe'\n            - '\\Terminals.exe'\n            - '\\ws_TunnelService.exe'\n    filter_optional_thor:\n        Image|endswith:\n            - '\\thor.exe'\n            - '\\thor64.exe'\n    filter_optional_splunk:\n        Image|startswith: 'C:\\Program Files\\SplunkUniversalForwarder\\bin\\'\n    filter_optional_sentinel_one:\n        Image|endswith: '\\Ranger\\SentinelRanger.exe'\n    filter_optional_firefox:\n        Image: 'C:\\Program Files\\Mozilla Firefox\\firefox.exe'\n    filter_optional_tsplus:  # Some RAS\n        Image:\n            - 'C:\\Program Files\\TSplus\\Java\\bin\\HTML5service.exe'\n            - 'C:\\Program Files (x86)\\TSplus\\Java\\bin\\HTML5service.exe'\n    filter_optional_null:\n        Image: null\n    filter_optional_empty:\n        Image: ''\n    filter_optional_unknown:\n        Image: '<unknown process>'\n    condition: selection and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Third party RDP tools\nlevel: high\n"},{"path":"network_connection\\net_connection_win_python.yml","content":"title: Python Initiated Connection\nid: bef0bc5a-b9ae-425d-85c6-7b2d705980c6\nstatus: test\ndescription: Detects a Python process initiating a network connection. While this often relates to package installation, it can also indicate a potential malicious script communicating with a C&C server.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1046/T1046.md#atomic-test-4---port-scan-using-python\n    - https://pypi.org/project/scapy/\nauthor: frack113\ndate: 2021-12-10\nmodified: 2025-03-05\ntags:\n    - attack.discovery\n    - attack.t1046\nlogsource:\n    category: network_connection\n    product: windows\n    definition: 'Requirements: Field enrichment is required for the filters to work. As field such as CommandLine and ParentImage are not available by default on this event type'\ndetection:\n    selection:\n        Initiated: 'true'\n        Image|contains|all:\n            - '\\python'\n            - '.exe'\n    filter_optional_conda:\n        # Related to anaconda updates. Command example: \"conda update conda\"\n        # This filter will only work with aurora agent enriched data as Sysmon EID 3 doesn't contain CommandLine nor ParentImage\n        ParentImage: C:\\ProgramData\\Anaconda3\\Scripts\\conda.exe\n        CommandLine|contains|all:\n            - ':\\ProgramData\\Anaconda3\\Scripts\\conda-script.py'\n            - 'update'\n    filter_optional_conda_jupyter_notebook:\n        # Related to anaconda opening an instance of Jupyter Notebook\n        # This filter will only work with aurora agent enriched data as Sysmon EID 3 doesn't contain CommandLine nor ParentImage\n        ParentImage: C:\\ProgramData\\Anaconda3\\python.exe\n        CommandLine|contains: 'C:\\ProgramData\\Anaconda3\\Scripts\\jupyter-notebook-script.py'\n    filter_main_local_communication:\n        # This could be caused when launching an instance of Jupyter Notebook locally for example but can also be caused by other instances of python opening sockets locally etc. So comment this out if you want to monitor for those instances\n        DestinationIp: 127.0.0.1\n        SourceIp: 127.0.0.1\n    filter_main_pip:\n        CommandLine|contains|all:\n            - 'pip.exe'\n            - 'install'\n    condition: selection and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Legitimate python scripts using the socket library or similar will trigger this. Apply additional filters and perform an initial baseline before deploying.\nlevel: medium\n"},{"path":"network_connection\\net_connection_win_office_uncommon_ports.yml","content":"title: Office Application Initiated Network Connection Over Uncommon Ports\nid: 3b5ba899-9842-4bc2-acc2-12308498bf42\nstatus: test\ndescription: Detects an office suit application (Word, Excel, PowerPoint, Outlook) communicating to target systems over uncommon ports.\nreferences:\n    - https://blogs.blackberry.com/en/2023/07/romcom-targets-ukraine-nato-membership-talks-at-nato-summit\nauthor: X__Junior (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-07-12\nmodified: 2025-10-17\ntags:\n    - attack.defense-evasion\n    - attack.command-and-control\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Initiated: 'true'\n        Image|endswith:\n            - '\\excel.exe'\n            - '\\outlook.exe'\n            - '\\powerpnt.exe'\n            - '\\winword.exe'\n            - '\\wordview.exe'\n    filter_main_common_ports:\n        DestinationPort:\n            - 53 # DNS\n            - 80 # HTTP\n            - 139 # NETBIOS\n            - 389 # LDAP\n            - 443 # HTTPS\n            - 445 # SMB\n            - 3268 # MSFT-GC\n    filter_main_outlook_ports:\n        Image|contains: ':\\Program Files\\Microsoft Office\\'\n        Image|endswith: '\\OUTLOOK.EXE'\n        DestinationPort:\n            - 143\n            - 465 # SMTP\n            - 587 # SMTP\n            - 993 # IMAP\n            - 995 # POP3\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Other ports can be used, apply additional filters accordingly\nlevel: medium\n"},{"path":"network_connection\\net_connection_win_office_outbound_non_local_ip.yml","content":"title: Office Application Initiated Network Connection To Non-Local IP\nid: 75e33ce3-ae32-4dcc-9aa8-a2a3029d6f84\nstatus: test\ndescription: |\n    Detects an office application (Word, Excel, PowerPoint)  that initiate a network connection to a non-private IP addresses.\n    This rule aims to detect traffic similar to one seen exploited in CVE-2021-42292.\n    This rule will require an initial baseline and tuning that is specific to your organization.\nreferences:\n    - https://corelight.com/blog/detecting-cve-2021-42292\n    - https://learn.microsoft.com/de-de/microsoft-365/enterprise/urls-and-ip-address-ranges?view=o365-worldwide\nauthor: Christopher Peacock '@securepeacock', SCYTHE '@scythe_io', Florian Roth (Nextron Systems), Tim Shelton, Nasreddine Bencherchali (Nextron Systems)\ndate: 2021-11-10\nmodified: 2025-10-17\ntags:\n    - attack.execution\n    - attack.t1203\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Image|endswith:\n            - '\\excel.exe'\n            - '\\outlook.exe'\n            - '\\powerpnt.exe'\n            - '\\winword.exe'\n            - '\\wordview.exe'\n        Initiated: 'true'\n    filter_main_local_ranges:\n        DestinationIp|cidr:\n            - '127.0.0.0/8'\n            - '10.0.0.0/8'\n            - '172.16.0.0/12'\n            - '192.168.0.0/16'\n            - '169.254.0.0/16'\n            - '::1/128'  # IPv6 loopback\n            - 'fe80::/10'  # IPv6 link-local addresses\n            - 'fc00::/7'  # IPv6 private addresses\n    filter_main_msrange_generic:\n        DestinationIp|cidr:\n            - '2.16.56.0/23' # Akamai International B.V.\n            - '2.17.248.0/21' # Akamai International B.V.\n            - '13.107.240.0/21' # Microsoft Corporation\n            - '20.184.0.0/13' # Microsoft Corporation\n            - '23.61.224.0/20' # Akamai-AS\n            - '20.192.0.0/10' # Microsoft Corporation\n            - '23.72.0.0/13' # Akamai International B.V.\n            - '23.3.88.0/22' # Akamai-AS\n            - '23.216.132.0/22' # Akamai-AS\n            - '40.76.0.0/14' # Microsoft Corporation\n            - '51.10.0.0/15' # Microsoft Corporation\n            - '51.103.0.0/16' # Microsoft Corporation\n            - '51.104.0.0/15' # Microsoft Corporation\n            - '51.142.136.0/22' # Microsoft Corporation - https://ipinfo.io/AS8075/51.140.0.0/14-51.142.136.0/22\n            - '52.160.0.0/11' # Microsoft Corporation - https://ipinfo.io/AS8075/52.160.0.0/11\n            - '95.101.96.0/21' # Akamai-As\n            - '204.79.197.0/24' # Microsoft Corporation\n    filter_main_msrange_exchange_1:\n        # Exchange Online\n        # \"urls\": [\n        #       \"outlook.cloud.microsoft\",\n        #       \"outlook.office.com\",\n        #       \"outlook.office365.com\"\n        # ]\n        DestinationIp|cidr:\n            - '13.107.4.0/22'\n            - '13.107.6.152/31'\n            - '13.107.18.10/31'\n            - '13.107.42.0/23'\n            - '13.107.128.0/22'\n            - '23.35.224.0/20'\n            - '23.53.40.0/22'\n            - '23.103.160.0/20'\n            - '23.216.76.0/22'\n            - '40.96.0.0/13'\n            - '40.104.0.0/15'\n            - '52.96.0.0/14'\n            - '131.253.33.215/32'\n            - '132.245.0.0/16'\n            - '150.171.32.0/22'\n            - '204.79.197.215/32'\n            - '2603:1006::/40'\n            - '2603:1016::/36'\n            - '2603:1026::/36'\n            - '2603:1036::/36'\n            - '2603:1046::/36'\n            - '2603:1056::/36'\n            - '2620:1ec:4::152/128'\n            - '2620:1ec:4::153/128'\n            - '2620:1ec:c::10/128'\n            - '2620:1ec:c::11/128'\n            - '2620:1ec:d::10/128'\n            - '2620:1ec:d::11/128'\n            - '2620:1ec:8f0::/46'\n            - '2620:1ec:900::/46'\n            - '2620:1ec:a92::152/128'\n            - '2620:1ec:a92::153/128'\n        DestinationPort:\n            - 80\n            - 443\n    filter_main_msrange_exchange_2:\n        # Exchange Online\n        # \"urls\": [\n        #       \"outlook.office365.com\",\n        #       \"smtp.office365.com\"\n        # ]\n        DestinationIp|cidr:\n            - '13.107.6.152/31'\n            - '13.107.18.10/31'\n            - '13.107.128.0/22'\n            - '23.103.160.0/20'\n            - '40.96.0.0/13'\n            - '40.104.0.0/15'\n            - '52.96.0.0/14'\n            - '131.253.33.215/32'\n            - '132.245.0.0/16'\n            - '150.171.32.0/22'\n            - '204.79.197.215/32'\n            - '2603:1006::/40'\n            - '2603:1016::/36'\n            - '2603:1026::/36'\n            - '2603:1036::/36'\n            - '2603:1046::/36'\n            - '2603:1056::/36'\n            - '2620:1ec:4::152/128'\n            - '2620:1ec:4::153/128'\n            - '2620:1ec:c::10/128'\n            - '2620:1ec:c::11/128'\n            - '2620:1ec:d::10/128'\n            - '2620:1ec:d::11/128'\n            - '2620:1ec:8f0::/46'\n            - '2620:1ec:900::/46'\n            - '2620:1ec:a92::152/128'\n            - '2620:1ec:a92::153/128'\n        DestinationPort:\n            - 143\n            - 587\n            - 993\n            - 995\n        Protocol: 'tcp'\n    filter_main_msrange_exchange_3:\n        # Exchange Online\n        # \"urls\": [\n        #       \"*.protection.outlook.com\"\n        #  ]\n        DestinationIp|cidr:\n            - '40.92.0.0/15'\n            - '40.107.0.0/16'\n            - '52.100.0.0/14'\n            - '52.238.78.88/32'\n            - '104.47.0.0/17'\n            - '2a01:111:f400::/48'\n            - '2a01:111:f403::/48'\n        DestinationPort: 443\n    filter_main_msrange_exchange_4:\n        # Exchange Online\n        # \"urls\": [\n        #       \"*.mail.protection.outlook.com\",\n        #       \"*.mx.microsoft\"\n        #  ]\n        DestinationIp|cidr:\n            - '40.92.0.0/15'\n            - '40.107.0.0/16'\n            - '52.100.0.0/14'\n            - '52.238.78.88/32'\n            - '104.47.0.0/17'\n            - '2a01:111:f400::/48'\n            - '2a01:111:f403::/48'\n        DestinationPort: 25\n    filter_main_msrange_sharepoint_1:\n        # SharePoint Online and OneDrive for Business\",\n        # \"urls\": [\n        #       \"*.sharepoint.com\"\n        # ]\n        DestinationIp|cidr:\n            - '13.107.136.0/22'\n            - '40.108.128.0/17'\n            - '52.104.0.0/14'\n            - '104.146.128.0/17'\n            - '150.171.40.0/22'\n            - '2603:1061:1300::/40'\n            - '2620:1ec:8f8::/46'\n            - '2620:1ec:908::/46'\n            - '2a01:111:f402::/48'\n        DestinationPort:\n            - 80\n            - 443\n        Protocol: 'tcp'\n    filter_main_msrange_office_1:\n        # Microsoft 365 Common and Office Online\",\n        # \"urls\": [\n        #       \"*.officeapps.live.com\",\n        #       \"*.online.office.com\",\n        #       \"office.live.com\",\n        #       \"office.com.akadns.net\"\n        # ],\n        DestinationIp|cidr:\n            - '13.107.6.171/32'\n            - '13.107.18.15/32'\n            - '13.107.140.6/32'\n            - '20.64.0.0/10'\n            - '52.108.0.0/14'\n            - '52.244.37.168/32'\n            - '2603:1006:1400::/40'\n            - '2603:1016:2400::/40'\n            - '2603:1026:2400::/40'\n            - '2603:1036:2400::/40'\n            - '2603:1046:1400::/40'\n            - '2603:1056:1400::/40'\n            - '2603:1063:2000::/38'\n            - '2620:1ec:c::15/128'\n            - '2620:1ec:8fc::6/128'\n            - '2620:1ec:a92::171/128'\n            - '2a01:111:f100:2000::a83e:3019/128'\n            - '2a01:111:f100:2002::8975:2d79/128'\n            - '2a01:111:f100:2002::8975:2da8/128'\n            - '2a01:111:f100:7000::6fdd:6cd5/128'\n            - '2a01:111:f100:a004::bfeb:88cf/128'\n        DestinationPort:\n            - 80\n            - 443\n        Protocol: 'tcp'\n    filter_main_msrange_office_2:\n        # Microsoft 365 Common and Office Online\n        # \"urls\": [\n        #       \"*.auth.microsoft.com\",\n        #       \"*.msftidentity.com\",\n        #       \"*.msidentity.com\",\n        #       \"account.activedirectory.windowsazure.com\",\n        #       \"accounts.accesscontrol.windows.net\",\n        #       \"adminwebservice.microsoftonline.com\",\n        #       \"api.passwordreset.microsoftonline.com\",\n        #       \"autologon.microsoftazuread-sso.com\",\n        #       \"becws.microsoftonline.com\",\n        #       \"ccs.login.microsoftonline.com\",\n        #       \"clientconfig.microsoftonline-p.net\",\n        #       \"cloudapp.azure.com\",\n        #       \"companymanager.microsoftonline.com\",\n        #       \"device.login.microsoftonline.com\",\n        #       \"graph.microsoft.com\",\n        #       \"graph.windows.net\",\n        #       \"login-us.microsoftonline.com\",\n        #       \"login.microsoft.com\",\n        #       \"login.microsoftonline-p.com\",\n        #       \"login.microsoftonline.com\",\n        #       \"login.windows.net\",\n        #       \"logincert.microsoftonline.com\",\n        #       \"loginex.microsoftonline.com\",\n        #       \"nexus.microsoftonline-p.com\",\n        #       \"passwordreset.microsoftonline.com\",\n        #       \"provisioningapi.microsoftonline.com\",\n        #       \"web.core.windows.net\",\n        # ]\n        DestinationIp|cidr:\n            - '172.128.0.0/10'\n            - '20.20.32.0/19'\n            - '20.103.156.88/32' # msn.com\n            - '20.190.128.0/18'\n            - '20.231.128.0/19'\n            - '40.126.0.0/18'\n            - '57.150.0.0/15'\n            - '2603:1006:2000::/48'\n            - '2603:1007:200::/48'\n            - '2603:1016:1400::/48'\n            - '2603:1017::/48'\n            - '2603:1026:3000::/48'\n            - '2603:1027:1::/48'\n            - '2603:1036:3000::/48'\n            - '2603:1037:1::/48'\n            - '2603:1046:2000::/48'\n            - '2603:1047:1::/48'\n            - '2603:1056:2000::/48'\n            - '2603:1057:2::/48'\n        DestinationPort:\n            - 80\n            - 443\n        Protocol: 'tcp'\n    filter_main_msrange_office_3:\n        # Microsoft 365 Common and Office Online\n        #  \"urls\": [\n        #       \"*.compliance.microsoft.com\",\n        #       \"*.data.microsoft.com\",\n        #       \"*.protection.office.com\",\n        #       \"*.security.microsoft.com\",\n        #       \"compliance.microsoft.com\",\n        #       \"defender.microsoft.com\",\n        #       \"protection.office.com\",\n        #       \"security.microsoft.com\",\n        #       \"teams.microsoft.com\",\n        #  ]\n        DestinationIp|cidr:\n            - '13.64.0.0/11'\n            - '13.107.6.192/32'\n            - '13.107.9.192/32'\n            - '13.89.179.14/32'\n            - '20.40.0.0/14'\n            - '20.48.0.0/12'\n            - '20.64.0.0/12'\n            - '52.123.0.0/16'\n            - '52.108.0.0/14'\n            - '52.136.0.0/13'\n            - '57.150.0.0/15'\n            - '80.239.150.67/32' # Arelion Sweden AB\n            - '2620:1ec:4::192/128'\n            - '2620:1ec:a92::192/128'\n        DestinationPort: 443\n        Protocol: 'tcp'\n    filter_main_destination_host:\n        DestinationHostname|endswith: '.deploy.static.akamaitechnologies.com'\n        DestinationPort: 443\n        Protocol: 'tcp'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - You may have to tune certain domains out that Excel may call out to, such as microsoft or other business use case domains.\n    - Office documents commonly have templates that refer to external addresses, like \"sharepoint.ourcompany.com\" may have to be tuned.\n    - It is highly recommended to baseline your activity and tune out common business use cases.\nlevel: medium\n"},{"path":"network_connection\\net_connection_win_notepad.yml","content":"title: Network Connection Initiated Via Notepad.EXE\nid: e81528db-fc02-45e8-8e98-4e84aba1f10b\nstatus: test\ndescription: |\n    Detects a network connection that is initiated by the \"notepad.exe\" process.\n    This might be a sign of process injection from a beacon process or something similar.\n    Notepad rarely initiates a network communication except when printing documents for example.\nreferences:\n    - https://web.archive.org/web/20200219102749/https://www.sans.org/cyber-security-summit/archives/file/summit-archive-1492186586.pdf\n    - https://www.cobaltstrike.com/blog/why-is-notepad-exe-connecting-to-the-internet\nauthor: EagleEye Team\ndate: 2020-05-14\nmodified: 2024-02-02\ntags:\n    - attack.privilege-escalation\n    - attack.command-and-control\n    - attack.execution\n    - attack.defense-evasion\n    - attack.t1055\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Image|endswith: '\\notepad.exe'\n    filter_optional_printing:\n        DestinationPort: 9100\n    condition: selection and not 1 of filter_optional_*\nfalsepositives:\n    - Printing documents via notepad might cause communication with the printer via port 9100 or similar.\nlevel: high\n"},{"path":"network_connection\\net_connection_win_imewdbld.yml","content":"title: Network Connection Initiated By IMEWDBLD.EXE\nid: 8d7e392e-9b28-49e1-831d-5949c6281228\nrelated:\n    - id: 863218bd-c7d0-4c52-80cd-0a96c09f54af\n      type: derived\nstatus: test\ndescription: |\n    Detects a network connection initiated by IMEWDBLD.EXE. This might indicate potential abuse of the utility as a LOLBIN in order to download arbitrary files or additional payloads.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1105/T1105.md#atomic-test-10---windows---powershell-download\n    - https://lolbas-project.github.io/lolbas/Binaries/IMEWDBLD/\nauthor: frack113\ndate: 2022-01-22\nmodified: 2023-11-09\ntags:\n    - attack.command-and-control\n    - attack.t1105\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Initiated: 'true'\n        Image|endswith: '\\IMEWDBLD.exe'\n    condition: selection\nfalsepositives:\n    - Unknown\n# Note: Please reduce this to medium if you find legitimate connections\nlevel: high\n"},{"path":"network_connection\\net_connection_win_finger.yml","content":"title: Network Connection Initiated via Finger.EXE\nid: 2fdaf50b-9fd5-449f-ba69-f17248119af6\nrelated:\n    - id: c082c2b0-525b-4dbc-9a26-a57dc4692074\n      type: similar\n    - id: af491bca-e752-4b44-9c86-df5680533dbc\n      type: similar\nstatus: experimental\ndescription: |\n    Detects network connections via finger.exe, which can be abused by threat actors to retrieve remote commands for execution on Windows devices.\n    In one ClickFix malware campaign, adversaries leveraged the finger protocol to fetch commands from a remote server.\n    Since the finger utility is not commonly used in modern Windows environments, its presence already raises suspicion.\n    Investigating such network connections can also help identify potential malicious infrastructure used by threat actors\nreferences:\n    - https://www.bleepingcomputer.com/news/security/decades-old-finger-protocol-abused-in-clickfix-malware-attacks/\nauthor: Swachchhanda Shrawan Poudel (Nextron Systems)\ndate: 2025-11-19\ntags:\n    - attack.command-and-control\n    - attack.t1071.004\n    - attack.execution\n    - attack.t1059.003\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Initiated: 'true'\n        Image|endswith: '\\finger.exe'\n    condition: selection\nfalsepositives:\n    - Unlikely\nlevel: high\n"},{"path":"network_connection\\net_connection_win_eqnedt.yml","content":"title: Network Connection Initiated By Eqnedt32.EXE\nid: a66bc059-c370-472c-a0d7-f8fd1bf9d583\nstatus: test\ndescription: Detects network connections from the Equation Editor process \"eqnedt32.exe\".\nreferences:\n    - https://twitter.com/forensicitguy/status/1513538712986079238\n    - https://forensicitguy.github.io/xloader-formbook-velvetsweatshop-spreadsheet/\n    - https://news.sophos.com/en-us/2019/07/18/a-new-equation-editor-exploit-goes-commercial-as-maldoc-attacks-using-it-spike/\nauthor: Max Altgelt (Nextron Systems)\ndate: 2022-04-14\nmodified: 2024-05-31\ntags:\n    - attack.execution\n    - attack.t1203\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Image|endswith: '\\eqnedt32.exe'\n    condition: selection\nfalsepositives:\n    - Unlikely\nlevel: high\n"},{"path":"network_connection\\net_connection_win_domain_vscode_tunnel_connection.yml","content":"title: Network Connection Initiated To Visual Studio Code Tunnels Domain\nid: 4b657234-038e-4ad5-997c-4be42340bce4\nrelated:\n    - id: 9501f8e6-8e3d-48fc-a8a6-1089dd5d7ef4 # Net Connection DevTunnels\n      type: similar\n    - id: b3e6418f-7c7a-4fad-993a-93b65027a9f1 # DNS VsCode\n      type: similar\n    - id: 1cb0c6ce-3d00-44fc-ab9c-6d6d577bf20b # DNS DevTunnels\n      type: similar\nstatus: test\ndescription: |\n    Detects network connections to Visual Studio Code tunnel domains initiated by a process on a system. Attackers can abuse that feature to establish a reverse shell or persistence on a machine.\nreferences:\n    - https://ipfyx.fr/post/visual-studio-code-tunnel/\n    - https://badoption.eu/blog/2023/01/31/code_c2.html\n    - https://cydefops.com/vscode-data-exfiltration\nauthor: Kamran Saifullah\ndate: 2023-11-20\ntags:\n    - attack.exfiltration\n    - attack.command-and-control\n    - attack.t1567\n    - attack.t1572\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Initiated: 'true'\n        DestinationHostname|endswith: '.tunnels.api.visualstudio.com'\n    condition: selection\nfalsepositives:\n    - Legitimate use of Visual Studio Code tunnel will also trigger this.\nlevel: medium\n"},{"path":"network_connection\\net_connection_win_domain_telegram_api_non_browser_access.yml","content":"title: Suspicious Non-Browser Network Communication With Telegram API\nid: c3dbbc9f-ef1d-470a-a90a-d343448d5875\nstatus: test\ndescription: Detects an a non-browser process interacting with the Telegram API which could indicate use of a covert C2\nreferences:\n    - https://www.ncsc.gov.uk/static-assets/documents/malware-analysis-reports/small-sieve/NCSC-MAR-Small-Sieve.pdf\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-05-19\ntags:\n    - attack.command-and-control\n    - attack.exfiltration\n    - attack.t1102\n    - attack.t1567\n    - attack.t1105\nlogsource:\n    product: windows\n    category: network_connection\ndetection:\n    selection:\n        DestinationHostname|contains: 'api.telegram.org'\n    # Other browsers or apps known to use telegram should be added\n    # TODO: Add full paths for default install locations\n    filter_main_brave:\n        Image|endswith: '\\brave.exe'\n    filter_main_chrome:\n        Image:\n            - 'C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe'\n            - 'C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe'\n    filter_main_firefox:\n        Image:\n            - 'C:\\Program Files\\Mozilla Firefox\\firefox.exe'\n            - 'C:\\Program Files (x86)\\Mozilla Firefox\\firefox.exe'\n    filter_main_ie:\n        Image:\n            - 'C:\\Program Files (x86)\\Internet Explorer\\iexplore.exe'\n            - 'C:\\Program Files\\Internet Explorer\\iexplore.exe'\n    filter_main_maxthon:\n        Image|endswith: '\\maxthon.exe'\n    filter_main_edge_1:\n        - Image|startswith: 'C:\\Program Files (x86)\\Microsoft\\EdgeWebView\\Application\\'\n        - Image|endswith: '\\WindowsApps\\MicrosoftEdge.exe'\n        - Image:\n              - 'C:\\Program Files (x86)\\Microsoft\\Edge\\Application\\msedge.exe'\n              - 'C:\\Program Files\\Microsoft\\Edge\\Application\\msedge.exe'\n    filter_main_edge_2:\n        Image|startswith:\n            - 'C:\\Program Files (x86)\\Microsoft\\EdgeCore\\'\n            - 'C:\\Program Files\\Microsoft\\EdgeCore\\'\n        Image|endswith:\n            - '\\msedge.exe'\n            - '\\msedgewebview2.exe'\n    filter_main_opera:\n        Image|endswith: '\\opera.exe'\n    filter_main_safari:\n        Image|endswith: '\\safari.exe'\n    filter_main_seamonkey:\n        Image|endswith: '\\seamonkey.exe'\n    filter_main_vivaldi:\n        Image|endswith: '\\vivaldi.exe'\n    filter_main_whale:\n        Image|endswith: '\\whale.exe'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Legitimate applications communicating with the Telegram API e.g. web browsers not in the exclusion list, app with an RSS  etc.\nlevel: medium\n"},{"path":"network_connection\\net_connection_win_domain_portmap.yml","content":"title: Network Communication Initiated To Portmap.IO Domain\nid: 07837ab9-60e1-481f-a74d-c31fb496a94c\nstatus: test\ndescription: Detects an executable accessing the portmap.io domain, which could be a sign of forbidden C2 traffic or data exfiltration by malicious actors\nreferences:\n    - https://portmap.io/\n    - https://github.com/rapid7/metasploit-framework/issues/11337\n    - https://pro.twitter.com/JaromirHorejsi/status/1795001037746761892/photo/2\nauthor: Florian Roth (Nextron Systems)\ndate: 2024-05-31\ntags:\n    - attack.t1041\n    - attack.command-and-control\n    - attack.t1090.002\n    - attack.exfiltration\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Initiated: 'true'\n        DestinationHostname|endswith: '.portmap.io'\n    condition: selection\nfalsepositives:\n    - Legitimate use of portmap.io domains\nlevel: medium\n"},{"path":"network_connection\\net_connection_win_domain_notion_api_susp_communication.yml","content":"title: Potentially Suspicious Network Connection To Notion API\nid: 7e9cf7b6-e827-11ed-a05b-15959c120003\nstatus: test\ndescription: Detects a non-browser process communicating with the Notion API. This could indicate potential use of a covert C2 channel such as \"OffensiveNotion C2\"\nreferences:\n    - https://github.com/mttaggart/OffensiveNotion\n    - https://medium.com/@huskyhacks.mk/we-put-a-c2-in-your-notetaking-app-offensivenotion-3e933bace332\nauthor: Gavin Knapp\ndate: 2023-05-03\ntags:\n    - attack.command-and-control\n    - attack.t1102\nlogsource:\n    product: windows\n    category: network_connection\ndetection:\n    selection:\n        DestinationHostname|contains: 'api.notion.com'\n    filter_main_notion:\n        Image|endswith: '\\AppData\\Local\\Programs\\Notion\\Notion.exe'\n    filter_main_brave:\n        Image|endswith: '\\brave.exe'\n    filter_main_chrome:\n        Image:\n            - 'C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe'\n            - 'C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe'\n    filter_main_firefox:\n        Image:\n            - 'C:\\Program Files\\Mozilla Firefox\\firefox.exe'\n            - 'C:\\Program Files (x86)\\Mozilla Firefox\\firefox.exe'\n    filter_main_ie:\n        Image:\n            - 'C:\\Program Files (x86)\\Internet Explorer\\iexplore.exe'\n            - 'C:\\Program Files\\Internet Explorer\\iexplore.exe'\n    filter_main_maxthon:\n        Image|endswith: '\\maxthon.exe'\n    filter_main_edge_1:\n        - Image|startswith: 'C:\\Program Files (x86)\\Microsoft\\EdgeWebView\\Application\\'\n        - Image|endswith: '\\WindowsApps\\MicrosoftEdge.exe'\n        - Image:\n              - 'C:\\Program Files (x86)\\Microsoft\\Edge\\Application\\msedge.exe'\n              - 'C:\\Program Files\\Microsoft\\Edge\\Application\\msedge.exe'\n    filter_main_edge_2:\n        Image|startswith:\n            - 'C:\\Program Files (x86)\\Microsoft\\EdgeCore\\'\n            - 'C:\\Program Files\\Microsoft\\EdgeCore\\'\n        Image|endswith:\n            - '\\msedge.exe'\n            - '\\msedgewebview2.exe'\n    filter_main_opera:\n        Image|endswith: '\\opera.exe'\n    filter_main_safari:\n        Image|endswith: '\\safari.exe'\n    filter_main_seamonkey:\n        Image|endswith: '\\seamonkey.exe'\n    filter_main_vivaldi:\n        Image|endswith: '\\vivaldi.exe'\n    filter_main_whale:\n        Image|endswith: '\\whale.exe'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Legitimate applications communicating with the \"api.notion.com\" endpoint that are not already in the exclusion list. The desktop and browser applications do not appear to be using the API by default unless integrations are configured.\nlevel: low\n"},{"path":"network_connection\\net_connection_win_domain_ngrok_tunnel.yml","content":"title: Communication To Ngrok Tunneling Service Initiated\nid: 1d08ac94-400d-4469-a82f-daee9a908849\nrelated:\n    - id: 18249279-932f-45e2-b37a-8925f2597670\n      type: similar\nstatus: test\ndescription: |\n    Detects an executable initiating a network connection to \"ngrok\" tunneling domains.\n    Attackers were seen using this \"ngrok\" in order to store their second stage payloads and malware.\n    While communication with such domains can be legitimate, often times is a sign of either data exfiltration by malicious actors or additional download.\nreferences:\n    - https://twitter.com/hakluke/status/1587733971814977537/photo/1\n    - https://ngrok.com/docs/secure-tunnels/tunnels/ssh-reverse-tunnel-agent\nauthor: Florian Roth (Nextron Systems)\ndate: 2022-11-03\nmodified: 2024-02-02\ntags:\n    - attack.exfiltration\n    - attack.command-and-control\n    - attack.t1567\n    - attack.t1568.002\n    - attack.t1572\n    - attack.t1090\n    - attack.t1102\n    - attack.s0508\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        DestinationHostname|contains:\n            - 'tunnel.us.ngrok.com'\n            - 'tunnel.eu.ngrok.com'\n            - 'tunnel.ap.ngrok.com'\n            - 'tunnel.au.ngrok.com'\n            - 'tunnel.sa.ngrok.com'\n            - 'tunnel.jp.ngrok.com'\n            - 'tunnel.in.ngrok.com'\n    condition: selection\nfalsepositives:\n    - Legitimate use of the ngrok service.\nlevel: high\n"},{"path":"network_connection\\net_connection_win_domain_ngrok.yml","content":"title: Process Initiated Network Connection To Ngrok Domain\nid: 18249279-932f-45e2-b37a-8925f2597670\nrelated:\n    - id: 1d08ac94-400d-4469-a82f-daee9a908849\n      type: similar\nstatus: test\ndescription: |\n    Detects an executable initiating a network connection to \"ngrok\" domains.\n    Attackers were seen using this \"ngrok\" in order to store their second stage payloads and malware.\n    While communication with such domains can be legitimate, often times is a sign of either data exfiltration by malicious actors or additional download.\nreferences:\n    - https://ngrok.com/\n    - https://ngrok.com/blog-post/new-ngrok-domains\n    - https://www.virustotal.com/gui/file/cca0c1182ac114b44dc52dd2058fcd38611c20bb6b5ad84710681d38212f835a/\n    - https://www.rnbo.gov.ua/files/2023_YEAR/CYBERCENTER/november/APT29%20attacks%20Embassies%20using%20CVE-2023-38831%20-%20report%20en.pdf\nauthor: Florian Roth (Nextron Systems)\ndate: 2022-07-16\nmodified: 2025-07-30\ntags:\n    - attack.exfiltration\n    - attack.command-and-control\n    - attack.t1567\n    - attack.t1572\n    - attack.t1102\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Initiated: 'true'\n        DestinationHostname|endswith:\n            - '.ngrok-free.app'\n            - '.ngrok-free.dev'\n            - '.ngrok.app'\n            - '.ngrok.dev'\n            - '.ngrok.io'\n    condition: selection\nfalsepositives:\n    - Legitimate use of the ngrok service.\n# Note: The level of this rule is related to your internal policy.\nlevel: high\n"},{"path":"network_connection\\net_connection_win_domain_mega_nz.yml","content":"title: Network Connection Initiated To Mega.nz\nid: fdeebdf0-9f3f-4d08-84a6-4c4d13e39fe4\nstatus: test\ndescription: |\n    Detects a network connection initiated by a binary to \"api.mega.co.nz\".\n    Attackers were seen abusing file sharing websites similar to \"mega.nz\" in order to upload/download additional payloads.\nreferences:\n    - https://megatools.megous.com/\n    - https://www.mandiant.com/resources/russian-targeting-gov-business\nauthor: Florian Roth (Nextron Systems)\ndate: 2021-12-06\nmodified: 2024-05-31\ntags:\n    - attack.exfiltration\n    - attack.t1567.002\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Initiated: 'true'\n        DestinationHostname|endswith:\n            - 'mega.co.nz'\n            - 'mega.nz'\n    condition: selection\nfalsepositives:\n    - Legitimate MEGA installers and utilities are expected to communicate with this domain. Exclude hosts that are known to be allowed to use this tool.\nlevel: low\n"},{"path":"network_connection\\net_connection_win_domain_localtonet_tunnel.yml","content":"title: Communication To LocaltoNet Tunneling Service Initiated\nid: 3ab65069-d82a-4d44-a759-466661a082d1\nstatus: test\ndescription: |\n    Detects an executable initiating a network connection to \"LocaltoNet\" tunneling sub-domains.\n    LocaltoNet is a reverse proxy that enables localhost services to be exposed to the Internet.\n    Attackers have been seen to use this service for command-and-control activities to bypass MFA and perimeter controls.\nreferences:\n    - https://localtonet.com/documents/supported-tunnels\n    - https://cloud.google.com/blog/topics/threat-intelligence/unc3944-targets-saas-applications\nauthor: Andreas Braathen (mnemonic.io)\ndate: 2024-06-17\ntags:\n    - attack.command-and-control\n    - attack.t1572\n    - attack.t1090\n    - attack.t1102\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        DestinationHostname|endswith:\n            - '.localto.net'\n            - '.localtonet.com'\n        Initiated: 'true'\n    condition: selection\nfalsepositives:\n    - Legitimate use of the LocaltoNet service.\nlevel: high\n"},{"path":"network_connection\\net_connection_win_domain_google_api_non_browser_access.yml","content":"title: Suspicious Non-Browser Network Communication With Google API\nid: 7e9cf7b6-e827-11ed-a05b-0242ac120003\nstatus: experimental\ndescription: |\n    Detects a non-browser process interacting with the Google API which could indicate the use of a covert C2 such as Google Sheet C2 (GC2-sheet)\nreferences:\n    - https://github.com/looCiprian/GC2-sheet\n    - https://youtu.be/n2dFlSaBBKo\n    - https://services.google.com/fh/files/blogs/gcat_threathorizons_full_apr2023.pdf\n    - https://www.tanium.com/blog/apt41-deploys-google-gc2-for-attacks-cyber-threat-intelligence-roundup/\n    - https://www.bleepingcomputer.com/news/security/hackers-abuse-google-command-and-control-red-team-tool-in-attacks/\nauthor: Gavin Knapp\ndate: 2023-05-01\nmodified: 2025-02-22\ntags:\n    - attack.command-and-control\n    - attack.t1102\nlogsource:\n    product: windows\n    category: network_connection\ndetection:\n    selection:\n        DestinationHostname|contains:\n            # Note: Please add additional google API related domains that might be abused.\n            - 'drive.googleapis.com'\n            - 'oauth2.googleapis.com'\n            - 'sheets.googleapis.com'\n            - 'www.googleapis.com'\n    filter_optional_brave:\n        Image|endswith: '\\brave.exe'\n    filter_optional_chrome:\n        Image|endswith:\n            - ':\\Program Files\\Google\\Chrome\\Application\\chrome.exe'\n            - ':\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe'\n    filter_optional_google_drive:\n        Image|contains: ':\\Program Files\\Google\\Drive File Stream\\'\n        Image|endswith: '\\GoogleDriveFS.exe'\n    filter_optional_firefox:\n        Image|endswith:\n            - ':\\Program Files\\Mozilla Firefox\\firefox.exe'\n            - ':\\Program Files (x86)\\Mozilla Firefox\\firefox.exe'\n    filter_optional_ie:\n        Image|endswith:\n            - ':\\Program Files (x86)\\Internet Explorer\\iexplore.exe'\n            - ':\\Program Files\\Internet Explorer\\iexplore.exe'\n    filter_optional_maxthon:\n        Image|endswith: '\\maxthon.exe'\n    filter_optional_edge_1:\n        - Image|contains: ':\\Program Files (x86)\\Microsoft\\EdgeWebView\\Application\\'\n        - Image|endswith:\n              - ':\\Program Files (x86)\\Microsoft\\Edge\\Application\\msedge.exe'\n              - ':\\Program Files\\Microsoft\\Edge\\Application\\msedge.exe'\n              - '\\WindowsApps\\MicrosoftEdge.exe'\n    filter_optional_edge_2:\n        Image|contains:\n            - ':\\Program Files (x86)\\Microsoft\\EdgeCore\\'\n            - ':\\Program Files\\Microsoft\\EdgeCore\\'\n        Image|endswith:\n            - '\\msedge.exe'\n            - '\\msedgewebview2.exe'\n    filter_optional_opera:\n        Image|endswith: '\\opera.exe'\n    filter_optional_safari:\n        Image|endswith: '\\safari.exe'\n    filter_optional_seamonkey:\n        Image|endswith: '\\seamonkey.exe'\n    filter_optional_vivaldi:\n        Image|endswith: '\\vivaldi.exe'\n    filter_optional_whale:\n        Image|endswith: '\\whale.exe'\n    filter_optional_googleupdate:\n        Image|endswith: '\\GoogleUpdate.exe'\n    filter_optional_outlook_exe:\n        Image|endswith: '\\outlook.exe'\n    filter_main_null:\n        Image: null\n    filter_main_empty:\n        Image: ''\n    condition: selection and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Legitimate applications communicating with the \"googleapis.com\" endpoints that are not already in the exclusion list. This is environmental dependent and requires further testing and tuning.\nlevel: medium\n"},{"path":"network_connection\\net_connection_win_domain_external_ip_lookup.yml","content":"title: Suspicious Network Connection to IP Lookup Service APIs\nid: edf3485d-dac4-4d50-90e4-b0e5813f7e60\nrelated:\n    - id: ec82e2a5-81ea-4211-a1f8-37a0286df2c2\n      type: derived\nstatus: test\ndescription: Detects external IP address lookups by non-browser processes via services such as \"api.ipify.org\". This could be indicative of potential post compromise internet test activity.\nreferences:\n    - https://github.com/rsp/scripts/blob/c8bb272d68164a9836e4f273d8f924927f39b8c6/externalip-benchmark.md\n    - https://www.cisa.gov/news-events/cybersecurity-advisories/aa20-302a\n    - https://thedfirreport.com/2022/11/28/emotet-strikes-again-lnk-file-leads-to-domain-wide-ransomware/\n    - https://www.trendmicro.com/en_us/research/23/e/managed-xdr-investigation-of-ducktail-in-trend-micro-vision-one.html\nauthor: Janantha Marasinghe, Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-04-24\nmodified: 2024-03-22\ntags:\n    - attack.discovery\n    - attack.t1016\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        - DestinationHostname:\n              - 'www.ip.cn'\n              - 'l2.io'\n        - DestinationHostname|contains:\n              - 'api.2ip.ua'\n              - 'api.bigdatacloud.net'\n              - 'api.ipify.org'\n              - 'bot.whatismyipaddress.com'\n              - 'canireachthe.net'\n              - 'checkip.amazonaws.com'\n              - 'checkip.dyndns.org'\n              - 'curlmyip.com'\n              - 'db-ip.com'\n              - 'edns.ip-api.com'\n              - 'eth0.me'\n              - 'freegeoip.app'\n              - 'geoipy.com'\n              - 'getip.pro'\n              - 'icanhazip.com'\n              - 'ident.me'\n              - 'ifconfig.io'\n              - 'ifconfig.me'\n              - 'ip-api.com'\n              - 'ip.360.cn'\n              - 'ip.anysrc.net'\n              - 'ip.taobao.com'\n              - 'ip.tyk.nu'\n              - 'ipaddressworld.com'\n              - 'ipapi.co'\n              - 'ipconfig.io'\n              - 'ipecho.net'\n              - 'ipinfo.io'\n              - 'ipip.net'\n              - 'ipof.in'\n              - 'ipv4.icanhazip.com'\n              - 'ipv4bot.whatismyipaddress.com'\n              - 'ipv6-test.com'\n              - 'ipwho.is'\n              - 'jsonip.com'\n              - 'myexternalip.com'\n              - 'seeip.org'\n              - 'wgetip.com'\n              - 'whatismyip.akamai.com'\n              - 'whois.pconline.com.cn'\n              - 'wtfismyip.com'\n    filter_optional_brave:\n        Image|endswith: '\\brave.exe'\n    filter_optional_chrome:\n        Image:\n            - 'C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe'\n            - 'C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe'\n    filter_optional_firefox:\n        Image:\n            - 'C:\\Program Files\\Mozilla Firefox\\firefox.exe'\n            - 'C:\\Program Files (x86)\\Mozilla Firefox\\firefox.exe'\n    filter_optional_ie:\n        Image:\n            - 'C:\\Program Files (x86)\\Internet Explorer\\iexplore.exe'\n            - 'C:\\Program Files\\Internet Explorer\\iexplore.exe'\n    filter_optional_maxthon:\n        Image|endswith: '\\maxthon.exe'\n    filter_optional_edge_1:\n        - Image|startswith: 'C:\\Program Files (x86)\\Microsoft\\EdgeWebView\\Application\\'\n        - Image|endswith: '\\WindowsApps\\MicrosoftEdge.exe'\n        - Image:\n              - 'C:\\Program Files (x86)\\Microsoft\\Edge\\Application\\msedge.exe'\n              - 'C:\\Program Files\\Microsoft\\Edge\\Application\\msedge.exe'\n    filter_optional_edge_2:\n        Image|startswith:\n            - 'C:\\Program Files (x86)\\Microsoft\\EdgeCore\\'\n            - 'C:\\Program Files\\Microsoft\\EdgeCore\\'\n        Image|endswith:\n            - '\\msedge.exe'\n            - '\\msedgewebview2.exe'\n    filter_optional_opera:\n        Image|endswith: '\\opera.exe'\n    filter_optional_safari:\n        Image|endswith: '\\safari.exe'\n    filter_optional_seamonkey:\n        Image|endswith: '\\seamonkey.exe'\n    filter_optional_vivaldi:\n        Image|endswith: '\\vivaldi.exe'\n    filter_optional_whale:\n        Image|endswith: '\\whale.exe'\n    condition: selection and not 1 of filter_optional_*\nfalsepositives:\n    - Legitimate use of the external websites for troubleshooting or network monitoring\nlevel: medium\n"},{"path":"network_connection\\net_connection_win_domain_dropbox_api.yml","content":"title: Suspicious Dropbox API Usage\nid: 25eabf56-22f0-4915-a1ed-056b8dae0a68\nstatus: test\ndescription: Detects an executable that isn't dropbox but communicates with the Dropbox API\nreferences:\n    - https://app.any.run/tasks/7e906adc-9d11-447f-8641-5f40375ecebb\n    - https://www.zscaler.com/blogs/security-research/new-espionage-attack-molerats-apt-targeting-users-middle-east\nauthor: Florian Roth (Nextron Systems)\ndate: 2022-04-20\ntags:\n    - attack.command-and-control\n    - attack.exfiltration\n    - attack.t1105\n    - attack.t1567.002\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Initiated: 'true'\n        DestinationHostname|endswith:\n            - 'api.dropboxapi.com'\n            - 'content.dropboxapi.com'\n    filter_main_legit_dropbox:\n        # Note: It's better to add a specific path to the exact location(s) where dropbox is installed\n        Image|contains: '\\Dropbox'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Legitimate use of the API with a tool that the author wasn't aware of\nlevel: high\n"},{"path":"network_connection\\net_connection_win_domain_devtunnels.yml","content":"title: Network Connection Initiated To DevTunnels Domain\nid: 9501f8e6-8e3d-48fc-a8a6-1089dd5d7ef4\nrelated:\n    - id: 4b657234-038e-4ad5-997c-4be42340bce4 # Net Connection VsCode\n      type: similar\n    - id: b3e6418f-7c7a-4fad-993a-93b65027a9f1 # DNS VsCode\n      type: similar\n    - id: 1cb0c6ce-3d00-44fc-ab9c-6d6d577bf20b # DNS DevTunnels\n      type: similar\nstatus: test\ndescription: |\n    Detects network connections to Devtunnels domains initiated by a process on a system. Attackers can abuse that feature to establish a reverse shell or persistence on a machine.\nreferences:\n    - https://blueteamops.medium.com/detecting-dev-tunnels-16f0994dc3e2\n    - https://learn.microsoft.com/en-us/azure/developer/dev-tunnels/security\n    - https://cydefops.com/devtunnels-unleashed\nauthor: Kamran Saifullah\ndate: 2023-11-20\ntags:\n    - attack.exfiltration\n    - attack.command-and-control\n    - attack.t1567.001\n    - attack.t1572\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Initiated: 'true'\n        DestinationHostname|endswith: '.devtunnels.ms'\n    condition: selection\nfalsepositives:\n    - Legitimate use of Devtunnels will also trigger this.\nlevel: medium\n"},{"path":"network_connection\\net_connection_win_domain_dead_drop_resolvers.yml","content":"title: New Connection Initiated To Potential Dead Drop Resolver Domain\nid: 297ae038-edc2-4b2e-bb3e-7c5fc94dd5c7\nrelated:\n    - id: d7b09985-95a3-44be-8450-b6eadf49833e\n      type: obsolete\nstatus: test\ndescription: |\n    Detects an executable, which is not an internet browser or known application, initiating network connections to legit popular websites, which were seen to be used as dead drop resolvers in previous attacks.\n    In this context attackers leverage known websites such as \"facebook\", \"youtube\", etc. In order to pass through undetected.\nreferences:\n    - https://web.archive.org/web/20220830134315/https://content.fireeye.com/apt-41/rpt-apt41/\n    - https://securelist.com/the-tetrade-brazilian-banking-malware/97779/\n    - https://blog.bushidotoken.net/2021/04/dead-drop-resolvers-espionage-inspired.html\n    - https://github.com/kleiton0x00/RedditC2\n    - https://twitter.com/kleiton0x7e/status/1600567316810551296\n    - https://www.linkedin.com/posts/kleiton-kurti_github-kleiton0x00redditc2-abusing-reddit-activity-7009939662462984192-5DbI/?originalSubdomain=al\nauthor: Sorina Ionescu, X__Junior (Nextron Systems)\ndate: 2022-08-17\nmodified: 2024-10-21\ntags:\n    - attack.command-and-control\n    - attack.t1102\n    - attack.t1102.001\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Initiated: 'true'\n        DestinationHostname|endswith:\n            - '.t.me'\n            - '4shared.com'\n            - 'abuse.ch'\n            - 'anonfiles.com'\n            - 'cdn.discordapp.com'\n            - 'cloudflare.com'\n            - 'ddns.net'\n            - 'discord.com'\n            - 'docs.google.com'\n            - 'drive.google.com'\n            - 'dropbox.com'\n            - 'dropmefiles.com'\n            - 'facebook.com'\n            - 'feeds.rapidfeeds.com'\n            - 'fotolog.com'\n            - 'ghostbin.co/'\n            - 'githubusercontent.com'\n            - 'gofile.io'\n            - 'hastebin.com'\n            - 'imgur.com'\n            - 'livejournal.com'\n            - 'mediafire.com'\n            - 'mega.co.nz'\n            - 'mega.nz'\n            - 'onedrive.com'\n            - 'pages.dev'\n            - 'paste.ee'\n            - 'pastebin.com'\n            - 'pastebin.pl'\n            - 'pastetext.net'\n            - 'pixeldrain.com'\n            - 'privatlab.com'\n            - 'privatlab.net'\n            - 'reddit.com'\n            - 'send.exploit.in'\n            - 'sendspace.com'\n            - 'steamcommunity.com'\n            - 'storage.googleapis.com'\n            - 'technet.microsoft.com'\n            - 'temp.sh'\n            - 'transfer.sh'\n            - 'trycloudflare.com'\n            - 'twitter.com'\n            - 'ufile.io'\n            - 'vimeo.com'\n            - 'w3spaces.com'\n            - 'wetransfer.com'\n            - 'workers.dev'\n            - 'youtube.com'\n    # Note: Add/Remove browsers/applications that you don't use or those that have custom install locations\n    # Note: To avoid complex conditions the filters for some apps are generic by name only. A custom tuning is recommended for best results\n    filter_main_chrome:\n        Image:\n            - 'C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe'\n            - 'C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe'\n    filter_main_chrome_appdata:\n        Image|startswith: 'C:\\Users\\'\n        Image|endswith: '\\AppData\\Local\\Google\\Chrome\\Application\\chrome.exe'\n    filter_main_firefox:\n        Image:\n            - 'C:\\Program Files\\Mozilla Firefox\\firefox.exe'\n            - 'C:\\Program Files (x86)\\Mozilla Firefox\\firefox.exe'\n    filter_main_firefox_appdata:\n        Image|startswith: 'C:\\Users\\'\n        Image|endswith: '\\AppData\\Local\\Mozilla Firefox\\firefox.exe'\n    filter_main_ie:\n        Image:\n            - 'C:\\Program Files (x86)\\Internet Explorer\\iexplore.exe'\n            - 'C:\\Program Files\\Internet Explorer\\iexplore.exe'\n    filter_main_edge_1:\n        - Image|startswith: 'C:\\Program Files (x86)\\Microsoft\\EdgeWebView\\Application\\'\n        - Image|endswith: '\\WindowsApps\\MicrosoftEdge.exe'\n        - Image:\n              - 'C:\\Program Files (x86)\\Microsoft\\Edge\\Application\\msedge.exe'\n              - 'C:\\Program Files\\Microsoft\\Edge\\Application\\msedge.exe'\n    filter_main_edge_2:\n        Image|startswith:\n            - 'C:\\Program Files (x86)\\Microsoft\\EdgeCore\\'\n            - 'C:\\Program Files\\Microsoft\\EdgeCore\\'\n        Image|endswith:\n            - '\\msedge.exe'\n            - '\\msedgewebview2.exe'\n    filter_main_safari:\n        Image|contains:\n            - 'C:\\Program Files (x86)\\Safari\\'\n            - 'C:\\Program Files\\Safari\\'\n        Image|endswith: '\\safari.exe'\n    filter_main_defender:\n        Image|contains:\n            - 'C:\\Program Files\\Windows Defender Advanced Threat Protection\\'\n            - 'C:\\Program Files\\Windows Defender\\'\n            - 'C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\'\n        Image|endswith:\n            - '\\MsMpEng.exe' # Microsoft Defender executable\n            - '\\MsSense.exe' # Windows Defender Advanced Threat Protection Service Executable\n    filter_main_prtg:\n        # Paessler's PRTG Network Monitor\n        Image|endswith:\n            - 'C:\\Program Files (x86)\\PRTG Network Monitor\\PRTG Probe.exe'\n            - 'C:\\Program Files\\PRTG Network Monitor\\PRTG Probe.exe'\n    filter_main_brave:\n        Image|startswith: 'C:\\Program Files\\BraveSoftware\\'\n        Image|endswith: '\\brave.exe'\n    filter_main_maxthon:\n        Image|contains: '\\AppData\\Local\\Maxthon\\'\n        Image|endswith: '\\maxthon.exe'\n    filter_main_opera:\n        Image|contains: '\\AppData\\Local\\Programs\\Opera\\'\n        Image|endswith: '\\opera.exe'\n    filter_main_seamonkey:\n        Image|startswith:\n            - 'C:\\Program Files\\SeaMonkey\\'\n            - 'C:\\Program Files (x86)\\SeaMonkey\\'\n        Image|endswith: '\\seamonkey.exe'\n    filter_main_vivaldi:\n        Image|contains: '\\AppData\\Local\\Vivaldi\\'\n        Image|endswith: '\\vivaldi.exe'\n    filter_main_whale:\n        Image|startswith:\n            - 'C:\\Program Files\\Naver\\Naver Whale\\'\n            - 'C:\\Program Files (x86)\\Naver\\Naver Whale\\'\n        Image|endswith: '\\whale.exe'\n    # Note: The TOR browser shouldn't be something you allow in your corporate network.\n    # filter_main_tor:\n    #     Image|contains: '\\Tor Browser\\'\n    filter_main_whaterfox:\n        Image|startswith:\n            - 'C:\\Program Files\\Waterfox\\'\n            - 'C:\\Program Files (x86)\\Waterfox\\'\n        Image|endswith: '\\Waterfox.exe'\n    filter_main_midori:\n        Image|contains: '\\AppData\\Local\\Programs\\midori-ng\\'\n        Image|endswith: '\\Midori Next Generation.exe'\n    filter_main_slimbrowser:\n        Image|startswith:\n            - 'C:\\Program Files\\SlimBrowser\\'\n            - 'C:\\Program Files (x86)\\SlimBrowser\\'\n        Image|endswith: '\\slimbrowser.exe'\n    filter_main_flock:\n        Image|contains: '\\AppData\\Local\\Flock\\'\n        Image|endswith: '\\Flock.exe'\n    filter_main_phoebe:\n        Image|contains: '\\AppData\\Local\\Phoebe\\'\n        Image|endswith: '\\Phoebe.exe'\n    filter_main_falkon:\n        Image|startswith:\n            - 'C:\\Program Files\\Falkon\\'\n            - 'C:\\Program Files (x86)\\Falkon\\'\n        Image|endswith: '\\falkon.exe'\n    filter_main_qtweb:\n        Image|startswith:\n            - 'C:\\Program Files (x86)\\QtWeb\\'\n            - 'C:\\Program Files\\QtWeb\\'\n        Image|endswith: '\\QtWeb.exe'\n    filter_main_avant:\n        Image|startswith:\n            - 'C:\\Program Files (x86)\\Avant Browser\\'\n            - 'C:\\Program Files\\Avant Browser\\'\n        Image|endswith: '\\avant.exe'\n    filter_main_whatsapp:\n        Image|startswith:\n            - 'C:\\Program Files (x86)\\WindowsApps\\'\n            - 'C:\\Program Files\\WindowsApps\\'\n        Image|endswith: '\\WhatsApp.exe'\n        DestinationHostname|endswith: 'facebook.com'\n    filter_main_telegram:\n        Image|contains: '\\AppData\\Roaming\\Telegram Desktop\\'\n        Image|endswith: '\\Telegram.exe'\n        DestinationHostname|endswith: '.t.me'\n    filter_main_onedrive:\n        Image|contains: '\\AppData\\Local\\Microsoft\\OneDrive\\'\n        Image|endswith: '\\OneDrive.exe'\n        DestinationHostname|endswith: 'onedrive.com'\n    filter_main_dropbox:\n        Image|startswith:\n            - 'C:\\Program Files (x86)\\Dropbox\\Client\\'\n            - 'C:\\Program Files\\Dropbox\\Client\\'\n        Image|endswith:\n            - '\\Dropbox.exe'\n            - '\\DropboxInstaller.exe'\n        DestinationHostname|endswith: 'dropbox.com'\n    filter_main_mega:\n        Image|endswith:\n            # Note: This is a basic/best effort filter in order to avoid FP with the MEGA installer and executable.\n            #       In practice please apply exact path to avoid basic path bypass techniques.\n            - '\\MEGAsync.exe'\n            - '\\MEGAsyncSetup32_*RC.exe' # Beta versions\n            - '\\MEGAsyncSetup32.exe' # Installers 32bit\n            - '\\MEGAsyncSetup64.exe' # Installers 64bit\n            - '\\MEGAupdater.exe'\n        DestinationHostname|endswith:\n            - 'mega.co.nz'\n            - 'mega.nz'\n    filter_main_googledrive:\n        Image|contains:\n            - 'C:\\Program Files\\Google\\Drive File Stream\\'\n            - 'C:\\Program Files (x86)\\Google\\Drive File Stream\\'\n        Image|endswith: 'GoogleDriveFS.exe'\n        DestinationHostname|endswith: 'drive.google.com'\n    filter_main_discord:\n        Image|contains: '\\AppData\\Local\\Discord\\'\n        Image|endswith: '\\Discord.exe'\n        DestinationHostname|endswith:\n            - 'discord.com'\n            - 'cdn.discordapp.com'\n    filter_main_null:\n        Image: null\n    filter_main_empty:\n        Image: ''\n    # filter_optional_qlik:\n    #     Image|endswith: '\\Engine.exe' # Process from qlik.com app\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - One might need to exclude other internet browsers found in it's network or other applications like ones mentioned above from Microsoft Defender.\n    - Ninite contacting githubusercontent.com\nlevel: high\n"},{"path":"network_connection\\net_connection_win_domain_crypto_mining_pools.yml","content":"title: Network Communication With Crypto Mining Pool\nid: fa5b1358-b040-4403-9868-15f7d9ab6329\nstatus: stable\ndescription: Detects initiated network connections to crypto mining pools\nreferences:\n    - https://www.poolwatch.io/coin/monero\n    - https://github.com/stamparm/maltrail/blob/3ea70459b9559134449423c0a7d8b965ac5c40ea/trails/static/suspicious/crypto_mining.txt\n    - https://www.virustotal.com/gui/search/behaviour_network%253A*.miningocean.org/files\nauthor: Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)\ndate: 2021-10-26\nmodified: 2024-01-19\ntags:\n    - attack.impact\n    - attack.t1496\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        DestinationHostname:\n            - 'alimabi.cn'\n            - 'ap.luckpool.net'\n            - 'bcn.pool.minergate.com'\n            - 'bcn.vip.pool.minergate.com'\n            - 'bohemianpool.com'\n            - 'ca-aipg.miningocean.org'\n            - 'ca-dynex.miningocean.org'\n            - 'ca-neurai.miningocean.org'\n            - 'ca-qrl.miningocean.org'\n            - 'ca-upx.miningocean.org'\n            - 'ca-zephyr.miningocean.org'\n            - 'ca.minexmr.com'\n            - 'ca.monero.herominers.com'\n            - 'cbd.monerpool.org'\n            - 'cbdv2.monerpool.org'\n            - 'cryptmonero.com'\n            - 'crypto-pool.fr'\n            - 'crypto-pool.info'\n            - 'cryptonight-hub.miningpoolhub.com'\n            - 'd1pool.ddns.net'\n            - 'd5pool.us'\n            - 'daili01.monerpool.org'\n            - 'de-aipg.miningocean.org'\n            - 'de-dynex.miningocean.org'\n            - 'de-zephyr.miningocean.org'\n            - 'de.minexmr.com'\n            - 'dl.nbminer.com'\n            - 'donate.graef.in'\n            - 'donate.ssl.xmrig.com'\n            - 'donate.v2.xmrig.com'\n            - 'donate.xmrig.com'\n            - 'donate2.graef.in'\n            - 'drill.moneroworld.com'\n            - 'dwarfpool.com'\n            - 'emercoin.com'\n            - 'emercoin.net'\n            - 'emergate.net'\n            - 'ethereumpool.co'\n            - 'eu.luckpool.net'\n            - 'eu.minerpool.pw'\n            - 'fcn-xmr.pool.minergate.com'\n            - 'fee.xmrig.com'\n            - 'fr-aipg.miningocean.org'\n            - 'fr-dynex.miningocean.org'\n            - 'fr-neurai.miningocean.org'\n            - 'fr-qrl.miningocean.org'\n            - 'fr-upx.miningocean.org'\n            - 'fr-zephyr.miningocean.org'\n            - 'fr.minexmr.com'\n            - 'hellominer.com'\n            - 'herominers.com'\n            - 'hk-aipg.miningocean.org'\n            - 'hk-dynex.miningocean.org'\n            - 'hk-neurai.miningocean.org'\n            - 'hk-qrl.miningocean.org'\n            - 'hk-upx.miningocean.org'\n            - 'hk-zephyr.miningocean.org'\n            - 'huadong1-aeon.ppxxmr.com'\n            - 'iwanttoearn.money'\n            - 'jw-js1.ppxxmr.com'\n            - 'koto-pool.work'\n            - 'lhr.nbminer.com'\n            - 'lhr3.nbminer.com'\n            - 'linux.monerpool.org'\n            - 'lokiturtle.herominers.com'\n            - 'luckpool.net'\n            - 'masari.miner.rocks'\n            - 'mine.c3pool.com'\n            - 'mine.moneropool.com'\n            - 'mine.ppxxmr.com'\n            - 'mine.zpool.ca'\n            - 'mine1.ppxxmr.com'\n            - 'minemonero.gq'\n            - 'miner.ppxxmr.com'\n            - 'miner.rocks'\n            - 'minercircle.com'\n            - 'minergate.com'\n            - 'minerpool.pw'\n            - 'minerrocks.com'\n            - 'miners.pro'\n            - 'minerxmr.ru'\n            - 'minexmr.cn'\n            - 'minexmr.com'\n            - 'mining-help.ru'\n            - 'miningpoolhub.com'\n            - 'mixpools.org'\n            - 'moner.monerpool.org'\n            - 'moner1min.monerpool.org'\n            - 'monero-master.crypto-pool.fr'\n            - 'monero.crypto-pool.fr'\n            - 'monero.hashvault.pro'\n            - 'monero.herominers.com'\n            - 'monero.lindon-pool.win'\n            - 'monero.miners.pro'\n            - 'monero.riefly.id'\n            - 'monero.us.to'\n            - 'monerocean.stream'\n            - 'monerogb.com'\n            - 'monerohash.com'\n            - 'moneroocean.stream'\n            - 'moneropool.com'\n            - 'moneropool.nl'\n            - 'monerorx.com'\n            - 'monerpool.org'\n            - 'moriaxmr.com'\n            - 'mro.pool.minergate.com'\n            - 'multipool.us'\n            - 'myxmr.pw'\n            - 'na.luckpool.net'\n            - 'nanopool.org'\n            - 'nbminer.com'\n            - 'node3.luckpool.net'\n            - 'noobxmr.com'\n            - 'pangolinminer.comgandalph3000.com'\n            - 'pool.4i7i.com'\n            - 'pool.armornetwork.org'\n            - 'pool.cortins.tk'\n            - 'pool.gntl.co.uk'\n            - 'pool.hashvault.pro'\n            - 'pool.minergate.com'\n            - 'pool.minexmr.com'\n            - 'pool.monero.hashvault.pro'\n            - 'pool.ppxxmr.com'\n            - 'pool.somec.cc'\n            - 'pool.support'\n            - 'pool.supportxmr.com'\n            - 'pool.usa-138.com'\n            - 'pool.xmr.pt'\n            - 'pool.xmrfast.com'\n            - 'pool2.armornetwork.org'\n            - 'poolchange.ppxxmr.com'\n            - 'pooldd.com'\n            - 'poolmining.org'\n            - 'poolto.be'\n            - 'ppxvip1.ppxxmr.com'\n            - 'ppxxmr.com'\n            - 'prohash.net'\n            - 'r.twotouchauthentication.online'\n            - 'randomx.xmrig.com'\n            - 'ratchetmining.com'\n            - 'seed.emercoin.com'\n            - 'seed.emercoin.net'\n            - 'seed.emergate.net'\n            - 'seed1.joulecoin.org'\n            - 'seed2.joulecoin.org'\n            - 'seed3.joulecoin.org'\n            - 'seed4.joulecoin.org'\n            - 'seed5.joulecoin.org'\n            - 'seed6.joulecoin.org'\n            - 'seed7.joulecoin.org'\n            - 'seed8.joulecoin.org'\n            - 'sg-aipg.miningocean.org'\n            - 'sg-dynex.miningocean.org'\n            - 'sg-neurai.miningocean.org'\n            - 'sg-qrl.miningocean.org'\n            - 'sg-upx.miningocean.org'\n            - 'sg-zephyr.miningocean.org'\n            - 'sg.minexmr.com'\n            - 'sheepman.mine.bz'\n            - 'siamining.com'\n            - 'sumokoin.minerrocks.com'\n            - 'supportxmr.com'\n            - 'suprnova.cc'\n            - 'teracycle.net'\n            - 'trtl.cnpool.cc'\n            - 'trtl.pool.mine2gether.com'\n            - 'turtle.miner.rocks'\n            - 'us-aipg.miningocean.org'\n            - 'us-dynex.miningocean.org'\n            - 'us-neurai.miningocean.org'\n            - 'us-west.minexmr.com'\n            - 'us-zephyr.miningocean.org'\n            - 'usxmrpool.com'\n            - 'viaxmr.com'\n            - 'webservicepag.webhop.net'\n            - 'xiazai.monerpool.org'\n            - 'xiazai1.monerpool.org'\n            - 'xmc.pool.minergate.com'\n            - 'xmo.pool.minergate.com'\n            - 'xmr-asia1.nanopool.org'\n            - 'xmr-au1.nanopool.org'\n            - 'xmr-eu1.nanopool.org'\n            - 'xmr-eu2.nanopool.org'\n            - 'xmr-jp1.nanopool.org'\n            - 'xmr-us-east1.nanopool.org'\n            - 'xmr-us-west1.nanopool.org'\n            - 'xmr-us.suprnova.cc'\n            - 'xmr-usa.dwarfpool.com'\n            - 'xmr.2miners.com'\n            - 'xmr.5b6b7b.ru'\n            - 'xmr.alimabi.cn'\n            - 'xmr.bohemianpool.com'\n            - 'xmr.crypto-pool.fr'\n            - 'xmr.crypto-pool.info'\n            - 'xmr.f2pool.com'\n            - 'xmr.hashcity.org'\n            - 'xmr.hex7e4.ru'\n            - 'xmr.ip28.net'\n            - 'xmr.monerpool.org'\n            - 'xmr.mypool.online'\n            - 'xmr.nanopool.org'\n            - 'xmr.pool.gntl.co.uk'\n            - 'xmr.pool.minergate.com'\n            - 'xmr.poolto.be'\n            - 'xmr.ppxxmr.com'\n            - 'xmr.prohash.net'\n            - 'xmr.simka.pw'\n            - 'xmr.somec.cc'\n            - 'xmr.suprnova.cc'\n            - 'xmr.usa-138.com'\n            - 'xmr.vip.pool.minergate.com'\n            - 'xmr1min.monerpool.org'\n            - 'xmrf.520fjh.org'\n            - 'xmrf.fjhan.club'\n            - 'xmrfast.com'\n            - 'xmrigcc.graef.in'\n            - 'xmrminer.cc'\n            - 'xmrpool.de'\n            - 'xmrpool.eu'\n            - 'xmrpool.me'\n            - 'xmrpool.net'\n            - 'xmrpool.xyz'\n            - 'xx11m.monerpool.org'\n            - 'xx11mv2.monerpool.org'\n            - 'xxx.hex7e4.ru'\n            - 'zarabotaibitok.ru'\n            - 'zer0day.ru'\n    condition: selection\nfalsepositives:\n    - Unlikely\nlevel: high\n"},{"path":"network_connection\\net_connection_win_domain_cloudflared_communication.yml","content":"title: Network Connection Initiated To Cloudflared Tunnels Domains\nid: 7cd1dcdc-6edf-4896-86dc-d1f19ad64903\nrelated:\n    - id: a1d9eec5-33b2-4177-8d24-27fe754d0812\n      type: derived\nstatus: test\ndescription: |\n    Detects network connections to Cloudflared tunnels domains initiated by a process on the system.\n    Attackers can abuse that feature to establish a reverse shell or persistence on a machine.\nreferences:\n    - https://defr0ggy.github.io/research/Abusing-Cloudflared-A-Proxy-Service-To-Host-Share-Applications/\n    - https://www.guidepointsecurity.com/blog/tunnel-vision-cloudflared-abused-in-the-wild/\n    - Internal Research\nauthor: Kamran Saifullah, Nasreddine Bencherchali (Nextron Systems)\ndate: 2024-05-27\ntags:\n    - attack.exfiltration\n    - attack.command-and-control\n    - attack.t1567\n    - attack.t1572\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Initiated: 'true'\n        DestinationHostname|endswith:\n            - '.v2.argotunnel.com'\n            - 'protocol-v2.argotunnel.com'\n            - 'trycloudflare.com'\n            - 'update.argotunnel.com'\n    condition: selection\nfalsepositives:\n    - Legitimate use of cloudflare tunnels will also trigger this.\nlevel: medium\n"},{"path":"network_connection\\net_connection_win_domain_btunnels.yml","content":"title: Network Connection Initiated To BTunnels Domains\nid: 9e02c8ec-02b9-43e8-81eb-34a475ba7965\nstatus: test\ndescription: |\n    Detects network connections to BTunnels domains initiated by a process on the system.\n    Attackers can abuse that feature to establish a reverse shell or persistence on a machine.\nreferences:\n    - https://defr0ggy.github.io/research/Utilizing-BTunnel-For-Data-Exfiltration/\nauthor: Kamran Saifullah\ndate: 2024-09-13\ntags:\n    - attack.exfiltration\n    - attack.command-and-control\n    - attack.t1567\n    - attack.t1572\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Initiated: 'true'\n        DestinationHostname|endswith: '.btunnel.co.in'\n    condition: selection\nfalsepositives:\n    - Legitimate use of BTunnels will also trigger this.\nlevel: medium\n"},{"path":"network_connection\\net_connection_win_domain_azurewebsites.yml","content":"title: Network Connection Initiated To AzureWebsites.NET By Non-Browser Process\nid: 5c80b618-0dbb-46e6-acbb-03d90bcb6d83\nrelated:\n    - id: e043f529-8514-4205-8ab0-7f7d2927b400\n      type: derived\nstatus: test\ndescription: |\n    Detects an initiated network connection by a non browser process on the system to \"azurewebsites.net\". The latter was often used by threat actors as a malware hosting and exfiltration site.\nreferences:\n    - https://www.sentinelone.com/labs/wip26-espionage-threat-actors-abuse-cloud-infrastructure-in-targeted-telco-attacks/\n    - https://symantec-enterprise-blogs.security.com/threat-intelligence/harvester-new-apt-attacks-asia\n    - https://www.ptsecurity.com/ww-en/analytics/pt-esc-threat-intelligence/higaisa-or-winnti-apt-41-backdoors-old-and-new/\n    - https://intezer.com/blog/research/how-we-escaped-docker-in-azure-functions/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2024-06-24\nmodified: 2024-07-16\ntags:\n    - attack.command-and-control\n    - attack.t1102\n    - attack.t1102.001\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Initiated: 'true'\n        DestinationHostname|endswith: 'azurewebsites.net'\n    # Note: Add/Remove browsers/applications that you don't use or those that have custom install locations\n    # Note: To avoid complex conditions the filters for some apps are generic by name only. A custom tuning is recommended for best results\n    filter_main_chrome:\n        Image:\n            - 'C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe'\n            - 'C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe'\n    filter_main_chrome_appdata:\n        Image|startswith: 'C:\\Users\\'\n        Image|endswith: '\\AppData\\Local\\Google\\Chrome\\Application\\chrome.exe'\n    filter_main_firefox:\n        Image:\n            - 'C:\\Program Files\\Mozilla Firefox\\firefox.exe'\n            - 'C:\\Program Files (x86)\\Mozilla Firefox\\firefox.exe'\n    filter_main_firefox_appdata:\n        Image|startswith: 'C:\\Users\\'\n        Image|endswith: '\\AppData\\Local\\Mozilla Firefox\\firefox.exe'\n    filter_main_ie:\n        Image:\n            - 'C:\\Program Files (x86)\\Internet Explorer\\iexplore.exe'\n            - 'C:\\Program Files\\Internet Explorer\\iexplore.exe'\n    filter_main_edge_1:\n        - Image|startswith: 'C:\\Program Files (x86)\\Microsoft\\EdgeWebView\\Application\\'\n        - Image|endswith: '\\WindowsApps\\MicrosoftEdge.exe'\n        - Image:\n              - 'C:\\Program Files (x86)\\Microsoft\\Edge\\Application\\msedge.exe'\n              - 'C:\\Program Files\\Microsoft\\Edge\\Application\\msedge.exe'\n    filter_main_edge_2:\n        Image|startswith:\n            - 'C:\\Program Files (x86)\\Microsoft\\EdgeCore\\'\n            - 'C:\\Program Files\\Microsoft\\EdgeCore\\'\n        Image|endswith:\n            - '\\msedge.exe'\n            - '\\msedgewebview2.exe'\n    filter_main_safari:\n        Image|contains:\n            - 'C:\\Program Files (x86)\\Safari\\'\n            - 'C:\\Program Files\\Safari\\'\n        Image|endswith: '\\safari.exe'\n    filter_main_defender:\n        Image|contains:\n            - 'C:\\Program Files\\Windows Defender Advanced Threat Protection\\'\n            - 'C:\\Program Files\\Windows Defender\\'\n            - 'C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\'\n        Image|endswith:\n            - '\\MsMpEng.exe' # Microsoft Defender executable\n            - '\\MsSense.exe' # Windows Defender Advanced Threat Protection Service Executable\n    filter_main_prtg:\n        # Paessler's PRTG Network Monitor\n        Image|endswith:\n            - 'C:\\Program Files (x86)\\PRTG Network Monitor\\PRTG Probe.exe'\n            - 'C:\\Program Files\\PRTG Network Monitor\\PRTG Probe.exe'\n    filter_main_brave:\n        Image|startswith: 'C:\\Program Files\\BraveSoftware\\'\n        Image|endswith: '\\brave.exe'\n    filter_main_maxthon:\n        Image|contains: '\\AppData\\Local\\Maxthon\\'\n        Image|endswith: '\\maxthon.exe'\n    filter_main_opera:\n        Image|contains: '\\AppData\\Local\\Programs\\Opera\\'\n        Image|endswith: '\\opera.exe'\n    filter_main_seamonkey:\n        Image|startswith:\n            - 'C:\\Program Files\\SeaMonkey\\'\n            - 'C:\\Program Files (x86)\\SeaMonkey\\'\n        Image|endswith: '\\seamonkey.exe'\n    filter_main_vivaldi:\n        Image|contains: '\\AppData\\Local\\Vivaldi\\'\n        Image|endswith: '\\vivaldi.exe'\n    filter_main_whale:\n        Image|startswith:\n            - 'C:\\Program Files\\Naver\\Naver Whale\\'\n            - 'C:\\Program Files (x86)\\Naver\\Naver Whale\\'\n        Image|endswith: '\\whale.exe'\n    # Note: The TOR browser shouldn't be something you allow in your corporate network.\n    # filter_main_tor:\n    #     Image|contains: '\\Tor Browser\\'\n    filter_main_whaterfox:\n        Image|startswith:\n            - 'C:\\Program Files\\Waterfox\\'\n            - 'C:\\Program Files (x86)\\Waterfox\\'\n        Image|endswith: '\\Waterfox.exe'\n    filter_main_slimbrowser:\n        Image|startswith:\n            - 'C:\\Program Files\\SlimBrowser\\'\n            - 'C:\\Program Files (x86)\\SlimBrowser\\'\n        Image|endswith: '\\slimbrowser.exe'\n    filter_main_flock:\n        Image|contains: '\\AppData\\Local\\Flock\\'\n        Image|endswith: '\\Flock.exe'\n    filter_main_phoebe:\n        Image|contains: '\\AppData\\Local\\Phoebe\\'\n        Image|endswith: '\\Phoebe.exe'\n    filter_main_falkon:\n        Image|startswith:\n            - 'C:\\Program Files\\Falkon\\'\n            - 'C:\\Program Files (x86)\\Falkon\\'\n        Image|endswith: '\\falkon.exe'\n    filter_main_qtweb:\n        Image|startswith:\n            - 'C:\\Program Files (x86)\\QtWeb\\'\n            - 'C:\\Program Files\\QtWeb\\'\n        Image|endswith: '\\QtWeb.exe'\n    filter_main_avant:\n        Image|startswith:\n            - 'C:\\Program Files (x86)\\Avant Browser\\'\n            - 'C:\\Program Files\\Avant Browser\\'\n        Image|endswith: '\\avant.exe'\n    filter_main_discord:\n        Image|contains: '\\AppData\\Local\\Discord\\'\n        Image|endswith: '\\Discord.exe'\n    filter_main_null:\n        Image: null\n    filter_main_empty:\n        Image: ''\n    # filter_optional_qlik:\n    #     Image|endswith: '\\Engine.exe' # Process from qlik.com app\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"network_connection\\net_connection_win_dialer_initiated_connection.yml","content":"title: Outbound Network Connection Initiated By Microsoft Dialer\nid: 37e4024a-6c80-4d8f-b95d-2e7e94f3a8d1\nstatus: test\ndescription: |\n    Detects outbound network connection initiated by Microsoft Dialer.\n    The Microsoft Dialer, also known as Phone Dialer, is a built-in utility application included in various versions of the Microsoft Windows operating system. Its primary function is to provide users with a graphical interface for managing phone calls via a modem or a phone line connected to the computer.\n    This is an outdated process in the current conext of it's usage and is a common target for info stealers for process injection, and is used to make C2 connections, common example is \"Rhadamanthys\"\nreferences:\n    - https://tria.ge/240301-rk34sagf5x/behavioral2\n    - https://app.any.run/tasks/6720b85b-9c53-4a12-b1dc-73052a78477d\n    - https://research.checkpoint.com/2023/rhadamanthys-v0-5-0-a-deep-dive-into-the-stealers-components/\n    - https://strontic.github.io/xcyclopedia/library/dialer.exe-0B69655F912619756C704A0BF716B61F.html\nauthor: CertainlyP\ndate: 2024-04-26\ntags:\n    - attack.execution\n    - attack.command-and-control\n    - attack.t1071.001\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Image|endswith: ':\\Windows\\System32\\dialer.exe'\n        Initiated: 'true'\n    filter_main_local_ranges:\n        DestinationIp|cidr:\n            - '127.0.0.0/8'\n            - '10.0.0.0/8'\n            - '172.16.0.0/12'\n            - '192.168.0.0/16'\n            - '169.254.0.0/16'\n            - '::1/128'  # IPv6 loopback\n            - 'fe80::/10'  # IPv6 link-local addresses\n            - 'fc00::/7'  # IPv6 private addresses\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - In Modern Windows systems, unable to see legitimate usage of this process, However, if an organization has legitimate purpose for this there can be false positives.\nlevel: high\n"},{"path":"network_connection\\net_connection_win_cmstp_initiated_connection.yml","content":"title: Outbound Network Connection Initiated By Cmstp.EXE\nid: efafe0bf-4238-479e-af8f-797bd3490d2d\nstatus: test\ndescription: |\n    Detects a network connection initiated by Cmstp.EXE\n    Its uncommon for \"cmstp.exe\" to initiate an outbound network connection. Investigate the source of such requests to determine if they are malicious.\nreferences:\n    - https://web.archive.org/web/20190720093911/http://www.endurant.io/cmstp/detecting-cmstp-enabled-code-execution-and-uac-bypass-with-sysmon/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-08-30\nmodified: 2024-05-31\ntags:\n    - attack.defense-evasion\n    - attack.t1218.003\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Image|endswith: '\\cmstp.exe'\n        Initiated: 'true'\n    filter_main_local_ranges:\n        DestinationIp|cidr:\n            - '127.0.0.0/8'\n            - '10.0.0.0/8'\n            - '172.16.0.0/12'\n            - '192.168.0.0/16'\n            - '169.254.0.0/16'\n            - '::1/128'  # IPv6 loopback\n            - 'fe80::/10'  # IPv6 link-local addresses\n            - 'fc00::/7'  # IPv6 private addresses\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Unknown\n# Note: Please report any false positive seen in the wild to help tune the rule.\nlevel: high\n"},{"path":"network_connection\\net_connection_win_certutil_initiated_connection.yml","content":"title: Uncommon Network Connection Initiated By Certutil.EXE\nid: 0dba975d-a193-4ed1-a067-424df57570d1\nstatus: test\ndescription: |\n    Detects a network connection initiated by the certutil.exe utility.\n    Attackers can abuse the utility in order to download malware or additional payloads.\nreferences:\n    - https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/certutil\nauthor: frack113, Florian Roth (Nextron Systems)\ndate: 2022-09-02\nmodified: 2024-05-31\ntags:\n    - attack.command-and-control\n    - attack.t1105\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Image|endswith: '\\certutil.exe'\n        Initiated: 'true'\n        DestinationPort:\n            - 80\n            - 135\n            - 443\n            - 445\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"network_connection\\net_connection_win_adws_unusual_connection.yml","content":"title: Uncommon Connection to Active Directory Web Services\nid: b3ad3c0f-c949-47a1-a30e-b0491ccae876\nstatus: test\ndescription: |\n    Detects uncommon network connections to the Active Directory Web Services (ADWS) from processes not typically associated with ADWS management.\nreferences:\n    - https://medium.com/falconforce/soaphound-tool-to-collect-active-directory-data-via-adws-165aca78288c\n    - https://github.com/FalconForceTeam/FalconFriday/blob/a9219dfcfd89836f34660223f47d766982bdce46/Discovery/ADWS_Connection_from_Unexpected_Binary-Win.md\nauthor: '@kostastsale'\ndate: 2024-01-26\ntags:\n    - attack.discovery\n    - attack.t1087\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Initiated: true\n        DestinationPort: 9389\n    filter_main_dsac:\n        Image: 'C:\\Windows\\system32\\dsac.exe'\n    filter_main_ms_monitoring_agent:\n        Image: 'C:\\Program Files\\Microsoft Monitoring Agent\\'\n    filter_main_powershell:\n        Image|startswith:\n            - 'C:\\Program Files\\PowerShell\\7\\pwsh.exe'\n            - 'C:\\Program Files\\PowerShell\\7-preview\\pwsh.ex'\n            - 'C:\\Windows\\System32\\WindowsPowerShell\\'\n            - 'C:\\Windows\\SysWOW64\\WindowsPowerShell\\'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - ADWS is used by a number of legitimate applications that need to interact with Active Directory. These applications should be added to the allow-listing to avoid false positives.\nlevel: medium\n"},{"path":"network_connection\\net_connection_win_addinutil_initiated.yml","content":"title: Network Connection Initiated By AddinUtil.EXE\nid: 5205613d-2a63-4412-a895-3a2458b587b3\nstatus: test\ndescription: |\n    Detects a network connection initiated by the Add-In deployment cache updating utility \"AddInutil.exe\".\n    This could indicate a potential command and control communication as this tool doesn't usually initiate network activity.\nreferences:\n    - https://www.blue-prints.blog/content/blog/posts/lolbin/addinutil-lolbas.html\nauthor: Michael McKinley (@McKinleyMike), Tony Latteri (@TheLatteri)\ndate: 2023-09-18\nmodified: 2024-07-16\ntags:\n    - attack.defense-evasion\n    - attack.t1218\nlogsource:\n    category: network_connection\n    product: windows\ndetection:\n    selection:\n        Initiated: 'true'\n        Image|endswith: '\\addinutil.exe'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"}]