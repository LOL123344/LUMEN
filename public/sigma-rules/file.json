[{"path":"file\\file_rename\\file_rename_win_ransomware.yml","content":"title: Suspicious Appended Extension\nid: e3f673b3-65d1-4d80-9146-466f8b63fa99\nstatus: test\ndescription: Detects file renames where the target filename uses an uncommon double extension. Could indicate potential ransomware activity renaming files and adding a custom extension to the encrypted files, such as \".jpg.crypted\", \".docx.locky\", etc.\nreferences:\n    - https://app.any.run/tasks/d66ead5a-faf4-4437-93aa-65785afaf9e5/\n    - https://blog.cyble.com/2022/08/10/onyx-ransomware-renames-its-leak-site-to-vsop/\nauthor: frack113\ndate: 2022-07-16\nmodified: 2023-11-11\ntags:\n    - attack.impact\n    - attack.t1486\nlogsource:\n    product: windows\n    category: file_rename\n    definition: 'Requirements: Microsoft-Windows-Kernel-File Provider with at least the KERNEL_FILE_KEYWORD_RENAME_SETLINK_PATH keyword'\ndetection:\n    selection:\n        SourceFilename|endswith:\n            - '.doc'\n            - '.docx'\n            - '.jpeg'\n            - '.jpg'\n            - '.lnk'\n            - '.pdf'\n            - '.png'\n            - '.pst'\n            - '.rtf'\n            - '.xls'\n            - '.xlsx'\n        TargetFilename|contains:\n            - '.doc.'\n            - '.docx.'\n            - '.jpeg.'\n            - '.jpg.'\n            - '.lnk.'\n            - '.pdf.'\n            - '.png.'\n            - '.pst.'\n            - '.rtf.'\n            - '.xls.'\n            - '.xlsx.'\n    filter_main_generic:\n        TargetFilename|endswith:\n            # Note: Please add more used extensions by backup or recovery software\n            - '.backup'\n            - '.bak'\n            - '.old'\n            - '.orig'\n            - '.temp'\n            - '.tmp'\n    filter_optional_anaconda:\n        TargetFilename|contains: ':\\ProgramData\\Anaconda3\\'\n        TargetFilename|endswith: '.c~'\n    condition: selection and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Backup software\nlevel: medium\n"},{"path":"file\\file_executable_detected\\file_executable_detected_win_susp_embeded_sed_file.yml","content":"title: Potentially Suspicious Self Extraction Directive File Created\nid: ab90dab8-c7da-4010-9193-563528cfa347\nrelated:\n    - id: 760e75d8-c3b5-409b-a9bf-6130b4c4603f\n      type: derived\nstatus: test\ndescription: |\n    Detects the creation of a binary file with the \".sed\" extension. The \".sed\" extension stand for Self Extraction Directive files.\n    These files are used by the \"iexpress.exe\" utility in order to create self extracting packages.\n    Attackers were seen abusing this utility and creating PE files with embedded \".sed\" entries.\n    Usually \".sed\" files are simple ini files and not PE binaries.\nreferences:\n    - https://strontic.github.io/xcyclopedia/library/iexpress.exe-D594B2A33EFAFD0EABF09E3FDC05FCEA.html\n    - https://en.wikipedia.org/wiki/IExpress\n    - https://www.virustotal.com/gui/file/602f4ae507fa8de57ada079adff25a6c2a899bd25cd092d0af7e62cdb619c93c/behavior\nauthor: Joseliyo Sanchez, @Joseliyo_Jstnk\ndate: 2024-02-05\ntags:\n    - attack.defense-evasion\n    - attack.t1218\nlogsource:\n    product: windows\n    category: file_executable_detected\ndetection:\n    selection:\n        TargetFilename|endswith: '.sed'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_writing_local_admin_share.yml","content":"title: Writing Local Admin Share\nid: 4aafb0fa-bff5-4b9d-b99e-8093e659c65f\nstatus: test\ndescription: |\n    Aversaries may use to interact with a remote network share using Server Message Block (SMB).\n    This technique is used by post-exploitation frameworks.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1021.002/T1021.002.md#atomic-test-4---execute-command-writing-output-to-local-admin-share\nauthor: frack113\ndate: 2022-01-01\nmodified: 2022-08-13\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.lateral-movement\n    - attack.t1546.002\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|contains|all:\n            - '\\\\\\\\127.0.0'\n            - '\\ADMIN$\\'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_wpbbin_persistence.yml","content":"title: UEFI Persistence Via Wpbbin - FileCreation\nid: e94b9ddc-eec5-4bb8-8a58-b9dc5f4e185f\nstatus: test\ndescription: Detects creation of a file named \"wpbbin\" in the \"%systemroot%\\system32\\\" directory. Which could be indicative of UEFI based persistence method\nreferences:\n    - https://grzegorztworek.medium.com/using-uefi-to-inject-executable-files-into-bitlocker-protected-drives-8ff4ca59c94c\n    - https://persistence-info.github.io/Data/wpbbin.html\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-07-18\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1542.001\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename: 'C:\\Windows\\System32\\wpbbin.exe'\n    condition: selection\nfalsepositives:\n    - Legitimate usage of the file by hardware manufacturer such as lenovo (Thanks @0gtweet for the tip)\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_wmi_persistence_script_event_consumer_write.yml","content":"title: WMI Persistence - Script Event Consumer File Write\nid: 33f41cdd-35ac-4ba8-814b-c6a4244a1ad4\nstatus: test\ndescription: Detects file writes of WMI script event consumer\nreferences:\n    - https://www.eideon.com/2018-03-02-THL03-WMIBackdoors/\nauthor: Thomas Patzke\ndate: 2018-03-07\nmodified: 2021-11-27\ntags:\n    - attack.privilege-escalation\n    - attack.t1546.003\n    - attack.persistence\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        Image: 'C:\\WINDOWS\\system32\\wbem\\scrcons.exe'\n    condition: selection\nfalsepositives:\n    - Dell Power Manager (C:\\Program Files\\Dell\\PowerManager\\DpmPowerPlanSetup.exe)\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_wmiprvse_wbemcomn_dll_hijack.yml","content":"title: Wmiprvse Wbemcomn DLL Hijack - File\nid: 614a7e17-5643-4d89-b6fe-f9df1a79641c\nstatus: test\ndescription: Detects a threat actor creating a file named `wbemcomn.dll` in the `C:\\Windows\\System32\\wbem\\` directory over the network and loading it for a WMI DLL Hijack scenario.\nreferences:\n    - https://threathunterplaybook.com/hunts/windows/201009-RemoteWMIWbemcomnDLLHijack/notebook.html\nauthor: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)\ndate: 2020-10-12\nmodified: 2022-12-02\ntags:\n    - attack.execution\n    - attack.t1047\n    - attack.lateral-movement\n    - attack.t1021.002\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        Image: System\n        TargetFilename|endswith: '\\wbem\\wbemcomn.dll'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: critical\n"},{"path":"file\\file_event\\file_event_win_wmiexec_default_filename.yml","content":"title: Wmiexec Default Output File\nid: 8d5aca11-22b3-4f22-b7ba-90e60533e1fb\nstatus: test\ndescription: Detects the creation of the default output filename used by the wmiexec tool\nreferences:\n    - https://www.crowdstrike.com/blog/how-to-detect-and-prevent-impackets-wmiexec/\n    - https://github.com/fortra/impacket/blob/f4b848fa27654ca95bc0f4c73dbba8b9c2c9f30a/examples/wmiexec.py\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-06-02\nmodified: 2023-03-08\ntags:\n    - attack.lateral-movement\n    - attack.execution\n    - attack.t1047\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        - TargetFilename|re: '\\\\Windows\\\\__1\\d{9}\\.\\d{1,7}$' # Admin$\n        - TargetFilename|re: 'C:\\\\__1\\d{9}\\.\\d{1,7}$' # C$\n        - TargetFilename|re: 'D:\\\\__1\\d{9}\\.\\d{1,7}$' # D$\n    condition: selection\nfalsepositives:\n    - Unlikely\nlevel: critical\n"},{"path":"file\\file_event\\file_event_win_winrm_awl_bypass.yml","content":"title: AWL Bypass with Winrm.vbs and Malicious WsmPty.xsl/WsmTxt.xsl - File\nid: d353dac0-1b41-46c2-820c-d7d2561fc6ed\nrelated:\n    - id: 074e0ded-6ced-4ebd-8b4d-53f55908119d\n      type: derived\nstatus: test\ndescription: Detects execution of attacker-controlled WsmPty.xsl or WsmTxt.xsl via winrm.vbs and copied cscript.exe (can be renamed)\nreferences:\n    - https://posts.specterops.io/application-whitelisting-bypass-and-arbitrary-unsigned-code-execution-technique-in-winrm-vbs-c8c24fb40404\nauthor: Julia Fomina, oscd.community\ndate: 2020-10-06\nmodified: 2022-11-28\ntags:\n    - attack.defense-evasion\n    - attack.t1216\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    system_files:\n        TargetFilename|endswith:\n            - 'WsmPty.xsl'\n            - 'WsmTxt.xsl'\n    in_system_folder:\n        TargetFilename|startswith:\n            - 'C:\\Windows\\System32\\'\n            - 'C:\\Windows\\SysWOW64\\'\n    condition: system_files and not in_system_folder\nfalsepositives:\n    - Unlikely\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_winrar_file_creation_in_startup_folder.yml","content":"title: WinRAR Creating Files in Startup Locations\nid: 74a2b37d-fea4-41e0-9ac7-c9fbcf1f60cc\nstatus: experimental\ndescription: |\n    Detects WinRAR creating files in Windows startup locations, which may indicate an attempt to establish persistence by adding malicious files to the Startup folder.\n    This kind of behaviour has been associated with exploitation of WinRAR path traversal vulnerability CVE-2025-6218 or CVE-2025-8088.\nreferences:\n    - https://github.com/mulwareX/CVE-2025-6218-POC\n    - https://x.com/0x534c/status/1944694507787710685\n    - https://www.welivesecurity.com/en/eset-research/update-winrar-tools-now-romcom-and-others-exploiting-zero-day-vulnerability/\nauthor: Swachchhanda Shrawan Poudel (Nextron Systems)\ndate: 2025-07-16\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547.001\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        Image|endswith:\n            - '\\WinRAR.exe'\n            - '\\Rar.exe'\n        TargetFilename|contains: '\\Start Menu\\Programs\\Startup\\'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_werfault_dll_hijacking.yml","content":"title: Creation of WerFault.exe/Wer.dll in Unusual Folder\nid: 28a452f3-786c-4fd8-b8f2-bddbe9d616d1\nstatus: test\ndescription: Detects the creation of a file named \"WerFault.exe\" or \"wer.dll\" in an uncommon folder, which could be a sign of WerFault DLL hijacking.\nreferences:\n    - https://www.bleepingcomputer.com/news/security/hackers-are-now-hiding-malware-in-windows-event-logs/\nauthor: frack113\ndate: 2022-05-09\nmodified: 2024-11-28\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1574.001\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|endswith:\n            - '\\WerFault.exe'\n            - '\\wer.dll'\n    filter_main_known_locations:\n        TargetFilename|startswith:\n            - 'C:\\Windows\\SoftwareDistribution\\'\n            - 'C:\\Windows\\System32\\'\n            - 'C:\\Windows\\SysWOW64\\'\n            - 'C:\\Windows\\WinSxS\\'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_webshell_creation_detect.yml","content":"title: Potential Webshell Creation On Static Website\nid: 39f1f9f2-9636-45de-98f6-a4046aa8e4b9\nstatus: test\ndescription: Detects the creation of files with certain extensions on a static web site. This can be indicative of potential uploads of a web shell.\nreferences:\n    - PT ESC rule and personal experience\n    - https://github.com/swisskyrepo/PayloadsAllTheThings/blob/c95a0a1a2855dc0cd7f7327614545fe30482a636/Upload%20Insecure%20Files/README.md\nauthor: Beyu Denis, oscd.community, Tim Shelton, Thurein Oo\ndate: 2019-10-22\nmodified: 2023-10-15\ntags:\n    - attack.persistence\n    - attack.t1505.003\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection_wwwroot_path:\n        TargetFilename|contains: '\\inetpub\\wwwroot\\'\n    selection_wwwroot_ext:\n        TargetFilename|contains:\n            - '.ashx'\n            - '.asp'\n            - '.ph'\n            - '.soap'\n    selection_htdocs_path:\n        TargetFilename|contains:\n            - '\\www\\'\n            - '\\htdocs\\'\n            - '\\html\\'\n    selection_htdocs_ext:\n        TargetFilename|contains: '.ph'\n    # selection_tomcat_path:\n    #     TargetFilename|contains: '\\webapps\\ROOT'\n    # selection_tomcat_ext:\n    #     TargetFilename|contains:\n    #         - '.jsp' # .jspx, .jspf\n    #         - '.jsv'\n    #         - '.jsw'\n    filter_main_temp:  # FP when unpacking some executables in $TEMP\n        TargetFilename|contains:\n            - '\\AppData\\Local\\Temp\\'\n            - '\\Windows\\Temp\\'\n    filter_main_system:\n        Image: 'System' # FP when backup/restore from drivers\n    filter_main_legitimate:\n        TargetFilename|contains: '\\xampp'\n    condition: (all of selection_wwwroot_* or all of selection_htdocs_*) and not 1 of filter_main_*\nfalsepositives:\n    - Legitimate administrator or developer creating legitimate executable files in a web application folder\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_vscode_tunnel_renamed_execution.yml","content":"title: Renamed VsCode Code Tunnel Execution - File Indicator\nid: d102b8f5-61dc-4e68-bd83-9a3187c67377\nstatus: test\ndescription: |\n    Detects the creation of a file with the name \"code_tunnel.json\" which indicate execution and usage of VsCode tunneling utility by an \"Image\" or \"Process\" other than VsCode.\nreferences:\n    - https://ipfyx.fr/post/visual-studio-code-tunnel/\n    - https://badoption.eu/blog/2023/01/31/code_c2.html\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-10-25\ntags:\n    - attack.command-and-control\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|endswith: '\\code_tunnel.json'\n    filter_main_legit_name:\n        # Note: There might be other legitimate names for VsCode. Please add them if found\n        Image|endswith:\n            - '\\code-tunnel.exe'\n            - '\\code.exe'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_vscode_tunnel_remote_creation_artefacts.yml","content":"title: Visual Studio Code Tunnel Remote File Creation\nid: 56e05d41-ce99-4ecd-912d-93f019ee0b71\nstatus: test\ndescription: |\n    Detects the creation of file by the \"node.exe\" process in the \".vscode-server\" directory. Could be a sign of remote file creation via VsCode tunnel feature\nreferences:\n    - Internal Research\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-10-25\ntags:\n    - attack.command-and-control\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        Image|contains: '\\servers\\Stable-'\n        Image|endswith: '\\server\\node.exe'\n        TargetFilename|contains: '\\.vscode-server\\data\\User\\History\\'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_vhd_download_via_browsers.yml","content":"title: VHD Image Download Via Browser\nid: 8468111a-ef07-4654-903b-b863a80bbc95\nstatus: test\ndescription: |\n    Detects creation of \".vhd\"/\".vhdx\" files by browser processes.\n    Malware can use mountable Virtual Hard Disk \".vhd\" files to encapsulate payloads and evade security controls.\nreferences:\n    - https://redcanary.com/blog/intelligence-insights-october-2021/\n    - https://www.kaspersky.com/blog/lazarus-vhd-ransomware/36559/\n    - https://securelist.com/lazarus-on-the-hunt-for-big-game/97757/\nauthor: frack113, Christopher Peacock '@securepeacock', SCYTHE '@scythe_io'\ndate: 2021-10-25\nmodified: 2023-05-05\ntags:\n    - attack.resource-development\n    - attack.t1587.001\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        Image|endswith:\n            - '\\brave.exe'\n            - '\\chrome.exe'\n            - '\\firefox.exe'\n            - '\\iexplore.exe'\n            - '\\maxthon.exe'\n            - '\\MicrosoftEdge.exe'\n            - '\\msedge.exe'\n            - '\\msedgewebview2.exe'\n            - '\\opera.exe'\n            - '\\safari.exe'\n            - '\\seamonkey.exe'\n            - '\\vivaldi.exe'\n            - '\\whale.exe'\n        # We don't use \"endswith\" to also match with ADS logs and \".vhdx\". Example: \"TargetFilename: C:\\Users\\xxx\\Downloads\\windows.vhd:Zone.Identifier\"\n        TargetFilename|contains: '.vhd'\n    condition: selection\nfalsepositives:\n    - Legitimate downloads of \".vhd\" files would also trigger this\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_uac_bypass_wmp.yml","content":"title: UAC Bypass Using Windows Media Player - File\nid: 68578b43-65df-4f81-9a9b-92f32711a951\nstatus: test\ndescription: Detects the pattern of UAC Bypass using Windows Media Player osksupport.dll (UACMe 32)\nreferences:\n    - https://github.com/hfiref0x/UACME\nauthor: Christian Burkard (Nextron Systems)\ndate: 2021-08-23\nmodified: 2022-10-09\ntags:\n    - attack.defense-evasion\n    - attack.privilege-escalation\n    - attack.t1548.002\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection1:\n        TargetFilename|startswith: 'C:\\Users\\'\n        TargetFilename|endswith: '\\AppData\\Local\\Temp\\OskSupport.dll'\n    selection2:\n        Image: 'C:\\Windows\\system32\\DllHost.exe'\n        TargetFilename: 'C:\\Program Files\\Windows Media Player\\osk.exe'\n    condition: 1 of selection*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_uac_bypass_winsat.yml","content":"title: UAC Bypass Abusing Winsat Path Parsing - File\nid: 155dbf56-e0a4-4dd0-8905-8a98705045e8\nstatus: test\ndescription: Detects the pattern of UAC Bypass using a path parsing issue in winsat.exe (UACMe 52)\nreferences:\n    - https://github.com/hfiref0x/UACME\nauthor: Christian Burkard (Nextron Systems)\ndate: 2021-08-30\nmodified: 2022-10-09\ntags:\n    - attack.defense-evasion\n    - attack.privilege-escalation\n    - attack.t1548.002\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|startswith: 'C:\\Users\\'\n        TargetFilename|endswith:\n            - '\\AppData\\Local\\Temp\\system32\\winsat.exe'\n            - '\\AppData\\Local\\Temp\\system32\\winmm.dll'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_uac_bypass_ntfs_reparse_point.yml","content":"title: UAC Bypass Using NTFS Reparse Point - File\nid: 7fff6773-2baa-46de-a24a-b6eec1aba2d1\nstatus: test\ndescription: Detects the pattern of UAC Bypass using NTFS reparse point and wusa.exe DLL hijacking (UACMe 36)\nreferences:\n    - https://github.com/hfiref0x/UACME\nauthor: Christian Burkard (Nextron Systems)\ndate: 2021-08-30\nmodified: 2022-10-09\ntags:\n    - attack.defense-evasion\n    - attack.privilege-escalation\n    - attack.t1548.002\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|startswith: 'C:\\Users\\'\n        TargetFilename|endswith: '\\AppData\\Local\\Temp\\api-ms-win-core-kernel32-legacy-l1.DLL'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_uac_bypass_msconfig_gui.yml","content":"title: UAC Bypass Using MSConfig Token Modification - File\nid: 41bb431f-56d8-4691-bb56-ed34e390906f\nstatus: test\ndescription: Detects the pattern of UAC Bypass using a msconfig GUI hack (UACMe 55)\nreferences:\n    - https://github.com/hfiref0x/UACME\nauthor: Christian Burkard (Nextron Systems)\ndate: 2021-08-30\nmodified: 2022-10-09\ntags:\n    - attack.defense-evasion\n    - attack.privilege-escalation\n    - attack.t1548.002\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|startswith: 'C:\\Users\\'\n        TargetFilename|endswith: '\\AppData\\Local\\Temp\\pkgmgr.exe'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_uac_bypass_ieinstal.yml","content":"title: UAC Bypass Using IEInstal - File\nid: bdd8157d-8e85-4397-bb82-f06cc9c71dbb\nstatus: test\ndescription: Detects the pattern of UAC Bypass using IEInstal.exe (UACMe 64)\nreferences:\n    - https://github.com/hfiref0x/UACME\nauthor: Christian Burkard (Nextron Systems)\ndate: 2021-08-30\nmodified: 2022-10-09\ntags:\n    - attack.defense-evasion\n    - attack.privilege-escalation\n    - attack.t1548.002\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        Image: 'C:\\Program Files\\Internet Explorer\\IEInstal.exe'\n        TargetFilename|startswith: 'C:\\Users\\'\n        TargetFilename|contains: '\\AppData\\Local\\Temp\\'\n        TargetFilename|endswith: 'consent.exe'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_uac_bypass_idiagnostic_profile.yml","content":"title: UAC Bypass Using IDiagnostic Profile - File\nid: 48ea844d-19b1-4642-944e-fe39c2cc1fec\nstatus: test\ndescription: Detects the creation of a file by \"dllhost.exe\" in System32 directory part of \"IDiagnosticProfileUAC\" UAC bypass technique\nreferences:\n    - https://github.com/Wh04m1001/IDiagnosticProfileUAC\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-07-03\ntags:\n    - attack.execution\n    - attack.defense-evasion\n    - attack.privilege-escalation\n    - attack.t1548.002\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        Image|endswith: '\\DllHost.exe'\n        TargetFilename|startswith: 'C:\\Windows\\System32\\'\n        TargetFilename|endswith: '.dll'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_uac_bypass_eventvwr.yml","content":"title: UAC Bypass Using EventVwr\nid: 63e4f530-65dc-49cc-8f80-ccfa95c69d43\nstatus: test\ndescription: Detects the pattern of a UAC bypass using Windows Event Viewer\nreferences:\n    - https://twitter.com/orange_8361/status/1518970259868626944?s=20&t=RFXqZjtA7tWM3HxqEH78Aw\n    - https://twitter.com/splinter_code/status/1519075134296006662?s=12&t=DLUXH86WtcmG_AZ5gY3C6g\n    - https://lolbas-project.github.io/lolbas/Binaries/Eventvwr/#execute\nauthor: Antonio Cocomazzi (idea), Florian Roth (Nextron Systems)\ndate: 2022-04-27\nmodified: 2022-11-22\ntags:\n    - attack.defense-evasion\n    - attack.privilege-escalation\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|endswith:\n            # Removed the start just in case the logging backend doesn't expand ENV variables when they're used\n            - '\\Microsoft\\Event Viewer\\RecentViews'\n            - '\\Microsoft\\EventV~1\\RecentViews'\n    filter:\n        Image|startswith:\n            - 'C:\\Windows\\System32\\'\n            - 'C:\\Windows\\SysWOW64\\'\n    condition: selection and not filter\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_uac_bypass_dotnet_profiler.yml","content":"title: UAC Bypass Using .NET Code Profiler on MMC\nid: 93a19907-d4f9-4deb-9f91-aac4692776a6\nstatus: test\ndescription: Detects the pattern of UAC Bypass using .NET Code Profiler and mmc.exe DLL hijacking (UACMe 39)\nreferences:\n    - https://github.com/hfiref0x/UACME\nauthor: Christian Burkard (Nextron Systems)\ndate: 2021-08-30\nmodified: 2022-10-09\ntags:\n    - attack.defense-evasion\n    - attack.privilege-escalation\n    - attack.t1548.002\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|startswith: 'C:\\Users\\'\n        TargetFilename|endswith: '\\AppData\\Local\\Temp\\pe386.dll'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_uac_bypass_consent_comctl32.yml","content":"title: UAC Bypass Using Consent and Comctl32 - File\nid: 62ed5b55-f991-406a-85d9-e8e8fdf18789\nstatus: test\ndescription: Detects the pattern of UAC Bypass using consent.exe and comctl32.dll (UACMe 22)\nreferences:\n    - https://github.com/hfiref0x/UACME\nauthor: Christian Burkard (Nextron Systems)\ndate: 2021-08-23\nmodified: 2022-10-09\ntags:\n    - attack.defense-evasion\n    - attack.privilege-escalation\n    - attack.t1548.002\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|startswith: 'C:\\Windows\\System32\\consent.exe.@'\n        TargetFilename|endswith: '\\comctl32.dll'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_tsclient_filewrite_startup.yml","content":"title: Hijack Legit RDP Session to Move Laterally\nid: 52753ea4-b3a0-4365-910d-36cff487b789\nstatus: test\ndescription: Detects the usage of tsclient share to place a backdoor on the RDP source machine's startup folder\nauthor: Samir Bousseaden\nreferences:\n    - Internal Research\ndate: 2019-02-21\nmodified: 2021-11-27\ntags:\n    - attack.command-and-control\n    - attack.t1219.002\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        Image|endswith: '\\mstsc.exe'\n        TargetFilename|contains: '\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\'\n    condition: selection\nfalsepositives:\n    - Unlikely\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_taskmgr_lsass_dump.yml","content":"title: LSASS Process Memory Dump Creation Via Taskmgr.EXE\nid: 69ca12af-119d-44ed-b50f-a47af0ebc364\nstatus: test\ndescription: Detects the creation of an \"lsass.dmp\" file by the taskmgr process. This indicates a manual dumping of the LSASS.exe process memory using Windows Task Manager.\nauthor: Swachchhanda Shrawan Poudel\ndate: 2023-10-19\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/987e3ca988ae3cff4b9f6e388c139c05bf44bbb8/atomics/T1003.001/T1003.001.md#L1\ntags:\n    - attack.credential-access\n    - attack.t1003.001\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        Image|endswith:\n            - ':\\Windows\\system32\\taskmgr.exe'\n            - ':\\Windows\\SysWOW64\\taskmgr.exe'\n        TargetFilename|contains|all:\n            - '\\AppData\\Local\\Temp\\'\n            - '\\lsass'\n            - '.DMP'\n    condition: selection\nfalsepositives:\n    - Rare case of troubleshooting by an administrator or support that has to be investigated regardless\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_system32_local_folder_privilege_escalation.yml","content":"title: Potential Privilege Escalation Attempt Via .Exe.Local Technique\nid: 07a99744-56ac-40d2-97b7-2095967b0e03\nstatus: test\ndescription: Detects potential privilege escalation attempt via the creation of the \"*.Exe.Local\" folder inside the \"System32\" directory in order to sideload \"comctl32.dll\"\nreferences:\n    - https://github.com/binderlabs/DirCreate2System\n    - https://github.com/sailay1996/awesome_windows_logical_bugs/blob/60cbb23a801f4c3195deac1cc46df27c225c3d07/dir_create2system.txt\nauthor: Nasreddine Bencherchali (Nextron Systems), Subhash P (@pbssubhash)\ndate: 2022-12-16\nmodified: 2022-12-19\ntags:\n    - attack.defense-evasion\n    - attack.persistence\n    - attack.privilege-escalation\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|startswith:\n            - 'C:\\Windows\\System32\\logonUI.exe.local'\n            - 'C:\\Windows\\System32\\werFault.exe.local'\n            - 'C:\\Windows\\System32\\consent.exe.local'\n            - 'C:\\Windows\\System32\\narrator.exe.local'\n            - 'C:\\Windows\\System32\\wermgr.exe.local'\n        TargetFilename|endswith: '\\comctl32.dll'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_sysinternals_psexec_service_key.yml","content":"title: PSEXEC Remote Execution File Artefact\nid: 304afd73-55a5-4bb9-8c21-0b1fc84ea9e4\nstatus: test\ndescription: Detects creation of the PSEXEC key file. Which is created anytime a PsExec command is executed. It gets written to the file system and will be recorded in the USN Journal on the target system\nreferences:\n    - https://aboutdfir.com/the-key-to-identify-psexec/\n    - https://twitter.com/davisrichardg/status/1616518800584704028\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-01-21\nmodified: 2023-02-23\ntags:\n    - attack.lateral-movement\n    - attack.privilege-escalation\n    - attack.execution\n    - attack.persistence\n    - attack.t1136.002\n    - attack.t1543.003\n    - attack.t1570\n    - attack.s0029\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|startswith: 'C:\\Windows\\PSEXEC-'\n        TargetFilename|endswith: '.key'\n    condition: selection\nfalsepositives:\n    - Unlikely\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_sysinternals_psexec_service.yml","content":"title: PsExec Service File Creation\nid: 259e5a6a-b8d2-4c38-86e2-26c5e651361d\nrelated:\n    - id: 42c575ea-e41e-41f1-b248-8093c3e82a28\n      type: derived\nstatus: test\ndescription: Detects default PsExec service filename which indicates PsExec service installation and execution\nreferences:\n    - https://www.jpcert.or.jp/english/pub/sr/ir_research.html\n    - https://jpcertcc.github.io/ToolAnalysisResultSheet\nauthor: Thomas Patzke\ndate: 2017-06-12\nmodified: 2022-10-26\ntags:\n    - attack.execution\n    - attack.t1569.002\n    - attack.s0029\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|endswith: '\\PSEXESVC.exe'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: low\n"},{"path":"file\\file_event\\file_event_win_sysinternals_procmon_driver_susp_creation.yml","content":"title: Process Monitor Driver Creation By Non-Sysinternals Binary\nid: a05baa88-e922-4001-bc4d-8738135f27de\nstatus: test\ndescription: Detects creation of the Process Monitor driver by processes other than Process Monitor (procmon) itself.\nreferences:\n    - Internal Research\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-05-05\ntags:\n    - attack.persistence\n    - attack.privilege-escalation\n    - attack.t1068\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|contains: '\\procmon'\n        TargetFilename|endswith: '.sys'\n    filter_main_process_explorer:\n        Image|endswith:\n            - '\\procmon.exe'\n            - '\\procmon64.exe'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Some false positives may occur with legitimate renamed process monitor binaries\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_sysinternals_procexp_driver_susp_creation.yml","content":"title: Process Explorer Driver Creation By Non-Sysinternals Binary\nid: de46c52b-0bf8-4936-a327-aace94f94ac6\nstatus: test\ndescription: |\n    Detects creation of the Process Explorer drivers by processes other than Process Explorer (procexp) itself.\n    Hack tools or malware may use the Process Explorer driver to elevate privileges, drops it to disk for a few moments, runs a service using that driver and removes it afterwards.\nreferences:\n    - https://learn.microsoft.com/en-us/sysinternals/downloads/process-explorer\n    - https://github.com/Yaxser/Backstab\n    - https://www.elastic.co/security-labs/stopping-vulnerable-driver-attacks\n    - https://news.sophos.com/en-us/2023/04/19/aukill-edr-killer-malware-abuses-process-explorer-driver/\nauthor: Florian Roth (Nextron Systems)\ndate: 2023-05-05\ntags:\n    - attack.persistence\n    - attack.privilege-escalation\n    - attack.t1068\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|contains: '\\PROCEXP'\n        TargetFilename|endswith: '.sys'\n    filter_main_process_explorer:\n        Image|endswith:\n            - '\\procexp.exe'\n            - '\\procexp64.exe'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Some false positives may occur with legitimate renamed process explorer binaries\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_sysinternals_livekd_driver_susp_creation.yml","content":"title: LiveKD Driver Creation By Uncommon Process\nid: 059c5af9-5131-4d8d-92b2-de4ad6146712\nrelated:\n    - id: 16fe46bb-4f64-46aa-817d-ff7bec4a2352\n      type: similar\nstatus: test\ndescription: Detects the creation of the LiveKD driver by a process image other than \"livekd.exe\".\nreferences:\n    - Internal Research\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-05-16\ntags:\n    - attack.defense-evasion\n    - attack.privilege-escalation\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename: 'C:\\Windows\\System32\\drivers\\LiveKdD.SYS'\n    filter_main_legit_name:\n        Image|endswith:\n            - '\\livekd.exe'\n            - '\\livek64.exe'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Administrators might rename LiveKD before its usage which could trigger this. Add additional names you use to the filter\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_sysinternals_livekd_driver.yml","content":"title: LiveKD Driver Creation\nid: 16fe46bb-4f64-46aa-817d-ff7bec4a2352\nstatus: test\ndescription: Detects the creation of the LiveKD driver, which is used for live kernel debugging\nreferences:\n    - Internal Research\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-05-16\ntags:\n    - attack.defense-evasion\n    - attack.privilege-escalation\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename: 'C:\\Windows\\System32\\drivers\\LiveKdD.SYS'\n        Image|endswith:\n            - '\\livekd.exe'\n            - '\\livek64.exe'\n    condition: selection\nfalsepositives:\n    - Legitimate usage of LiveKD for debugging purposes will also trigger this\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_sysinternals_livekd_default_dump_name.yml","content":"title: LiveKD Kernel Memory Dump File Created\nid: 814ddeca-3d31-4265-8e07-8cc54fb44903\nstatus: test\ndescription: Detects the creation of a file that has the same name as the default LiveKD kernel memory dump.\nreferences:\n    - Internal Research\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-05-16\ntags:\n    - attack.defense-evasion\n    - attack.privilege-escalation\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename: 'C:\\Windows\\livekd.dmp'\n    condition: selection\nfalsepositives:\n    - In rare occasions administrators might leverage LiveKD to perform live kernel debugging. This should not be allowed on production systems. Investigate and apply additional filters where necessary.\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_sysinternals_adexplorer_dump_written.yml","content":"title: ADExplorer Writing Complete AD Snapshot Into .dat File\nid: 0a1255c5-d732-4b62-ac02-b5152d34fb83\nrelated:\n    - id: 9212f354-7775-4e28-9c9f-8f0a4544e664\n      type: similar\nstatus: experimental\ndescription: Detects the dual use tool ADExplorer writing a complete AD snapshot into a .dat file. This can be used by attackers to extract data for Bloodhound, usernames for password spraying or use the meta data for social engineering. The snapshot doesn't contain password hashes but there have been cases, where administrators put passwords in the comment field.\nreferences:\n    - https://learn.microsoft.com/de-de/sysinternals/downloads/adexplorer\n    - https://github.com/c3c/ADExplorerSnapshot.py/tree/f700904defac330802bbfedd1d8ffd9248f4ee24\n    - https://www.packetlabs.net/posts/scattered-spider-is-a-young-ransomware-gang-exploiting-large-corporations/\n    - https://www.nccgroup.com/us/research-blog/lapsus-recent-techniques-tactics-and-procedures/\n    - https://trustedsec.com/blog/adexplorer-on-engagements\nauthor: Arnim Rupp (Nextron Systems), Thomas Patzke\ndate: 2025-07-09\ntags:\n    - attack.discovery\n    - attack.t1087.002\n    - attack.t1069.002\n    - attack.t1482\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        Image|endswith:\n            - '\\ADExp.exe'\n            - '\\ADExplorer.exe'\n            - '\\ADExplorer64.exe'\n            - '\\ADExplorer64a.exe'\n        TargetFilename|endswith: '.dat'\n    condition: selection\nfalsepositives:\n    - Legitimate use of ADExplorer by administrators creating .dat snapshots\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_susp_winsxs_binary_creation.yml","content":"title: WinSxS Executable File Creation By Non-System Process\nid: 34746e8c-5fb8-415a-b135-0abc167e912a\nrelated:\n    - id: 64827580-e4c3-4c64-97eb-c72325d45399\n      type: derived\nstatus: test\ndescription: Detects the creation of binaries in the WinSxS folder by non-system processes\nreferences:\n    - https://media.defense.gov/2023/May/09/2003218554/-1/-1/0/JOINT_CSA_HUNTING_RU_INTEL_SNAKE_MALWARE_20230509.PDF\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-05-11\ntags:\n    - attack.execution\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|startswith: 'C:\\Windows\\WinSxS\\'\n        TargetFilename|endswith: '.exe'\n    filter_main_system_location:\n        Image|startswith:\n            - 'C:\\Windows\\Systems32\\'\n            - 'C:\\Windows\\SysWOW64\\'\n            - 'C:\\Windows\\WinSxS\\'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_susp_windows_terminal_profile.yml","content":"title: Windows Terminal Profile Settings Modification By Uncommon Process\nid: 9b64de98-9db3-4033-bd7a-f51430105f00\nstatus: test\ndescription: Detects the creation or modification of the Windows Terminal Profile settings file \"settings.json\" by an uncommon process.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/74438b0237d141ee9c99747976447dc884cb1a39/atomics/T1547.015/T1547.015.md#atomic-test-1---persistence-by-modifying-windows-terminal-profile\n    - https://twitter.com/nas_bench/status/1550836225652686848\nauthor: frack113, Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-07-22\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547.015\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        Image|endswith:\n            # Note: Add other potential common applications\n            - '\\cmd.exe'\n            - '\\cscript.exe'\n            - '\\mshta.exe'\n            - '\\powershell.exe'\n            - '\\pwsh.exe'\n            - '\\wscript.exe'\n        TargetFilename|endswith: '\\AppData\\Local\\Packages\\Microsoft.WindowsTerminal_8wekyb3d8bbwe\\LocalState\\settings.json'\n    condition: selection\nfalsepositives:\n    - Some false positives may occur with admin scripts that set WT settings.\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_susp_wdac_policy_creation.yml","content":"title: Potentially Suspicious WDAC Policy File Creation\nid: 1d2de8a6-4803-4fde-b85b-f58f3aa7a705\nstatus: experimental\ndescription: |\n    Detects suspicious Windows Defender Application Control (WDAC) policy file creation from abnormal processes that could be abused by attacker to block EDR/AV components while allowing their own malicious code to run on the system.\nreferences:\n    - https://learn.microsoft.com/en-us/windows/security/application-security/application-control/app-control-for-business/deployment/deploy-appcontrol-policies-using-group-policy\n    - https://beierle.win/2024-12-20-Weaponizing-WDAC-Killing-the-Dreams-of-EDR/\n    - https://github.com/logangoins/Krueger/tree/main\n    - https://learn.microsoft.com/en-us/windows/security/application-security/application-control/app-control-for-business/deployment/appcontrol-deployment-guide\n    - https://learn.microsoft.com/en-us/windows/security/application-security/application-control/app-control-for-business/deployment/deploy-appcontrol-policies-with-script\n    - https://learn.microsoft.com/en-us/windows/security/application-security/application-control/app-control-for-business/deployment/deploy-appcontrol-policies-with-memcm\nauthor: X__Junior\ndate: 2025-02-07\nmodified: 2025-04-21\ntags:\n    - attack.defense-evasion\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection_target:\n        # This is a default location but unfortunately it could be any path configured in Group Policy Management Editor.\n        # No file extension needed because any extension would work, check first reference.\n        TargetFilename|contains: '\\Windows\\System32\\CodeIntegrity\\'\n    filter_main_images:\n        Image|endswith:\n            - '\\Microsoft.ConfigurationManagement.exe' # Replace with full path to avoid false negatives\n            - '\\WDAC Wizard.exe' # Replace with full path to avoid false negatives\n            - 'C:\\Program Files\\PowerShell\\7-preview\\pwsh.exe'\n            - 'C:\\Program Files\\PowerShell\\7\\pwsh.exe'\n            - 'C:\\Windows\\System32\\dllhost.exe'\n            - 'C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell_ise.exe'\n            - 'C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe'\n            - 'C:\\Windows\\SysWOW64\\dllhost.exe'\n            - 'C:\\Windows\\SysWOW64\\WindowsPowerShell\\v1.0\\powershell_ise.exe'\n            - 'C:\\Windows\\SysWOW64\\WindowsPowerShell\\v1.0\\powershell.exe'\n    filter_main_cli:\n        - CommandLine|contains|all:\n              - 'ConvertFrom-CIPolicy -XmlFilePath'\n              - '-BinaryFilePath '\n        - CommandLine|contains: 'CiTool --update-policy'\n        - CommandLine|contains|all:\n              - 'Copy-Item -Path'\n              - '-Destination'\n    filter_main_system:\n        Image: 'System'\n    condition: selection_target and not 1 of filter_main_*\nfalsepositives:\n    - Administrators and security vendors could leverage WDAC, apply additional filters as needed.\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_susp_vscode_powershell_profile.yml","content":"title: VsCode Powershell Profile Modification\nid: 3a9fa2ec-30bc-4ebd-b49e-7c9cff225502\nrelated:\n    - id: b5b78988-486d-4a80-b991-930eff3ff8bf\n      type: similar\nstatus: test\ndescription: Detects the creation or modification of a vscode related powershell profile which could indicate suspicious activity as the profile can be used as a mean of persistence\nreferences:\n    - https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_profiles?view=powershell-7.2\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-08-24\nmodified: 2023-01-06\ntags:\n    - attack.persistence\n    - attack.privilege-escalation\n    - attack.t1546.013\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|endswith: '\\Microsoft.VSCode_profile.ps1'\n    condition: selection\nfalsepositives:\n    - Legitimate use of the profile by developers or administrators\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_susp_teamviewer_remote_session.yml","content":"title: TeamViewer Remote Session\nid: 162ab1e4-6874-4564-853c-53ec3ab8be01\nstatus: test\ndescription: Detects the creation of log files during a TeamViewer remote session\nreferences:\n    - https://www.teamviewer.com/en-us/\nauthor: Florian Roth (Nextron Systems)\ndate: 2022-01-30\ntags:\n    - attack.command-and-control\n    - attack.t1219.002\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection1:\n        TargetFilename|endswith:\n            - '\\TeamViewer\\RemotePrinting\\tvprint.db'\n            - '\\TeamViewer\\TVNetwork.log'\n    selection2:\n        TargetFilename|contains|all:\n            - '\\TeamViewer'\n            - '_Logfile.log'\n    condition: 1 of selection*\nfalsepositives:\n    - Legitimate uses of TeamViewer in an organisation\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_susp_task_write.yml","content":"title: Suspicious Scheduled Task Write to System32 Tasks\nid: 80e1f67a-4596-4351-98f5-a9c3efabac95\nstatus: test\ndescription: Detects the creation of tasks from processes executed from suspicious locations\nreferences:\n    - Internal Research\nauthor: Florian Roth (Nextron Systems)\ndate: 2021-11-16\nmodified: 2022-01-12\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.execution\n    - attack.t1053\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|contains: '\\Windows\\System32\\Tasks'\n        Image|contains:\n            - '\\AppData\\'\n            - 'C:\\PerfLogs'\n            - '\\Windows\\System32\\config\\systemprofile'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_susp_system_interactive_powershell.yml","content":"title: Suspicious Interactive PowerShell as SYSTEM\nid: 5b40a734-99b6-4b98-a1d0-1cea51a08ab2\nstatus: test\ndescription: Detects the creation of files that indicator an interactive use of PowerShell in the SYSTEM user context\nreferences:\n    - https://jpcertcc.github.io/ToolAnalysisResultSheet/details/PowerSploit_Invoke-Mimikatz.htm\nauthor: Florian Roth (Nextron Systems)\ndate: 2021-12-07\nmodified: 2022-08-13\ntags:\n    - attack.execution\n    - attack.t1059.001\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename:\n            - 'C:\\Windows\\System32\\config\\systemprofile\\AppData\\Roaming\\Microsoft\\Windows\\PowerShell\\PSReadLine\\ConsoleHost_history.txt'\n            - 'C:\\Windows\\System32\\config\\systemprofile\\AppData\\Local\\Microsoft\\Windows\\PowerShell\\StartupProfileData-Interactive'\n    condition: selection\nfalsepositives:\n    - Administrative activity\n    - PowerShell scripts running as SYSTEM user\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_susp_startup_folder_persistence.yml","content":"title: Suspicious Startup Folder Persistence\nid: 28208707-fe31-437f-9a7f-4b1108b94d2e\nrelated:\n    - id: 2aa0a6b4-a865-495b-ab51-c28249537b75\n      type: similar\nstatus: test\ndescription: |\n    Detects the creation of potentially malicious script and executable files in Windows startup folders, which is a common persistence technique used by threat actors.\n    These files (.ps1, .vbs, .js, .bat, etc.) are automatically executed when a user logs in, making the Startup folder an attractive target for attackers.\n    This technique is frequently observed in malvertising campaigns and malware distribution where attackers attempt to maintain long-term access to compromised systems.\nreferences:\n    - https://github.com/last-byte/PersistenceSniper\n    - https://www.microsoft.com/en-us/security/blog/2025/03/06/malvertising-campaign-leads-to-info-stealers-hosted-on-github/\n    - https://github.com/redcanaryco/atomic-red-team/blob/5ede8f21e42ebe37e0a6eff757dba60bcfa85859/atomics/T1547.001/T1547.001.md\nauthor: Nasreddine Bencherchali (Nextron Systems), Swachchhanda Shrawan Poudel (Nextron Systems)\ndate: 2022-08-10\nmodified: 2025-10-12\ntags:\n    - attack.privilege-escalation\n    - attack.execution\n    - attack.t1204.002\n    - attack.persistence\n    - attack.t1547.001\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|contains: '\\Windows\\Start Menu\\Programs\\Startup\\'\n        TargetFilename|endswith:\n            # Add or remove suspicious extensions according to your env needs\n            - '.bat'\n            - '.cmd'\n            - '.dll'\n            - '.hta'\n            - '.jar'\n            - '.js'\n            - '.jse'\n            - '.msi'\n            - '.ps1'\n            - '.psd1'\n            - '.psm1'\n            - '.scr'\n            - '.url'\n            - '.vba'\n            - '.vbe'\n            - '.vbs'\n            - '.wsf'\n    condition: selection\nfalsepositives:\n    - Rare legitimate usage of some of the extensions mentioned in the rule\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_susp_spool_drivers_color_drop.yml","content":"title: Drop Binaries Into Spool Drivers Color Folder\nid: ce7066a6-508a-42d3-995b-2952c65dc2ce\nstatus: test\ndescription: Detects the creation of suspcious binary files inside the \"\\windows\\system32\\spool\\drivers\\color\\\" as seen in the blog referenced below\nreferences:\n    - https://www.microsoft.com/security/blog/2022/07/27/untangling-knotweed-european-private-sector-offensive-actor-using-0-day-exploits/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-07-28\ntags:\n    - attack.defense-evasion\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|startswith: 'C:\\Windows\\System32\\spool\\drivers\\color\\'\n        TargetFilename|endswith:\n            - '.dll'\n            - '.exe'\n            - '.sys'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_susp_right_to_left_override_extension_spoofing.yml","content":"title: Potential File Extension Spoofing Using Right-to-Left Override\nid: 979baf41-ca44-4540-9d0c-4fcef3b5a3a4\nrelated:\n    - id: ad691d92-15f2-4181-9aa4-723c74f9ddc3\n      type: derived\nstatus: test\ndescription: |\n    Detects suspicious filenames that contain a right-to-left override character and a potentially spoofed file extensions.\nreferences:\n    - https://redcanary.com/blog/right-to-left-override/\n    - https://www.malwarebytes.com/blog/news/2014/01/the-rtlo-method\n    - https://tria.ge/241015-l98snsyeje/behavioral2\n    - https://www.unicode.org/versions/Unicode5.2.0/ch02.pdf\nauthor: Jonathan Peters (Nextron Systems), Florian Roth (Nextron Systems), Swachchhanda Shrawan Poudel (Nextron Systems)\ndate: 2024-11-17\nmodified: 2025-02-06\ntags:\n    - attack.execution\n    - attack.defense-evasion\n    - attack.t1036.002\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection_rtlo_unicode:\n        TargetFilename|contains:\n            - '\\u202e'  # Unicode RTLO character\n            - '[U+202E]'\n    selection_extensions:\n        TargetFilename|contains:\n            - '3pm.'  # Reversed `.mp3`\n            - '4pm.'  # Reversed `.mp4`\n            - 'cod.'  # Reversed `.doc`\n            - 'fdp.'  # Reversed `.pdf`\n            - 'ftr.'  # Reversed `.rtf`\n            - 'gepj.'  # Reversed `.jpeg`\n            - 'gnp.'  # Reversed `.png`\n            - 'gpj.'  # Reversed `.jpg`\n            - 'ism.'  # Reversed `.msi`\n            - 'lmth.'  # Reversed `.html`\n            - 'nls.' # Reversed `.sln`\n            - 'piz.'  # Reversed `.zip`\n            - 'slx.'  # Reversed `.xls`\n            - 'tdo.'  # Reversed `.odt`\n            - 'vsc.'  # Reversed `.csv`\n            - 'vwm.'  # Reversed `.wmv`\n            - 'xcod.'  # Reversed `.docx`\n            - 'xslx.'  # Reversed `.xlsx`\n            - 'xtpp.'  # Reversed `.pptx`\n    condition: all of selection_*\nfalsepositives:\n    - Filenames that contains scriptures such as arabic or hebrew might make use of this character\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_susp_recycle_bin_fake_exec.yml","content":"title: Suspicious File Creation Activity From Fake Recycle.Bin Folder\nid: cd8b36ac-8e4a-4c2f-a402-a29b8fbd5bca\nrelated:\n    - id: 5ce0f04e-3efc-42af-839d-5b3a543b76c0\n      type: derived\nstatus: test\ndescription: Detects file write event from/to a fake recycle bin folder that is often used as a staging directory for malware\nreferences:\n    - https://www.mandiant.com/resources/blog/infected-usb-steal-secrets\n    - https://unit42.paloaltonetworks.com/cloaked-ursa-phishing/\nauthor: X__Junior (Nextron Systems)\ndate: 2023-07-12\nmodified: 2023-12-11\ntags:\n    - attack.persistence\n    - attack.defense-evasion\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        - Image|contains:\n              # e.g. C:\\$RECYCLER.BIN\n              - 'RECYCLERS.BIN\\'\n              - 'RECYCLER.BIN\\'\n        - TargetFilename|contains:\n              # e.g. C:\\$RECYCLER.BIN\n              - 'RECYCLERS.BIN\\'\n              - 'RECYCLER.BIN\\'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_susp_public_folder_extension.yml","content":"title: Suspicious Binaries and Scripts in Public Folder\nid: b447f7de-1e53-4cbf-bfb4-f1f6d0b04e4e\nstatus: experimental\ndescription: Detects the creation of a file with a suspicious extension in the public folder, which could indicate potential malicious activity.\nreferences:\n    - https://intel.thedfirreport.com/events/view/30032 # Private Report\n    - https://intel.thedfirreport.com/eventReports/view/70 # Private Report\n    - https://thedfirreport.com/2025/01/27/cobalt-strike-and-a-pair-of-socks-lead-to-lockbit-ransomware/\nauthor: 'The DFIR Report'\ndate: 2025-01-23\ntags:\n    - attack.execution\n    - attack.t1204\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|contains: ':\\Users\\Public\\'\n        TargetFilename|endswith:\n            - '.bat'\n            - '.dll'\n            - '.exe'\n            - '.hta'\n            - '.js'\n            - '.ps1'\n            - '.vbe'\n            - '.vbs'\n    condition: selection\nfalsepositives:\n    - Administrators deploying legitimate binaries to public folders.\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_susp_procexplorer_driver_created_in_tmp_folder.yml","content":"title: Suspicious PROCEXP152.sys File Created In TMP\nid: 3da70954-0f2c-4103-adff-b7440368f50e\nstatus: test\ndescription: |\n  Detects the creation of the PROCEXP152.sys file in the application-data local temporary folder.\n  This driver is used by Sysinternals Process Explorer but also by KDU (https://github.com/hfiref0x/KDU) or Ghost-In-The-Logs (https://github.com/bats3c/Ghost-In-The-Logs), which uses KDU.\nreferences:\n    - https://web.archive.org/web/20230331181619/https://blog.dylan.codes/evading-sysmon-and-windows-event-logging/\nauthor: xknow (@xknow_infosec), xorxes (@xor_xes)\ndate: 2019-04-08\nmodified: 2022-11-22\ntags:\n    - attack.t1562.001\n    - attack.defense-evasion\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|contains: '\\AppData\\Local\\Temp\\'\n        TargetFilename|endswith: 'PROCEXP152.sys'\n    filter:\n        Image|contains:\n            - '\\procexp64.exe'\n            - '\\procexp.exe'\n            - '\\procmon64.exe'\n            - '\\procmon.exe'\n    condition: selection and not filter\nfalsepositives:\n    - Other legimate tools using this driver and filename (like Sysinternals). Note - Clever attackers may easily bypass this detection by just renaming the driver filename. Therefore just Medium-level and don't rely on it.\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_susp_powershell_profile.yml","content":"title: PowerShell Profile Modification\nid: b5b78988-486d-4a80-b991-930eff3ff8bf\nstatus: test\ndescription: Detects the creation or modification of a powershell profile which could indicate suspicious activity as the profile can be used as a mean of persistence\nreferences:\n    - https://www.welivesecurity.com/2019/05/29/turla-powershell-usage/\n    - https://persistence-info.github.io/Data/powershellprofile.html\nauthor: HieuTT35, Nasreddine Bencherchali (Nextron Systems)\ndate: 2019-10-24\nmodified: 2023-10-23\ntags:\n    - attack.persistence\n    - attack.privilege-escalation\n    - attack.t1546.013\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|endswith:\n            - '\\Microsoft.PowerShell_profile.ps1'\n            - '\\PowerShell\\profile.ps1'\n            - '\\Program Files\\PowerShell\\7-preview\\profile.ps1'\n            - '\\Program Files\\PowerShell\\7\\profile.ps1'\n            - '\\Windows\\System32\\WindowsPowerShell\\v1.0\\profile.ps1'\n            - '\\WindowsPowerShell\\profile.ps1'\n    condition: selection\nfalsepositives:\n    - System administrator creating Powershell profile manually\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_susp_lnk_double_extension.yml","content":"title: Suspicious LNK Double Extension File Created\nid: 3215aa19-f060-4332-86d5-5602511f3ca8\nrelated:\n    - id: b4926b47-a9d7-434c-b3a0-adc3fa0bd13e\n      type: derived\nstatus: test\ndescription: |\n    Detects the creation of files with an \"LNK\" as a second extension. This is sometimes used by malware as a method to abuse the fact that Windows hides the \"LNK\" extension by default.\nreferences:\n    - https://www.crowdstrike.com/blog/meet-crowdstrikes-adversary-of-the-month-for-june-mustang-panda/\n    - https://www.anomali.com/blog/china-based-apt-mustang-panda-targets-minority-groups-public-and-private-sector-organizations\n    - https://www.cybereason.com/blog/research/a-bazar-of-tricks-following-team9s-development-cycles\n    - https://twitter.com/malwrhunterteam/status/1235135745611960321\n    - https://twitter.com/luc4m/status/1073181154126254080\nauthor: Nasreddine Bencherchali (Nextron Systems), frack113\ndate: 2022-11-07\nmodified: 2023-10-18\ntags:\n    - attack.defense-evasion\n    - attack.t1036.007\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|endswith: '.lnk'\n        TargetFilename|contains:\n            - '.doc.'\n            - '.docx.'\n            - '.jpg.'\n            - '.pdf.'\n            - '.ppt.'\n            - '.pptx.'\n            - '.xls.'\n            - '.xlsx.'\n    filter_main_recent:\n        TargetFilename|contains: '\\AppData\\Roaming\\Microsoft\\Windows\\Recent\\'\n    filter_optional_office_recent:\n        Image|endswith:\n            # Note: Some additional office application might need to be added\n            - '\\excel.exe'\n            - '\\powerpnt.exe'\n            - '\\winword.exe'\n        TargetFilename|contains: '\\AppData\\Roaming\\Microsoft\\Office\\Recent\\'\n    filter_optional_office_excel:\n        Image|endswith: '\\excel.exe'\n        TargetFilename|contains: '\\AppData\\Roaming\\Microsoft\\Excel'\n    filter_optional_office_powerpoint:\n        Image|endswith: '\\powerpnt.exe'\n        TargetFilename|contains: '\\AppData\\Roaming\\Microsoft\\PowerPoint'\n    filter_optional_office_word:\n        Image|endswith: '\\winword.exe'\n        TargetFilename|contains: '\\AppData\\Roaming\\Microsoft\\Word'\n    condition: selection and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Some tuning is required for other general purpose directories of third party apps\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_susp_legitimate_app_dropping_script.yml","content":"title: Legitimate Application Dropped Script\nid: 7d604714-e071-49ff-8726-edeb95a70679\nstatus: test\ndescription: Detects programs on a Windows system that should not write scripts to disk\nreferences:\n    - https://github.com/Neo23x0/sysmon-config/blob/3f808d9c022c507aae21a9346afba4a59dd533b9/sysmonconfig-export-block.xml#L1326\nauthor: frack113, Florian Roth (Nextron Systems)\ndate: 2022-08-21\nmodified: 2023-06-22\ntags:\n    - attack.defense-evasion\n    - attack.t1218\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        Image|endswith:\n            # Microsoft Office Programs Dropping Executables / Rest of the apps are covered in: c7a74c80-ba5a-486e-9974-ab9e682bc5e4\n            - \\eqnedt32.exe\n            - \\wordpad.exe\n            - \\wordview.exe\n            # LOLBINs that can be used to download executables\n            - \\certutil.exe\n            - \\certoc.exe\n            - \\CertReq.exe\n            # - \\bitsadmin.exe (depends on the environment; comment in if you're sure that bitsadmin doesn't do that in your env)\n            - \\Desktopimgdownldr.exe\n            - \\esentutl.exe\n            # - \\expand.exe\n            - '\\mshta.exe'\n            # Executables that should never drop an executable to disk (but may after a previous process injection or if it's malware that uses a legitimate name)\n            - '\\AcroRd32.exe'\n            - '\\RdrCEF.exe'\n            - '\\hh.exe'\n            - '\\finger.exe'\n        TargetFilename|endswith:\n            - '.ps1'\n            - '.bat'\n            - '.vbs'\n            - '.scf'\n            - '.wsf'\n            - '.wsh'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_susp_legitimate_app_dropping_exe.yml","content":"title: Legitimate Application Dropped Executable\nid: f0540f7e-2db3-4432-b9e0-3965486744bc\nstatus: test\ndescription: Detects programs on a Windows system that should not write executables to disk\nreferences:\n    - https://github.com/Neo23x0/sysmon-config/blob/3f808d9c022c507aae21a9346afba4a59dd533b9/sysmonconfig-export-block.xml#L1326\nauthor: frack113, Florian Roth (Nextron Systems)\ndate: 2022-08-21\nmodified: 2023-06-22\ntags:\n    - attack.defense-evasion\n    - attack.t1218\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        Image|endswith:\n            # Microsoft Office Programs Dropping Executables / Rest of the apps are covered in: c7a74c80-ba5a-486e-9974-ab9e682bc5e4\n            - '\\eqnedt32.exe'\n            - '\\wordpad.exe'\n            - '\\wordview.exe'\n            # LOLBINs that can be used to download executables\n            - '\\certutil.exe'\n            - '\\certoc.exe'\n            - '\\CertReq.exe'\n            # - \\bitsadmin.exe (depends on the environment; comment in if you're sure that bitsadmin doesn't do that in your env)\n            - '\\Desktopimgdownldr.exe'\n            - '\\esentutl.exe'\n            # - \\expand.exe\n            - '\\mshta.exe'\n            # Executables that should never drop an executable to disk (but may after a previous process injection or if it's malware that uses a legitimate name)\n            - '\\AcroRd32.exe'\n            - '\\RdrCEF.exe'\n            - '\\hh.exe'\n            - '\\finger.exe'\n        TargetFilename|endswith:\n            - '.exe'\n            - '.dll'\n            - '.ocx'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_susp_legitimate_app_dropping_archive.yml","content":"title: Legitimate Application Dropped Archive\nid: 654fcc6d-840d-4844-9b07-2c3300e54a26\nstatus: test\ndescription: Detects programs on a Windows system that should not write an archive to disk\nreferences:\n    - https://github.com/Neo23x0/sysmon-config/blob/3f808d9c022c507aae21a9346afba4a59dd533b9/sysmonconfig-export-block.xml#L1326\nauthor: frack113, Florian Roth\ndate: 2022-08-21\ntags:\n    - attack.defense-evasion\n    - attack.t1218\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        Image|endswith:\n            # Microsoft Office Programs Dropping Executables\n            - \\winword.exe\n            - \\excel.exe\n            - \\powerpnt.exe\n            - \\msaccess.exe\n            - \\mspub.exe\n            - \\eqnedt32.exe\n            - \\visio.exe\n            - \\wordpad.exe\n            - \\wordview.exe\n            # LOLBINs that can be used to download executables\n            - \\certutil.exe\n            - \\certoc.exe\n            - \\CertReq.exe\n            # - \\bitsadmin.exe (depends on the environment; comment in if you're sure that bitsadmin doesn't do that in your env)\n            - \\Desktopimgdownldr.exe\n            - \\esentutl.exe\n            # - \\expand.exe\n            - \\finger.exe\n            # Executables that should never drop an executable to disk (but may after a previous process injection or if it's malware that uses a legitimate name)\n            - \\notepad.exe\n            - \\AcroRd32.exe\n            - \\RdrCEF.exe\n            - \\mshta.exe\n            - \\hh.exe\n        TargetFilename|endswith:\n            - '.zip'\n            - '.rar'\n            - '.7z'\n            - '.diagcab'\n            - '.appx'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_susp_homoglyph_filename.yml","content":"title: Potential Homoglyph Attack Using Lookalike Characters in Filename\nid: 4f1707b1-b50b-45b4-b5a2-3978b5a5d0d6\nstatus: test\ndescription: |\n    Detects the presence of unicode characters which are homoglyphs, or identical in appearance, to ASCII letter characters.\n    This is used as an obfuscation and masquerading techniques. Only \"perfect\" homoglyphs are included; these are characters that\n    are indistinguishable from ASCII characters and thus may make excellent candidates for homoglyph attack characters.\nreferences:\n    - https://redcanary.com/threat-detection-report/threats/socgholish/#threat-socgholish\n    - http://www.irongeek.com/homoglyph-attack-generator.php\nauthor: Micah Babinski, @micahbabinski\ndate: 2023-05-08\ntags:\n    - attack.defense-evasion\n    - attack.t1036\n    - attack.t1036.003\n    # - attack.t1036.008\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection_upper:\n        TargetFilename|contains:\n            - \"\\u0410\" # /A\n            - \"\\u0412\" # /B\n            - \"\\u0415\" # /E\n            - \"\\u041a\" # /K\n            - \"\\u041c\" # /M\n            - \"\\u041d\" # /H\n            - \"\\u041e\" # /O\n            - \"\\u0420\" # /P\n            - \"\\u0421\" # /C\n            - \"\\u0422\" # /T\n            - \"\\u0425\" # /X\n            - \"\\u0405\" # /S\n            - \"\\u0406\" # /I\n            - \"\\u0408\" # /J\n            - \"\\u04ae\" # /Y\n            - \"\\u04c0\" # /I\n            - \"\\u050C\" # /G\n            - \"\\u051a\" # /Q\n            - \"\\u051c\" # /W\n            - \"\\u0391\" # /A\n            - \"\\u0392\" # /B\n            - \"\\u0395\" # /E\n            - \"\\u0396\" # /Z\n            - \"\\u0397\" # /H\n            - \"\\u0399\" # /I\n            - \"\\u039a\" # /K\n            - \"\\u039c\" # /M\n            - \"\\u039d\" # /N\n            - \"\\u039f\" # /O\n            - \"\\u03a1\" # /P\n            - \"\\u03a4\" # /T\n            - \"\\u03a5\" # /Y\n            - \"\\u03a7\" # /X\n    selection_lower:\n        TargetFilename|contains:\n            - \"\\u0430\" # /a\n            - \"\\u0435\" # /e\n            - \"\\u043e\" # /o\n            - \"\\u0440\" # /p\n            - \"\\u0441\" # /c\n            - \"\\u0445\" # /x\n            - \"\\u0455\" # /s\n            - \"\\u0456\" # /i\n            - \"\\u04cf\" # /l\n            - \"\\u0458\" # /j\n            - \"\\u04bb\" # /h\n            - \"\\u0501\" # /d\n            - \"\\u051b\" # /q\n            - \"\\u051d\" # /w\n            - \"\\u03bf\" # /o\n    condition: 1 of selection_*\nfalsepositives:\n    - File names with legitimate Cyrillic text. Will likely require tuning (or not be usable) in countries where these alphabets are in use.\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_susp_hidden_dir_index_allocation.yml","content":"title: Potential Hidden Directory Creation Via NTFS INDEX_ALLOCATION Stream\nid: a8f866e1-bdd4-425e-a27a-37619238d9c7\nrelated:\n    - id: 0900463c-b33b-49a8-be1d-552a3b553dae\n      type: similar\nstatus: test\ndescription: |\n    Detects the creation of hidden file/folder with the \"::$index_allocation\" stream. Which can be used as a technique to prevent access to folder and files from tooling such as \"explorer.exe\" and \"powershell.exe\"\nreferences:\n    - https://twitter.com/pfiatde/status/1681977680688738305\n    - https://soroush.me/blog/2010/12/a-dotty-salty-directory-a-secret-place-in-ntfs-for-secret-files/\n    - https://sec-consult.com/blog/detail/pentesters-windows-ntfs-tricks-collection/\n    - https://github.com/redcanaryco/atomic-red-team/blob/5c3b23002d2bbede3c07e7307165fc2a235a427d/atomics/T1564.004/T1564.004.md#atomic-test-5---create-hidden-directory-via-index_allocation\n    - https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-fscc/c54dec26-1551-4d3a-a0ea-4fa40f848eb3\nauthor: Scoubi (@ScoubiMtl)\ndate: 2023-10-09\ntags:\n    - attack.defense-evasion\n    - attack.t1564.004\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        # Note: Both Sysmon and ETW are unable to log the presence of such streams in the CommandLine. But EDRs such as Crowdstrike are able to use e.g. CMD console history. Users are advised to test this before usage\n        TargetFilename|contains: '::$index_allocation'\n    condition: selection\nfalsepositives:\n    - Unlikely\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_susp_get_variable.yml","content":"title: Suspicious Get-Variable.exe Creation\nid: 0c3fac91-5627-46e8-a6a8-a0d7b9b8ae1b\nstatus: test\ndescription: |\n    Get-Variable is a valid PowerShell cmdlet\n    WindowsApps is by default in the path where PowerShell is executed.\n    So when the Get-Variable command is issued on PowerShell execution, the system first looks for the Get-Variable executable in the path and executes the malicious binary instead of looking for the PowerShell cmdlet.\nreferences:\n    - https://blog.malwarebytes.com/threat-intelligence/2022/04/colibri-loader-combines-task-scheduler-and-powershell-in-clever-persistence-technique/\n    - https://www.joesandbox.com/analysis/465533/0/html\nauthor: frack113\ndate: 2022-04-23\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1546\n    - attack.defense-evasion\n    - attack.t1027\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|endswith: 'Local\\Microsoft\\WindowsApps\\Get-Variable.exe'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_susp_file_write_in_webapps_root.yml","content":"title: Suspicious File Write to Webapps Root Directory\nid: 89c42960-f244-4dad-9151-ae9b1a3287a2\nstatus: experimental\ndescription: |\n    Detects suspicious file writes to the root directory of web applications, particularly Apache web servers or Tomcat servers.\n    This may indicate an attempt to deploy malicious files such as web shells or other unauthorized scripts.\nreferences:\n    - https://labs.watchtowr.com/guess-who-would-be-stupid-enough-to-rob-the-same-vault-twice-pre-auth-rce-chains-in-commvault/\nauthor: Swachchhanda Shrawan Poudel (Nextron Systems)\ndate: 2025-10-20\ntags:\n    - attack.persistence\n    - attack.t1505.003\n    - attack.initial-access\n    - attack.t1190\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    # Add more suspicious processes or paths or extensions as needed\n    selection_susp_img:\n        Image|endswith:\n            - '\\dotnet.exe'\n            - '\\w3wp.exe'\n            - '\\java.exe'\n    selection_servers:\n        TargetFilename|contains:\n            - '\\apache'\n            - '\\tomcat'\n    selection_path:\n        TargetFilename|contains: '\\webapps\\ROOT\\'\n    selection_susp_extensions:\n        TargetFilename|endswith: '.jsp'\n    condition: all of selection_*\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_susp_filewrite_in_sharepoint_layouts_dir.yml","content":"title: Suspicious File Write to SharePoint Layouts Directory\nid: 1f0489be-b496-4ddf-b3a9-5900f2044e9c\nstatus: experimental\ndescription: |\n    Detects suspicious file writes to SharePoint layouts directory which could indicate webshell activity or post-exploitation.\n    This behavior has been observed in the exploitation of SharePoint vulnerabilities such as CVE-2025-49704, CVE-2025-49706 or CVE-2025-53770.\nreferences:\n    - https://unit42.paloaltonetworks.com/microsoft-sharepoint-cve-2025-49704-cve-2025-49706-cve-2025-53770/\n    - https://www.microsoft.com/en-us/security/blog/2025/07/22/disrupting-active-exploitation-of-on-premises-sharepoint-vulnerabilities/\nauthor: Swachchhanda Shrawan Poudel (Nextron Systems)\ndate: 2025-07-24\ntags:\n    - attack.initial-access\n    - attack.t1190\n    - attack.persistence\n    - attack.t1505.003\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        Image|endswith:\n            - '\\cmd.exe'\n            - '\\powershell_ise.exe'\n            - '\\powershell.exe'\n            - '\\pwsh.exe'\n            - '\\w3wp.exe'\n        TargetFilename|startswith:\n            - 'C:\\Program Files\\Common Files\\Microsoft Shared\\Web Server Extensions\\'\n            - 'C:\\Program Files (x86)\\Common Files\\Microsoft Shared\\Web Server Extensions\\'\n        TargetFilename|contains:\n            - '\\15\\TEMPLATE\\LAYOUTS\\'\n            - '\\16\\TEMPLATE\\LAYOUTS\\'\n        TargetFilename|endswith:\n            - '.asax'\n            - '.ascx'\n            - '.ashx'\n            - '.asmx'\n            - '.asp'\n            - '.aspx'\n            - '.bat'\n            - '.cmd'\n            - '.cer'\n            - '.config'\n            - '.hta'\n            - '.js'\n            - '.jsp'\n            - '.jspx'\n            - '.php'\n            - '.ps1'\n            - '.vbs'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_susp_executable_creation.yml","content":"title: Suspicious Executable File Creation\nid: 74babdd6-a758-4549-9632-26535279e654\nstatus: test\ndescription: |\n    Detect creation of suspicious executable file names.\n    Some strings look for suspicious file extensions, others look for filenames that exploit unquoted service paths.\nreferences:\n    - https://medium.com/@SumitVerma101/windows-privilege-escalation-part-1-unquoted-service-path-c7a011a8d8ae\n    - https://app.any.run/tasks/76c69e2d-01e8-49d9-9aea-fb7cc0c4d3ad/\nauthor: frack113\ndate: 2022-09-05\nmodified: 2023-12-11\ntags:\n    - attack.defense-evasion\n    - attack.t1564\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|endswith:\n            - ':\\$Recycle.Bin.exe'\n            - ':\\Documents and Settings.exe'\n            - ':\\MSOCache.exe'\n            - ':\\PerfLogs.exe'\n            - ':\\Recovery.exe'\n            - '.bat.exe'\n            - '.sys.exe'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_susp_exchange_aspx_write.yml","content":"title: Suspicious MSExchangeMailboxReplication ASPX Write\nid: 7280c9f3-a5af-45d0-916a-bc01cb4151c9\nstatus: test\ndescription: Detects suspicious activity in which the MSExchangeMailboxReplication process writes .asp and .apsx files to disk, which could be a sign of ProxyShell exploitation\nreferences:\n    - https://redcanary.com/blog/blackbyte-ransomware/\nauthor: Florian Roth (Nextron Systems)\ndate: 2022-02-25\ntags:\n    - attack.initial-access\n    - attack.t1190\n    - attack.persistence\n    - attack.t1505.003\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        Image|endswith: '\\MSExchangeMailboxReplication.exe'\n        TargetFilename|endswith:\n            - '.aspx'\n            - '.asp'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_susp_dpapi_backup_and_cert_export_ioc.yml","content":"title: DPAPI Backup Keys And Certificate Export Activity IOC\nid: 7892ec59-c5bb-496d-8968-e5d210ca3ac4\nstatus: test\ndescription: |\n    Detects file names with specific patterns seen generated and used by tools such as Mimikatz and DSInternals related to exported or stolen DPAPI backup keys and certificates.\nreferences:\n    - https://www.dsinternals.com/en/dpapi-backup-key-theft-auditing/\n    - https://github.com/MichaelGrafnetter/DSInternals/blob/39ee8a69bbdc1cfd12c9afdd7513b4788c4895d4/Src/DSInternals.Common/Data/DPAPI/DPAPIBackupKey.cs#L28-L32\nauthor: Nounou Mbeiri, Nasreddine Bencherchali (Nextron Systems)\ndate: 2024-06-26\ntags:\n    - attack.credential-access\n    - attack.t1555\n    - attack.t1552.004\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|contains:\n            - 'ntds_capi_'\n            - 'ntds_legacy_'\n            - 'ntds_unknown_'\n        TargetFilename|endswith:\n            - '.cer'\n            - '.key'\n            - '.pfx'\n            - '.pvk'\n    condition: selection\nfalsepositives:\n    - Unlikely\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_susp_double_extension.yml","content":"title: Suspicious Double Extension Files\nid: b4926b47-a9d7-434c-b3a0-adc3fa0bd13e\nrelated:\n    - id: 1cdd9a09-06c9-4769-99ff-626e2b3991b8\n      type: derived\n    - id: 3215aa19-f060-4332-86d5-5602511f3ca8\n      type: similar\nstatus: test\ndescription: Detects dropped files with double extensions, which is often used by malware as a method to abuse the fact that Windows hide default extensions by default.\nreferences:\n    - https://www.crowdstrike.com/blog/meet-crowdstrikes-adversary-of-the-month-for-june-mustang-panda/\n    - https://www.anomali.com/blog/china-based-apt-mustang-panda-targets-minority-groups-public-and-private-sector-organizations\n    - https://www.cybereason.com/blog/research/a-bazar-of-tricks-following-team9s-development-cycles\n    - https://twitter.com/malwrhunterteam/status/1235135745611960321\n    - https://twitter.com/luc4m/status/1073181154126254080\n    - https://cloud.google.com/blog/topics/threat-intelligence/cybercriminals-weaponize-fake-ai-websites\n    - https://vipre.com/blog/svg-phishing-attacks-the-new-trick-in-the-cybercriminals-playbook/\nauthor: Nasreddine Bencherchali (Nextron Systems), frack113\ndate: 2022-06-19\nmodified: 2025-07-22\ntags:\n    - attack.defense-evasion\n    - attack.t1036.007\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection_gen:\n        TargetFilename|endswith:\n            - '.exe'\n            - '.iso'\n            - '.rar'\n            - '.svg'\n            - '.zip'\n            # - '.lnk'  # legitimate links can happen just anywhere\n        TargetFilename|contains:\n            - '.doc.'\n            - '.docx.'\n            - '.gif.'\n            - '.jpeg.'\n            - '.jpg.'\n            - '.mp3.'\n            - '.mp4.'\n            - '.pdf.'\n            - '.png.'\n            - '.ppt.'\n            - '.pptx.'\n            - '.rtf.'\n            - '.svg.'\n            - '.txt.'\n            - '.xls.'\n            - '.xlsx.'\n    selection_exe:\n        TargetFilename|endswith:\n            - '.rar.exe'\n            - '.zip.exe'\n    # Note: If you wanna keep using the \".lnk\" extension. You might uncomment this filter and add additional locations\n    # filter_main_lnk:\n    #     TargetFilename|contains:\n    #         - '\\AppData\\Roaming\\Microsoft\\Office\\Recent\\'\n    #         - '\\AppData\\Roaming\\Microsoft\\Windows\\Recent\\'\n    condition: 1 of selection_*\nfalsepositives:\n    - Unlikely\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_susp_diagcab.yml","content":"title: Creation of a Diagcab\nid: 3d0ed417-3d94-4963-a562-4a92c940656a\nstatus: test\ndescription: Detects the creation of diagcab file, which could be caused by some legitimate installer or is a sign of exploitation (review the filename and its location)\nreferences:\n    - https://threadreaderapp.com/thread/1533879688141086720.html\nauthor: frack113\ndate: 2022-06-08\ntags:\n    - attack.resource-development\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|endswith: '.diagcab'\n    condition: selection\nfalsepositives:\n    - Legitimate microsoft diagcab\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_susp_desktop_txt.yml","content":"title: Suspicious Creation TXT File in User Desktop\nid: caf02a0a-1e1c-4552-9b48-5e070bd88d11\nstatus: test\ndescription: Ransomware create txt file in the user Desktop\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1486/T1486.md#atomic-test-5---purelocker-ransom-note\nauthor: frack113\ndate: 2021-12-26\ntags:\n    - attack.impact\n    - attack.t1486\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        Image|endswith: '\\cmd.exe'\n        TargetFilename|contains|all:\n            - '\\Users\\'\n            - '\\Desktop\\'\n        TargetFilename|endswith: '.txt'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_susp_desktop_ini.yml","content":"title: Suspicious desktop.ini Action\nid: 81315b50-6b60-4d8f-9928-3466e1022515\nstatus: test\ndescription: Detects unusual processes accessing desktop.ini, which can be leveraged to alter how Explorer displays a folder's content (i.e. renaming files) without changing them on disk.\nreferences:\n    - https://isc.sans.edu/forums/diary/Desktopini+as+a+postexploitation+tool/25912/\nauthor: Maxime Thiebaut (@0xThiebaut), Tim Shelton (HAWK.IO)\ndate: 2020-03-19\nmodified: 2022-10-07\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547.009\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|endswith: '\\desktop.ini'\n    filter_generic:\n        Image|startswith:\n            - 'C:\\Windows\\'\n            - 'C:\\Program Files\\'\n            - 'C:\\Program Files (x86)\\'\n    filter_jetbrains:\n        Image|endswith: '\\AppData\\Local\\JetBrains\\Toolbox\\bin\\7z.exe'\n        TargetFilename|contains: '\\JetBrains\\apps\\'\n    filter_upgrade:\n        TargetFilename|startswith: 'C:\\$WINDOWS.~BT\\NewOS\\'\n    condition: selection and not 1 of filter_*\nfalsepositives:\n    - Operations performed through Windows SCCM or equivalent\n    - Read only access list authority\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_susp_desktopimgdownldr_file.yml","content":"title: Suspicious Desktopimgdownldr Target File\nid: fc4f4817-0c53-4683-a4ee-b17a64bc1039\nstatus: test\ndescription: Detects a suspicious Microsoft desktopimgdownldr file creation that stores a file to a suspicious location or contains a file with a suspicious extension\nreferences:\n    - https://labs.sentinelone.com/living-off-windows-land-a-new-native-file-downldr/\n    - https://twitter.com/SBousseaden/status/1278977301745741825\nauthor: Florian Roth (Nextron Systems)\ndate: 2020-07-03\nmodified: 2022-06-02\ntags:\n    - attack.command-and-control\n    - attack.t1105\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        Image|endswith: '\\svchost.exe'\n        TargetFilename|contains: '\\Personalization\\LockScreenImage\\'\n    filter1:\n        TargetFilename|contains: 'C:\\Windows\\'\n    filter2:\n        TargetFilename|contains:\n            - '.jpg'\n            - '.jpeg'\n            - '.png'\n    condition: selection and not filter1 and not filter2\nfields:\n    - CommandLine\n    - ParentCommandLine\nfalsepositives:\n    - False positives depend on scripts and administrative tools used in the monitored environment\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_susp_default_gpo_dir_write.yml","content":"title: Suspicious Files in Default GPO Folder\nid: 5f87308a-0a5b-4623-ae15-d8fa1809bc60\nstatus: test\ndescription: Detects the creation of copy of suspicious files (EXE/DLL) to the default GPO storage folder\nreferences:\n    - https://redcanary.com/blog/intelligence-insights-november-2021/\nauthor: elhoim\ndate: 2022-04-28\ntags:\n    - attack.t1036.005\n    - attack.defense-evasion\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|contains: '\\Policies\\{31B2F340-016D-11D2-945F-00C04FB984F9}\\'\n        TargetFilename|endswith:\n            - '.dll'\n            - '.exe'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_susp_creation_by_mobsync.yml","content":"title: Created Files by Microsoft Sync Center\nid: 409f8a98-4496-4aaa-818a-c931c0a8b832\nstatus: test\ndescription: This rule detects suspicious files created by Microsoft Sync Center (mobsync)\nreferences:\n    - https://redcanary.com/blog/intelligence-insights-november-2021/\nauthor: elhoim\ndate: 2022-04-28\nmodified: 2022-06-02\ntags:\n    - attack.privilege-escalation\n    - attack.t1055\n    - attack.t1218\n    - attack.execution\n    - attack.defense-evasion\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection_mobsync:\n        Image|endswith: '\\mobsync.exe'\n    filter_created_file:\n        TargetFilename|endswith:\n            - '.dll'\n            - '.exe'\n    condition: selection_mobsync and filter_created_file\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_susp_colorcpl.yml","content":"title: Suspicious Creation with Colorcpl\nid: e15b518d-b4ce-4410-a9cd-501f23ce4a18\nstatus: test\ndescription: Once executed, colorcpl.exe will copy the arbitrary file to c:\\windows\\system32\\spool\\drivers\\color\\\nreferences:\n    - https://twitter.com/eral4m/status/1480468728324231172?s=20\nauthor: frack113\ndate: 2022-01-21\nmodified: 2023-01-05\ntags:\n    - attack.defense-evasion\n    - attack.t1564\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        Image|endswith: '\\colorcpl.exe'\n    filter_ext:\n        TargetFilename|endswith:\n            - '.icm'\n            - '.gmmp'\n            - '.cdmp'\n            - '.camp'\n    condition: selection and not 1 of filter_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_startup_folder_file_write.yml","content":"title: Startup Folder File Write\nid: 2aa0a6b4-a865-495b-ab51-c28249537b75\nrelated:\n    - id: 28208707-fe31-437f-9a7f-4b1108b94d2e\n      type: similar\nstatus: test\ndescription: A General detection for files being created in the Windows startup directory. This could be an indicator of persistence.\nreferences:\n    - https://github.com/OTRF/detection-hackathon-apt29/issues/12\n    - https://github.com/OTRF/ThreatHunter-Playbook/blob/2d4257f630f4c9770f78d0c1df059f891ffc3fec/docs/evals/apt29/detections/5.B.1_611FCA99-97D0-4873-9E51-1C1BA2DBB40D.md\nauthor: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)\ndate: 2020-05-02\nmodified: 2025-10-17\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547.001\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|contains: '\\Microsoft\\Windows\\Start Menu\\Programs\\StartUp'\n    filter_main_update:\n        - Image: 'C:\\Windows\\System32\\wuauclt.exe'\n        - TargetFilename|startswith: 'C:\\$WINDOWS.~BT\\NewOS\\'\n    filter_optional_onenote:\n        Image|endswith: '\\ONENOTE.EXE'\n        TargetFilename|endswith: '\\Send to OneNote.lnk'\n    condition: selection and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - FP could be caused by legitimate application writing shortcuts for example. This folder should always be inspected to make sure that all the files in there are legitimate\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_shell_write_susp_files_extensions.yml","content":"title: Windows Binaries Write Suspicious Extensions\nid: b8fd0e93-ff58-4cbd-8f48-1c114e342e62\nrelated:\n    - id: 1277f594-a7d1-4f28-a2d3-73af5cbeab43\n      type: derived\nstatus: test\ndescription: Detects Windows executables that write files with suspicious extensions\nreferences:\n    - Internal Research\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-08-12\nmodified: 2025-10-07\ntags:\n    - attack.defense-evasion\n    - attack.t1036\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection_generic:\n        Image|endswith:\n            - '\\csrss.exe'\n            - '\\lsass.exe'\n            - '\\RuntimeBroker.exe'\n            - '\\sihost.exe'\n            - '\\smss.exe'\n            - '\\wininit.exe'\n            - '\\winlogon.exe'\n        TargetFilename|endswith:\n            - '.bat'\n            - '.dll'\n            - '.exe'\n            - '.hta'\n            - '.iso'\n            - '.ps1'\n            - '.txt'\n            - '.vbe'\n            - '.vbs'\n    selection_special:\n        Image|endswith:\n            - '\\dllhost.exe'\n            - '\\rundll32.exe'\n            - '\\svchost.exe'\n        TargetFilename|endswith:\n            - '.bat'\n            - '.hta'\n            - '.iso'\n            - '.ps1'\n            - '.vbe'\n            - '.vbs'\n    filter_main_AppLockerPolicyTest:\n        Image: 'C:\\Windows\\System32\\dllhost.exe'\n        TargetFilename|contains|all:\n            - ':\\Users\\'\n            - '\\AppData\\Local\\Temp\\__PSScriptPolicyTest_'\n        TargetFilename|endswith: '.ps1'\n    filter_main_script_gpo_machine:\n        Image: 'C:\\Windows\\system32\\svchost.exe'\n        TargetFilename|contains|all:\n            - 'C:\\Windows\\System32\\GroupPolicy\\DataStore\\'\n            - '\\sysvol\\'\n            - '\\Policies\\'\n            - '\\Machine\\Scripts\\Startup\\'\n        TargetFilename|endswith:\n            - '.ps1'\n            - '.bat'\n    filter_main_clipchamp:\n        Image: 'C:\\Windows\\system32\\svchost.exe'\n        TargetFilename|contains|all:\n            - 'C:\\Program Files\\WindowsApps\\Clipchamp'\n            - '.ps1'\n    filter_main_powershell_preview:\n        Image:\n            - 'C:\\Windows\\system32\\svchost.exe'\n            - 'C:\\Windows\\SysWOW64\\svchost.exe'\n        TargetFilename|startswith:\n            - 'C:\\Program Files\\WindowsApps\\Microsoft.PowerShellPreview'\n            - 'C:\\Program Files (x86)\\WindowsApps\\Microsoft.PowerShellPreview'\n        TargetFilename|endswith: '.ps1'\n    condition: 1 of selection_* and not 1 of filter_main_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_shell_write_susp_directory.yml","content":"title: Windows Shell/Scripting Application File Write to Suspicious Folder\nid: 1277f594-a7d1-4f28-a2d3-73af5cbeab43\nstatus: test\ndescription: Detects Windows shells and scripting applications that write files to suspicious folders\nreferences:\n    - Internal Research\nauthor: Florian Roth (Nextron Systems)\ndate: 2021-11-20\nmodified: 2023-03-29\ntags:\n    - attack.execution\n    - attack.t1059\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection_1:\n        Image|endswith:\n            - '\\bash.exe'\n            - '\\cmd.exe'\n            - '\\cscript.exe'\n            - '\\msbuild.exe'  # https://github.com/elastic/detection-rules/blob/c76a39796972ecde44cb1da6df47f1b6562c9770/rules/windows/defense_evasion_execution_msbuild_started_by_office_app.toml\n            - '\\powershell.exe'\n            - '\\pwsh.exe'\n            - '\\sh.exe'\n            - '\\wscript.exe'\n        TargetFilename|startswith:\n            - 'C:\\PerfLogs\\'\n            - 'C:\\Users\\Public\\'\n    selection_2:\n        Image|endswith:\n            - '\\certutil.exe'\n            - '\\forfiles.exe'\n            - '\\mshta.exe'\n            # - '\\rundll32.exe' # Potential FP\n            - '\\schtasks.exe'\n            - '\\scriptrunner.exe'\n            - '\\wmic.exe'  # https://app.any.run/tasks/c903e9c8-0350-440c-8688-3881b556b8e0/\n        TargetFilename|contains:\n            - 'C:\\PerfLogs\\'\n            - 'C:\\Users\\Public\\'\n            - 'C:\\Windows\\Temp\\'\n    condition: 1 of selection_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_sed_file_creation.yml","content":"title: Self Extraction Directive File Created In Potentially Suspicious Location\nid: 760e75d8-c3b5-409b-a9bf-6130b4c4603f\nrelated:\n    - id: ab90dab8-c7da-4010-9193-563528cfa347\n      type: derived\nstatus: test\ndescription: |\n    Detects the creation of Self Extraction Directive files (.sed) in a potentially suspicious location.\n    These files are used by the \"iexpress.exe\" utility in order to create self extracting packages.\n    Attackers were seen abusing this utility and creating PE files with embedded \".sed\" entries.\nreferences:\n    - https://strontic.github.io/xcyclopedia/library/iexpress.exe-D594B2A33EFAFD0EABF09E3FDC05FCEA.html\n    - https://en.wikipedia.org/wiki/IExpress\n    - https://www.virustotal.com/gui/file/602f4ae507fa8de57ada079adff25a6c2a899bd25cd092d0af7e62cdb619c93c/behavior\nauthor: Joseliyo Sanchez, @Joseliyo_Jstnk\ndate: 2024-02-05\ntags:\n    - attack.defense-evasion\n    - attack.t1218\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|contains:\n            - ':\\ProgramData\\'\n            - ':\\Temp\\'\n            - ':\\Windows\\System32\\Tasks\\'\n            - ':\\Windows\\Tasks\\'\n            - ':\\Windows\\Temp\\'\n            - '\\AppData\\Local\\Temp\\'\n        TargetFilename|endswith: '.sed'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_sam_dump.yml","content":"title: Potential SAM Database Dump\nid: 4e87b8e2-2ee9-4b2a-a715-4727d297ece0\nstatus: test\ndescription: Detects the creation of files that look like exports of the local SAM (Security Account Manager)\nreferences:\n    - https://github.com/search?q=CVE-2021-36934\n    - https://web.archive.org/web/20210725081645/https://github.com/cube0x0/CVE-2021-36934\n    - https://www.google.com/search?q=%22reg.exe+save%22+sam\n    - https://github.com/HuskyHacks/ShadowSteal\n    - https://github.com/FireFart/hivenightmare\nauthor: Florian Roth (Nextron Systems)\ndate: 2022-02-11\nmodified: 2023-01-05\ntags:\n    - attack.credential-access\n    - attack.t1003.002\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        - TargetFilename|endswith:\n              - '\\Temp\\sam'\n              - '\\sam.sav'\n              - '\\Intel\\sam'\n              - '\\sam.hive'\n              - '\\Perflogs\\sam'\n              - '\\ProgramData\\sam'\n              - '\\Users\\Public\\sam'\n              - '\\AppData\\Local\\sam'\n              - '\\AppData\\Roaming\\sam'\n              - '_ShadowSteal.zip'       # https://github.com/HuskyHacks/ShadowSteal\n              - '\\Documents\\SAM.export'  # https://github.com/n3tsurge/CVE-2021-36934/\n              - ':\\sam'\n        - TargetFilename|contains:\n              - '\\hive_sam_'             # https://github.com/FireFart/hivenightmare\n              - '\\sam.save'\n              - '\\sam.export'\n              - '\\~reg_sam.save'\n              - '\\sam_backup'\n              - '\\sam.bck'\n              - '\\sam.backup'\n    condition: selection\nfalsepositives:\n    - Rare cases of administrative activity\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_ripzip_attack.yml","content":"title: Potential RipZip Attack on Startup Folder\nid: a6976974-ea6f-4e97-818e-ea08625c52cb\nstatus: test\ndescription: |\n    Detects a phishing attack which expands a ZIP file containing a malicious shortcut.\n    If the victim expands the ZIP file via the explorer process, then the explorer process expands the malicious ZIP file and drops a malicious shortcut redirected to a backdoor into the Startup folder.\n    Additionally, the file name of the malicious shortcut in Startup folder contains {0AFACED1-E828-11D1-9187-B532F1E9575D} meaning the folder shortcut operation.\nreferences:\n    - https://twitter.com/jonasLyk/status/1549338335243534336?t=CrmPocBGLbDyE4p6zTX1cg&s=19\nauthor: Greg (rule)\ndate: 2022-07-21\nmodified: 2023-01-05\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection: # %APPDATA%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\target.lnk.{0AFACED1-E828-11D1-9187-B532F1E9575D}\\target.lnk\n        TargetFilename|contains|all:\n            - '\\Microsoft\\Windows\\Start Menu\\Programs\\Startup'\n            - '.lnk.{0AFACED1-E828-11D1-9187-B532F1E9575D}'\n        Image|endswith: '\\explorer.exe'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_remote_access_tools_screenconnect_remote_file.yml","content":"title: Remote Access Tool - ScreenConnect Temporary File\nid: 0afecb6e-6223-4a82-99fb-bf5b981e92a5\nrelated:\n    - id: b1f73849-6329-4069-bc8f-78a604bb8b23\n      type: similar\nstatus: test\ndescription: |\n    Detects the creation of files in a specific location by ScreenConnect RMM.\n    ScreenConnect has feature to remotely execute binaries on a target machine. These binaries will be dropped to \":\\Users\\<username>\\Documents\\ConnectWiseControl\\Temp\\\" before execution.\nreferences:\n    - https://github.com/SigmaHQ/sigma/pull/4467\nauthor: Ali Alwashali\ndate: 2023-10-10\ntags:\n    - attack.execution\n    - attack.t1059.003\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        Image|endswith: '\\ScreenConnect.WindowsClient.exe'\n        TargetFilename|contains: '\\Documents\\ConnectWiseControl\\Temp\\'\n    condition: selection\nfalsepositives:\n    - Legitimate use of ScreenConnect\n# Note: Incase the level if ScreenConnect is not used\nlevel: low\n"},{"path":"file\\file_event\\file_event_win_remote_access_tools_screenconnect_artefact.yml","content":"title: ScreenConnect Temporary Installation Artefact\nid: fec96f39-988b-4586-b746-b93d59fd1922\nstatus: test\ndescription: |\n    An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks.\n    These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment.\n    Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land)\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1219/T1219.md#atomic-test-5---screenconnect-application-download-and-install-on-windows\nauthor: frack113\ndate: 2022-02-13\ntags:\n    - attack.command-and-control\n    - attack.t1219.002\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|contains: '\\Bin\\ScreenConnect.' # pattern to dll and jar file\n    condition: selection\nfalsepositives:\n    - Legitimate use\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_remcom_service.yml","content":"title: RemCom Service File Creation\nid: 7eff1a7f-dd45-4c20-877a-f21e342a7611\nstatus: test\ndescription: Detects default RemCom service filename which indicates RemCom service installation and execution\nreferences:\n    - https://github.com/kavika13/RemCom/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-08-04\ntags:\n    - attack.execution\n    - attack.t1569.002\n    - attack.s0029\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|endswith: '\\RemComSvc.exe'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_regedit_print_as_pdf.yml","content":"title: PDF File Created By RegEdit.EXE\nid: 145095eb-e273-443b-83d0-f9b519b7867b\nstatus: test\ndescription: |\n    Detects the creation of a file with the \".pdf\" extension by the \"RegEdit.exe\" process.\n    This indicates that a user is trying to print/save a registry key as a PDF in order to potentially extract sensitive information and bypass defenses.\nreferences:\n    - https://sensepost.com/blog/2024/dumping-lsa-secrets-a-story-about-task-decorrelation/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2024-07-08\ntags:\n    - attack.defense-evasion\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        Image|endswith: '\\regedit.exe'\n        TargetFilename|endswith: '.pdf'\n    condition: selection\nfalsepositives:\n    - Unlikely\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_redmimicry_winnti_filedrop.yml","content":"title: Potential Winnti Dropper Activity\nid: 130c9e58-28ac-4f83-8574-0a4cc913b97e\nstatus: test\ndescription: Detects files dropped by Winnti as described in RedMimicry Winnti playbook\nreferences:\n    - https://redmimicry.com/posts/redmimicry-winnti/#dropper\nauthor: Alexander Rausch\ndate: 2020-06-24\nmodified: 2023-01-05\ntags:\n    - attack.defense-evasion\n    - attack.t1027\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|endswith:\n            - '\\gthread-3.6.dll'\n            - '\\sigcmm-2.4.dll'\n            - '\\Windows\\Temp\\tmp.bat'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_rdp_file_susp_creation.yml","content":"title: .RDP File Created By Uncommon Application\nid: fccfb43e-09a7-4bd2-8b37-a5a7df33386d\nrelated:\n    - id: f748c45a-f8d3-4e6f-b617-fe176f695b8f\n      type: derived\nstatus: test\ndescription: |\n    Detects creation of a file with an \".rdp\" extension by an application that doesn't commonly create such files.\nreferences:\n    - https://www.blackhillsinfosec.com/rogue-rdp-revisiting-initial-access-methods/\n    - https://web.archive.org/web/20230726144748/https://blog.thickmints.dev/mintsights/detecting-rogue-rdp/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-04-18\nmodified: 2024-11-01\ntags:\n    - attack.defense-evasion\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|endswith: '.rdp'\n        Image|endswith:\n            # Covers browsers\n            - '\\brave.exe'\n            - '\\CCleaner Browser\\Application\\CCleanerBrowser.exe'\n            - '\\chromium.exe'\n            - '\\firefox.exe'\n            - '\\Google\\Chrome\\Application\\chrome.exe'\n            - '\\iexplore.exe'\n            - '\\microsoftedge.exe'\n            - '\\msedge.exe'\n            - '\\Opera.exe'\n            - '\\Vivaldi.exe'\n            - '\\Whale.exe'\n            # Covers email clients\n            - '\\olk.exe' # Outlook\n            - '\\Outlook.exe'\n            - '\\RuntimeBroker.exe' # If the windows mail client is used\n            - '\\Thunderbird.exe'\n            # Covers chat applications\n            - '\\Discord.exe' # Should open the browser for download, but just in case.\n            - '\\Keybase.exe'\n            - '\\msteams.exe'\n            - '\\Slack.exe'\n            - '\\teams.exe'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_rclone_config_files.yml","content":"title: Rclone Config File Creation\nid: 34986307-b7f4-49be-92f3-e7a4d01ac5db\nstatus: test\ndescription: Detects Rclone config files being created\nreferences:\n    - https://research.nccgroup.com/2021/05/27/detecting-rclone-an-effective-tool-for-exfiltration/\nauthor: Aaron Greetham (@beardofbinary) - NCC Group\ndate: 2021-05-26\nmodified: 2023-05-09\ntags:\n    - attack.exfiltration\n    - attack.t1567.002\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|contains|all:\n            - ':\\Users\\'\n            - '\\.config\\rclone\\'\n    condition: selection\nfalsepositives:\n    - Legitimate Rclone usage\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_ps_script_policy_test_creation_by_uncommon_process.yml","content":"title: PSScriptPolicyTest Creation By Uncommon Process\nid: 1027d292-dd87-4a1a-8701-2abe04d7783c\nstatus: test\ndescription: Detects the creation of the \"PSScriptPolicyTest\" PowerShell script by an uncommon process. This file is usually generated by Microsoft Powershell to test against Applocker.\nreferences:\n    - https://www.paloaltonetworks.com/blog/security-operations/stopping-powershell-without-powershell/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-06-01\nmodified: 2025-10-07\ntags:\n    - attack.defense-evasion\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|contains: '__PSScriptPolicyTest_'\n    filter_main_powershell:\n        Image:\n            - 'C:\\Program Files\\PowerShell\\7-preview\\pwsh.exe'\n            - 'C:\\Program Files\\PowerShell\\7\\pwsh.exe'\n            - 'C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell_ise.exe'\n            - 'C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe'\n            - 'C:\\Windows\\SysWOW64\\WindowsPowerShell\\v1.0\\powershell_ise.exe'\n            - 'C:\\Windows\\SysWOW64\\WindowsPowerShell\\v1.0\\powershell.exe'\n    filter_main_pwsh_preview:\n        Image|contains:\n            - 'C:\\Program Files\\WindowsApps\\Microsoft.PowerShellPreview'\n            - '\\AppData\\Local\\Microsoft\\WindowsApps\\Microsoft.PowerShellPreview'\n        Image|endswith: '\\pwsh.exe'\n    filter_main_generic:\n        Image:\n            - 'C:\\Windows\\System32\\dsac.exe'\n            - 'C:\\Windows\\System32\\sdiagnhost.exe'\n            - 'C:\\Windows\\System32\\ServerManager.exe'\n            - 'C:\\Windows\\System32\\wsmprovhost.exe'\n            - 'C:\\Windows\\SysWOW64\\sdiagnhost.exe'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_powershell_startup_shortcuts.yml","content":"title: Potential Startup Shortcut Persistence Via PowerShell.EXE\nid: 92fa78e7-4d39-45f1-91a3-8b23f3f1088d\nstatus: test\ndescription: |\n    Detects PowerShell writing startup shortcuts.\n    This procedure was highlighted in Red Canary Intel Insights Oct. 2021, \"We frequently observe adversaries using PowerShell to write malicious .lnk files into the startup directory to establish persistence.\n    Accordingly, this detection opportunity is likely to identify persistence mechanisms in multiple threats.\n    In the context of Yellow Cockatoo, this persistence mechanism eventually launches the command-line script that leads to the installation of a malicious DLL\"\nreferences:\n    - https://redcanary.com/blog/intelligence-insights-october-2021/\n    - https://github.com/redcanaryco/atomic-red-team/blob/36d49de4c8b00bf36054294b4a1fcbab3917d7c5/atomics/T1547.001/T1547.001.md#atomic-test-7---add-executable-shortcut-link-to-user-startup-folder\nauthor: Christopher Peacock '@securepeacock', SCYTHE\ndate: 2021-10-24\nmodified: 2023-02-23\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547.001\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        Image|endswith:\n            - '\\powershell.exe'\n            - '\\pwsh.exe'\n        TargetFilename|contains: '\\start menu\\programs\\startup\\'\n        TargetFilename|endswith: '.lnk'\n    condition: selection\nfalsepositives:\n    - Depending on your environment accepted applications may leverage this at times. It is recommended to search for anomalies inidicative of malware.\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_powershell_module_uncommon_creation.yml","content":"title: PowerShell Module File Created By Non-PowerShell Process\nid: e3845023-ca9a-4024-b2b2-5422156d5527\nstatus: test\ndescription: Detects the creation of a new PowerShell module \".psm1\", \".psd1\", \".dll\", \".ps1\", etc. by a non-PowerShell process\nreferences:\n    - Internal Research\n    - https://learn.microsoft.com/en-us/powershell/scripting/developer/module/understanding-a-windows-powershell-module?view=powershell-7.3\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-05-09\nmodified: 2025-10-07\ntags:\n    - attack.persistence\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|contains:\n            - '\\WindowsPowerShell\\Modules\\'\n            - '\\PowerShell\\7\\Modules\\'\n    filter_main_pwsh:\n        Image|endswith:\n            - ':\\Program Files\\PowerShell\\7-preview\\pwsh.exe'\n            - ':\\Program Files\\PowerShell\\7\\pwsh.exe'\n            - ':\\Windows\\System32\\poqexec.exe' # https://github.com/SigmaHQ/sigma/issues/4448\n            - ':\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell_ise.exe'\n            - ':\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe'\n            - ':\\Windows\\SysWOW64\\poqexec.exe' # https://github.com/SigmaHQ/sigma/issues/4448\n            - ':\\Windows\\SysWOW64\\WindowsPowerShell\\v1.0\\powershell_ise.exe'\n            - ':\\Windows\\SysWOW64\\WindowsPowerShell\\v1.0\\powershell.exe'\n    filter_main_msiexec:\n        Image:\n            - 'C:\\Windows\\System32\\msiexec.exe'\n            - 'C:\\Windows\\SysWOW64\\msiexec.exe'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_powershell_module_susp_creation.yml","content":"title: Potential Suspicious PowerShell Module File Created\nid: e8a52bbd-bced-459f-bd93-64db45ce7657\nstatus: test\ndescription: Detects the creation of a new PowerShell module in the first folder of the module directory structure \"\\WindowsPowerShell\\Modules\\malware\\malware.psm1\". This is somewhat an uncommon practice as legitimate modules often includes a version folder.\nreferences:\n    - Internal Research\n    - https://learn.microsoft.com/en-us/powershell/scripting/developer/module/understanding-a-windows-powershell-module?view=powershell-7.3\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-05-09\ntags:\n    - attack.persistence\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|endswith:\n            # Note: Don't include PowerShell 7 as it has default modules that don't follow this logic\n            - '\\\\WindowsPowerShell\\\\Modules\\\\*\\.ps'\n            - '\\\\WindowsPowerShell\\\\Modules\\\\*\\.dll'\n    condition: selection\nfalsepositives:\n    - False positive rate will vary depending on the environments. Additional filters might be required to make this logic usable in production.\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_powershell_module_creation.yml","content":"title: PowerShell Module File Created\nid: e36941d0-c0f0-443f-bc6f-cb2952eb69ea\nstatus: test\ndescription: Detects the creation of a new PowerShell module \".psm1\", \".psd1\", \".dll\", \".ps1\", etc.\nreferences:\n    - Internal Research\n    - https://learn.microsoft.com/en-us/powershell/scripting/developer/module/understanding-a-windows-powershell-module?view=powershell-7.3\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-05-09\ntags:\n    - attack.persistence\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        Image|endswith:\n            - '\\powershell.exe'\n            - '\\pwsh.exe'\n        TargetFilename|contains:\n            - '\\WindowsPowerShell\\Modules\\'\n            - '\\PowerShell\\7\\Modules\\'\n    condition: selection\nfalsepositives:\n    - Likely\nlevel: low\n"},{"path":"file\\file_event\\file_event_win_powershell_exploit_scripts.yml","content":"title: Malicious PowerShell Scripts - FileCreation\nid: f331aa1f-8c53-4fc3-b083-cc159bc971cb\nrelated:\n    - id: 41025fd7-0466-4650-a813-574aaacbe7f4\n      type: similar\nstatus: test\ndescription: Detects the creation of known offensive powershell scripts used for exploitation\nreferences:\n    - https://github.com/PowerShellMafia/PowerSploit\n    - https://github.com/NetSPI/PowerUpSQL\n    - https://github.com/CsEnox/EventViewer-UACBypass\n    - https://web.archive.org/web/20210511204621/https://github.com/AlsidOfficial/WSUSpendu\n    - https://github.com/nettitude/Invoke-PowerThIEf\n    - https://github.com/S3cur3Th1sSh1t/WinPwn\n    - https://github.com/S3cur3Th1sSh1t/PowerSharpPack/tree/master/PowerSharpBinaries\n    - https://github.com/BC-SECURITY/Invoke-ZeroLogon/blob/111d17c7fec486d9bb23387e2e828b09a26075e4/Invoke-ZeroLogon.ps1\n    - https://github.com/xorrior/RandomPS-Scripts/blob/848c919bfce4e2d67b626cbcf4404341cfe3d3b6/Get-DXWebcamVideo.ps1\n    - https://github.com/rvrsh3ll/Misc-Powershell-Scripts/blob/6f23bb41f9675d7e2d32bacccff75e931ae00554/OfficeMemScraper.ps1\n    - https://github.com/dafthack/DomainPasswordSpray/blob/b13d64a5834694aa73fd2aea9911a83027c465a7/DomainPasswordSpray.ps1\n    - https://unit42.paloaltonetworks.com/threat-assessment-black-basta-ransomware/ # Invoke-TotalExec\n    - https://research.nccgroup.com/2022/06/06/shining-the-light-on-black-basta/ # Invoke-TotalExec\n    - https://github.com/HarmJ0y/DAMP\n    - https://github.com/samratashok/nishang\n    - https://github.com/DarkCoderSc/PowerRunAsSystem/\n    - https://github.com/besimorhino/powercat\n    - https://github.com/Kevin-Robertson/Powermad\n    - https://github.com/adrecon/ADRecon\n    - https://github.com/adrecon/AzureADRecon\n    - https://github.com/sadshade/veeam-creds/blob/6010eaf31ba41011b58d6af3950cffbf6f5cea32/Veeam-Get-Creds.ps1\n    - https://github.com/The-Viper-One/Invoke-PowerDPAPI/\nauthor: Markus Neis, Nasreddine Bencherchali (Nextron Systems), Mustafa Kaan Demir, Georg Lauenstein\ndate: 2018-04-07\nmodified: 2025-07-06\ntags:\n    - attack.execution\n    - attack.t1059.001\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection_generic:\n        TargetFilename|endswith:\n            # Note: Please ensure alphabetical order when adding new entries\n            - '\\Add-ConstrainedDelegationBackdoor.ps1'\n            - '\\Add-Exfiltration.ps1'\n            - '\\Add-Persistence.ps1'\n            - '\\Add-RegBackdoor.ps1'\n            - '\\Add-RemoteRegBackdoor.ps1'\n            - '\\Add-ScrnSaveBackdoor.ps1'\n            - '\\ADRecon.ps1'\n            - '\\AzureADRecon.ps1'\n            - '\\BadSuccessor.ps1'\n            - '\\Check-VM.ps1'\n            - '\\ConvertTo-ROT13.ps1'\n            - '\\Copy-VSS.ps1'\n            - '\\Create-MultipleSessions.ps1'\n            - '\\DNS_TXT_Pwnage.ps1'\n            - '\\dnscat2.ps1'\n            - '\\Do-Exfiltration.ps1'\n            - '\\DomainPasswordSpray.ps1'\n            - '\\Download_Execute.ps1'\n            - '\\Download-Execute-PS.ps1'\n            - '\\Enable-DuplicateToken.ps1'\n            - '\\Enabled-DuplicateToken.ps1'\n            - '\\Execute-Command-MSSQL.ps1'\n            - '\\Execute-DNSTXT-Code.ps1'\n            - '\\Execute-OnTime.ps1'\n            - '\\ExetoText.ps1'\n            - '\\Exploit-Jboss.ps1'\n            - '\\Find-AVSignature.ps1'\n            - '\\Find-Fruit.ps1'\n            - '\\Find-GPOLocation.ps1'\n            - '\\Find-TrustedDocuments.ps1'\n            - '\\FireBuster.ps1'\n            - '\\FireListener.ps1'\n            - '\\Get-ApplicationHost.ps1'\n            - '\\Get-ChromeDump.ps1'\n            - '\\Get-ClipboardContents.ps1'\n            - '\\Get-ComputerDetail.ps1'\n            - '\\Get-FoxDump.ps1'\n            - '\\Get-GPPAutologon.ps1'\n            - '\\Get-GPPPassword.ps1'\n            - '\\Get-IndexedItem.ps1'\n            - '\\Get-Keystrokes.ps1'\n            - '\\Get-LSASecret.ps1'\n            - '\\Get-MicrophoneAudio.ps1'\n            - '\\Get-PassHashes.ps1'\n            - '\\Get-PassHints.ps1'\n            - '\\Get-RegAlwaysInstallElevated.ps1'\n            - '\\Get-RegAutoLogon.ps1'\n            - '\\Get-RickAstley.ps1'\n            - '\\Get-Screenshot.ps1'\n            - '\\Get-SecurityPackages.ps1'\n            - '\\Get-ServiceFilePermission.ps1'\n            - '\\Get-ServicePermission.ps1'\n            - '\\Get-ServiceUnquoted.ps1'\n            - '\\Get-SiteListPassword.ps1'\n            - '\\Get-System.ps1'\n            - '\\Get-TimedScreenshot.ps1'\n            - '\\Get-UnattendedInstallFile.ps1'\n            - '\\Get-Unconstrained.ps1'\n            - '\\Get-USBKeystrokes.ps1'\n            - '\\Get-VaultCredential.ps1'\n            - '\\Get-VulnAutoRun.ps1'\n            - '\\Get-VulnSchTask.ps1'\n            - '\\Get-WebConfig.ps1'\n            - '\\Get-WebCredentials.ps1'\n            - '\\Get-WLAN-Keys.ps1'\n            - '\\Gupt-Backdoor.ps1'\n            - '\\HTTP-Backdoor.ps1'\n            - '\\HTTP-Login.ps1'\n            - '\\Install-ServiceBinary.ps1'\n            - '\\Install-SSP.ps1'\n            - '\\Invoke-ACLScanner.ps1'\n            - '\\Invoke-ADSBackdoor.ps1'\n            - '\\Invoke-AmsiBypass.ps1'\n            - '\\Invoke-ARPScan.ps1'\n            - '\\Invoke-BackdoorLNK.ps1'\n            - '\\Invoke-BadPotato.ps1'\n            - '\\Invoke-BetterSafetyKatz.ps1'\n            - '\\Invoke-BruteForce.ps1'\n            - '\\Invoke-BypassUAC.ps1'\n            - '\\Invoke-Carbuncle.ps1'\n            - '\\Invoke-Certify.ps1'\n            - '\\Invoke-ConPtyShell.ps1'\n            - '\\Invoke-CredentialInjection.ps1'\n            - '\\Invoke-CredentialsPhish.ps1'\n            - '\\Invoke-DAFT.ps1'\n            - '\\Invoke-DCSync.ps1'\n            - '\\Invoke-Decode.ps1'\n            - '\\Invoke-DinvokeKatz.ps1'\n            - '\\Invoke-DllInjection.ps1'\n            - '\\Invoke-DNSUpdate.ps1'\n            - '\\Invoke-DowngradeAccount.ps1'\n            - '\\Invoke-EgressCheck.ps1'\n            - '\\Invoke-Encode.ps1'\n            - '\\Invoke-EventViewer.ps1'\n            - '\\Invoke-Eyewitness.ps1'\n            - '\\Invoke-FakeLogonScreen.ps1'\n            - '\\Invoke-Farmer.ps1'\n            - '\\Invoke-Get-RBCD-Threaded.ps1'\n            - '\\Invoke-Gopher.ps1'\n            - '\\Invoke-Grouper2.ps1'\n            - '\\Invoke-Grouper3.ps1'\n            - '\\Invoke-HandleKatz.ps1'\n            - '\\Invoke-Interceptor.ps1'\n            - '\\Invoke-Internalmonologue.ps1'\n            - '\\Invoke-Inveigh.ps1'\n            - '\\Invoke-InveighRelay.ps1'\n            - '\\Invoke-JSRatRegsvr.ps1'\n            - '\\Invoke-JSRatRundll.ps1'\n            - '\\Invoke-KrbRelay.ps1'\n            - '\\Invoke-KrbRelayUp.ps1'\n            - '\\Invoke-LdapSignCheck.ps1'\n            - '\\Invoke-Lockless.ps1'\n            - '\\Invoke-MalSCCM.ps1'\n            - '\\Invoke-Mimikatz.ps1'\n            - '\\Invoke-MimikatzWDigestDowngrade.ps1'\n            - '\\Invoke-Mimikittenz.ps1'\n            - '\\Invoke-MITM6.ps1'\n            - '\\Invoke-NanoDump.ps1'\n            - '\\Invoke-NetRipper.ps1'\n            - '\\Invoke-NetworkRelay.ps1'\n            - '\\Invoke-NinjaCopy.ps1'\n            - '\\Invoke-OxidResolver.ps1'\n            - '\\Invoke-P0wnedshell.ps1'\n            - '\\Invoke-P0wnedshellx86.ps1'\n            - '\\Invoke-Paranoia.ps1'\n            - '\\Invoke-PortScan.ps1'\n            - '\\Invoke-PoshRatHttp.ps1'\n            - '\\Invoke-PoshRatHttps.ps1'\n            - '\\Invoke-PostExfil.ps1'\n            - '\\Invoke-PowerDump.ps1'\n            - '\\Invoke-PowerDPAPI.ps1'\n            - '\\Invoke-PowerShellIcmp.ps1'\n            - '\\Invoke-PowerShellTCP.ps1'\n            - '\\Invoke-PowerShellTcpOneLine.ps1'\n            - '\\Invoke-PowerShellTcpOneLineBind.ps1'\n            - '\\Invoke-PowerShellUdp.ps1'\n            - '\\Invoke-PowerShellUdpOneLine.ps1'\n            - '\\Invoke-PowerShellWMI.ps1'\n            - '\\Invoke-PowerThIEf.ps1'\n            - '\\Invoke-PPLDump.ps1'\n            - '\\Invoke-Prasadhak.ps1'\n            - '\\Invoke-PsExec.ps1'\n            - '\\Invoke-PsGcat.ps1'\n            - '\\Invoke-PsGcatAgent.ps1'\n            - '\\Invoke-PSInject.ps1'\n            - '\\Invoke-PsUaCme.ps1'\n            - '\\Invoke-ReflectivePEInjection.ps1'\n            - '\\Invoke-ReverseDNSLookup.ps1'\n            - '\\Invoke-Rubeus.ps1'\n            - '\\Invoke-RunAs.ps1'\n            - '\\Invoke-SafetyKatz.ps1'\n            - '\\Invoke-SauronEye.ps1'\n            - '\\Invoke-SCShell.ps1'\n            - '\\Invoke-Seatbelt.ps1'\n            - '\\Invoke-ServiceAbuse.ps1'\n            - '\\Invoke-SessionGopher.ps1'\n            - '\\Invoke-ShellCode.ps1'\n            - '\\Invoke-SMBScanner.ps1'\n            - '\\Invoke-Snaffler.ps1'\n            - '\\Invoke-Spoolsample.ps1'\n            - '\\Invoke-SSHCommand.ps1'\n            - '\\Invoke-SSIDExfil.ps1'\n            - '\\Invoke-StandIn.ps1'\n            - '\\Invoke-StickyNotesExtract.ps1'\n            - '\\Invoke-Tater.ps1'\n            - '\\Invoke-Thunderfox.ps1'\n            - '\\Invoke-ThunderStruck.ps1'\n            - '\\Invoke-TokenManipulation.ps1'\n            - '\\Invoke-Tokenvator.ps1'\n            - '\\Invoke-TotalExec.ps1'\n            - '\\Invoke-UrbanBishop.ps1'\n            - '\\Invoke-UserHunter.ps1'\n            - '\\Invoke-VoiceTroll.ps1'\n            - '\\Invoke-Whisker.ps1'\n            - '\\Invoke-WinEnum.ps1'\n            - '\\Invoke-winPEAS.ps1'\n            - '\\Invoke-WireTap.ps1'\n            - '\\Invoke-WmiCommand.ps1'\n            - '\\Invoke-WScriptBypassUAC.ps1'\n            - '\\Invoke-Zerologon.ps1'\n            - '\\Keylogger.ps1'\n            - '\\MailRaider.ps1'\n            - '\\New-HoneyHash.ps1'\n            - '\\OfficeMemScraper.ps1'\n            - '\\Offline_Winpwn.ps1'\n            - '\\Out-CHM.ps1'\n            - '\\Out-DnsTxt.ps1'\n            - '\\Out-Excel.ps1'\n            - '\\Out-HTA.ps1'\n            - '\\Out-Java.ps1'\n            - '\\Out-JS.ps1'\n            - '\\Out-Minidump.ps1'\n            - '\\Out-RundllCommand.ps1'\n            - '\\Out-SCF.ps1'\n            - '\\Out-SCT.ps1'\n            - '\\Out-Shortcut.ps1'\n            - '\\Out-WebQuery.ps1'\n            - '\\Out-Word.ps1'\n            - '\\Parse_Keys.ps1'\n            - '\\Port-Scan.ps1'\n            - '\\PowerBreach.ps1'\n            - '\\powercat.ps1'\n            - '\\Powermad.ps1'\n            - '\\PowerRunAsSystem.psm1'\n            - '\\PowerSharpPack.ps1'\n            - '\\PowerUp.ps1'\n            - '\\PowerUpSQL.ps1'\n            - '\\PowerView.ps1'\n            - '\\PSAsyncShell.ps1'\n            - '\\RemoteHashRetrieval.ps1'\n            - '\\Remove-Persistence.ps1'\n            - '\\Remove-PoshRat.ps1'\n            - '\\Remove-Update.ps1'\n            - '\\Run-EXEonRemote.ps1'\n            - '\\Schtasks-Backdoor.ps1'\n            - '\\Set-DCShadowPermissions.ps1'\n            - '\\Set-MacAttribute.ps1'\n            - '\\Set-RemotePSRemoting.ps1'\n            - '\\Set-RemoteWMI.ps1'\n            - '\\Set-Wallpaper.ps1'\n            - '\\Show-TargetScreen.ps1'\n            - '\\Speak.ps1'\n            - '\\Start-CaptureServer.ps1'\n            - '\\Start-WebcamRecorder.ps1'\n            - '\\StringToBase64.ps1'\n            - '\\TexttoExe.ps1'\n            - '\\Veeam-Get-Creds.ps1'\n            - '\\VolumeShadowCopyTools.ps1'\n            - '\\WinPwn.ps1'\n            - '\\WSUSpendu.ps1'\n    selection_invoke_sharp:\n        TargetFilename|contains: 'Invoke-Sharp' # Covers all \"Invoke-Sharp\" variants\n        TargetFilename|endswith: '.ps1'\n    condition: 1 of selection_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_powershell_drop_powershell.yml","content":"title: PowerShell Script Dropped Via PowerShell.EXE\nid: 576426ad-0131-4001-ae01-be175da0c108\nstatus: test\ndescription: Detects PowerShell creating a PowerShell file (.ps1). While often times this behavior is benign, sometimes it can be a sign of a dropper script trying to achieve persistence.\nreferences:\n    - https://www.zscaler.com/blogs/security-research/onenote-growing-threat-malware-distribution\nauthor: frack113\ndate: 2023-05-09\ntags:\n    - attack.persistence\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        Image|endswith:\n            - '\\powershell.exe'\n            - '\\pwsh.exe'\n        TargetFilename|endswith: '.ps1'\n    filter_main_psscriptpolicytest:\n        TargetFilename|contains: '__PSScriptPolicyTest_'\n    filter_main_appdata:\n        TargetFilename|startswith: 'C:\\Users\\'\n        TargetFilename|contains: '\\AppData\\Local\\Temp\\'\n    filter_main_windows_temp:\n        TargetFilename|startswith: 'C:\\Windows\\Temp\\'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - False positives will differ depending on the environment and scripts used. Apply additional filters accordingly.\nlevel: low\n"},{"path":"file\\file_event\\file_event_win_powershell_drop_binary_or_script.yml","content":"title: Potential Binary Or Script Dropper Via PowerShell\nid: 7047d730-036f-4f40-b9d8-1c63e36d5e62\nstatus: test\ndescription: Detects PowerShell creating a binary executable or a script file.\nreferences:\n    - https://www.zscaler.com/blogs/security-research/onenote-growing-threat-malware-distribution\nauthor: frack113, Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-03-17\nmodified: 2025-07-04\ntags:\n    - attack.persistence\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        Image|endswith:\n            - '\\powershell.exe'\n            - '\\powershell_ise.exe'\n            - '\\pwsh.exe'\n        TargetFilename|endswith:\n            - '.bat'\n            - '.chm'\n            - '.cmd'\n            - '.com'\n            - '.dll'\n            - '.exe'\n            - '.hta'\n            - '.jar'\n            - '.js'\n            - '.ocx'\n            - '.scr'\n            - '.sys'\n            - '.vbe'\n            - '.vbs'\n            - '.wsf'\n    filter_main_user_temp:\n        TargetFilename|startswith: 'C:\\Users\\'\n        TargetFilename|contains: '\\AppData\\Local\\Temp\\'\n        TargetFilename|endswith:\n            - '.dll'\n            - '.exe'\n    filter_main_other_temp:\n        # Example: C:\\Windows\\Temp\\0DA9758B-4649-4969-9409-5CBDF193FB53\\TransmogProvider.dll\n        TargetFilename|startswith:\n            - 'C:\\Windows\\Temp\\'\n            - 'C:\\Windows\\SystemTemp\\'\n        TargetFilename|endswith:\n            - '.dll'\n            - '.exe'\n    filter_main_powershell_module:\n        TargetFilename|startswith: 'C:\\Users\\'\n        TargetFilename|contains: '\\WindowsPowerShell\\Modules\\' # C:\\Users\\xxxx\\Documents\\WindowsPowerShell\\Modules\\powershell-yaml\\0.4.12\\lib\\net47\\PowerShellYamlSerializer.dll\n        TargetFilename|endswith: '.dll'\n    filter_main_nuget:\n        TargetFilename|startswith: 'C:\\Program Files\\PackageManagement\\ProviderAssemblies\\nuget\\'\n        TargetFilename|endswith: '\\Microsoft.PackageManagement.NuGetProvider.dll'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - False positives will differ depending on the environment and scripts used. Apply additional filters accordingly.\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_perflogs_susp_files.yml","content":"title: Suspicious File Created In PerfLogs\nid: bbb7e38c-0b41-4a11-b306-d2a457b7ac2b\nstatus: test\ndescription: Detects suspicious file based on their extension being created in \"C:\\PerfLogs\\\". Note that this directory mostly contains \".etl\" files\nreferences:\n    - Internal Research\n    - https://labs.withsecure.com/publications/fin7-target-veeam-servers\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-05-05\ntags:\n    - attack.execution\n    - attack.t1059\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|startswith: 'C:\\PerfLogs\\'\n        TargetFilename|endswith:\n            - '.7z'\n            - '.bat'\n            - '.bin'\n            - '.chm'\n            - '.dll'\n            - '.exe'\n            - '.hta'\n            - '.lnk'\n            - '.ps1'\n            - '.psm1'\n            - '.py'\n            - '.scr'\n            - '.sys'\n            - '.vbe'\n            - '.vbs'\n            - '.zip'\n    condition: selection\nfalsepositives:\n    - Unlikely\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_pcre_net_temp_file.yml","content":"title: PCRE.NET Package Temp Files\nid: 6e90ae7a-7cd3-473f-a035-4ebb72d961da\nstatus: test\ndescription: Detects processes creating temp files related to PCRE.NET package\nreferences:\n    - https://twitter.com/rbmaslen/status/1321859647091970051\n    - https://twitter.com/tifkin_/status/1321916444557365248\nauthor: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)\ndate: 2020-10-29\nmodified: 2022-10-09\ntags:\n    - attack.execution\n    - attack.t1059\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|contains: \\AppData\\Local\\Temp\\ba9ea7344a4a5f591d6e5dc32a13494b\\\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_office_uncommon_file_startup.yml","content":"title: Uncommon File Created In Office Startup Folder\nid: a10a2c40-2c4d-49f8-b557-1a946bc55d9d\nstatus: test\ndescription: Detects the creation of a file with an uncommon extension in an Office application startup folder\nreferences:\n    - https://app.any.run/tasks/d6fe6624-6ef8-485d-aa75-3d1bdda2a08c/\n    - http://addbalance.com/word/startup.htm\n    - https://answers.microsoft.com/en-us/msoffice/forum/all/document-in-word-startup-folder-doesnt-open-when/44ab0932-2917-4150-8cdc-2f2cf39e86f3\n    - https://en.wikipedia.org/wiki/List_of_Microsoft_Office_filename_extensions\nauthor: frack113, Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-06-05\nmodified: 2023-12-13\ntags:\n    - attack.resource-development\n    - attack.t1587.001\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection_word_paths:\n        - TargetFilename|contains: '\\Microsoft\\Word\\STARTUP'\n        - TargetFilename|contains|all:\n              - '\\Office'\n              - '\\Program Files'\n              - '\\STARTUP'\n    filter_exclude_word_ext:\n        TargetFilename|endswith:\n            - '.docb' # Word binary document introduced in Microsoft Office 2007\n            - '.docm' # Word macro-enabled document; same as docx, but may contain macros and scripts\n            - '.docx' # Word document\n            - '.dotm' # Word macro-enabled template; same as dotx, but may contain macros and scripts\n            - '.mdb' # MS Access DB\n            - '.mdw' # MS Access DB\n            - '.pdf' # PDF documents\n            - '.wll' # Word add-in\n            - '.wwl' # Word add-in\n    selection_excel_paths:\n        - TargetFilename|contains: '\\Microsoft\\Excel\\XLSTART'\n        - TargetFilename|contains|all:\n              - '\\Office'\n              - '\\Program Files'\n              - '\\XLSTART'\n    filter_exclude_excel_ext:\n        TargetFilename|endswith:\n            - '.xll'\n            - '.xls'\n            - '.xlsm'\n            - '.xlsx'\n            - '.xlt'\n            - '.xltm'\n            - '.xlw'\n    filter_main_office_click_to_run:\n        Image|contains: ':\\Program Files\\Common Files\\Microsoft Shared\\ClickToRun\\'\n        Image|endswith: '\\OfficeClickToRun.exe'\n    filter_main_office_apps:\n        Image|contains:\n            - ':\\Program Files\\Microsoft Office\\'\n            - ':\\Program Files (x86)\\Microsoft Office\\'\n        Image|endswith:\n            - '\\winword.exe'\n            - '\\excel.exe'\n    condition: ((selection_word_paths and not filter_exclude_word_ext) or (selection_excel_paths and not filter_exclude_excel_ext)) and not 1 of filter_main_*\nfalsepositives:\n    - False positive might stem from rare extensions used by other Office utilities.\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_office_susp_file_extension.yml","content":"title: File With Uncommon Extension Created By An Office Application\nid: c7a74c80-ba5a-486e-9974-ab9e682bc5e4\nstatus: test\ndescription: Detects the creation of files with an executable or script extension by an Office application.\nreferences:\n    - https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/\n    - https://github.com/vadim-hunter/Detection-Ideas-Rules/blob/02bcbfc2bfb8b4da601bb30de0344ae453aa1afe/Threat%20Intelligence/The%20DFIR%20Report/20210329_Sodinokibi_(aka_REvil)_Ransomware.yaml\nauthor: Vadim Khrykov (ThreatIntel), Cyb3rEng (Rule), Nasreddine Bencherchali (Nextron Systems)\ndate: 2021-08-23\nmodified: 2025-10-17\ntags:\n    - attack.t1204.002\n    - attack.execution\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    # Note: Please add more file extensions to the logic of your choice.\n    selection1:\n        Image|endswith:\n            - '\\excel.exe'\n            - '\\msaccess.exe'\n            - '\\mspub.exe'\n            - '\\powerpnt.exe'\n            - '\\visio.exe'\n            - '\\winword.exe'\n    selection2:\n        TargetFilename|endswith:\n            - '.bat'\n            - '.cmd'\n            - '.com'\n            - '.dll'\n            - '.exe'\n            - '.hta'\n            - '.ocx'\n            - '.proj'\n            - '.ps1'\n            - '.scf'\n            - '.scr'\n            - '.sys'\n            - '.vbe'\n            - '.vbs'\n            - '.wsf'\n            - '.wsh'\n    filter_main_localassembly:\n        TargetFilename|contains: '\\AppData\\Local\\assembly\\tmp\\'\n        TargetFilename|endswith: '.dll'\n    filter_optional_webservicecache: # matches e.g. directory with name *.microsoft.com\n        TargetFilename|contains|all:\n            - 'C:\\Users\\'\n            - '\\AppData\\Local\\Microsoft\\Office\\'\n            - '\\WebServiceCache\\AllUsers'\n        TargetFilename|endswith: '.com'\n    filter_optional_webex:\n        Image|endswith: '\\winword.exe'\n        TargetFilename|contains: '\\AppData\\Local\\Temp\\webexdelta\\'\n        TargetFilename|endswith:\n            - '.dll'\n            - '.exe'\n    filter_optional_backstageinappnavcache: # matches e.g. C:\\Users\\xxxxx\\AppData\\Local\\Microsoft\\Office\\16.0\\BackstageInAppNavCache\\ODB-user@domain.com\n        TargetFilename|contains|all:\n            - 'C:\\Users\\'\n            - '\\AppData\\Local\\Microsoft\\Office\\'\n            - '\\BackstageInAppNavCache\\'\n        TargetFilename|endswith: '.com'\n    condition: all of selection* and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_office_startup_persistence.yml","content":"title: Potential Persistence Via Microsoft Office Startup Folder\nid: 0e20c89d-2264-44ae-8238-aeeaba609ece\nstatus: test\ndescription: Detects creation of Microsoft Office files inside of one of the default startup folders in order to achieve persistence.\nreferences:\n    - https://insight-jp.nttsecurity.com/post/102hojk/operation-restylink-apt-campaign-targeting-japanese-companies\n    - https://learn.microsoft.com/en-us/office/troubleshoot/excel/use-startup-folders\nauthor: Max Altgelt (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-06-02\nmodified: 2023-06-22\ntags:\n    - attack.persistence\n    - attack.t1137\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection_word_paths:\n        - TargetFilename|contains: '\\Microsoft\\Word\\STARTUP'\n        - TargetFilename|contains|all:\n              - '\\Office'\n              - '\\Program Files'\n              - '\\STARTUP'\n    selection_word_extension:\n        TargetFilename|endswith:\n            - '.doc'\n            - '.docm'\n            - '.docx'\n            - '.dot'\n            - '.dotm'\n            - '.rtf'\n    selection_excel_paths:\n        - TargetFilename|contains: '\\Microsoft\\Excel\\XLSTART'\n        - TargetFilename|contains|all:\n              - '\\Office'\n              - '\\Program Files'\n              - '\\XLSTART'\n    selection_excel_extension:\n        TargetFilename|endswith:\n            - '.xls'\n            - '.xlsm'\n            - '.xlsx'\n            - '.xlt'\n            - '.xltm'\n    filter_main_office:\n        Image|endswith:\n            - '\\WINWORD.exe'\n            - '\\EXCEL.exe'\n    condition: (all of selection_word_* or all of selection_excel_*) and not filter_main_office\nfalsepositives:\n    - Loading a user environment from a backup or a domain controller\n    - Synchronization of templates\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_office_publisher_files_in_susp_locations.yml","content":"title: Publisher Attachment File Dropped In Suspicious Location\nid: 3d2a2d59-929c-4b78-8c1a-145dfe9e07b1\nstatus: test\ndescription: Detects creation of files with the \".pub\" extension in suspicious or uncommon locations. This could be a sign of attackers abusing Publisher documents\nreferences:\n    - https://twitter.com/EmericNasi/status/1623224526220804098\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-02-08\ntags:\n    - attack.defense-evasion\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|contains:\n            - '\\AppData\\Local\\Temp\\'\n            - '\\Users\\Public\\'\n            - '\\Windows\\Temp\\'\n            - 'C:\\Temp\\'\n        TargetFilename|endswith: '.pub'\n    condition: selection\nfalsepositives:\n    - Legitimate usage of \".pub\" files from those locations\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_office_outlook_susp_macro_creation.yml","content":"title: Suspicious Outlook Macro Created\nid: 117d3d3a-755c-4a61-b23e-9171146d094c\nrelated:\n    - id: 8c31f563-f9a7-450c-bfa8-35f8f32f1f61\n      type: derived\nstatus: test\ndescription: Detects the creation of a macro file for Outlook.\nreferences:\n    - https://www.mdsec.co.uk/2020/11/a-fresh-outlook-on-mail-based-persistence/\n    - https://speakerdeck.com/heirhabarov/hunting-for-persistence-via-microsoft-exchange-server-or-outlook?slide=53\n    - https://www.linkedin.com/pulse/outlook-backdoor-using-vba-samir-b-/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-02-08\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.command-and-control\n    - attack.t1137\n    - attack.t1008\n    - attack.t1546\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|endswith: '\\Microsoft\\Outlook\\VbaProject.OTM'\n    filter:\n        Image|endswith: '\\outlook.exe'\n    condition: selection and not filter\nfalsepositives:\n    - Unlikely\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_office_outlook_susp_file_creation_in_temp_dir.yml","content":"title: Suspicious File Created in Outlook Temporary Directory\nid: fabb0e80-030c-4e3e-a104-d09676991ac3\nrelated:\n    - id: f748c45a-f8d3-4e6f-b617-fe176f695b8f\n      type: obsolete\nstatus: experimental\ndescription: |\n    Detects the creation of files with suspicious file extensions in the temporary directory that Outlook uses when opening attachments.\n    This can be used to detect spear-phishing campaigns that use suspicious files as attachments, which may contain malicious code.\nreferences:\n    - https://vipre.com/blog/svg-phishing-attacks-the-new-trick-in-the-cybercriminals-playbook/\n    - https://thecyberexpress.com/rogue-rdp-files-used-in-ukraine-cyberattacks/\n    - https://www.microsoft.com/en-us/security/blog/2024/10/29/midnight-blizzard-conducts-large-scale-spear-phishing-campaign-using-rdp-files/\nauthor: Florian Roth (Nextron Systems), Swachchhanda Shrawan Poudel (Nextron Systems)\ndate: 2025-07-22\ntags:\n    - attack.initial-access\n    - attack.t1566.001\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection_extension:\n        TargetFilename|endswith:\n            - '.cpl'\n            - '.hta'\n            - '.iso'\n            - '.rdp'\n            - '.svg'\n            - '.vba'\n            - '.vbe'\n            - '.vbs'\n    selection_location:\n        - TargetFilename|contains:\n              - '\\AppData\\Local\\Packages\\Microsoft.Outlook_'\n              - '\\AppData\\Local\\Microsoft\\Olk\\Attachments\\'\n        - TargetFilename|contains|all:\n              - '\\AppData\\Local\\Microsoft\\Windows\\'\n              - '\\Content.Outlook\\'\n    condition: all of selection_*\nfalsepositives:\n    - Opening of headers or footers in email signatures that include SVG images or legitimate SVG attachments\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_office_outlook_newform.yml","content":"title: Potential Persistence Via Outlook Form\nid: c3edc6a5-d9d4-48d8-930e-aab518390917\nstatus: test\ndescription: Detects the creation of a new Outlook form which can contain malicious code\nreferences:\n    - https://speakerdeck.com/heirhabarov/hunting-for-persistence-via-microsoft-exchange-server-or-outlook?slide=76\n    - https://speakerdeck.com/heirhabarov/hunting-for-persistence-via-microsoft-exchange-server-or-outlook?slide=79\n    - https://learn.microsoft.com/en-us/office/vba/outlook/concepts/outlook-forms/create-an-outlook-form\n    - https://www.slipstick.com/developer/custom-form/clean-outlooks-forms-cache/\nauthor: Tobias Michalski (Nextron Systems)\ndate: 2021-06-10\nmodified: 2023-02-22\ntags:\n    - attack.persistence\n    - attack.t1137.003\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        Image|endswith: '\\outlook.exe'\n        TargetFilename|contains:\n            - '\\AppData\\Local\\Microsoft\\FORMS\\IPM'\n            - '\\Local Settings\\Application Data\\Microsoft\\Forms' # Windows XP\n    condition: selection\nfalsepositives:\n    - Legitimate use of outlook forms\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_office_outlook_macro_creation.yml","content":"title: New Outlook Macro Created\nid: 8c31f563-f9a7-450c-bfa8-35f8f32f1f61\nrelated:\n    - id: 117d3d3a-755c-4a61-b23e-9171146d094c\n      type: derived\nstatus: test\ndescription: Detects the creation of a macro file for Outlook.\nreferences:\n    - https://www.mdsec.co.uk/2020/11/a-fresh-outlook-on-mail-based-persistence/\nauthor: '@ScoubiMtl'\ndate: 2021-04-05\nmodified: 2023-02-08\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.command-and-control\n    - attack.t1137\n    - attack.t1008\n    - attack.t1546\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        Image|endswith: '\\outlook.exe'\n        TargetFilename|endswith: '\\Microsoft\\Outlook\\VbaProject.OTM'\n    condition: selection\nfalsepositives:\n    - User genuinely creates a VB Macro for their email\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_office_onenote_susp_dropped_files.yml","content":"title: Suspicious File Created Via OneNote Application\nid: fcc6d700-68d9-4241-9a1a-06874d621b06\nstatus: test\ndescription: Detects suspicious files created via the OneNote application. This could indicate a potential malicious \".one\"/\".onepkg\" file was executed as seen being used in malware activity in the wild\nreferences:\n    - https://www.bleepingcomputer.com/news/security/hackers-now-use-microsoft-onenote-attachments-to-spread-malware/\n    - https://blog.osarmor.com/319/onenote-attachment-delivers-asyncrat-malware/\n    - https://twitter.com/MaD_c4t/status/1623414582382567424\n    - https://labs.withsecure.com/publications/detecting-onenote-abuse\n    - https://www.trustedsec.com/blog/new-attacks-old-tricks-how-onenote-malware-is-evolving/\n    - https://app.any.run/tasks/17f2d378-6d11-4d6f-8340-954b04f35e83/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-02-09\nmodified: 2023-02-27\ntags:\n    - attack.defense-evasion\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        Image|endswith:\n            - '\\onenote.exe'\n            - '\\onenotem.exe'\n            - '\\onenoteim.exe'\n        TargetFilename|contains: '\\AppData\\Local\\Temp\\OneNote\\'\n        TargetFilename|endswith:\n            # TODO: Add more suspicious extensions\n            - '.bat'\n            - '.chm'\n            - '.cmd'\n            - '.dll'\n            - '.exe'\n            - '.hta'\n            - '.htm'\n            - '.html'\n            - '.js'\n            - '.lnk'\n            - '.ps1'\n            - '.vbe'\n            - '.vbs'\n            - '.wsf'\n    condition: selection\nfalsepositives:\n    - False positives should be very low with the extensions list cited. Especially if you don't heavily utilize OneNote.\n    - Occasional FPs might occur if OneNote is used internally to share different embedded documents\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_office_onenote_files_in_susp_locations.yml","content":"title: OneNote Attachment File Dropped In Suspicious Location\nid: 7fd164ba-126a-4d9c-9392-0d4f7c243df0\nstatus: test\ndescription: Detects creation of files with the \".one\"/\".onepkg\" extension in suspicious or uncommon locations. This could be a sign of attackers abusing OneNote attachments\nreferences:\n    - https://www.bleepingcomputer.com/news/security/hackers-now-use-microsoft-onenote-attachments-to-spread-malware/\n    - https://blog.osarmor.com/319/onenote-attachment-delivers-asyncrat-malware/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-01-22\nmodified: 2023-09-19\ntags:\n    - attack.defense-evasion\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|contains:\n            # Note: add more common locations for drops such as download folders and the like. Or baseline legitimate locations and alert on everything else\n            - '\\AppData\\Local\\Temp\\'\n            - '\\Users\\Public\\'\n            - '\\Windows\\Temp\\'\n            - ':\\Temp\\'\n        TargetFilename|endswith:\n            - '.one'\n            - '.onepkg'\n    filter_main_onenote:\n        Image|contains: ':\\Program Files\\Microsoft Office\\'\n        Image|endswith: '\\ONENOTE.EXE'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Legitimate usage of \".one\" or \".onepkg\" files from those locations\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_office_macro_files_from_susp_process.yml","content":"title: Office Macro File Creation From Suspicious Process\nid: b1c50487-1967-4315-a026-6491686d860e\nstatus: test\ndescription: Detects the creation of a office macro file from a a suspicious process\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1566.001/T1566.001.md\n    - https://learn.microsoft.com/en-us/deployoffice/compat/office-file-format-reference\nauthor: frack113, Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-01-23\nmodified: 2023-02-22\ntags:\n    - attack.initial-access\n    - attack.t1566.001\nlogsource:\n    category: file_event\n    product: windows\n    definition: 'Requirements: The \"ParentImage\" field is not available by default on EID 11 of Sysmon logs. To be able to use this rule to the full extent you need to enriche the log with additional ParentImage data'\ndetection:\n    selection_cmd:\n        - Image|endswith:\n              - '\\cscript.exe'\n              - '\\mshta.exe'\n              - '\\regsvr32.exe'\n              - '\\rundll32.exe'\n              - '\\wscript.exe'\n        # Note: ParentImage is a custom field and is not available by default on Sysmon EID 11\n        - ParentImage|endswith:\n              - '\\cscript.exe'\n              - '\\mshta.exe'\n              - '\\regsvr32.exe'\n              - '\\rundll32.exe'\n              - '\\wscript.exe'\n    selection_ext:\n        TargetFilename|endswith:\n            - '.docm'\n            - '.dotm'\n            - '.xlsm'\n            - '.xltm'\n            - '.potm'\n            - '.pptm'\n    condition: all of selection_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_office_macro_files_downloaded.yml","content":"title: Office Macro File Download\nid: 0e29e3a7-1ad8-40aa-b691-9f82ecd33d66\nrelated:\n    - id: 91174a41-dc8f-401b-be89-7bfc140612a0\n      type: similar\nstatus: test\ndescription: |\n    Detects the creation of a new office macro files on the system via an application (browser, mail client).\n    This can help identify potential malicious activity, such as the download of macro-enabled documents that could be used for exploitation.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1566.001/T1566.001.md\n    - https://learn.microsoft.com/en-us/deployoffice/compat/office-file-format-reference\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-01-23\nmodified: 2025-10-29\ntags:\n    - attack.initial-access\n    - attack.t1566.001\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection_processes:\n        Image|endswith:\n            # Email clients\n            - '\\RuntimeBroker.exe' # Windows Email clients uses RuntimeBroker to create the files\n            - '\\outlook.exe'\n            - '\\thunderbird.exe'\n            # Browsers\n            - '\\brave.exe'\n            - '\\chrome.exe'\n            - '\\firefox.exe'\n            - '\\iexplore.exe'\n            - '\\maxthon.exe'\n            - '\\MicrosoftEdge.exe'\n            - '\\msedge.exe'\n            - '\\msedgewebview2.exe'\n            - '\\opera.exe'\n            - '\\safari.exe'\n            - '\\seamonkey.exe'\n            - '\\vivaldi.exe'\n            - '\\whale.exe'\n    selection_ext:\n        - TargetFilename|endswith:\n              - '.docm'\n              - '.dotm'\n              - '.xlsm'\n              - '.xltm'\n              - '.potm'\n              - '.pptm'\n        - TargetFilename|contains:\n              - '.docm:Zone'\n              - '.dotm:Zone'\n              - '.xlsm:Zone'\n              - '.xltm:Zone'\n              - '.potm:Zone'\n              - '.pptm:Zone'\n    condition: all of selection_*\nfalsepositives:\n    - Legitimate macro files downloaded from the internet\n    - Legitimate macro files sent as attachments via emails\nlevel: low\n"},{"path":"file\\file_event\\file_event_win_office_macro_files_created.yml","content":"title: Office Macro File Creation\nid: 91174a41-dc8f-401b-be89-7bfc140612a0\nrelated:\n    - id: 0e29e3a7-1ad8-40aa-b691-9f82ecd33d66\n      type: similar\nstatus: test\ndescription: Detects the creation of a new office macro files on the systems\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1566.001/T1566.001.md\n    - https://learn.microsoft.com/en-us/deployoffice/compat/office-file-format-reference\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-01-23\ntags:\n    - attack.initial-access\n    - attack.t1566.001\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|endswith:\n            - '.docm'\n            - '.dotm'\n            - '.xlsm'\n            - '.xltm'\n            - '.potm'\n            - '.pptm'\n    condition: selection\nfalsepositives:\n    - Very common in environments that rely heavily on macro documents\nlevel: low\n"},{"path":"file\\file_event\\file_event_win_office_addin_persistence.yml","content":"title: Potential Persistence Via Microsoft Office Add-In\nid: 8e1cb247-6cf6-42fa-b440-3f27d57e9936\nstatus: test\ndescription: Detects potential persistence activity via startup add-ins that load when Microsoft Office starts (.wll/.xll are simply .dll fit for Word or Excel).\nreferences:\n    - Internal Research\n    - https://labs.withsecure.com/publications/add-in-opportunities-for-office-persistence\n    - https://github.com/redcanaryco/atomic-red-team/blob/4ae9580a1a8772db87a1b6cdb0d03e5af231e966/atomics/T1137.006/T1137.006.md\nauthor: NVISO\ndate: 2020-05-11\nmodified: 2023-02-08\ntags:\n    - attack.persistence\n    - attack.t1137.006\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection_wlldropped:\n        TargetFilename|contains: '\\Microsoft\\Word\\Startup\\'\n        TargetFilename|endswith: '.wll'\n    selection_xlldropped:\n        TargetFilename|contains: '\\Microsoft\\Excel\\Startup\\'\n        TargetFilename|endswith: '.xll'\n    selection_xladropped:\n        TargetFilename|contains: 'Microsoft\\Excel\\XLSTART\\'\n        TargetFilename|endswith: '.xlam'\n    selection_generic:\n        TargetFilename|contains: '\\Microsoft\\Addins\\'\n        TargetFilename|endswith:\n            - '.xlam'\n            - '.xla'\n            - '.ppam'\n    condition: 1 of selection_*\nfalsepositives:\n    - Legitimate add-ins\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_ntds_exfil_tools.yml","content":"title: NTDS Exfiltration Filename Patterns\nid: 3a8da4e0-36c1-40d2-8b29-b3e890d5172a\nstatus: test\ndescription: Detects creation of files with specific name patterns seen used in various tools that export the NTDS.DIT for exfiltration.\nreferences:\n    - https://github.com/rapid7/metasploit-framework/blob/eb6535009f5fdafa954525687f09294918b5398d/modules/post/windows/gather/ntds_grabber.rb\n    - https://github.com/rapid7/metasploit-framework/blob/eb6535009f5fdafa954525687f09294918b5398d/data/post/powershell/NTDSgrab.ps1\n    - https://github.com/SecureAuthCorp/impacket/blob/7d2991d78836b376452ca58b3d14daa61b67cb40/impacket/examples/secretsdump.py#L2405\nauthor: Florian Roth (Nextron Systems)\ndate: 2022-03-11\nmodified: 2023-05-05\ntags:\n    - attack.credential-access\n    - attack.t1003.003\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|endswith:\n            - '\\All.cab' # https://github.com/rapid7/metasploit-framework/blob/eb6535009f5fdafa954525687f09294918b5398d/data/post/powershell/NTDSgrab.ps1\n            - '.ntds.cleartext' # https://github.com/SecureAuthCorp/impacket/blob/7d2991d78836b376452ca58b3d14daa61b67cb40/impacket/examples/secretsdump.py#L2405\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_ntds_dit_uncommon_process.yml","content":"title: NTDS.DIT Creation By Uncommon Process\nid: 11b1ed55-154d-4e82-8ad7-83739298f720\nrelated:\n    - id: 4e7050dd-e548-483f-b7d6-527ab4fa784d\n      type: similar\nstatus: test\ndescription: Detects creation of a file named \"ntds.dit\" (Active Directory Database) by an uncommon process or a process located in a suspicious directory\nreferences:\n    - https://stealthbits.com/blog/extracting-password-hashes-from-the-ntds-dit-file/\n    - https://adsecurity.org/?p=2398\nauthor: Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-01-11\nmodified: 2022-07-14\ntags:\n    - attack.credential-access\n    - attack.t1003.002\n    - attack.t1003.003\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection_ntds:\n        TargetFilename|endswith: '\\ntds.dit'\n    selection_process_img:\n        Image|endswith:\n            # Add more suspicious processes as you see fit\n            - '\\cmd.exe'\n            - '\\cscript.exe'\n            - '\\mshta.exe'\n            - '\\powershell.exe'\n            - '\\pwsh.exe'\n            - '\\regsvr32.exe'\n            - '\\rundll32.exe'\n            - '\\wscript.exe'\n            - '\\wsl.exe'\n            - '\\wt.exe'\n    selection_process_paths:\n        Image|contains:\n            - '\\AppData\\'\n            - '\\Temp\\'\n            - '\\Public\\'\n            - '\\PerfLogs\\'\n    condition: selection_ntds and 1 of selection_process_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_ntds_dit_uncommon_parent_process.yml","content":"title: NTDS.DIT Creation By Uncommon Parent Process\nid: 4e7050dd-e548-483f-b7d6-527ab4fa784d\nrelated:\n    - id: 11b1ed55-154d-4e82-8ad7-83739298f720\n      type: similar\nstatus: test\ndescription: Detects creation of a file named \"ntds.dit\" (Active Directory Database) by an uncommon parent process or directory\nreferences:\n    - https://www.ired.team/offensive-security/credential-access-and-credential-dumping/ntds.dit-enumeration\n    - https://www.n00py.io/2022/03/manipulating-user-passwords-without-mimikatz/\n    - https://pentestlab.blog/tag/ntds-dit/\n    - https://github.com/samratashok/nishang/blob/414ee1104526d7057f9adaeee196d91ae447283e/Gather/Copy-VSS.ps1\nauthor: Florian Roth (Nextron Systems)\ndate: 2022-03-11\nmodified: 2023-01-05\ntags:\n    - attack.credential-access\n    - attack.t1003.003\nlogsource:\n    product: windows\n    category: file_event\n    definition: 'Requirements: The \"ParentImage\" field is not available by default on EID 11 of Sysmon logs. To be able to use this rule to the full extent you need to enrich the log with additional ParentImage data'\ndetection:\n    selection_file:\n        TargetFilename|endswith: '\\ntds.dit'\n    selection_process_parent:\n        # Note: ParentImage is a custom field and is not available by default on Sysmon EID 11\n        ParentImage|endswith:\n            - '\\cscript.exe'\n            - '\\httpd.exe'\n            - '\\nginx.exe'\n            - '\\php-cgi.exe'\n            - '\\powershell.exe'\n            - '\\pwsh.exe'\n            - '\\w3wp.exe'\n            - '\\wscript.exe'\n    selection_process_parent_path:\n        # Note: ParentImage is a custom field and is not available by default on Sysmon EID 11\n        ParentImage|contains:\n            - '\\apache'\n            - '\\tomcat'\n            - '\\AppData\\'\n            - '\\Temp\\'\n            - '\\Public\\'\n            - '\\PerfLogs\\'\n    condition: selection_file and 1 of selection_process_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_ntds_dit_creation.yml","content":"title: NTDS.DIT Created\nid: 0b8baa3f-575c-46ee-8715-d6f28cc7d33c\nstatus: test\ndescription: Detects creation of a file named \"ntds.dit\" (Active Directory Database)\nreferences:\n    - Internal Research\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-05-05\ntags:\n    - attack.credential-access\n    - attack.t1003.003\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|endswith: 'ntds.dit'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: low\n"},{"path":"file\\file_event\\file_event_win_notepad_plus_plus_persistence.yml","content":"title: Potential Persistence Via Notepad++ Plugins\nid: 54127bd4-f541-4ac3-afdb-ea073f63f692\nstatus: test\ndescription: Detects creation of new \".dll\" files inside the plugins directory of a notepad++ installation by a process other than \"gup.exe\". Which could indicates possible persistence\nreferences:\n    - https://pentestlab.blog/2022/02/14/persistence-notepad-plugins/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-06-10\nmodified: 2025-09-01\ntags:\n    - attack.persistence\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|contains: '\\Notepad++\\plugins\\'\n        TargetFilename|endswith: '.dll'\n    filter_gup:\n        Image|endswith: '\\Notepad++\\updater\\gup.exe'\n    filter_install:\n        # This filter is for Sigma dataset you could remove it or change when using the rule in your own env\n        Image|startswith: 'C:\\Users\\'\n        Image|contains: '\\AppData\\Local\\Temp\\'\n        Image|endswith:\n            - '\\target.exe'\n            - 'Installer.x64.exe'\n    filter_main_installer:\n        Image|contains: '\\npp.'\n        Image|endswith: '.exe'\n        TargetFilename:\n            - 'C:\\Program Files\\Notepad++\\plugins\\NppExport\\NppExport.dll'\n            - 'C:\\Program Files\\Notepad++\\plugins\\mimeTools\\mimeTools.dll'\n            - 'C:\\Program Files\\Notepad++\\plugins\\NppConverter\\NppConverter.dll'\n            - 'C:\\Program Files\\Notepad++\\plugins\\Config\\nppPluginList.dll'\n    condition: selection and not 1 of filter_*\nfalsepositives:\n    - Possible FPs during first installation of Notepad++\n    - Legitimate use of custom plugins by users in order to enhance notepad++ functionalities\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_new_scr_file.yml","content":"title: SCR File Write Event\nid: c048f047-7e2a-4888-b302-55f509d4a91d\nstatus: test\ndescription: Detects the creation of screensaver files (.scr) outside of system folders. Attackers may execute an application as an \".SCR\" file using \"rundll32.exe desk.cpl,InstallScreenSaver\" for example.\nreferences:\n    - https://lolbas-project.github.io/lolbas/Libraries/Desk/\nauthor: 'Christopher Peacock @securepeacock, SCYTHE @scythe_io'\ndate: 2022-04-27\nmodified: 2023-08-23\ntags:\n    - attack.defense-evasion\n    - attack.t1218.011\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|endswith: '.scr'\n    filter:\n        TargetFilename|contains:\n            - ':\\$WINDOWS.~BT\\NewOS\\'\n            - ':\\Windows\\System32\\'\n            - ':\\Windows\\SysWOW64\\'\n            - ':\\Windows\\WinSxS\\'\n            - ':\\WUDownloadCache\\' # Windows Update Download Cache\n    condition: selection and not filter\nfalsepositives:\n    - The installation of new screen savers by third party software\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_new_files_in_uncommon_appdata_folder.yml","content":"title: Suspicious File Creation In Uncommon AppData Folder\nid: d7b50671-d1ad-4871-aa60-5aa5b331fe04\nstatus: test\ndescription: Detects the creation of suspicious files and folders inside the user's AppData folder but not inside any of the common and well known directories (Local, Romaing, LocalLow). This method could be used as a method to bypass detection who exclude the AppData folder in fear of FPs\nreferences:\n    - Internal Research\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-08-05\nmodified: 2023-02-23\ntags:\n    - attack.defense-evasion\n    - attack.execution\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|startswith: 'C:\\Users\\'\n        TargetFilename|contains: '\\AppData\\'\n        TargetFilename|endswith:\n            # Add more as needed\n            - '.bat'\n            - '.cmd'\n            - '.cpl'\n            - '.dll'\n            - '.exe'\n            - '.hta'\n            - '.iso'\n            - '.lnk'\n            - '.msi'\n            - '.ps1'\n            - '.psm1'\n            - '.scr'\n            - '.vbe'\n            - '.vbs'\n    filter_main:\n        TargetFilename|startswith: 'C:\\Users\\'\n        TargetFilename|contains:\n            - '\\AppData\\Local\\'\n            - '\\AppData\\LocalLow\\'\n            - '\\AppData\\Roaming\\'\n    condition: selection and not filter_main\nfalsepositives:\n    - Unlikely\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_net_cli_artefact.yml","content":"title: Suspicious DotNET CLR Usage Log Artifact\nid: e0b06658-7d1d-4cd3-bf15-03467507ff7c\nrelated:\n    - id: 4508a70e-97ef-4300-b62b-ff27992990ea\n      type: derived\n    - id: e4b63079-6198-405c-abd7-3fe8b0ce3263\n      type: obsolete\nstatus: test\ndescription: Detects the creation of Usage Log files by the CLR (clr.dll). These files are named after the executing process once the assembly is finished executing for the first time in the (user) session context.\nreferences:\n    - https://bohops.com/2021/03/16/investigating-net-clr-usage-log-tampering-techniques-for-edr-evasion/\n    - https://github.com/olafhartong/sysmon-modular/blob/fa1ae53132403d262be2bbd7f17ceea7e15e8c78/11_file_create/include_dotnet.xml\n    - https://web.archive.org/web/20221026202428/https://gist.github.com/code-scrap/d7f152ffcdb3e0b02f7f394f5187f008\n    - https://web.archive.org/web/20230329154538/https://blog.menasec.net/2019/07/interesting-difr-traces-of-net-clr.html\nauthor: frack113, omkar72, oscd.community, Wojciech Lesicki\ndate: 2022-11-18\nmodified: 2023-02-23\ntags:\n    - attack.defense-evasion\n    - attack.t1218\nlogsource:\n    category: file_event\n    product: windows\n    definition: 'Requirements: UsageLogs folder must be monitored by the sysmon configuration'\ndetection:\n    selection:\n        TargetFilename|endswith:\n            - '\\UsageLogs\\cmstp.exe.log'\n            - '\\UsageLogs\\cscript.exe.log'\n            - '\\UsageLogs\\mshta.exe.log'\n            - '\\UsageLogs\\msxsl.exe.log'\n            - '\\UsageLogs\\regsvr32.exe.log'\n            - '\\UsageLogs\\rundll32.exe.log'\n            - '\\UsageLogs\\svchost.exe.log'\n            - '\\UsageLogs\\wscript.exe.log'\n            - '\\UsageLogs\\wmic.exe.log'\n    filter_main_rundll32:\n        # This filter requires the event to be enriched by additional information such as ParentImage and CommandLine activity\n        ParentImage|endswith: '\\MsiExec.exe'\n        ParentCommandLine|contains: ' -Embedding'\n        Image|endswith: '\\rundll32.exe'\n        CommandLine|contains|all:\n            - 'Temp'\n            - 'zzzzInvokeManagedCustomActionOutOfProc'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Rundll32.exe with zzzzInvokeManagedCustomActionOutOfProc in command line and msiexec.exe as parent process - https://twitter.com/SBousseaden/status/1388064061087260675\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_mysqld_uncommon_file_creation.yml","content":"title: Uncommon File Creation By Mysql Daemon Process\nid: c61daa90-3c1e-4f18-af62-8f288b5c9aaf\nstatus: test\ndescription: |\n    Detects the creation of files with scripting or executable extensions by Mysql daemon.\n    Which could be an indicator of \"User Defined Functions\" abuse to download malware.\nreferences:\n    - https://asec.ahnlab.com/en/58878/\n    - https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/honeypot-recon-mysql-malware-infection-via-user-defined-functions-udf/\nauthor: Joseph Kamau\ndate: 2024-05-27\ntags:\n    - attack.defense-evasion\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        Image|endswith:\n            - \\mysqld.exe\n            - \\mysqld-nt.exe\n        TargetFilename|endswith:\n            - '.bat'\n            - '.dat'\n            - '.dll'\n            - '.exe'\n            - '.ps1'\n            - '.psm1'\n            - '.vbe'\n            - '.vbs'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_msdt_susp_directories.yml","content":"title: File Creation In Suspicious Directory By Msdt.EXE\nid: 318557a5-150c-4c8d-b70e-a9910e199857\nstatus: test\ndescription: Detects msdt.exe creating files in suspicious directories which could be a sign of exploitation of either Follina or Dogwalk vulnerabilities\nreferences:\n    - https://irsl.medium.com/the-trouble-with-microsofts-troubleshooters-6e32fc80b8bd\n    - https://msrc-blog.microsoft.com/2022/05/30/guidance-for-cve-2022-30190-microsoft-support-diagnostic-tool-vulnerability/\nauthor: Vadim Varganov, Florian Roth (Nextron Systems)\ndate: 2022-08-24\nmodified: 2023-02-23\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547.001\n    - cve.2022-30190\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        Image|endswith: '\\msdt.exe'\n        TargetFilename|contains:\n            - '\\Desktop\\'\n            - '\\Start Menu\\Programs\\Startup\\'\n            - 'C:\\PerfLogs\\'\n            - 'C:\\ProgramData\\'\n            - 'C:\\Users\\Public\\'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_mal_octopus_scanner.yml","content":"title: Octopus Scanner Malware\nid: 805c55d9-31e6-4846-9878-c34c75054fe9\nstatus: test\ndescription: Detects Octopus Scanner Malware.\nreferences:\n    - https://securitylab.github.com/research/octopus-scanner-malware-open-source-supply-chain\nauthor: NVISO\ndate: 2020-06-09\nmodified: 2021-11-27\ntags:\n    - attack.initial-access\n    - attack.t1195\n    - attack.t1195.001\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|endswith:\n            - '\\AppData\\Local\\Microsoft\\Cache134.dat'\n            - '\\AppData\\Local\\Microsoft\\ExplorerSync.db'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_mal_adwind.yml","content":"title: Adwind RAT / JRAT File Artifact\nid: 0bcfabcb-7929-47f4-93d6-b33fb67d34d1\nrelated:\n    - id: 1fac1481-2dbc-48b2-9096-753c49b4ec71\n      type: derived\nstatus: test\ndescription: Detects javaw.exe in AppData folder as used by Adwind / JRAT\nreferences:\n    - https://www.hybrid-analysis.com/sample/ba86fa0d4b6af2db0656a88b1dd29f36fe362473ae8ad04255c4e52f214a541c?environmentId=100\n    - https://www.first.org/resources/papers/conf2017/Advanced-Incident-Detection-and-Threat-Hunting-using-Sysmon-and-Splunk.pdf\nauthor: Florian Roth (Nextron Systems), Tom Ueltschi, Jonhnathan Ribeiro, oscd.community\ndate: 2017-11-10\nmodified: 2022-12-02\ntags:\n    - attack.execution\n    - attack.t1059.005\n    - attack.t1059.007\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        - TargetFilename|contains|all:\n              - '\\AppData\\Roaming\\Oracle\\bin\\java'\n              - '.exe'\n        - TargetFilename|contains|all:\n              - '\\Retrive'\n              - '.vbs'\n    condition: selection\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_lsass_werfault_dump.yml","content":"title: WerFault LSASS Process Memory Dump\nid: c3e76af5-4ce0-4a14-9c9a-25ceb8fda182\nstatus: test\ndescription: Detects WerFault creating a dump file with a name that indicates that the dump file could be an LSASS process memory, which contains user credentials\nreferences:\n    - https://github.com/helpsystems/nanodump\nauthor: Florian Roth (Nextron Systems)\ndate: 2022-06-27\ntags:\n    - attack.credential-access\n    - attack.t1003.001\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        Image: C:\\WINDOWS\\system32\\WerFault.exe\n        TargetFilename|contains:\n            - '\\lsass'\n            - 'lsass.exe'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_lsass_shtinkering.yml","content":"title: LSASS Process Dump Artefact In CrashDumps Folder\nid: 6902955a-01b7-432c-b32a-6f5f81d8f625\nstatus: test\ndescription: Detects the presence of an LSASS dump file in the \"CrashDumps\" folder. This could be a sign of LSASS credential dumping. Techniques such as the LSASS Shtinkering have been seen abusing the Windows Error Reporting to dump said process.\nreferences:\n    - https://github.com/deepinstinct/Lsass-Shtinkering\n    - https://media.defcon.org/DEF%20CON%2030/DEF%20CON%2030%20presentations/Asaf%20Gilboa%20-%20LSASS%20Shtinkering%20Abusing%20Windows%20Error%20Reporting%20to%20Dump%20LSASS.pdf\nauthor: '@pbssubhash'\ndate: 2022-12-08\ntags:\n    - attack.credential-access\n    - attack.t1003.001\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|startswith: 'C:\\Windows\\System32\\config\\systemprofile\\AppData\\Local\\CrashDumps\\'\n        TargetFilename|contains: 'lsass.exe.'\n        TargetFilename|endswith: '.dmp'\n    condition: selection\nfalsepositives:\n    - Rare legitimate dump of the process by the operating system due to a crash of lsass\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_lsass_default_dump_file_names.yml","content":"title: LSASS Process Memory Dump Files\nid: a5a2d357-1ab8-4675-a967-ef9990a59391\nrelated:\n    - id: db2110f3-479d-42a6-94fb-d35bc1e46492\n      type: obsolete\n    - id: 5e3d3601-0662-4af0-b1d2-36a05e90c40a\n      type: obsolete\nstatus: test\ndescription: Detects creation of files with names used by different memory dumping tools to create a memory dump of the LSASS process memory, which contains user credentials.\nreferences:\n    - https://www.google.com/search?q=procdump+lsass\n    - https://medium.com/@markmotig/some-ways-to-dump-lsass-exe-c4a75fdc49bf\n    - https://github.com/elastic/detection-rules/blob/c76a39796972ecde44cb1da6df47f1b6562c9770/rules/windows/credential_access_lsass_memdump_file_created.toml\n    - https://www.whiteoaksecurity.com/blog/attacks-defenses-dumping-lsass-no-mimikatz/\n    - https://github.com/helpsystems/nanodump\n    - https://github.com/CCob/MirrorDump\n    - https://github.com/safedv/RustiveDump/blob/1a9b026b477587becfb62df9677cede619d42030/src/main.rs#L35\n    - https://github.com/ricardojoserf/NativeDump/blob/01d8cd17f31f51f5955a38e85cd3c83a17596175/NativeDump/Program.cs#L258\nauthor: Florian Roth (Nextron Systems)\ndate: 2021-11-15\nmodified: 2024-10-08\ntags:\n    - attack.credential-access\n    - attack.t1003.001\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection_1:\n        TargetFilename|endswith:\n            - '\\Andrew.dmp'\n            - '\\Coredump.dmp'\n            - '\\lsass.dmp'\n            - '\\lsass.rar'\n            - '\\lsass.zip'\n            - '\\NotLSASS.zip'  # https://github.com/CCob/MirrorDump\n            - '\\PPLBlade.dmp'  # https://github.com/tastypepperoni/PPLBlade\n            - '\\rustive.dmp' # https://github.com/safedv/RustiveDump/blob/main/src/main.rs#L35\n    selection_2:\n        TargetFilename|contains:\n            - '\\lsass_2'  # default format of procdump v9.0 is lsass_YYMMDD_HHmmss.dmp\n            - '\\lsassdmp'\n            - '\\lsassdump'\n    selection_3:\n        TargetFilename|contains|all:\n            - '\\lsass'\n            - '.dmp'\n    selection_4:\n        TargetFilename|contains: 'SQLDmpr'\n        TargetFilename|endswith: '.mdmp'\n    selection_5:\n        TargetFilename|contains:\n            - '\\nanodump'\n            - '\\proc_' # NativeDump pattern https://github.com/ricardojoserf/NativeDump/blob/01d8cd17f31f51f5955a38e85cd3c83a17596175/NativeDump/Program.cs#L258\n        TargetFilename|endswith: '.dmp'\n    condition: 1 of selection_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_lolbin_gather_network_info_script_output.yml","content":"title: GatherNetworkInfo.VBS Reconnaissance Script Output\nid: f92a6f1e-a512-4a15-9735-da09e78d7273\nrelated:\n    - id: 575dce0c-8139-4e30-9295-1ee75969f7fe # ProcCreation LOLBIN\n      type: similar\n    - id: 07aa184a-870d-413d-893a-157f317f6f58 # ProcCreation Susp\n      type: similar\nstatus: test\ndescription: Detects creation of files which are the results of executing the built-in reconnaissance script \"C:\\Windows\\System32\\gatherNetworkInfo.vbs\".\nreferences:\n    - https://posts.slayerlabs.com/living-off-the-land/#gathernetworkinfovbs\n    - https://www.mandiant.com/resources/blog/trojanized-windows-installers-ukrainian-government\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-02-08\ntags:\n    - attack.discovery\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|startswith: 'C:\\Windows\\System32\\config'\n        TargetFilename|endswith:\n            - '\\Hotfixinfo.txt'\n            - '\\netiostate.txt'\n            - '\\sysportslog.txt'\n            - '\\VmSwitchLog.evtx'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_iso_file_recent.yml","content":"title: ISO or Image Mount Indicator in Recent Files\nid: 4358e5a5-7542-4dcb-b9f3-87667371839b\nstatus: test\ndescription: |\n    Detects the creation of recent element file that points to an .ISO, .IMG, .VHD or .VHDX file as often used in phishing attacks.\n    This can be a false positive on server systems but on workstations users should rarely mount .iso or .img files.\nreferences:\n    - https://www.microsoft.com/security/blog/2021/05/27/new-sophisticated-email-based-attack-from-nobelium/\n    - https://www.trendmicro.com/vinfo/us/security/news/cybercrime-and-digital-threats/malicious-spam-campaign-uses-iso-image-files-to-deliver-lokibot-and-nanocore\n    - https://blog.emsisoft.com/en/32373/beware-new-wave-of-malware-spreads-via-iso-file-email-attachments/\n    - https://insights.sei.cmu.edu/blog/the-dangers-of-vhd-and-vhdx-files/\nauthor: Florian Roth (Nextron Systems)\ndate: 2022-02-11\ntags:\n    - attack.initial-access\n    - attack.t1566.001\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|endswith:\n            - '.iso.lnk'\n            - '.img.lnk'\n            - '.vhd.lnk'\n            - '.vhdx.lnk'\n        TargetFilename|contains: '\\Microsoft\\Windows\\Recent\\'\n    condition: selection\nfalsepositives:\n    - Cases in which a user mounts an image file for legitimate reasons\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_iso_file_mount.yml","content":"title: ISO File Created Within Temp Folders\nid: 2f9356ae-bf43-41b8-b858-4496d83b2acb\nstatus: test\ndescription: Detects the creation of a ISO file in the Outlook temp folder or in the Appdata temp folder. Typical of Qakbot TTP from end-July 2022.\nreferences:\n    - https://twitter.com/Sam0x90/status/1552011547974696960\n    - https://securityaffairs.co/wordpress/133680/malware/dll-sideloading-spread-qakbot.html\n    - https://github.com/redcanaryco/atomic-red-team/blob/0f229c0e42bfe7ca736a14023836d65baa941ed2/atomics/T1553.005/T1553.005.md#atomic-test-1---mount-iso-image\nauthor: '@sam0x90'\ndate: 2022-07-30\ntags:\n    - attack.initial-access\n    - attack.t1566.001\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection_1:\n        TargetFilename|contains|all:\n            - '\\AppData\\Local\\Temp\\'\n            - '.zip\\'\n        TargetFilename|endswith: '.iso'\n    selection_2:\n        TargetFilename|contains: '\\AppData\\Local\\Microsoft\\Windows\\INetCache\\Content.Outlook\\'\n        TargetFilename|endswith: '.iso'\n    condition: 1 of selection*\nfields:\n    - Image\n    - ComputerName\n    - TargetFileName\nfalsepositives:\n    - Potential FP by sysadmin opening a zip file containing a legitimate ISO file\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_iphlpapi_dll_sideloading.yml","content":"title: Malicious DLL File Dropped in the Teams or OneDrive Folder\nid: 1908fcc1-1b92-4272-8214-0fbaf2fa5163\nstatus: test\ndescription: |\n    Detects creation of a malicious DLL file in the location where the OneDrive or Team applications\n    Upon execution of the Teams or OneDrive application, the dropped malicious DLL file (\"iphlpapi.dll\") is sideloaded\nreferences:\n    - https://blog.cyble.com/2022/07/27/targeted-attacks-being-carried-out-via-dll-sideloading/\nauthor: frack113\ndate: 2022-08-12\ntags:\n    - attack.persistence\n    - attack.privilege-escalation\n    - attack.defense-evasion\n    - attack.t1574.001\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|contains|all:\n            - 'iphlpapi.dll'\n            - '\\AppData\\Local\\Microsoft'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_install_teamviewer_desktop.yml","content":"title: Installation of TeamViewer Desktop\nid: 9711de76-5d4f-4c50-a94f-21e4e8f8384d\nstatus: test\ndescription: TeamViewer_Desktop.exe is create during install\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1219/T1219.md#atomic-test-1---teamviewer-files-detected-test-on-windows\nauthor: frack113\ndate: 2022-01-28\ntags:\n    - attack.command-and-control\n    - attack.t1219.002\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|endswith: '\\TeamViewer_Desktop.exe'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_initial_access_dll_search_order_hijacking.yml","content":"title: Potential Initial Access via DLL Search Order Hijacking\nid: dbbd9f66-2ed3-4ca2-98a4-6ea985dd1a1c\nstatus: test\ndescription: Detects attempts to create a DLL file to a known desktop application dependencies folder such as Slack, Teams or OneDrive and by an unusual process. This may indicate an attempt to load a malicious module via DLL search order hijacking.\nreferences:\n    - https://github.com/elastic/protections-artifacts/commit/746086721fd385d9f5c6647cada1788db4aea95f#diff-5d46dd4ac6866b4337ec126be8cee0e115467b3e8703794ba6f6df6432c806bc\n    - https://posts.specterops.io/automating-dll-hijack-discovery-81c4295904b0\nauthor: Tim Rauch (rule), Elastic (idea)\ndate: 2022-10-21\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1566\n    - attack.t1566.001\n    - attack.initial-access\n    - attack.t1574\n    - attack.t1574.001\n    - attack.defense-evasion\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        Image|endswith:\n            # add more processes when you find them\n            - '\\winword.exe'\n            - '\\excel.exe'\n            - '\\powerpnt.exe'\n            - '\\MSACCESS.EXE'\n            - '\\MSPUB.EXE'\n            - '\\fltldr.exe'\n            - '\\cmd.exe'\n            - '\\certutil.exe'\n            - '\\mshta.exe'\n            - '\\cscript.exe'\n            - '\\wscript.exe'\n            - '\\curl.exe'\n            - '\\powershell.exe'\n            - '\\pwsh.exe'\n        TargetFilename|endswith: '.dll'\n        TargetFilename|contains|all:\n            - '\\Users\\'\n            - '\\AppData\\'\n        TargetFilename|contains:\n            # add more suspicious paths when you find them\n            - '\\Microsoft\\OneDrive\\'\n            - '\\Microsoft OneDrive\\'\n            - '\\Microsoft\\Teams\\'\n            - '\\Local\\slack\\app-'\n            - '\\Local\\Programs\\Microsoft VS Code\\'\n    filter:\n        Image|endswith: '\\cmd.exe'\n        TargetFilename|contains|all:\n            - '\\Users\\'\n            - '\\AppData\\'\n            - '\\Microsoft\\OneDrive\\'\n            - '\\api-ms-win-core-'\n    condition: selection and not filter\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_impacket_file_indicators.yml","content":"title: HackTool - Impacket File Indicators\nid: 03f4ca17-de95-428d-a75a-4ee78b047256\nrelated:\n    - id: 6e2a900a-ced9-4e4a-a9c2-13e706f9518a\n      type: similar\nstatus: experimental\ndescription: Detects file creation events with filename patterns used by Impacket.\nreferences:\n    - https://thedfirreport.com/2025/05/19/another-confluence-bites-the-dust-falling-to-elpaco-team-ransomware/\n    - https://github.com/fortra/impacket\nauthor: \"The DFIR Report, IrishDeath\"\ndate: 2025-05-19\ntags:\n    - attack.credential-access\n    - attack.t1003.001\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection_names_re:\n        TargetFilename|re: '\\\\sessionresume_[a-zA-Z]{8}$' # https://github.com/fortra/impacket/blob/ead516a1209742efc7ac550707a9304ba08681e9/impacket/examples/secretsdump.py#L1925C38-L1925C51\n    condition: selection_names_re\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_hktl_safetykatz.yml","content":"title: HackTool - SafetyKatz Dump Indicator\nid: e074832a-eada-4fd7-94a1-10642b130e16\nstatus: test\ndescription: Detects default lsass dump filename generated by SafetyKatz.\nreferences:\n    - https://github.com/GhostPack/SafetyKatz\n    - https://github.com/GhostPack/SafetyKatz/blob/715b311f76eb3a4c8d00a1bd29c6cd1899e450b7/SafetyKatz/Program.cs#L63\nauthor: Markus Neis\ndate: 2018-07-24\nmodified: 2024-06-27\ntags:\n    - attack.credential-access\n    - attack.t1003.001\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|endswith: '\\Temp\\debug.bin'\n    condition: selection\nfalsepositives:\n    - Rare legitimate files with similar filename structure\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_hktl_remote_cred_dump.yml","content":"title: HackTool - Potential Remote Credential Dumping Activity Via CrackMapExec Or Impacket-Secretsdump\nid: 6e2a900a-ced9-4e4a-a9c2-13e706f9518a\nstatus: test\ndescription: Detects default filenames output from the execution of CrackMapExec and Impacket-secretsdump against an endpoint.\nreferences:\n    - https://github.com/Porchetta-Industries/CrackMapExec\n    - https://github.com/fortra/impacket/blob/ff8c200fd040b04d3b5ff05449646737f836235d/examples/secretsdump.py\nauthor: SecurityAura\ndate: 2022-11-16\nmodified: 2024-06-27\ntags:\n    - attack.credential-access\n    - attack.t1003\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        Image|endswith: '\\svchost.exe'\n        # CommandLine|contains: 'RemoteRegistry' # Uncomment this line if you collect CommandLine data for files events from more accuracy\n        TargetFilename|re: '\\\\Windows\\\\System32\\\\[a-zA-Z0-9]{8}\\.tmp$'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_hktl_quarkspw_filedump.yml","content":"title: HackTool - QuarksPwDump Dump File\nid: 847def9e-924d-4e90-b7c4-5f581395a2b4\nstatus: test\ndescription: Detects a dump file written by QuarksPwDump password dumper\nreferences:\n    - https://jpcertcc.github.io/ToolAnalysisResultSheet/details/QuarksPWDump.htm\nauthor: Florian Roth (Nextron Systems)\ndate: 2018-02-10\nmodified: 2024-06-27\ntags:\n    - attack.credential-access\n    - attack.t1003.002\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|contains|all:\n            - '\\AppData\\Local\\Temp\\SAM-'\n            - '.dmp'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: critical\n"},{"path":"file\\file_event\\file_event_win_hktl_powerup_dllhijacking.yml","content":"title: HackTool - Powerup Write Hijack DLL\nid: 602a1f13-c640-4d73-b053-be9a2fa58b96\nstatus: test\ndescription: |\n    Powerup tool's Write Hijack DLL exploits DLL hijacking for privilege escalation.\n    In it's default mode, it builds a self deleting .bat file which executes malicious command.\n    The detection rule relies on creation of the malicious bat file (debug.bat by default).\nreferences:\n    - https://powersploit.readthedocs.io/en/latest/Privesc/Write-HijackDll/\nauthor: Subhash Popuri (@pbssubhash)\ndate: 2021-08-21\nmodified: 2024-06-27\ntags:\n    - attack.persistence\n    - attack.privilege-escalation\n    - attack.defense-evasion\n    - attack.t1574.001\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        Image|endswith:\n            - '\\powershell.exe'\n            - '\\pwsh.exe'\n        TargetFilename|endswith: '.bat'\n    condition: selection\nfalsepositives:\n    - Any powershell script that creates bat files # highly unlikely (untested)\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_hktl_nppspy.yml","content":"title: HackTool - NPPSpy Hacktool Usage\nid: cad1fe90-2406-44dc-bd03-59d0b58fe722\nstatus: test\ndescription: Detects the use of NPPSpy hacktool that stores cleartext passwords of users that logged in to a local file\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1003/T1003.md#atomic-test-2---credential-dumping-with-nppspy\n    - https://twitter.com/0gtweet/status/1465282548494487554\nauthor: Florian Roth (Nextron Systems)\ndate: 2021-11-29\nmodified: 2024-06-27\ntags:\n    - attack.credential-access\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|endswith:\n            - '\\NPPSpy.txt'\n            - '\\NPPSpy.dll'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_hktl_mimikatz_files.yml","content":"title: HackTool - Mimikatz Kirbi File Creation\nid: 9e099d99-44c2-42b6-a6d8-54c3545cab29\nrelated:\n    - id: 034affe8-6170-11ec-844f-0f78aa0c4d66\n      type: obsolete\nstatus: test\ndescription: Detects the creation of files created by mimikatz such as \".kirbi\", \"mimilsa.log\", etc.\nreferences:\n    - https://cobalt.io/blog/kerberoast-attack-techniques\n    - https://pentestlab.blog/2019/10/21/persistence-security-support-provider/\nauthor: Florian Roth (Nextron Systems), David ANDRE\ndate: 2021-11-08\nmodified: 2024-06-27\ntags:\n    - attack.credential-access\n    - attack.t1558\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|endswith:\n            - '.kirbi' # Kerberos tickets\n            - 'mimilsa.log' # MemSSP default file\n    condition: selection\nfalsepositives:\n    - Unlikely\nlevel: critical\n"},{"path":"file\\file_event\\file_event_win_hktl_krbrelay_remote_ioc.yml","content":"title: HackTool - RemoteKrbRelay SMB Relay Secrets Dump Module Indicators\nid: 3ab79e90-9fab-4cdf-a7b2-6522bc742adb\nstatus: test\ndescription: Detects the creation of file with specific names used by RemoteKrbRelay SMB Relay attack module.\nreferences:\n    - https://github.com/CICADA8-Research/RemoteKrbRelay/blob/19ec76ba7aa50c2722b23359bc4541c0a9b2611c/Exploit/RemoteKrbRelay/Relay/Attacks/RemoteRegistry.cs#L31-L40\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2024-06-27\ntags:\n    - attack.command-and-control\n    - attack.t1219.002\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|endswith:\n            - ':\\windows\\temp\\sam.tmp'\n            - ':\\windows\\temp\\sec.tmp'\n            - ':\\windows\\temp\\sys.tmp'\n    condition: selection\nfalsepositives:\n    - Unlikely\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_hktl_inveigh_artefacts.yml","content":"title: HackTool - Inveigh Execution Artefacts\nid: bb09dd3e-2b78-4819-8e35-a7c1b874e449\nstatus: test\ndescription: Detects the presence and execution of Inveigh via dropped artefacts\nreferences:\n    - https://github.com/Kevin-Robertson/Inveigh/blob/29d9e3c3a625b3033cdaf4683efaafadcecb9007/Inveigh/Support/Output.cs\n    - https://github.com/Kevin-Robertson/Inveigh/blob/29d9e3c3a625b3033cdaf4683efaafadcecb9007/Inveigh/Support/Control.cs\n    - https://thedfirreport.com/2020/11/23/pysa-mespinoza-ransomware/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-10-24\nmodified: 2024-06-27\ntags:\n    - attack.command-and-control\n    - attack.t1219.002\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|endswith:\n            - '\\Inveigh-Log.txt'\n            - '\\Inveigh-Cleartext.txt'\n            - '\\Inveigh-NTLMv1Users.txt'\n            - '\\Inveigh-NTLMv2Users.txt'\n            - '\\Inveigh-NTLMv1.txt'\n            - '\\Inveigh-NTLMv2.txt'\n            - '\\Inveigh-FormInput.txt'\n            - '\\Inveigh.dll'\n            - '\\Inveigh.exe'\n            - '\\Inveigh.ps1'\n            - '\\Inveigh-Relay.ps1'\n    condition: selection\nfalsepositives:\n    - Unlikely\nlevel: critical\n"},{"path":"file\\file_event\\file_event_win_hktl_hivenightmare_file_exports.yml","content":"title: HackTool - Typical HiveNightmare SAM File Export\nid: 6ea858a8-ba71-4a12-b2cc-5d83312404c7\nstatus: test\ndescription: Detects files written by the different tools that exploit HiveNightmare\nreferences:\n    - https://github.com/GossiTheDog/HiveNightmare\n    - https://github.com/FireFart/hivenightmare/\n    - https://github.com/WiredPulse/Invoke-HiveNightmare\n    - https://twitter.com/cube0x0/status/1418920190759378944\nauthor: Florian Roth (Nextron Systems)\ndate: 2021-07-23\nmodified: 2024-06-27\ntags:\n    - attack.credential-access\n    - attack.t1552.001\n    - cve.2021-36934\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        - TargetFilename|contains:\n              - '\\hive_sam_'  # Go version\n              - '\\SAM-2021-'  # C++ version\n              - '\\SAM-2022-'  # C++ version\n              - '\\SAM-2023-'  # C++ version\n              - '\\SAM-haxx'   # Early C++ versions\n              - '\\Sam.save'   # PowerShell version\n        - TargetFilename: 'C:\\windows\\temp\\sam'  # C# version of HiveNightmare\n    condition: selection\nfalsepositives:\n    - Files that accidentally contain these strings\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_hktl_dumpert.yml","content":"title: HackTool - Dumpert Process Dumper Default File\nid: 93d94efc-d7ad-4161-ad7d-1638c4f908d8\nrelated:\n    - id: 2704ab9e-afe2-4854-a3b1-0c0706d03578\n      type: derived\nstatus: test\ndescription: Detects the creation of the default dump file used by Outflank Dumpert tool. A process dumper, which dumps the lsass process memory\nreferences:\n    - https://github.com/outflanknl/Dumpert\n    - https://unit42.paloaltonetworks.com/actors-still-exploiting-sharepoint-vulnerability/\nauthor: Florian Roth (Nextron Systems)\ndate: 2020-02-04\nmodified: 2023-05-09\ntags:\n    - attack.credential-access\n    - attack.t1003.001\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|endswith: 'dumpert.dmp'\n    condition: selection\nfalsepositives:\n    - Very unlikely\nlevel: critical\n"},{"path":"file\\file_event\\file_event_win_hktl_crackmapexec_indicators.yml","content":"title: HackTool - CrackMapExec File Indicators\nid: 736ffa74-5f6f-44ca-94ef-1c0df4f51d2a\nrelated:\n    - id: 9433ff9c-5d3f-4269-99f8-95fc826ea489\n      type: obsolete\nstatus: test\ndescription: Detects file creation events with filename patterns used by CrackMapExec.\nreferences:\n    - https://github.com/byt3bl33d3r/CrackMapExec/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2024-03-11\nmodified: 2024-06-27\ntags:\n    - attack.credential-access\n    - attack.t1003.001\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection_path:\n        TargetFilename|startswith: 'C:\\Windows\\Temp\\' # The disk extension is hardcoded in the tool.\n    selection_names_str:\n        TargetFilename|endswith:\n            - '\\temp.ps1' # https://github.com/byt3bl33d3r/CrackMapExec/blob/3c3e412193cb6d3237abe90c543e5d995bfa4447/cme/modules/keepass_trigger.py#L42C41-L42C68\n            - '\\msol.ps1' # https://github.com/byt3bl33d3r/CrackMapExec/blob/3c3e412193cb6d3237abe90c543e5d995bfa4447/cme/modules/msol.py#L48C98-L48C106\n    selection_names_re:\n        - TargetFilename|re: '\\\\[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}\\.txt$' # https://github.com/byt3bl33d3r/CrackMapExec/blob/3c3e412193cb6d3237abe90c543e5d995bfa4447/cme/protocols/wmi/wmiexec.py#L86\n        - TargetFilename|re: '\\\\[a-zA-Z]{8}\\.tmp$' # https://github.com/byt3bl33d3r/CrackMapExec/blob/3c3e412193cb6d3237abe90c543e5d995bfa4447/cme/protocols/smb/atexec.py#L145C19-L146\n    condition: selection_path and 1 of selection_names_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_gotoopener_artefact.yml","content":"title: GoToAssist Temporary Installation Artefact\nid: 5d756aee-ad3e-4306-ad95-cb1abec48de2\nstatus: test\ndescription: |\n    An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks.\n    These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment.\n    Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land)\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1219/T1219.md#atomic-test-4---gotoassist-files-detected-test-on-windows\nauthor: frack113\ndate: 2022-02-13\ntags:\n    - attack.command-and-control\n    - attack.t1219.002\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|contains: '\\AppData\\Local\\Temp\\LogMeInInc\\GoToAssist Remote Support Expert\\'\n    condition: selection\nfalsepositives:\n    - Legitimate use\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_exchange_webshell_drop_suspicious.yml","content":"title: Suspicious File Drop by Exchange\nid: 6b269392-9eba-40b5-acb6-55c882b20ba6\nrelated:\n    - id: bd1212e5-78da-431e-95fa-c58e3237a8e6\n      type: similar\nstatus: test\ndescription: Detects suspicious file type dropped by an Exchange component in IIS\nreferences:\n    - https://www.microsoft.com/security/blog/2022/09/30/analyzing-attacks-using-the-exchange-vulnerabilities-cve-2022-41040-and-cve-2022-41082/\n    - https://www.gteltsc.vn/blog/canh-bao-chien-dich-tan-cong-su-dung-lo-hong-zero-day-tren-microsoft-exchange-server-12714.html\n    - https://en.gteltsc.vn/blog/cap-nhat-nhe-ve-lo-hong-bao-mat-0day-microsoft-exchange-dang-duoc-su-dung-de-tan-cong-cac-to-chuc-tai-viet-nam-9685.html\nauthor: Florian Roth (Nextron Systems)\ndate: 2022-10-04\ntags:\n    - attack.persistence\n    - attack.t1190\n    - attack.initial-access\n    - attack.t1505.003\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        Image|endswith: '\\w3wp.exe'\n        CommandLine|contains: 'MSExchange'\n    selection_types:\n        TargetFilename|endswith:\n            - '.aspx'\n            - '.asp'\n            - '.ashx'\n            - '.ps1'\n            - '.bat'\n            - '.exe'\n            - '.dll'\n            - '.vbs'\n    condition: all of selection*\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_exchange_webshell_drop.yml","content":"title: Suspicious ASPX File Drop by Exchange\nid: bd1212e5-78da-431e-95fa-c58e3237a8e6\nrelated:\n    - id: 6b269392-9eba-40b5-acb6-55c882b20ba6\n      type: similar\nstatus: test\ndescription: Detects suspicious file type dropped by an Exchange component in IIS into a suspicious folder\nreferences:\n    - https://www.microsoft.com/security/blog/2022/09/30/analyzing-attacks-using-the-exchange-vulnerabilities-cve-2022-41040-and-cve-2022-41082/\n    - https://www.gteltsc.vn/blog/canh-bao-chien-dich-tan-cong-su-dung-lo-hong-zero-day-tren-microsoft-exchange-server-12714.html\n    - https://en.gteltsc.vn/blog/cap-nhat-nhe-ve-lo-hong-bao-mat-0day-microsoft-exchange-dang-duoc-su-dung-de-tan-cong-cac-to-chuc-tai-viet-nam-9685.html\nauthor: Florian Roth (Nextron Systems), MSTI (query, idea)\ndate: 2022-10-01\ntags:\n    - attack.persistence\n    - attack.t1505.003\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        Image|endswith: '\\w3wp.exe'\n        CommandLine|contains: 'MSExchange'\n        TargetFilename|contains:\n            - 'FrontEnd\\HttpProxy\\'           # from GTSC and MSTI reports\n            - '\\inetpub\\wwwroot\\aspnet_client\\' # from GTSC report\n    selection_types:\n        TargetFilename|endswith:\n            - '.aspx'\n            - '.asp'\n            - '.ashx'\n    condition: all of selection*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_errorhandler_persistence.yml","content":"title: Potential Persistence Attempt Via ErrorHandler.Cmd\nid: 15904280-565c-4b73-9303-3291f964e7f9\nstatus: test\ndescription: |\n    Detects creation of a file named \"ErrorHandler.cmd\" in the \"C:\\WINDOWS\\Setup\\Scripts\\\" directory which could be used as a method of persistence\n    The content of C:\\WINDOWS\\Setup\\Scripts\\ErrorHandler.cmd is read whenever some tools under C:\\WINDOWS\\System32\\oobe\\ (e.g. Setup.exe) fail to run for any reason.\nreferences:\n    - https://www.hexacorn.com/blog/2022/01/16/beyond-good-ol-run-key-part-135/\n    - https://github.com/last-byte/PersistenceSniper\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-08-09\nmodified: 2022-12-19\ntags:\n    - attack.persistence\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|endswith: '\\WINDOWS\\Setup\\Scripts\\ErrorHandler.cmd'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_dump_file_susp_creation.yml","content":"title: Potentially Suspicious DMP/HDMP File Creation\nid: aba15bdd-657f-422a-bab3-ac2d2a0d6f1c\nrelated:\n    - id: 3a525307-d100-48ae-b3b9-0964699d7f97\n      type: similar\nstatus: test\ndescription: Detects the creation of a file with the \".dmp\"/\".hdmp\" extension by a shell or scripting application such as \"cmd\", \"powershell\", etc. Often created by software during a crash. Memory dumps can sometimes contain sensitive information such as credentials. It's best to determine the source of the crash.\nreferences:\n    - https://learn.microsoft.com/en-us/windows/win32/wer/collecting-user-mode-dumps\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-09-07\ntags:\n    - attack.defense-evasion\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        Image|endswith:\n            - '\\cmd.exe'\n            - '\\cscript.exe'\n            - '\\mshta.exe'\n            - '\\powershell.exe'\n            - '\\pwsh.exe'\n            - '\\wscript.exe'\n        TargetFilename|endswith:\n            - '.dmp'\n            - '.dump'\n            - '.hdmp'\n    condition: selection\nfalsepositives:\n    - Some administrative PowerShell or VB scripts might have the ability to collect dumps and move them to other folders which might trigger a false positive.\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_dll_sideloading_space_path.yml","content":"title: DLL Search Order Hijackig Via Additional Space in Path\nid: b6f91281-20aa-446a-b986-38a92813a18f\nstatus: test\ndescription: |\n    Detects when an attacker create a similar folder structure to windows system folders such as (Windows, Program Files...)\n    but with a space in order to trick DLL load search order and perform a \"DLL Search Order Hijacking\" attack\nreferences:\n    - https://twitter.com/cyb3rops/status/1552932770464292864\n    - https://www.wietzebeukema.nl/blog/hijacking-dlls-in-windows\nauthor: frack113, Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-07-30\ntags:\n    - attack.persistence\n    - attack.privilege-escalation\n    - attack.defense-evasion\n    - attack.t1574.001\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|startswith:\n            - 'C:\\Windows \\'\n            - 'C:\\Program Files \\'\n            - 'C:\\Program Files (x86) \\'\n        TargetFilename|endswith: '.dll'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_dcom_iertutil_dll_hijack.yml","content":"title: Potential DCOM InternetExplorer.Application DLL Hijack\nid: 2f7979ae-f82b-45af-ac1d-2b10e93b0baa\nrelated:\n    - id: e554f142-5cf3-4e55-ace9-a1b59e0def65\n      type: obsolete\n    - id: f354eba5-623b-450f-b073-0b5b2773b6aa\n      type: similar\nstatus: test\ndescription: Detects potential DLL hijack of \"iertutil.dll\" found in the DCOM InternetExplorer.Application Class over the network\nreferences:\n    - https://threathunterplaybook.com/hunts/windows/201009-RemoteDCOMIErtUtilDLLHijack/notebook.html\nauthor: Roberto Rodriguez @Cyb3rWard0g, Open Threat Research (OTR), wagga\ndate: 2020-10-12\nmodified: 2022-12-18\ntags:\n    - attack.lateral-movement\n    - attack.t1021.002\n    - attack.t1021.003\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        Image: System\n        TargetFilename|endswith: '\\Internet Explorer\\iertutil.dll'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: critical\n"},{"path":"file\\file_event\\file_event_win_csharp_compile_artefact.yml","content":"title: Dynamic CSharp Compile Artefact\nid: e4a74e34-ecde-4aab-b2fb-9112dd01aed0\nstatus: test\ndescription: |\n    When C# is compiled dynamically, a .cmdline file will be created as a part of the process.\n    Certain processes are not typically observed compiling C# code, but can do so without touching disk.\n    This can be used to unpack a payload for execution\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1027.004/T1027.004.md#atomic-test-2---dynamic-c-compile\nauthor: frack113\ndate: 2022-01-09\nmodified: 2023-02-17\ntags:\n    - attack.defense-evasion\n    - attack.t1027.004\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|endswith: '.cmdline'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: low\n"},{"path":"file\\file_event\\file_event_win_csexec_service.yml","content":"title: CSExec Service File Creation\nid: f0e2b768-5220-47dd-b891-d57b96fc0ec1\nstatus: test\ndescription: Detects default CSExec service filename which indicates CSExec service installation and execution\nreferences:\n    - https://github.com/malcomvetter/CSExec\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-08-04\ntags:\n    - attack.execution\n    - attack.t1569.002\n    - attack.s0029\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|endswith: '\\csexecsvc.exe'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_cscript_wscript_dropper.yml","content":"title: WScript or CScript Dropper - File\nid: 002bdb95-0cf1-46a6-9e08-d38c128a6127\nrelated:\n    - id: cea72823-df4d-4567-950c-0b579eaf0846\n      type: derived\nstatus: test\ndescription: Detects a file ending in jse, vbe, js, vba, vbs written by cscript.exe or wscript.exe\nreferences:\n    - WScript or CScript Dropper (cea72823-df4d-4567-950c-0b579eaf0846)\nauthor: Tim Shelton\ndate: 2022-01-10\nmodified: 2022-12-02\ntags:\n    - attack.execution\n    - attack.t1059.005\n    - attack.t1059.007\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        Image|endswith:\n            - '\\wscript.exe'\n            - '\\cscript.exe'\n        TargetFilename|startswith:\n            - 'C:\\Users\\'\n            - 'C:\\ProgramData'\n        TargetFilename|endswith:\n            - '.jse'\n            - '.vbe'\n            - '.js'\n            - '.vba'\n            - '.vbs'\n    condition: selection\nfields:\n    - Image\n    - TargetFilename\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_cred_dump_tools_dropped_files.yml","content":"title: Cred Dump Tools Dropped Files\nid: 8fbf3271-1ef6-4e94-8210-03c2317947f6\nstatus: test\ndescription: Files with well-known filenames (parts of credential dump software or files produced by them) creation\nreferences:\n    - https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment\nauthor: Teymur Kheirkhabarov, oscd.community\ndate: 2019-11-01\nmodified: 2022-09-21\ntags:\n    - attack.credential-access\n    - attack.t1003.001\n    - attack.t1003.002\n    - attack.t1003.003\n    - attack.t1003.004\n    - attack.t1003.005\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        - TargetFilename|contains:\n              - '\\fgdump-log'\n              - '\\kirbi'\n              - '\\pwdump'\n              - '\\pwhashes'\n              - '\\wce_ccache'\n              - '\\wce_krbtkts'\n        - TargetFilename|endswith:\n              - '\\cachedump.exe'\n              - '\\cachedump64.exe'\n              - '\\DumpExt.dll'\n              - '\\DumpSvc.exe'\n              - '\\Dumpy.exe'\n              - '\\fgexec.exe'\n              - '\\lsremora.dll'\n              - '\\lsremora64.dll'\n              - '\\NTDS.out'\n              - '\\procdump64.exe'\n              - '\\pstgdump.exe'\n              - '\\pwdump.exe'\n              - '\\SAM.out'\n              - '\\SECURITY.out'\n              - '\\servpw.exe'\n              - '\\servpw64.exe'\n              - '\\SYSTEM.out'\n              - '\\test.pwd'\n              - '\\wceaux.dll'\n    condition: selection\nfalsepositives:\n    - Legitimate Administrator using tool for password recovery\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_creation_unquoted_service_path.yml","content":"title: Creation Exe for Service with Unquoted Path\nid: 8c3c76ca-8f8b-4b1d-aaf3-81aebcd367c9\nstatus: test\ndescription: |\n    Adversaries may execute their own malicious payloads by hijacking vulnerable file path references.\n    Adversaries can take advantage of paths that lack surrounding quotations by placing an executable in a higher level directory within the path, so that Windows will choose the adversary's executable to launch.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1574.009/T1574.009.md\nauthor: frack113\ndate: 2021-12-30\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547.009\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        # Feel free to add more\n        TargetFilename: 'C:\\program.exe'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_creation_system_file.yml","content":"title: Files With System Process Name In Unsuspected Locations\nid: d5866ddf-ce8f-4aea-b28e-d96485a20d3d\nstatus: test\ndescription: |\n    Detects the creation of an executable with a system process name in folders other than the system ones (System32, SysWOW64, etc.).\n    It is highly recommended to perform an initial baseline before using this rule in production.\nreferences:\n    - Internal Research\nauthor: Sander Wiebing, Tim Shelton, Nasreddine Bencherchali (Nextron Systems)\ndate: 2020-05-26\nmodified: 2025-10-07\ntags:\n    - attack.defense-evasion\n    - attack.t1036.005\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|endswith:\n            - '\\AtBroker.exe'\n            - '\\audiodg.exe'\n            - '\\backgroundTaskHost.exe'\n            - '\\bcdedit.exe'\n            - '\\bitsadmin.exe'\n            - '\\cmdl32.exe'\n            - '\\cmstp.exe'\n            - '\\conhost.exe'\n            - '\\csrss.exe'\n            - '\\dasHost.exe'\n            - '\\dfrgui.exe'\n            - '\\dllhost.exe'\n            - '\\dwm.exe'\n            - '\\eventcreate.exe'\n            - '\\eventvwr.exe'\n            - '\\explorer.exe'\n            - '\\extrac32.exe'\n            - '\\fontdrvhost.exe'\n            - '\\ipconfig.exe'\n            - '\\iscsicli.exe'\n            - '\\iscsicpl.exe'\n            - '\\logman.exe'\n            - '\\LogonUI.exe'\n            - '\\LsaIso.exe'\n            - '\\lsass.exe'\n            - '\\lsm.exe'\n            - '\\msiexec.exe'\n            - '\\msinfo32.exe'\n            - '\\mstsc.exe'\n            - '\\nbtstat.exe'\n            - '\\odbcconf.exe'\n            - '\\powershell.exe'\n            - '\\pwsh.exe'\n            - '\\regini.exe'\n            - '\\regsvr32.exe'\n            - '\\rundll32.exe'\n            - '\\RuntimeBroker.exe'\n            - '\\schtasks.exe'\n            - '\\SearchFilterHost.exe'\n            - '\\SearchIndexer.exe'\n            - '\\SearchProtocolHost.exe'\n            - '\\SecurityHealthService.exe'\n            - '\\SecurityHealthSystray.exe'\n            - '\\services.exe'\n            - '\\ShellAppRuntime.exe'\n            - '\\sihost.exe'\n            - '\\smartscreen.exe'\n            - '\\smss.exe'\n            - '\\spoolsv.exe'\n            - '\\svchost.exe'\n            - '\\SystemSettingsBroker.exe'\n            - '\\taskhost.exe'\n            - '\\taskhostw.exe'\n            - '\\Taskmgr.exe'\n            - '\\TiWorker.exe'\n            - '\\vssadmin.exe'\n            - '\\w32tm.exe'\n            - '\\WerFault.exe'\n            - '\\WerFaultSecure.exe'\n            - '\\wermgr.exe'\n            - '\\wevtutil.exe'\n            - '\\wininit.exe'\n            - '\\winlogon.exe'\n            - '\\winrshost.exe'\n            - '\\WinRTNetMUAHostServer.exe'\n            - '\\wlanext.exe'\n            - '\\wlrmdr.exe'\n            - '\\WmiPrvSE.exe'\n            - '\\wslhost.exe'\n            - '\\WSReset.exe'\n            - '\\WUDFHost.exe'\n            - '\\WWAHost.exe'\n    filter_main_generic:\n        # Note: It is recommended to use a more robust filter instead of this generic one, to avoid false negatives.\n        TargetFilename|contains:\n            # - '\\SystemRoot\\System32\\'\n            - 'C:\\$WINDOWS.~BT\\'\n            - 'C:\\$WinREAgent\\'\n            - 'C:\\Windows\\SoftwareDistribution\\'\n            - 'C:\\Windows\\System32\\'\n            - 'C:\\Windows\\SysWOW64\\'\n            - 'C:\\Windows\\WinSxS\\'\n            - 'C:\\Windows\\uus\\'\n    filter_main_svchost:\n        Image|endswith:\n            - 'C:\\Windows\\system32\\svchost.exe'\n            - 'C:\\Windows\\SysWOW64\\svchost.exe'\n        TargetFilename|contains:\n            - 'C:\\Program Files\\WindowsApps\\'\n            - 'C:\\Program Files (x86)\\WindowsApps\\'\n            - '\\AppData\\Local\\Microsoft\\WindowsApps\\'\n    filter_main_wuauclt:\n        Image|endswith:\n            - 'C:\\Windows\\System32\\wuauclt.exe'\n            - 'C:\\Windows\\SysWOW64\\wuauclt.exe'\n    filter_main_explorer:\n        TargetFilename|endswith: 'C:\\Windows\\explorer.exe'\n    filter_main_msiexec:\n        # This filter handles system processes who are updated/installed using misexec.\n        Image|endswith:\n            - 'C:\\WINDOWS\\system32\\msiexec.exe'\n            - 'C:\\WINDOWS\\SysWOW64\\msiexec.exe'\n        # Add more processes if you find them or simply filter msiexec on its own. If the list grows big\n        TargetFilename|startswith:\n            - 'C:\\Program Files\\PowerShell\\7\\pwsh.exe'\n            - 'C:\\Program Files\\PowerShell\\7-preview\\pwsh.exe'\n            - 'C:\\Program Files\\WindowsApps\\Microsoft.PowerShellPreview\\'\n    filter_main_healtray:\n        TargetFilename|contains: 'C:\\Windows\\System32\\SecurityHealth\\'\n        TargetFilename|endswith: '\\SecurityHealthSystray.exe'\n        Image|endswith: '\\SecurityHealthSetup.exe'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - System processes copied outside their default folders for testing purposes\n    - Third party software naming their software with the same names as the processes mentioned here\n# Note: Upgrade to high after an initial baseline to your environement.\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_creation_system_dll_files.yml","content":"title: Files With System DLL Name In Unsuspected Locations\nid: 13c02350-4177-4e45-ac17-cf7ca628ff5e\nstatus: test\ndescription: |\n    Detects the creation of a file with the \".dll\" extension that has the name of a System DLL in uncommon or unsuspected locations. (Outisde of \"System32\", \"SysWOW64\", etc.).\n    It is highly recommended to perform an initial baseline before using this rule in production.\nreferences:\n    - Internal Research\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2024-06-24\ntags:\n    - attack.defense-evasion\n    - attack.t1036.005\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|endswith:\n            # Note: Add more System DLL that can be abused for DLL sideloading to increase coverage\n            - '\\secur32.dll'\n            - '\\tdh.dll'\n    filter_main_generic:\n        # Note: It is recommended to use a more robust filter instead of this generic one, to avoid false negatives.\n        TargetFilename|contains:\n            # - '\\SystemRoot\\System32\\'\n            - 'C:\\$WINDOWS.~BT\\'\n            - 'C:\\$WinREAgent\\'\n            - 'C:\\Windows\\SoftwareDistribution\\'\n            - 'C:\\Windows\\System32\\'\n            - 'C:\\Windows\\SysWOW64\\'\n            - 'C:\\Windows\\WinSxS\\'\n            - 'C:\\Windows\\uus\\'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Third party software might bundle specific versions of system DLLs.\n# Note: Upgrade to high after an initial baseline to your environement.\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_creation_scr_binary_file.yml","content":"title: Suspicious Screensaver Binary File Creation\nid: 97aa2e88-555c-450d-85a6-229bcd87efb8\nstatus: test\ndescription: |\n    Adversaries may establish persistence by executing malicious content triggered by user inactivity.\n    Screensavers are programs that execute after a configurable time of user inactivity and consist of Portable Executable (PE) files with a .scr file extension\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1546.002/T1546.002.md\nauthor: frack113\ndate: 2021-12-29\nmodified: 2022-11-08\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1546.002\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|endswith: '.scr'\n    filter_generic:\n        Image|endswith:\n            - '\\Kindle.exe'\n            - '\\Bin\\ccSvcHst.exe' # Symantec Endpoint Protection\n    filter_tiworker:\n        # ParentCommandLine: C:\\WINDOWS\\system32\\svchost.exe -k DcomLaunch -p\n        Image|endswith: '\\TiWorker.exe'\n        TargetFilename|endswith: '\\uwfservicingscr.scr'\n    condition: selection and not 1 of filter_*\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_creation_new_shim_database.yml","content":"title: New Custom Shim Database Created\nid: ee63c85c-6d51-4d12-ad09-04e25877a947\nstatus: test\ndescription: |\n    Adversaries may establish persistence and/or elevate privileges by executing malicious content triggered by application shims.\n    The Microsoft Windows Application Compatibility Infrastructure/Framework (Application Shim) was created to allow for backward compatibility of software as the operating system codebase changes over time.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1546.011/T1546.011.md#atomic-test-2---new-shim-database-files-created-in-the-default-shim-database-directory\n    - https://www.mandiant.com/resources/blog/fin7-shim-databases-persistence\n    - https://liberty-shell.com/sec/2020/02/25/shim-persistence/\n    - https://andreafortuna.org/2018/11/12/process-injection-and-persistence-using-application-shimming/\nauthor: frack113, Nasreddine Bencherchali (Nextron Systems)\ndate: 2021-12-29\nmodified: 2023-12-06\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547.009\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|contains:\n            - ':\\Windows\\apppatch\\Custom\\'\n            - ':\\Windows\\apppatch\\CustomSDB\\'\n    condition: selection\nfalsepositives:\n    - Legitimate custom SHIM installations will also trigger this rule\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_creation_deno.yml","content":"title: Suspicious Deno File Written from Remote Source\nid: 6c0ce3b6-85e2-49d4-9c3f-6e008ce9796e\nstatus: experimental\ndescription: |\n    Detects Deno writing a file from a direct HTTP(s) call and writing to the appdata folder or bringing it's own malicious DLL.\n    This behavior may indicate an attempt to execute remotely hosted, potentially malicious files through deno.\nreferences:\n    - https://taggart-tech.com/evildeno/\nauthor: Josh Nickels, Michael Taggart\ndate: 2025-05-22\ntags:\n    - attack.execution\n    - attack.t1204\n    - attack.t1059.007\n    - attack.command-and-control\n    - attack.t1105\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection_path:\n        TargetFilename|contains:\n            - '\\deno\\gen\\'\n            - '\\deno\\remote\\https\\'\n        TargetFilename|contains|all:\n            - ':\\Users\\'\n            - '\\AppData\\'\n    condition: selection_path\nfalsepositives:\n    - Legitimate usage of deno to request a file or bring a DLL to a host\nlevel: low\n"},{"path":"file\\file_event\\file_event_win_create_non_existent_dlls.yml","content":"title: Creation Of Non-Existent System DLL\nid: df6ecb8b-7822-4f4b-b412-08f524b4576c\nrelated:\n    - id: 6b98b92b-4f00-4f62-b4fe-4d1920215771 # ImageLoad rule\n      type: similar\nstatus: test\ndescription: |\n    Detects the creation of system DLLs that are usually not present on the system (or at least not in system directories).\n    Usually this technique is used to achieve DLL hijacking.\nreferences:\n    - https://decoded.avast.io/martinchlumecky/png-steganography/\n    - https://posts.specterops.io/lateral-movement-scm-and-dll-hijacking-primer-d2f61e8ab992\n    - https://clement.notin.org/blog/2020/09/12/CVE-2020-7315-McAfee-Agent-DLL-injection/\n    - https://github.com/Wh04m1001/SysmonEoP\n    - https://www.hexacorn.com/blog/2013/12/08/beyond-good-ol-run-key-part-5/\n    - https://github.com/blackarrowsec/redteam-research/tree/26e6fc0c0d30d364758fa11c2922064a9a7fd309/LPE%20via%20StorSvc\nauthor: Nasreddine Bencherchali (Nextron Systems), fornotes\ndate: 2022-12-01\nmodified: 2024-01-10\ntags:\n    - attack.defense-evasion\n    - attack.persistence\n    - attack.privilege-escalation\n    - attack.t1574.001\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|endswith:\n            - ':\\Windows\\System32\\TSMSISrv.dll'\n            - ':\\Windows\\System32\\TSVIPSrv.dll'\n            - ':\\Windows\\System32\\wbem\\wbemcomn.dll'\n            - ':\\Windows\\System32\\WLBSCTRL.dll'\n            - ':\\Windows\\System32\\wow64log.dll'\n            - ':\\Windows\\System32\\WptsExtensions.dll'\n            - '\\SprintCSP.dll'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_create_evtx_non_common_locations.yml","content":"title: EVTX Created In Uncommon Location\nid: 65236ec7-ace0-4f0c-82fd-737b04fd4dcb\nstatus: test\ndescription: |\n    Detects the creation of new files with the \".evtx\" extension in non-common or non-standard location.\n    This could indicate tampering with default EVTX locations in order to evade security controls or simply exfiltration of event log to search for sensitive information within.\n    Note that backup software and legitimate administrator might perform similar actions during troubleshooting.\nreferences:\n    - https://learn.microsoft.com/en-us/windows/win32/eventlog/eventlog-key\nauthor: D3F7A5105\ndate: 2023-01-02\nmodified: 2024-03-26\ntags:\n    - attack.defense-evasion\n    - attack.t1562.002\nlogsource:\n    category: file_event\n    product: windows\n    definition: 'Requirements: The \".evtx\" extension should be monitored via a Sysmon configuration. Example: <TargetFilename condition=\"end with\">.evtx<TargetFilename>'\ndetection:\n    selection:\n        TargetFilename|endswith: '.evtx'\n    filter_main_path:\n        TargetFilename|startswith: 'C:\\Windows\\System32\\winevt\\Logs\\'\n    filter_main_baseimage:\n        TargetFilename|startswith: 'C:\\ProgramData\\Microsoft\\Windows\\Containers\\BaseImages\\'\n        TargetFilename|endswith: '\\Windows\\System32\\winevt\\Logs\\'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Administrator or backup activity\n    - An unknown bug seems to trigger the Windows \"svchost\" process to drop EVTX files in the \"C:\\Windows\\Temp\" directory in the form \"<log_name\">_<uuid>.evtx\". See https://superuser.com/questions/1371229/low-disk-space-after-filling-up-c-windows-temp-with-evtx-and-txt-files\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_bloodhound_collection.yml","content":"title: BloodHound Collection Files\nid: 02773bed-83bf-469f-b7ff-e676e7d78bab\nstatus: test\ndescription: Detects default file names outputted by the BloodHound collection tool SharpHound\nreferences:\n    - https://academy.hackthebox.com/course/preview/active-directory-bloodhound/bloodhound--data-collection\nauthor: C.J. May\ndate: 2022-08-09\nmodified: 2023-03-29\ntags:\n    - attack.discovery\n    - attack.t1087.001\n    - attack.t1087.002\n    - attack.t1482\n    - attack.t1069.001\n    - attack.t1069.002\n    - attack.execution\n    - attack.t1059.001\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|endswith:\n            - 'BloodHound.zip'\n            - '_computers.json'\n            - '_containers.json'\n            - '_domains.json'\n            - '_gpos.json'\n            - '_groups.json'\n            - '_ous.json'\n            - '_users.json'\n    filter_optional_ms_winapps:\n        Image|endswith: '\\svchost.exe'\n        TargetFilename|startswith: 'C:\\Program Files\\WindowsApps\\Microsoft.'\n        TargetFilename|endswith: '\\pocket_containers.json'\n    condition: selection and not 1 of filter_optional_*\nfalsepositives:\n    - Some false positives may arise in some environment and this may require some tuning. Add additional filters or reduce level depending on the level of noise\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_aspnet_temp_files.yml","content":"title: Assembly DLL Creation Via AspNetCompiler\nid: 4c7f49ee-2638-43bb-b85b-ce676c30b260 # TMP File\nrelated:\n    - id: 9ccba514-7cb6-4c5c-b377-700758f2f120 # SuspChild\n      type: similar\n    - id: 9f50fe98-fe5c-4a2d-86c7-fad7f63ed622 # Susp Paths\n      type: similar\n    - id: a01b8329-5953-4f73-ae2d-aa01e1f35f00 # Exec\n      type: similar\nstatus: test\ndescription: |\n    Detects the creation of new DLL assembly files by \"aspnet_compiler.exe\", which could be a sign of \"aspnet_compiler\" abuse to proxy execution through a build provider.\nreferences:\n    - Internal Research\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-08-14\ntags:\n    - attack.execution\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        Image|endswith: '\\aspnet_compiler.exe'\n        TargetFilename|contains|all:\n            - '\\Temporary ASP.NET Files\\'\n            - '\\assembly\\tmp\\'\n            - '.dll'\n    condition: selection\nfalsepositives:\n    - Legitimate assembly compilation using a build provider\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_anydesk_writing_susp_binaries.yml","content":"title: Suspicious Binary Writes Via AnyDesk\nid: 2d367498-5112-4ae5-a06a-96e7bc33a211\nstatus: test\ndescription: |\n    Detects AnyDesk writing binary files to disk other than \"gcapi.dll\".\n    According to RedCanary research it is highly abnormal for AnyDesk to write executable files to disk besides gcapi.dll,\n    which is a legitimate DLL that is part of the Google Chrome web browser used to interact with the Google Cloud API. (See reference section for more details)\nreferences:\n    - https://redcanary.com/blog/misbehaving-rats/\n    - https://thedfirreport.com/2025/02/24/confluence-exploit-leads-to-lockbit-ransomware/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-09-28\nmodified: 2025-02-24\ntags:\n    - attack.command-and-control\n    - attack.t1219.002\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        Image|endswith:\n            - '\\AnyDesk.exe'\n            - '\\AnyDeskMSI.exe'\n        TargetFilename|endswith:\n            - '.dll'\n            - '.exe'\n    filter_dlls:\n        TargetFilename|endswith: '\\gcapi.dll'\n    condition: selection and not 1 of filter_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_event\\file_event_win_anydesk_artefact.yml","content":"title: Anydesk Temporary Artefact\nid: 0b9ad457-2554-44c1-82c2-d56a99c42377\nstatus: test\ndescription: |\n    An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks.\n    These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment.\n    Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land)\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1219/T1219.md#atomic-test-2---anydesk-files-detected-test-on-windows\nauthor: frack113\ndate: 2022-02-11\nmodified: 2024-07-20\ntags:\n    - attack.command-and-control\n    - attack.t1219.002\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|contains:\n            - '\\AppData\\Roaming\\AnyDesk\\user.conf'\n            - '\\AppData\\Roaming\\AnyDesk\\system.conf'\n    condition: selection\nfalsepositives:\n    - Legitimate use\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_advanced_ip_scanner.yml","content":"title: Advanced IP Scanner - File Event\nid: fed85bf9-e075-4280-9159-fbe8a023d6fa\nrelated:\n    - id: bef37fa2-f205-4a7b-b484-0759bfd5f86f\n      type: derived\nstatus: test\ndescription: Detects the use of Advanced IP Scanner. Seems to be a popular tool for ransomware groups.\nreferences:\n    - https://news.sophos.com/en-us/2019/12/09/snatch-ransomware-reboots-pcs-into-safe-mode-to-bypass-protection/\n    - https://www.fireeye.com/blog/threat-research/2020/05/tactics-techniques-procedures-associated-with-maze-ransomware-incidents.html\n    - https://labs.f-secure.com/blog/prelude-to-ransomware-systembc\n    - https://assets.documentcloud.org/documents/20444693/fbi-pin-egregor-ransomware-bc-01062021.pdf\n    - https://thedfirreport.com/2021/01/18/all-that-for-a-coinminer\nauthor: '@ROxPinTeddy'\ndate: 2020-05-12\nmodified: 2022-11-29\ntags:\n    - attack.discovery\n    - attack.t1046\nlogsource:\n    category: file_event\n    product: windows\ndetection:\n    selection:\n        TargetFilename|contains: '\\AppData\\Local\\Temp\\Advanced IP Scanner 2'\n    condition: selection\nfalsepositives:\n    - Legitimate administrative use\nlevel: medium\n"},{"path":"file\\file_event\\file_event_win_adsi_cache_creation_by_uncommon_tool.yml","content":"title: ADSI-Cache File Creation By Uncommon Tool\nid: 75bf09fa-1dd7-4d18-9af9-dd9e492562eb\nstatus: test\ndescription: Detects the creation of an \"Active Directory Schema Cache File\" (.sch) file by an uncommon tool.\nreferences:\n    - https://medium.com/@ivecodoe/detecting-ldapfragger-a-newly-released-cobalt-strike-beacon-using-ldap-for-c2-communication-c274a7f00961\n    - https://blog.fox-it.com/2020/03/19/ldapfragger-command-and-control-over-ldap-attributes/\n    - https://github.com/fox-it/LDAPFragger\nauthor: xknow @xknow_infosec, Tim Shelton\ndate: 2019-03-24\nmodified: 2023-10-18\ntags:\n    - attack.t1001.003\n    - attack.command-and-control\nlogsource:\n    product: windows\n    category: file_event\ndetection:\n    selection:\n        TargetFilename|contains: '\\Local\\Microsoft\\Windows\\SchCache\\'\n        TargetFilename|endswith: '.sch'\n    filter_main_generic:\n        - Image|endswith:\n              - ':\\Program Files\\Cylance\\Desktop\\CylanceSvc.exe'\n              - ':\\Windows\\CCM\\CcmExec.exe'\n              - ':\\windows\\system32\\dllhost.exe'\n              - ':\\Windows\\system32\\dsac.exe'\n              - ':\\Windows\\system32\\efsui.exe'\n              - ':\\windows\\system32\\mmc.exe'\n              - ':\\windows\\system32\\svchost.exe'\n              - ':\\Windows\\System32\\wbem\\WmiPrvSE.exe'\n              - ':\\windows\\system32\\WindowsPowerShell\\v1.0\\powershell.exe'\n        - Image|contains:\n              - ':\\Windows\\ccmsetup\\autoupgrade\\ccmsetup' # C:\\Windows\\ccmsetup\\autoupgrade\\ccmsetup.TMC00002.40.exe\n              - ':\\Program Files\\SentinelOne\\Sentinel Agent' # C:\\Program Files\\SentinelOne\\Sentinel Agent 21.7.7.40005\\SentinelAgent.exe\n    filter_main_office:\n        Image|contains|all:\n            - ':\\Program Files\\'\n            - '\\Microsoft Office'\n        Image|endswith: '\\OUTLOOK.EXE'\n    filter_optional_ldapwhoami:\n        Image|endswith: '\\LANDesk\\LDCLient\\ldapwhoami.exe'\n    filter_optional_citrix:\n        # Example:\n        #   TargetFilename=C:\\Windows\\ServiceProfiles\\NetworkService\\AppData\\Local\\Microsoft\\Windows\\SchCache\\REDACTED.com.sch\n        Image|endswith: ':\\Program Files\\Citrix\\Receiver StoreFront\\Services\\DefaultDomainServices\\Citrix.DeliveryServices.DomainServices.ServiceHost.exe'\n    condition: selection and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Other legimate tools, which do ADSI (LDAP) operations, e.g. any remoting activity by MMC, Powershell, Windows etc.\nlevel: medium\n"},{"path":"file\\file_delete\\file_delete_win_zone_identifier_ads_uncommon.yml","content":"title: ADS Zone.Identifier Deleted By Uncommon Application\nid: 3109530e-ab47-4cc6-a953-cac5ebcc93ae\nrelated:\n    - id: 7eac0a16-5832-4e81-865f-0268a6d19e4b\n      type: similar\nstatus: test\ndescription: Detects the deletion of the \"Zone.Identifier\" ADS by an uncommon process. Attackers can leverage this in order to bypass security restrictions that make use of the ADS such as Microsoft Office apps.\nreferences:\n    - https://securityliterate.com/how-malware-abuses-the-zone-identifier-to-circumvent-detection-and-analysis/\n    - Internal Research\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-09-04\nmodified: 2025-07-04\ntags:\n    - attack.defense-evasion\n    - attack.t1070.004\nlogsource:\n    product: windows\n    category: file_delete\ndetection:\n    selection:\n        TargetFilename|endswith: ':Zone.Identifier'\n    filter_main_generic:\n        # Note: in some envs this activity might be performed by other software. Apply additional filters as necessary\n        Image:\n            - 'C:\\Program Files\\PowerShell\\7-preview\\pwsh.exe'\n            - 'C:\\Program Files\\PowerShell\\7\\pwsh.exe'\n            - 'C:\\Windows\\explorer.exe'\n            - 'C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe'\n            - 'C:\\Windows\\SysWOW64\\explorer.exe'\n            - 'C:\\Windows\\SysWOW64\\WindowsPowerShell\\v1.0\\powershell.exe'\n    filter_optional_browsers_chrome:\n        Image:\n            - 'C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe'\n            - 'C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe'\n    filter_optional_browsers_firefox:\n        Image:\n            - 'C:\\Program Files (x86)\\Mozilla Firefox\\firefox.exe'\n            - 'C:\\Program Files\\Mozilla Firefox\\firefox.exe'\n    filter_optional_browsers_msedge:\n        Image:\n            - 'C:\\Program Files (x86)\\Microsoft\\Edge\\Application\\msedge.exe'\n            - 'C:\\Program Files\\Microsoft\\Edge\\Application\\msedge.exe'\n    condition: selection and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Other third party applications not listed.\nlevel: medium\n"},{"path":"file\\file_delete\\file_delete_win_unusual_deletion_by_dns_exe.yml","content":"title: Unusual File Deletion by Dns.exe\nid: 8f0b1fb1-9bd4-4e74-8cdf-a8de4d2adfd0\nrelated:\n    - id: 9f383dc0-fdeb-4d56-acbc-9f9f4f8f20f3 # FileChange version\n      type: similar\nstatus: test\ndescription: Detects an unexpected file being deleted by dns.exe which my indicate activity related to remote code execution or other forms of exploitation as seen in CVE-2020-1350 (SigRed)\nreferences:\n    - https://www.elastic.co/guide/en/security/current/unusual-file-modification-by-dns-exe.html\nauthor: Tim Rauch (Nextron Systems), Elastic (idea)\ndate: 2022-09-27\nmodified: 2023-02-15\ntags:\n    - attack.persistence\n    - attack.initial-access\n    - attack.t1133\nlogsource:\n    category: file_delete\n    product: windows\ndetection:\n    selection:\n        Image|endswith: '\\dns.exe'\n    filter:\n        TargetFilename|endswith: '\\dns.log'\n    condition: selection and not filter\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_delete\\file_delete_win_sysinternals_sdelete_file_deletion.yml","content":"title: File Deleted Via Sysinternals SDelete\nid: 6ddab845-b1b8-49c2-bbf7-1a11967f64bc\nstatus: test\ndescription: Detects the deletion of files by the Sysinternals SDelete utility. It looks for the common name pattern used to rename files.\nreferences:\n    - https://github.com/OTRF/detection-hackathon-apt29/issues/9\n    - https://github.com/OTRF/ThreatHunter-Playbook/blob/2d4257f630f4c9770f78d0c1df059f891ffc3fec/docs/evals/apt29/detections/4.B.4_83D62033-105A-4A02-8B75-DAB52D8D51EC.md\nauthor: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)\ndate: 2020-05-02\nmodified: 2023-02-15\ntags:\n    - attack.defense-evasion\n    - attack.t1070.004\nlogsource:\n    product: windows\n    category: file_delete\ndetection:\n    selection:\n        TargetFilename|endswith:\n            - '.AAA'\n            - '.ZZZ'\n    filter_wireshark:\n        TargetFilename|endswith: '\\Wireshark\\radius\\dictionary.alcatel-lucent.aaa'\n    condition: selection and not 1 of filter_*\nfalsepositives:\n    - Legitimate usage\nlevel: medium\n"},{"path":"file\\file_delete\\file_delete_win_delete_tomcat_logs.yml","content":"title: Tomcat WebServer Logs Deleted\nid: 270185ff-5f50-4d6d-a27f-24c3b8c9fef8\nstatus: test\ndescription: Detects the deletion of tomcat WebServer logs which may indicate an attempt to destroy forensic evidence\nreferences:\n    - Internal Research\n    - https://linuxhint.com/view-tomcat-logs-windows/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-02-16\ntags:\n    - attack.defense-evasion\n    - attack.t1070\nlogsource:\n    category: file_delete\n    product: windows\ndetection:\n    selection:\n        TargetFilename|contains|all:\n            - '\\Tomcat'\n            - '\\logs\\'\n        TargetFilename|contains:\n            - 'catalina.'\n            - '_access_log.'\n            - 'localhost.'\n    condition: selection\nfalsepositives:\n    - During uninstallation of the tomcat server\n    - During log rotation\nlevel: medium\n"},{"path":"file\\file_delete\\file_delete_win_delete_teamviewer_logs.yml","content":"title: TeamViewer Log File Deleted\nid: b1decb61-ed83-4339-8e95-53ea51901720\nstatus: test\ndescription: Detects the deletion of the TeamViewer log files which may indicate an attempt to destroy forensic evidence\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1070.004/T1070.004.md\nauthor: frack113\ndate: 2022-01-16\nmodified: 2023-02-15\ntags:\n    - attack.defense-evasion\n    - attack.t1070.004\nlogsource:\n    product: windows\n    category: file_delete\ndetection:\n    selection:\n        TargetFilename|contains: '\\TeamViewer_'\n        TargetFilename|endswith: '.log'\n    filter:\n        Image: C:\\Windows\\system32\\svchost.exe\n    condition: selection and not filter\nfalsepositives:\n    - Unknown\nlevel: low\n"},{"path":"file\\file_delete\\file_delete_win_delete_prefetch.yml","content":"title: Prefetch File Deleted\nid: 0a1f9d29-6465-4776-b091-7f43b26e4c89\nstatus: test\ndescription: Detects the deletion of a prefetch file which may indicate an attempt to destroy forensic evidence\nreferences:\n    - Internal Research\n    - https://www.group-ib.com/blog/hunting-for-ttps-with-prefetch-files/\nauthor: Cedric MAURUGEON\ndate: 2021-09-29\nmodified: 2024-01-25\ntags:\n    - attack.defense-evasion\n    - attack.t1070.004\nlogsource:\n    product: windows\n    category: file_delete\ndetection:\n    selection:\n        TargetFilename|contains: ':\\Windows\\Prefetch\\'\n        TargetFilename|endswith: '.pf'\n    filter_main_svchost:\n        Image|endswith: ':\\windows\\system32\\svchost.exe'\n        User|contains: # covers many language settings\n            - 'AUTHORI'\n            - 'AUTORI'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_delete\\file_delete_win_delete_powershell_command_history.yml","content":"title: PowerShell Console History Logs Deleted\nid: ff301988-c231-4bd0-834c-ac9d73b86586\nstatus: test\ndescription: Detects the deletion of the PowerShell console History logs which may indicate an attempt to destroy forensic evidence\nreferences:\n    - Internal Research\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-02-15\ntags:\n    - attack.defense-evasion\n    - attack.t1070\nlogsource:\n    category: file_delete\n    product: windows\ndetection:\n    selection:\n        TargetFilename|endswith: '\\PSReadLine\\ConsoleHost_history.txt'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"file\\file_delete\\file_delete_win_delete_own_image.yml","content":"title: Process Deletion of Its Own Executable\nid: f01d1f70-cd41-42ec-9c0b-26dd9c22bf29\nstatus: test\ndescription: |\n    Detects the deletion of a process's executable by itself. This is usually not possible without workarounds and may be used by malware to hide its traces.\nreferences:\n    - https://github.com/joaoviictorti/RustRedOps/tree/ce04369a246006d399e8c61d9fe0e6b34f988a49/Self_Deletion\nauthor: Max Altgelt (Nextron Systems)\ndate: 2024-09-03\ntags:\n    - attack.defense-evasion\nlogsource:\n    product: windows\n    category: file_delete\ndetection:\n    selection:\n        TargetFilename|fieldref: Image\n    condition: selection\nfalsepositives:\n    - Some false positives are to be expected from uninstallers.\nlevel: medium\n"},{"path":"file\\file_delete\\file_delete_win_delete_iis_access_logs.yml","content":"title: IIS WebServer Access Logs Deleted\nid: 3eb8c339-a765-48cc-a150-4364c04652bf\nrelated:\n    - id: 0649be4a-aeb0-45b0-b89e-7f1668f6d9c0\n      type: similar\nstatus: test\ndescription: Detects the deletion of IIS WebServer access logs which may indicate an attempt to destroy forensic evidence\nreferences:\n    - https://www.elastic.co/guide/en/security/current/webserver-access-logs-deleted.html\nauthor: Tim Rauch (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-09-16\nmodified: 2023-02-15\ntags:\n    - attack.defense-evasion\n    - attack.t1070\nlogsource:\n    category: file_delete\n    product: windows\ndetection:\n    selection:\n        TargetFilename|contains: '\\inetpub\\logs\\LogFiles\\'\n        TargetFilename|endswith: '.log'\n    condition: selection\nfalsepositives:\n    - During uninstallation of the IIS service\n    - During log rotation\nlevel: medium\n"},{"path":"file\\file_delete\\file_delete_win_delete_exchange_powershell_logs.yml","content":"title: Exchange PowerShell Cmdlet History Deleted\nid: a55349d8-9588-4c5a-8e3b-1925fe2a4ffe\nstatus: test\ndescription: Detects the deletion of the Exchange PowerShell cmdlet History logs which may indicate an attempt to destroy forensic evidence\nreferences:\n    - https://m365internals.com/2022/10/07/hunting-in-on-premises-exchange-server-logs/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-10-26\nmodified: 2022-12-30\ntags:\n    - attack.defense-evasion\n    - attack.t1070\nlogsource:\n    category: file_delete\n    product: windows\ndetection:\n    selection:\n        TargetFilename|startswith: '\\Logging\\CmdletInfra\\LocalPowerShell\\Cmdlet\\'\n        TargetFilename|contains: '_Cmdlet_'\n    condition: selection\nfalsepositives:\n    - Possible FP during log rotation\nlevel: high\n"},{"path":"file\\file_delete\\file_delete_win_delete_event_log_files.yml","content":"title: EventLog EVTX File Deleted\nid: 63c779ba-f638-40a0-a593-ddd45e8b1ddc\nstatus: test\ndescription: Detects the deletion of the event log files which may indicate an attempt to destroy forensic evidence\nreferences:\n    - Internal Research\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-02-15\ntags:\n    - attack.defense-evasion\n    - attack.t1070\nlogsource:\n    category: file_delete\n    product: windows\ndetection:\n    selection:\n        TargetFilename|startswith: 'C:\\Windows\\System32\\winevt\\Logs\\'\n        TargetFilename|endswith: '.evtx'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"file\\file_delete\\file_delete_win_delete_backup_file.yml","content":"title: Backup Files Deleted\nid: 06125661-3814-4e03-bfa2-1e4411c60ac3\nstatus: test\ndescription: Detects deletion of files with extensions often used for backup files. Adversaries may delete or remove built-in operating system data and turn off services designed to aid in the recovery of a corrupted system to prevent recovery.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1490/T1490.md#atomic-test-6---windows---delete-backup-files\nauthor: frack113\ndate: 2022-01-02\nmodified: 2023-02-15\ntags:\n    - attack.impact\n    - attack.t1490\nlogsource:\n    product: windows\n    category: file_delete\ndetection:\n    selection:\n        Image|endswith:\n            - '\\cmd.exe'\n            - '\\powershell.exe'\n            - '\\pwsh.exe'\n            - '\\wt.exe'\n            - '\\rundll32.exe'\n            - '\\regsvr32.exe'\n        TargetFilename|endswith:\n            - '.VHD'\n            - '.bac'\n            - '.bak'\n            - '.wbcat'\n            - '.bkf'\n            - '.set'\n            - '.win'\n            - '.dsk'\n    condition: selection\nfalsepositives:\n    - Legitimate usage\nlevel: medium\n"},{"path":"file\\file_change\\file_change_win_unusual_modification_by_dns_exe.yml","content":"title: Unusual File Modification by dns.exe\nid: 9f383dc0-fdeb-4d56-acbc-9f9f4f8f20f3\nrelated:\n    - id: 8f0b1fb1-9bd4-4e74-8cdf-a8de4d2adfd0 # FileDelete version\n      type: similar\nstatus: test\ndescription: Detects an unexpected file being modified by dns.exe which my indicate activity related to remote code execution or other forms of exploitation as seen in CVE-2020-1350 (SigRed)\nreferences:\n    - https://www.elastic.co/guide/en/security/current/unusual-file-modification-by-dns-exe.html\nauthor: Tim Rauch (Nextron Systems), Elastic (idea)\ndate: 2022-09-27\ntags:\n    - attack.persistence\n    - attack.initial-access\n    - attack.t1133\nlogsource:\n    category: file_change\n    product: windows\ndetection:\n    selection:\n        Image|endswith: '\\dns.exe'\n    filter:\n        TargetFilename|endswith: '\\dns.log'\n    condition: selection and not filter\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"file\\file_change\\file_change_win_2022_timestomping.yml","content":"title: File Creation Date Changed to Another Year\nid: 558eebe5-f2ba-4104-b339-36f7902bcc1a\nstatus: test\ndescription: |\n    Attackers may change the file creation time of a backdoor to make it look like it was installed with the operating system.\n    Note that many processes legitimately change the creation time of a file; it does not necessarily indicate malicious activity.\nreferences:\n    - https://www.inversecos.com/2022/04/defence-evasion-technique-timestomping.html\nauthor: frack113, Florian Roth (Nextron Systems)\ndate: 2022-08-12\nmodified: 2022-10-25\ntags:\n    - attack.t1070.006\n    - attack.defense-evasion\nlogsource:\n    category: file_change\n    product: windows\ndetection:\n    selection1:\n        PreviousCreationUtcTime|startswith: '2022'\n    filter1:\n        CreationUtcTime|startswith: '2022'\n    selection2:\n        PreviousCreationUtcTime|startswith: '202'\n    filter2:\n        CreationUtcTime|startswith: '202'\n    gen_filter_updates:\n        - Image:\n              - 'C:\\Windows\\system32\\ProvTool.exe'\n              - 'C:\\Windows\\System32\\usocoreworker.exe'\n              - 'C:\\Windows\\ImmersiveControlPanel\\SystemSettings.exe'\n        - TargetFilename|startswith: 'C:\\ProgramData\\USOPrivate\\UpdateStore\\'\n        - TargetFilename|endswith:\n              - '.tmp'\n              - '.temp'\n    gen_filter_tiworker:\n        Image|startswith: 'C:\\WINDOWS\\'\n        Image|endswith: '\\TiWorker.exe'\n        TargetFilename|endswith: '.cab'\n    condition: (( selection1 and not filter1 ) or ( selection2 and not filter2 )) and not 1 of gen_filter*\nfalsepositives:\n    - Changes made to or by the local NTP service\nlevel: high\n"},{"path":"file\\file_access\\file_access_win_teams_sensitive_files.yml","content":"title: Microsoft Teams Sensitive File Access By Uncommon Applications\nid: 65744385-8541-44a6-8630-ffc824d7d4cc\nstatus: test\ndescription: |\n    Detects file access attempts to sensitive Microsoft teams files (leveldb, cookies) by an uncommon process.\nreferences:\n    - https://www.bleepingcomputer.com/news/security/microsoft-teams-stores-auth-tokens-as-cleartext-in-windows-linux-macs/\n    - https://www.vectra.ai/blog/undermining-microsoft-teams-security-by-mining-tokens\nauthor: '@SerkinValery'\ndate: 2024-07-22\ntags:\n    - attack.credential-access\n    - attack.t1528\nlogsource:\n    product: windows\n    category: file_access\n    definition: 'Requirements: Microsoft-Windows-Kernel-File ETW provider'\ndetection:\n    selection:\n        FileName|contains:\n            - '\\Microsoft\\Teams\\Cookies'\n            - '\\Microsoft\\Teams\\Local Storage\\leveldb'\n    filter_main_legit_location:\n        # Note: its best to filter the full path to avoid false negatives\n        Image|endswith: '\\Microsoft\\Teams\\current\\Teams.exe'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"file\\file_access\\file_access_win_susp_process_access_browser_cred_files.yml","content":"title: Suspicious File Access to Browser Credential Storage\nid: a1dfd976-4852-41d4-9507-dc6590a3ccd0\nstatus: experimental\ndescription: |\n    Detects file access to browser credential storage paths by non-browser processes, which may indicate credential access attempts.\n    Adversaries may attempt to access browser credential storage to extract sensitive information such as usernames and passwords or cookies.\n    This behavior is often commonly observed in credential stealing malware.\nreferences:\n    - https://github.com/splunk/security_content/blob/7283ba3723551f46b69dfeb23a63b358afb2cb0e/lookups/browser_app_list.csv?plain=1\n    - https://fourcore.io/blogs/threat-hunting-browser-credential-stealing\nauthor: frack113, X__Junior (Nextron Systems), Swachchhanda Shrawan Poudel (Nextron Systems), Parth-FourCore\ndate: 2025-05-22\ntags:\n    - attack.credential-access\n    - attack.t1555.003\n    - attack.discovery\n    - attack.t1217\nlogsource:\n    category: file_access\n    product: windows\ndetection:\n    selection_browser_paths:\n        FileName|contains:\n            - '\\Sputnik\\Sputnik'\n            - '\\MapleStudio\\ChromePlus'\n            - '\\QIP Surf'\n            - '\\BlackHawk'\n            - '\\7Star\\7Star'\n            - '\\CatalinaGroup\\Citrio'\n            - '\\Google\\Chrome'\n            - '\\Coowon\\Coowon'\n            - '\\CocCoc\\Browser'\n            - '\\uCozMedia\\Uran'\n            - '\\Tencent\\QQBrowser'\n            - '\\Orbitum'\n            - '\\Slimjet'\n            - '\\Iridium'\n            - '\\Vivaldi'\n            - '\\Chromium'\n            - '\\GhostBrowser'\n            - '\\CentBrowser'\n            - '\\Xvast'\n            - '\\Chedot'\n            - '\\SuperBird'\n            - '\\360Browser\\Browser'\n            - '\\360Chrome\\Chrome'\n            - '\\Comodo\\Dragon'\n            - '\\BraveSoftware\\Brave-Browser'\n            - '\\Torch'\n            - '\\UCBrowser\\'\n            - '\\Blisk'\n            - '\\Epic Privacy Browser'\n            - '\\Nichrome'\n            - '\\Amigo'\n            - '\\Kometa'\n            - '\\Xpom'\n            - '\\Microsoft\\Edge'\n            - '\\Liebao7Default\\EncryptedStorage'\n            - '\\AVAST Software\\Browser'\n            - '\\Kinza'\n            - '\\Mozilla\\SeaMonkey\\'\n            - '\\Comodo\\IceDragon\\'\n            - '\\8pecxstudios\\Cyberfox\\'\n            - '\\FlashPeak\\SlimBrowser\\'\n            - '\\Moonchild Productions\\Pale Moon\\'\n    selection_browser_subpaths:\n        FileName|contains:\n            - '\\Profiles\\'\n            - '\\User Data'\n    selection_cred_files:\n        - FileName|contains:\n              - '\\Login Data'\n              - '\\Cookies'\n              - '\\EncryptedStorage'\n              - '\\WebCache\\'\n        - FileName|endswith:\n              - 'cert9.db'\n              - 'cookies.sqlite'\n              - 'formhistory.sqlite'\n              - 'key3.db'\n              - 'key4.db'\n              - 'Login Data.sqlite'\n              - 'logins.json'\n              - 'places.sqlite'\n    filter_main_img:\n        Image|endswith:\n            - '\\Sputnik.exe'\n            - '\\ChromePlus.exe'\n            - '\\QIP Surf.exe'\n            - '\\BlackHawk.exe'\n            - '\\7Star.exe'\n            - '\\Sleipnir5.exe'\n            - '\\Citrio.exe'\n            - '\\Chrome SxS.exe'\n            - '\\Chrome.exe'\n            - '\\Coowon.exe'\n            - '\\CocCocBrowser.exe'\n            - '\\Uran.exe'\n            - '\\QQBrowser.exe'\n            - '\\Orbitum.exe'\n            - '\\Slimjet.exe'\n            - '\\Iridium.exe'\n            - '\\Vivaldi.exe'\n            - '\\Chromium.exe'\n            - '\\GhostBrowser.exe'\n            - '\\CentBrowser.exe'\n            - '\\Xvast.exe'\n            - '\\Chedot.exe'\n            - '\\SuperBird.exe'\n            - '\\360Browser.exe'\n            - '\\360Chrome.exe'\n            - '\\dragon.exe'\n            - '\\brave.exe'\n            - '\\torch.exe'\n            - '\\UCBrowser.exe'\n            - '\\BliskBrowser.exe'\n            - '\\Epic Privacy Browser.exe'\n            - '\\nichrome.exe'\n            - '\\AmigoBrowser.exe'\n            - '\\KometaBrowser.exe'\n            - '\\XpomBrowser.exe'\n            - '\\msedge.exe'\n            - '\\LiebaoBrowser.exe'\n            - '\\AvastBrowser.exe'\n            - '\\Kinza.exe'\n            - '\\seamonkey.exe'\n            - '\\icedragon.exe'\n            - '\\cyberfox.exe'\n            - '\\SlimBrowser.exe'\n            - '\\palemoon.exe'\n    filter_main_path:\n        Image|contains:\n            - '\\Sputnik\\'\n            - '\\MapleStudio\\'\n            - '\\QIP Surf\\'\n            - '\\BlackHawk\\'\n            - '\\7Star\\'\n            - '\\Fenrir Inc\\'\n            - '\\CatalinaGroup\\'\n            - '\\Google\\'\n            - '\\Coowon\\'\n            - '\\CocCoc\\'\n            - '\\uCozMedia\\'\n            - '\\Tencent\\'\n            - '\\Orbitum\\'\n            - '\\Slimjet\\'\n            - '\\Iridium\\'\n            - '\\Vivaldi\\'\n            - '\\Chromium\\'\n            - '\\GhostBrowser\\'\n            - '\\CentBrowser\\'\n            - '\\Xvast\\'\n            - '\\Chedot\\'\n            - '\\SuperBird\\'\n            - '\\360Browser\\'\n            - '\\360Chrome\\'\n            - '\\Comodo\\'\n            - '\\BraveSoftware\\'\n            - '\\Torch\\'\n            - '\\UCBrowser\\'\n            - '\\Blisk\\'\n            - '\\Epic Privacy Browser\\'\n            - '\\Nichrome\\'\n            - '\\Amigo\\'\n            - '\\Kometa\\'\n            - '\\Xpom\\'\n            - '\\Microsoft\\'\n            - '\\Liebao7\\'\n            - '\\AVAST Software\\'\n            - '\\Kinza\\'\n            - '\\Mozilla\\'\n            - '\\8pecxstudios\\'\n            - '\\FlashPeak\\'\n            - '\\Moonchild Productions\\'\n    filter_main_system:\n        Image: System\n        ParentImage: Idle\n    filter_main_generic:\n        Image|startswith:\n            - 'C:\\Program Files\\'\n            - 'C:\\Program Files (x86)\\'\n            - 'C:\\Windows\\System32\\'\n            - 'C:\\Windows\\SysWOW64\\'\n    filter_optional_defender:\n        Image|contains: '\\Microsoft\\Windows Defender\\'\n        Image|endswith:\n            - '\\MpCopyAccelerator.exe'\n            - '\\MsMpEng.exe'\n    filter_optional_thor:\n        Image|endswith:\n            - '\\thor.exe'\n            - '\\thor64.exe'\n    filter_optional_msiexec:\n        ParentImage: 'C:\\Windows\\System32\\msiexec.exe'\n    filter_optional_other:\n        Image|endswith: '\\everything.exe'\n    condition: all of selection_* and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Antivirus, Anti-Spyware, Anti-Malware Software\n    - Legitimate software accessing browser data for synchronization or backup purposes.\n    - Legitimate software installed on partitions other than \"C:\\\"\nlevel: low\n"},{"path":"file\\file_access\\file_access_win_susp_gpo_files.yml","content":"title: Access To Potentially Sensitive Sysvol Files By Uncommon Applications\nid: d51694fe-484a-46ac-92d6-969e76d60d10\nrelated:\n    - id: 8344c19f-a023-45ff-ad63-a01c5396aea0\n      type: derived\nstatus: test\ndescription: Detects file access requests to potentially sensitive files hosted on the Windows Sysvol share.\nreferences:\n    - https://github.com/vletoux/pingcastle\nauthor: frack113\ndate: 2023-12-21\nmodified: 2024-07-29\ntags:\n    - attack.credential-access\n    - attack.t1552.006\nlogsource:\n    category: file_access\n    product: windows\n    definition: 'Requirements: Microsoft-Windows-Kernel-File ETW provider'\ndetection:\n    selection:\n        FileName|startswith: '\\\\'\n        FileName|contains|all:\n            - '\\sysvol\\'\n            - '\\Policies\\'\n        FileName|endswith:\n            - 'audit.csv'\n            - 'Files.xml'\n            - 'GptTmpl.inf'\n            - 'groups.xml'\n            - 'Registry.pol'\n            - 'Registry.xml'\n            - 'scheduledtasks.xml'\n            - 'scripts.ini'\n            - 'services.xml'\n    filter_main_generic:\n        Image|startswith:\n            - 'C:\\Program Files (x86)\\'\n            - 'C:\\Program Files\\'\n            - 'C:\\Windows\\system32\\'\n            - 'C:\\Windows\\SysWOW64\\'\n    filter_main_explorer:\n        Image: 'C:\\Windows\\explorer.exe'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"file\\file_access\\file_access_win_susp_dpapi_master_key_access.yml","content":"title: Access To Windows DPAPI Master Keys By Uncommon Applications\nid: 46612ae6-86be-4802-bc07-39b59feb1309\nstatus: test\ndescription: |\n    Detects file access requests to the the Windows Data Protection API Master keys by an uncommon application.\n    This can be a sign of credential stealing. Example case would be usage of mimikatz \"dpapi::masterkey\" function\nreferences:\n    - http://blog.harmj0y.net/redteaming/operational-guidance-for-offensive-user-dpapi-abuse/\n    - https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/dpapi-extracting-passwords\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-10-17\nmodified: 2024-07-29\ntags:\n    - attack.credential-access\n    - attack.t1555.004\nlogsource:\n    category: file_access\n    product: windows\n    definition: 'Requirements: Microsoft-Windows-Kernel-File ETW provider'\ndetection:\n    selection:\n        FileName|contains:\n            - '\\Microsoft\\Protect\\S-1-5-18\\' # For System32\n            - '\\Microsoft\\Protect\\S-1-5-21-' # For Users\n    filter_system_folders:\n        Image|startswith:\n            - 'C:\\Program Files\\'\n            - 'C:\\Program Files (x86)\\'\n            - 'C:\\Windows\\system32\\'\n            - 'C:\\Windows\\SysWOW64\\'\n    condition: selection and not 1 of filter_*\nfalsepositives:\n    - Unknown\n# Increase level after false positives filters are good enough\nlevel: medium\n"},{"path":"file\\file_access\\file_access_win_susp_crypto_currency_wallets.yml","content":"title: Access To Crypto Currency Wallets By Uncommon Applications\nid: f41b0311-44f9-44f0-816d-dd45e39d4bc8\nstatus: test\ndescription: |\n    Detects file access requests to crypto currency files by uncommon processes.\n    Could indicate potential attempt of crypto currency wallet stealing.\nreferences:\n    - Internal Research\nauthor: X__Junior (Nextron Systems)\ndate: 2024-07-29\ntags:\n    - attack.t1003\n    - attack.credential-access\nlogsource:\n    category: file_access\n    product: windows\n    definition: 'Requirements: Microsoft-Windows-Kernel-File ETW provider'\ndetection:\n    selection:\n        - FileName|contains:\n              - '\\AppData\\Roaming\\Ethereum\\keystore\\'\n              - '\\AppData\\Roaming\\EthereumClassic\\keystore\\'\n              - '\\AppData\\Roaming\\monero\\wallets\\'\n        - FileName|endswith:\n              - '\\AppData\\Roaming\\Bitcoin\\wallet.dat'\n              - '\\AppData\\Roaming\\BitcoinABC\\wallet.dat'\n              - '\\AppData\\Roaming\\BitcoinSV\\wallet.dat'\n              - '\\AppData\\Roaming\\DashCore\\wallet.dat'\n              - '\\AppData\\Roaming\\DogeCoin\\wallet.dat'\n              - '\\AppData\\Roaming\\Litecoin\\wallet.dat'\n              - '\\AppData\\Roaming\\Ripple\\wallet.dat'\n              - '\\AppData\\Roaming\\Zcash\\wallet.dat'\n    filter_main_system:\n        Image: System\n    filter_main_generic:\n        # This filter is added to avoid large amount of FP with 3rd party software. You should remove this in favour of specific filter per-application\n        Image|startswith:\n            - 'C:\\Program Files (x86)\\'\n            - 'C:\\Program Files\\'\n            - 'C:\\Windows\\system32\\'\n            - 'C:\\Windows\\SysWOW64\\'\n    filter_optional_defender:\n        Image|startswith: 'C:\\ProgramData\\Microsoft\\Windows Defender\\'\n        Image|endswith:\n            - '\\MpCopyAccelerator.exe'\n            - '\\MsMpEng.exe'\n    condition: selection and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Antivirus, Anti-Spyware, Anti-Malware Software\n    - Backup software\n    - Legitimate software installed on partitions other than \"C:\\\"\n    - Searching software such as \"everything.exe\"\nlevel: medium\n"},{"path":"file\\file_access\\file_access_win_susp_credhist.yml","content":"title: Access To Windows Credential History File By Uncommon Applications\nid: 7a2a22ea-a203-4cd3-9abf-20eb1c5c6cd2\nstatus: test\ndescription: |\n    Detects file access requests to the Windows Credential History File by an uncommon application.\n    This can be a sign of credential stealing. Example case would be usage of mimikatz \"dpapi::credhist\" function\nreferences:\n    - https://tools.thehacker.recipes/mimikatz/modules/dpapi/credhist\n    - https://www.passcape.com/windows_password_recovery_dpapi_credhist\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-10-17\nmodified: 2024-07-29\ntags:\n    - attack.credential-access\n    - attack.t1555.004\nlogsource:\n    category: file_access\n    product: windows\n    definition: 'Requirements: Microsoft-Windows-Kernel-File ETW provider'\ndetection:\n    selection:\n        FileName|endswith: '\\Microsoft\\Protect\\CREDHIST'\n    filter_main_system_folders:\n        Image|startswith:\n            - 'C:\\Program Files\\'\n            - 'C:\\Program Files (x86)\\'\n            - 'C:\\Windows\\system32\\'\n            - 'C:\\Windows\\SysWOW64\\'\n    filter_main_explorer:\n        Image: 'C:\\Windows\\explorer.exe'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Unknown\n# Increase level after false positives filters are good enough\nlevel: medium\n"},{"path":"file\\file_access\\file_access_win_susp_credential_manager_access.yml","content":"title: Credential Manager Access By Uncommon Applications\nid: 407aecb1-e762-4acf-8c7b-d087bcff3bb6\nstatus: test\ndescription: |\n    Detects suspicious processes based on name and location that access the windows credential manager and vault.\n    Which can be a sign of credential stealing. Example case would be usage of mimikatz \"dpapi::cred\" function\nreferences:\n    - https://hunter2.gitbook.io/darthsidious/privilege-escalation/mimikatz\n    - https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-10-11\nmodified: 2024-07-29\ntags:\n    - attack.t1003\n    - attack.credential-access\nlogsource:\n    category: file_access\n    product: windows\n    definition: 'Requirements: Microsoft-Windows-Kernel-File ETW provider'\ndetection:\n    selection:\n        FileName|contains:\n            - '\\AppData\\Local\\Microsoft\\Credentials\\'\n            - '\\AppData\\Roaming\\Microsoft\\Credentials\\'\n            - '\\AppData\\Local\\Microsoft\\Vault\\'\n            - '\\ProgramData\\Microsoft\\Vault\\'\n    filter_system_folders:\n        Image|startswith:\n            - 'C:\\Program Files\\'\n            - 'C:\\Program Files (x86)\\'\n            - 'C:\\Windows\\system32\\'\n            - 'C:\\Windows\\SysWOW64\\'\n    condition: selection and not 1 of filter_*\nfalsepositives:\n    - Legitimate software installed by the users for example in the \"AppData\" directory may access these files (for any reason).\n# Increase level after false positives filters are good enough\nlevel: medium\n"}]