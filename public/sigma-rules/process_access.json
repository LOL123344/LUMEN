[{"path":"process_access\\proc_access_win_uac_bypass_wow64_logger.yml","content":"title: UAC Bypass Using WOW64 Logger DLL Hijack\nid: 4f6c43e2-f989-4ea5-bcd8-843b49a0317c\nstatus: test\ndescription: Detects the pattern of UAC Bypass using a WoW64 logger DLL hijack (UACMe 30)\nreferences:\n    - https://github.com/hfiref0x/UACME\nauthor: Christian Burkard (Nextron Systems)\ndate: 2021-08-23\nmodified: 2022-10-09\ntags:\n    - attack.defense-evasion\n    - attack.privilege-escalation\n    - attack.t1548.002\nlogsource:\n    category: process_access\n    product: windows\ndetection:\n    selection:\n        SourceImage|contains: ':\\Windows\\SysWOW64\\'\n        GrantedAccess: '0x1fffff'\n        CallTrace|startswith: 'UNKNOWN(0000000000000000)|UNKNOWN(0000000000000000)|'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"process_access\\proc_access_win_uac_bypass_editionupgrademanagerobj.yml","content":"title: Function Call From Undocumented COM Interface EditionUpgradeManager\nid: fb3722e4-1a06-46b6-b772-253e2e7db933\nstatus: test\ndescription: Detects function calls from the EditionUpgradeManager COM interface. Which is an interface that is not used by standard executables.\nreferences:\n    - https://www.snip2code.com/Snippet/4397378/UAC-bypass-using-EditionUpgradeManager-C/\n    - https://gist.github.com/hfiref0x/de9c83966623236f5ebf8d9ae2407611\nauthor: oscd.community, Dmitry Uchakin\ndate: 2020-10-07\nmodified: 2023-11-30\ntags:\n    - attack.defense-evasion\n    - attack.privilege-escalation\n    - attack.t1548.002\nlogsource:\n    category: process_access\n    product: windows\ndetection:\n    selection:\n        CallTrace|contains: 'editionupgrademanagerobj.dll'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"process_access\\proc_access_win_svchost_susp_access_request.yml","content":"title: Suspicious Svchost Process Access\nid: 166e9c50-8cd9-44af-815d-d1f0c0e90dde\nstatus: test\ndescription: Detects suspicious access to the \"svchost\" process such as that used by Invoke-Phantom to kill the thread of the Windows event logging service.\nreferences:\n    - https://github.com/hlldz/Invoke-Phant0m\n    - https://twitter.com/timbmsft/status/900724491076214784\nauthor: Tim Burrell\ndate: 2020-01-02\nmodified: 2023-01-30\ntags:\n    - attack.defense-evasion\n    - attack.t1562.002\nlogsource:\n    category: process_access\n    product: windows\ndetection:\n    selection:\n        TargetImage|endswith: ':\\Windows\\System32\\svchost.exe'\n        GrantedAccess: '0x1F3FFF'\n        CallTrace|contains: 'UNKNOWN'\n    filter_main_msbuild:\n        SourceImage|contains: ':\\Program Files\\Microsoft Visual Studio\\'\n        SourceImage|endswith: '\\MSBuild\\Current\\Bin\\MSBuild.exe'\n        # Just to make sure it's \"really\" .NET :)\n        CallTrace|contains:\n            - 'Microsoft.Build.ni.dll'\n            - 'System.ni.dll'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"process_access\\proc_access_win_svchost_credential_dumping.yml","content":"title: Credential Dumping Attempt Via Svchost\nid: 174afcfa-6e40-4ae9-af64-496546389294\nstatus: test\ndescription: Detects when a process tries to access the memory of svchost to potentially dump credentials.\nreferences:\n    - Internal Research\nauthor: Florent Labouyrie\ndate: 2021-04-30\nmodified: 2022-10-09\ntags:\n    - attack.defense-evasion\n    - attack.privilege-escalation\n    - attack.t1548\nlogsource:\n    product: windows\n    category: process_access\ndetection:\n    selection:\n        TargetImage|endswith: '\\svchost.exe'\n        GrantedAccess: '0x143a'\n    filter_main_known_processes:\n        SourceImage|endswith:\n            - '\\services.exe'\n            - '\\msiexec.exe'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"process_access\\proc_access_win_susp_direct_ntopenprocess_call.yml","content":"title: Potential Direct Syscall of NtOpenProcess\nid: 3f3f3506-1895-401b-9cc3-e86b16e630d0\nstatus: test\ndescription: Detects potential calls to NtOpenProcess directly from NTDLL.\nreferences:\n    - https://medium.com/falconforce/falconfriday-direct-system-calls-and-cobalt-strike-bofs-0xff14-741fa8e1bdd6\nauthor: Christian Burkard (Nextron Systems), Tim Shelton (FP)\ndate: 2021-07-28\nmodified: 2023-12-13\ntags:\n    - attack.execution\n    - attack.t1106\nlogsource:\n    category: process_access\n    product: windows\ndetection:\n    selection:\n        CallTrace|startswith: 'UNKNOWN'\n    filter_main_vcredist:\n        TargetImage|endswith: 'vcredist_x64.exe'\n        SourceImage|endswith: 'vcredist_x64.exe'\n    filter_main_generic:\n        # Examples include \"systeminfo\", \"backgroundTaskHost\", \"AUDIODG\"\n        SourceImage|contains:\n            - ':\\Program Files (x86)\\'\n            - ':\\Program Files\\'\n            - ':\\Windows\\System32\\'\n            - ':\\Windows\\SysWOW64\\'\n            - ':\\Windows\\WinSxS\\'\n        TargetImage|contains:\n            - ':\\Program Files (x86)\\'\n            - ':\\Program Files\\'\n            - ':\\Windows\\System32\\'\n            - ':\\Windows\\SysWOW64\\'\n            - ':\\Windows\\WinSxS\\'\n    filter_main_kerneltrace_edge:\n        # Cases in which the CallTrace is just e.g. 'UNKNOWN(19290435374)' from Microsoft-Windows-Kernel-Audit-API-Calls provider\n        Provider_Name: 'Microsoft-Windows-Kernel-Audit-API-Calls'\n    filter_optional_vmware:\n        TargetImage|endswith: ':\\Windows\\system32\\systeminfo.exe'\n        SourceImage|endswith: 'setup64.exe' # vmware\n    filter_optional_cylance:\n        SourceImage|endswith: ':\\Windows\\Explorer.EXE'\n        TargetImage|endswith: ':\\Program Files\\Cylance\\Desktop\\CylanceUI.exe'\n    filter_optional_amazon:\n        SourceImage|endswith: 'AmazonSSMAgentSetup.exe'\n        TargetImage|endswith: 'AmazonSSMAgentSetup.exe'\n    filter_optional_vscode: # VsCode\n        SourceImage|endswith: '\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe'\n        TargetImage|endswith: '\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe'\n    filter_optional_teams: # MS Teams\n        TargetImage|endswith: '\\AppData\\Local\\Microsoft\\Teams\\current\\Teams.exe'\n        SourceImage|endswith: '\\AppData\\Local\\Microsoft\\Teams\\current\\Teams.exe'\n    filter_optional_discord: # Discord\n        TargetImage|contains: '\\AppData\\Local\\Discord\\'\n        TargetImage|endswith: '\\Discord.exe'\n    filter_optional_yammer:\n        SourceImage|contains: '\\AppData\\Local\\yammerdesktop\\app-'\n        SourceImage|endswith: '\\Yammer.exe'\n        TargetImage|contains: '\\AppData\\Local\\yammerdesktop\\app-'\n        TargetImage|endswith: '\\Yammer.exe'\n        GrantedAccess: '0x1000'\n    filter_optional_evernote:\n        TargetImage|endswith: '\\Evernote\\Evernote.exe'\n    filter_optional_adobe_acrobat:\n        SourceImage|contains: ':\\Program Files\\Adobe\\Acrobat DC\\Acrobat\\'\n        SourceImage|endswith: '\\AcroCEF.exe'\n        TargetImage|contains: ':\\Program Files\\Adobe\\Acrobat DC\\Acrobat\\'\n        TargetImage|endswith: '\\AcroCEF.exe'\n    condition: selection and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"process_access\\proc_access_win_susp_all_access_uncommon_target.yml","content":"title: Uncommon Process Access Rights For Target Image\nid: a24e5861-c6ca-4fde-a93c-ba9256feddf0\nstatus: test\ndescription: |\n    Detects process access request to uncommon target images with a \"PROCESS_ALL_ACCESS\" access mask.\nreferences:\n    - https://learn.microsoft.com/en-us/windows/win32/procthread/process-security-and-access-rights\nauthor: Nasreddine Bencherchali (Nextron Systems), frack113\ndate: 2024-05-27\ntags:\n    - attack.defense-evasion\n    - attack.privilege-escalation\n    - attack.t1055.011\nlogsource:\n    category: process_access\n    product: windows\ndetection:\n    selection:\n        TargetImage|endswith:\n            # Note: Add additional uncommon targets to increase coverage.\n            - '\\calc.exe'\n            - '\\calculator.exe'\n            - '\\mspaint.exe'\n            - '\\notepad.exe'\n            - '\\ping.exe'\n            - '\\wordpad.exe'\n            - '\\write.exe'\n        GrantedAccess: '0x1FFFFF' # PROCESS_ALL_ACCESS - All possible access rights for a process object.\n    condition: selection\nfalsepositives:\n    - Unknown\n# Note: please upgrade to a higher level after an initial test/tuning.\nlevel: low\n"},{"path":"process_access\\proc_access_win_lsass_whitelisted_process_names.yml","content":"title: LSASS Access From Potentially White-Listed Processes\nid: 4be8b654-0c01-4c9d-a10c-6b28467fc651\nstatus: test\ndescription: |\n    Detects a possible process memory dump that uses a white-listed filename like TrolleyExpress.exe as a way to dump the LSASS process memory without Microsoft Defender interference\nreferences:\n    - https://twitter.com/_xpn_/status/1491557187168178176\n    - https://www.ired.team/offensive-security/credential-access-and-credential-dumping/dump-credentials-from-lsass-process-without-mimikatz\n    - https://twitter.com/mrd0x/status/1460597833917251595\nauthor: Florian Roth (Nextron Systems)\ndate: 2022-02-10\nmodified: 2023-11-29\ntags:\n    - attack.credential-access\n    - attack.t1003.001\n    - attack.s0002\nlogsource:\n    category: process_access\n    product: windows\ndetection:\n    selection:\n        TargetImage|endswith: '\\lsass.exe'\n        SourceImage|endswith:\n            - '\\TrolleyExpress.exe'  # Citrix\n            - '\\ProcessDump.exe'     # Cisco Jabber\n            - '\\dump64.exe'          # Visual Studio\n        GrantedAccess|endswith:\n            - '10'\n            - '30'\n            - '50'\n            - '70'\n            - '90'\n            - 'B0'\n            - 'D0'\n            - 'F0'\n            - '18'\n            - '38'\n            - '58'\n            - '78'\n            - '98'\n            - 'B8'\n            - 'D8'\n            - 'F8'\n            - '1A'\n            - '3A'\n            - '5A'\n            - '7A'\n            - '9A'\n            - 'BA'\n            - 'DA'\n            - 'FA'\n            - '0x14C2'  # https://github.com/b4rtik/ATPMiniDump/blob/76304f93b390af3bb66e4f451ca16562a479bdc9/ATPMiniDump/ATPMiniDump.c\n            - 'FF'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"process_access\\proc_access_win_lsass_werfault.yml","content":"title: Credential Dumping Attempt Via WerFault\nid: e5b33f7d-eb93-48b6-9851-09e1e610b6d7\nstatus: test\ndescription: Detects process LSASS memory dump using Mimikatz, NanoDump, Invoke-Mimikatz, Procdump or Taskmgr based on the CallTrace pointing to ntdll.dll, dbghelp.dll or dbgcore.dll for win10, server2016 and up.\nreferences:\n    - https://github.com/helpsystems/nanodump/commit/578116faea3d278d53d70ea932e2bbfe42569507\nauthor: Florian Roth (Nextron Systems)\ndate: 2012-06-27\nmodified: 2023-11-29\ntags:\n    - attack.credential-access\n    - attack.t1003.001\n    - attack.s0002\nlogsource:\n    category: process_access\n    product: windows\ndetection:\n    selection:\n        SourceImage|endswith: '\\WerFault.exe'\n        TargetImage|endswith: '\\lsass.exe'\n        GrantedAccess: '0x1FFFFF'\n    condition: selection\nfalsepositives:\n    - Actual failures in lsass.exe that trigger a crash dump (unlikely)\n    - Unknown cases in which WerFault accesses lsass.exe\nlevel: high\n"},{"path":"process_access\\proc_access_win_lsass_susp_access_flag.yml","content":"title: Potentially Suspicious GrantedAccess Flags On LSASS\nid: a18dd26b-6450-46de-8c91-9659150cf088\nrelated:\n    - id: 32d0d3e2-e58d-4d41-926b-18b520b2b32d\n      type: similar\nstatus: test\ndescription: Detects process access requests to LSASS process with potentially suspicious access flags\nreferences:\n    - https://learn.microsoft.com/en-us/windows/win32/procthread/process-security-and-access-rights\n    - https://onedrive.live.com/view.aspx?resid=D026B4699190F1E6!2843&ithint=file%2cpptx&app=PowerPoint&authkey=!AMvCRTKB_V1J5ow\n    - https://web.archive.org/web/20230208123920/https://cyberwardog.blogspot.com/2017/03/chronicles-of-threat-hunter-hunting-for_22.html\n    - https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment\n    - https://web.archive.org/web/20230420013146/http://security-research.dyndns.org/pub/slides/FIRST2017/FIRST-2017_Tom-Ueltschi_Sysmon_FINAL_notes.pdf\nauthor: Florian Roth, Roberto Rodriguez, Dimitrios Slamaris, Mark Russinovich, Thomas Patzke, Teymur Kheirkhabarov, Sherif Eldeeb, James Dickenson, Aleksey Potapov, oscd.community\ndate: 2021-11-22\nmodified: 2023-11-29\ntags:\n    - attack.credential-access\n    - attack.t1003.001\n    - attack.s0002\nlogsource:\n    category: process_access\n    product: windows\ndetection:\n    selection_target:\n        TargetImage|endswith: '\\lsass.exe'\n    selection_access:\n        - GrantedAccess|endswith:\n              # - '10'  # covered in rule 678dfc63-fefb-47a5-a04c-26bcf8cc9f65\n              - '30'\n              - '50'\n              - '70'\n              - '90'\n              - 'B0'\n              - 'D0'\n              - 'F0'\n              - '18'\n              - '38'\n              - '58'\n              - '78'\n              - '98'\n              - 'B8'\n              - 'D8'\n              - 'F8'\n              - '1A'\n              - '3A'\n              - '5A'\n              - '7A'\n              - '9A'\n              - 'BA'\n              - 'DA'\n              - 'FA'\n              - '0x14C2'  # https://github.com/b4rtik/ATPMiniDump/blob/76304f93b390af3bb66e4f451ca16562a479bdc9/ATPMiniDump/ATPMiniDump.c\n        - GrantedAccess|startswith:\n              - '0x100000'\n              - '0x1418'    # car.2019-04-004\n              - '0x1438'    # car.2019-04-004\n              - '0x143a'    # car.2019-04-004\n              - '0x1f0fff'\n              - '0x1f1fff'\n              - '0x1f2fff'\n              - '0x1f3fff'\n              - '0x40'\n              # - '0x1000'  # minimum access requirements to query basic info from service\n              # - '0x1010'    # car.2019-04-004\n              # - '0x1400'\n              # - '0x1410'    # car.2019-04-004 # Covered by 678dfc63-fefb-47a5-a04c-26bcf8cc9f65\n    filter_main_generic:\n        # When using this rule. Remove this filter and replace it by the path of the specific AV you use\n        SourceImage|contains:\n            - ':\\Program Files (x86)\\'\n            - ':\\Program Files\\'\n            - ':\\Windows\\System32\\'\n            - ':\\Windows\\SysWOW64\\'\n    filter_optional_malwarebytes:\n        SourceImage|endswith: ':\\ProgramData\\MALWAREBYTES\\MBAMSERVICE\\ctlrupdate\\mbupdatr.exe'\n    filter_optional_vscode:\n        SourceImage|endswith: '\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe'\n    filter_main_windefend_1:\n        SourceImage|contains: ':\\ProgramData\\Microsoft\\Windows Defender\\'\n        SourceImage|endswith: '\\MsMpEng.exe'\n    filter_main_windefend_2:\n        CallTrace|contains|all:\n            - '|?:\\ProgramData\\Microsoft\\Windows Defender\\Definition Updates\\{'\n            - '}\\mpengine.dll+'\n        GrantedAccess: '0x1418'\n    filter_main_windefend_3:\n        CallTrace|contains:\n            - '|c:\\program files\\windows defender\\mprtp.dll'\n            - '|c:\\program files\\windows defender\\MpClient.dll'\n    filter_optional_vmwaretools:\n        SourceImage|contains: ':\\ProgramData\\VMware\\VMware Tools\\'\n        SourceImage|endswith: '\\vmtoolsd.exe'\n    filter_optional_sysinternals_process_explorer:\n        SourceImage|endswith:\n            - '\\PROCEXP64.EXE'\n            - '\\PROCEXP.EXE'\n        GrantedAccess: '0x40'\n    filter_optional_mbami:\n        SourceImage|endswith: '\\MBAMInstallerService.exe'\n        GrantedAccess: '0x40'\n    filter_optional_nextron:\n        SourceImage|endswith:\n            - '\\aurora-agent-64.exe'\n            - '\\aurora-agent.exe'\n            - '\\thor.exe'\n            - '\\thor64.exe'\n        GrantedAccess: '0x40'\n    filter_main_explorer:\n        SourceImage|endswith: '\\explorer.exe'\n        GrantedAccess: '0x401'\n    filter_optional_sysinternals_handle:\n        SourceImage|endswith:\n            - '\\handle.exe'\n            - '\\handle64.exe'\n        GrantedAccess: '0x40'\n    filter_optional_webex:\n        SourceImage|endswith: '\\AppData\\Local\\WebEx\\WebexHost.exe'\n        GrantedAccess: '0x401'\n    filter_optional_steam_apps:\n        SourceImage|contains: '\\SteamLibrary\\steamapps\\'\n    condition: all of selection_* and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Legitimate software such as AV and EDR\nlevel: medium\n"},{"path":"process_access\\proc_access_win_lsass_seclogon_access.yml","content":"title: Suspicious LSASS Access Via MalSecLogon\nid: 472159c5-31b9-4f56-b794-b766faa8b0a7\nstatus: test\ndescription: Detects suspicious access to LSASS handle via a call trace to \"seclogon.dll\" with a suspicious access right.\nreferences:\n    - https://twitter.com/SBousseaden/status/1541920424635912196\n    - https://github.com/elastic/detection-rules/blob/2bc1795f3d7bcc3946452eb4f07ae799a756d94e/rules/windows/credential_access_lsass_handle_via_malseclogon.toml\n    - https://splintercod3.blogspot.com/p/the-hidden-side-of-seclogon-part-3.html\nauthor: Samir Bousseaden (original elastic rule), Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-06-29\ntags:\n    - attack.credential-access\n    - attack.t1003.001\nlogsource:\n    category: process_access\n    product: windows\ndetection:\n    selection:\n        TargetImage|endswith: '\\lsass.exe'\n        SourceImage|endswith: '\\svchost.exe'\n        GrantedAccess: '0x14c0'\n        CallTrace|contains: 'seclogon.dll'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"process_access\\proc_access_win_lsass_remote_access_trough_winrm.yml","content":"title: Remote LSASS Process Access Through Windows Remote Management\nid: aa35a627-33fb-4d04-a165-d33b4afca3e8\nstatus: stable\ndescription: Detects remote access to the LSASS process via WinRM. This could be a sign of credential dumping from tools like mimikatz.\nreferences:\n    - https://pentestlab.blog/2018/05/15/lateral-movement-winrm/\nauthor: Patryk Prauze - ING Tech\ndate: 2019-05-20\nmodified: 2023-11-29\ntags:\n    - attack.credential-access\n    - attack.execution\n    - attack.t1003.001\n    - attack.t1059.001\n    - attack.lateral-movement\n    - attack.t1021.006\n    - attack.s0002\nlogsource:\n    category: process_access\n    product: windows\ndetection:\n    selection:\n        TargetImage|endswith: '\\lsass.exe'\n        SourceImage|endswith: ':\\Windows\\system32\\wsmprovhost.exe'\n    filter_main_access:\n        GrantedAccess: '0x80000000'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Unlikely\nlevel: high\n"},{"path":"process_access\\proc_access_win_lsass_python_based_tool.yml","content":"title: Credential Dumping Activity By Python Based Tool\nid: f8be3e82-46a3-4e4e-ada5-8e538ae8b9c9\nrelated:\n    - id: 4b9a8556-99c4-470b-a40c-9c8d02c77ed0\n      type: obsolete\n    - id: 7186e989-4ed7-4f4e-a656-4674b9e3e48b\n      type: obsolete\nstatus: stable\ndescription: Detects LSASS process access for potential credential dumping by a Python-like tool such as LaZagne or Pypykatz.\nreferences:\n    - https://twitter.com/bh4b3sh/status/1303674603819081728\n    - https://github.com/skelsec/pypykatz\nauthor: Bhabesh Raj, Jonhnathan Ribeiro\ndate: 2023-11-27\nmodified: 2023-11-29\ntags:\n    - attack.credential-access\n    - attack.t1003.001\n    - attack.s0349\nlogsource:\n    category: process_access\n    product: windows\ndetection:\n    selection:\n        TargetImage|endswith: '\\lsass.exe'\n        CallTrace|contains|all:\n            - '_ctypes.pyd+'\n            - ':\\Windows\\System32\\KERNELBASE.dll+'\n            - ':\\Windows\\SYSTEM32\\ntdll.dll+'\n        CallTrace|contains:\n            - 'python27.dll+'\n            - 'python3*.dll+'\n        GrantedAccess: '0x1FFFFF'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"process_access\\proc_access_win_lsass_memdump.yml","content":"title: Potential Credential Dumping Activity Via LSASS\nid: 5ef9853e-4d0e-4a70-846f-a9ca37d876da\nstatus: test\ndescription: |\n    Detects process access requests to the LSASS process with specific call trace calls and access masks.\n    This behaviour is expressed by many credential dumping tools such as Mimikatz, NanoDump, Invoke-Mimikatz, Procdump and even the Taskmgr dumping feature.\nreferences:\n    - https://web.archive.org/web/20230329170326/https://blog.menasec.net/2019/02/threat-hunting-21-procdump-or-taskmgr.html\n    - https://web.archive.org/web/20230208123920/https://cyberwardog.blogspot.com/2017/03/chronicles-of-threat-hunter-hunting-for_22.html\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1003.001/T1003.001.md\n    - https://research.splunk.com/endpoint/windows_possible_credential_dumping/\nauthor: Samir Bousseaden, Michael Haag\ndate: 2019-04-03\nmodified: 2024-03-02\ntags:\n    - attack.credential-access\n    - attack.t1003.001\n    - attack.s0002\nlogsource:\n    category: process_access\n    product: windows\ndetection:\n    selection:\n        TargetImage|endswith: '\\lsass.exe'\n        GrantedAccess|contains:\n            - '0x1038'\n            - '0x1438'\n            - '0x143a'\n            - '0x1fffff' # Too many false positives\n            # - '0x01000'  # Too many false positives\n            # - '0x1010'   # Too many false positives\n            # - '0x1400'  # Too many false positives\n            # - '0x1410' # Too many false positives\n            # - '0x40'   # Too many false positives\n        CallTrace|contains:\n            - 'dbgcore.dll'\n            - 'dbghelp.dll'\n            - 'kernel32.dll'\n            - 'kernelbase.dll'\n            - 'ntdll.dll'\n    filter_main_system_user:\n        SourceUser|contains: # Covers many language settings\n            - 'AUTHORI'\n            - 'AUTORI'\n    filter_optional_thor:\n        CallTrace|contains|all:\n            - ':\\Windows\\Temp\\asgard2-agent\\'\n            - '\\thor\\thor64.exe+'\n            - '|UNKNOWN('\n        GrantedAccess: '0x103800'\n    filter_optional_sysmon:\n        SourceImage|endswith: ':\\Windows\\Sysmon64.exe'\n    condition: selection and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"process_access\\proc_access_win_lsass_dump_keyword_image.yml","content":"title: LSASS Memory Access by Tool With Dump Keyword In Name\nid: 9bd012ee-0dff-44d7-84a0-aa698cfd87a3\nstatus: test\ndescription: Detects LSASS process access requests from a source process with the \"dump\" keyword in its image name.\nreferences:\n    - https://twitter.com/_xpn_/status/1491557187168178176\n    - https://www.ired.team/offensive-security/credential-access-and-credential-dumping/dump-credentials-from-lsass-process-without-mimikatz\nauthor: Florian Roth (Nextron Systems)\ndate: 2022-02-10\nmodified: 2023-11-29\ntags:\n    - attack.credential-access\n    - attack.t1003.001\n    - attack.s0002\nlogsource:\n    category: process_access\n    product: windows\ndetection:\n    selection:\n        TargetImage|endswith: '\\lsass.exe'\n        SourceImage|contains: 'dump'\n        GrantedAccess|endswith:\n            - '10'\n            - '30'\n            - '50'\n            - '70'\n            - '90'\n            - 'B0'\n            - 'D0'\n            - 'F0'\n            - '18'\n            - '38'\n            - '58'\n            - '78'\n            - '98'\n            - 'B8'\n            - 'D8'\n            - 'F8'\n            - '1A'\n            - '3A'\n            - '5A'\n            - '7A'\n            - '9A'\n            - 'BA'\n            - 'DA'\n            - 'FA'\n            - '0x14C2'  # https://github.com/b4rtik/ATPMiniDump/blob/76304f93b390af3bb66e4f451ca16562a479bdc9/ATPMiniDump/ATPMiniDump.c\n            - 'FF'\n    condition: selection\nfalsepositives:\n    - Rare programs that contain the word dump in their name and access lsass\nlevel: high\n"},{"path":"process_access\\proc_access_win_lsass_dump_comsvcs_dll.yml","content":"title: Lsass Memory Dump via Comsvcs DLL\nid: a49fa4d5-11db-418c-8473-1e014a8dd462\nstatus: test\ndescription: Detects adversaries leveraging the MiniDump export function from comsvcs.dll via rundll32 to perform a memory dump from lsass.\nreferences:\n    - https://twitter.com/shantanukhande/status/1229348874298388484\n    - https://modexp.wordpress.com/2019/08/30/minidumpwritedump-via-com-services-dll/\nauthor: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)\ndate: 2020-10-20\nmodified: 2023-11-29\ntags:\n    - attack.credential-access\n    - attack.t1003.001\nlogsource:\n    category: process_access\n    product: windows\ndetection:\n    selection:\n        TargetImage|endswith: '\\lsass.exe'\n        SourceImage|endswith: '\\rundll32.exe'\n        CallTrace|contains: 'comsvcs.dll'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"process_access\\proc_access_win_hktl_sysmonente.yml","content":"title: HackTool - SysmonEnte Execution\nid: d29ada0f-af45-4f27-8f32-f7b77c3dbc4e\nstatus: test\ndescription: Detects the use of SysmonEnte, a tool to attack the integrity of Sysmon\nreferences:\n    - https://codewhitesec.blogspot.com/2022/09/attacks-on-sysmon-revisited-sysmonente.html\n    - https://github.com/codewhitesec/SysmonEnte/\n    - https://github.com/codewhitesec/SysmonEnte/blob/fe267690fcc799fbda15398243615a30451d9099/screens/1.png\nauthor: Florian Roth (Nextron Systems)\ndate: 2022-09-07\nmodified: 2023-11-28\ntags:\n    - attack.defense-evasion\n    - attack.t1562.002\nlogsource:\n    category: process_access\n    product: windows\ndetection:\n    selection_sysmon:\n        TargetImage|contains:\n            - ':\\Windows\\Sysmon.exe'\n            - ':\\Windows\\Sysmon64.exe'\n        GrantedAccess: '0x1400'\n    selection_calltrace:\n        CallTrace: 'Ente'\n    filter_main_generic:\n        SourceImage|contains:\n            - ':\\Program Files (x86)\\'\n            - ':\\Program Files\\'\n            - ':\\Windows\\System32\\'\n            - ':\\Windows\\SysWOW64\\'\n    filter_main_msdefender:\n        SourceImage|contains: ':\\ProgramData\\Microsoft\\Windows Defender\\Platform\\'\n        SourceImage|endswith: '\\MsMpEng.exe'\n    condition: ( selection_sysmon and not 1 of filter_main_* ) or selection_calltrace\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"process_access\\proc_access_win_hktl_littlecorporal_generated_maldoc.yml","content":"title: HackTool - LittleCorporal Generated Maldoc Injection\nid: 7bdde3bf-2a42-4c39-aa31-a92b3e17afac\nstatus: test\ndescription: Detects the process injection of a LittleCorporal generated Maldoc.\nreferences:\n    - https://github.com/connormcgarr/LittleCorporal\nauthor: Christian Burkard (Nextron Systems)\ndate: 2021-08-09\nmodified: 2023-11-28\ntags:\n    - attack.defense-evasion\n    - attack.execution\n    - attack.privilege-escalation\n    - attack.t1204.002\n    - attack.t1055.003\nlogsource:\n    category: process_access\n    product: windows\ndetection:\n    selection:\n        SourceImage|endswith: '\\winword.exe'\n        CallTrace|contains|all:\n            - ':\\Windows\\Microsoft.NET\\Framework64\\v2.'\n            - 'UNKNOWN'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"process_access\\proc_access_win_hktl_handlekatz_lsass_access.yml","content":"title: HackTool - HandleKatz Duplicating LSASS Handle\nid: b1bd3a59-c1fd-4860-9f40-4dd161a7d1f5\nstatus: test\ndescription: Detects HandleKatz opening LSASS to duplicate its handle to later dump the memory without opening any new handles\nreferences:\n    - https://github.com/codewhitesec/HandleKatz\nauthor: Bhabesh Raj (rule), @thefLinkk\ndate: 2022-06-27\nmodified: 2023-11-28\ntags:\n    - attack.execution\n    - attack.t1106\n    - attack.defense-evasion\n    - attack.t1003.001\n    - attack.credential-access\nlogsource:\n    category: process_access\n    product: windows\ndetection:\n    selection:\n        TargetImage|endswith: '\\lsass.exe' # Theoretically, can be any benign process holding handle to LSASS\n        GrantedAccess: '0x1440' # Only PROCESS_DUP_HANDLE, PROCESS_QUERY_LIMITED_INFORMATION, PROCESS_QUERY_INFORMATION\n        # Example: C:\\Windows\\SYSTEM32\\ntdll.dll+9d234\\|UNKNOWN(00000000001C119B)\n        CallTrace|startswith: 'C:\\Windows\\System32\\ntdll.dll+'\n        CallTrace|contains: '|UNKNOWN('\n        CallTrace|endswith: ')'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"process_access\\proc_access_win_hktl_generic_access.yml","content":"title: HackTool - Generic Process Access\nid: d0d2f720-d14f-448d-8242-51ff396a334e\nstatus: test\ndescription: Detects process access requests from hacktool processes based on their default image name\nreferences:\n    - https://jsecurity101.medium.com/bypassing-access-mask-auditing-strategies-480fb641c158\n    - https://www.splunk.com/en_us/blog/security/you-bet-your-lsass-hunting-lsass-access.html\nauthor: Nasreddine Bencherchali (Nextron Systems), Swachchhanda Shrawan Poudel\ndate: 2023-11-27\ntags:\n    - attack.credential-access\n    - attack.t1003.001\n    - attack.s0002\nlogsource:\n    category: process_access\n    product: windows\ndetection:\n    selection:\n        - SourceImage|endswith:\n              - '\\Akagi.exe'\n              - '\\Akagi64.exe'\n              - '\\atexec_windows.exe'\n              - '\\Certify.exe'\n              - '\\Certipy.exe'\n              - '\\CoercedPotato.exe'\n              - '\\crackmapexec.exe'\n              - '\\CreateMiniDump.exe'\n              - '\\dcomexec_windows.exe'\n              - '\\dpapi_windows.exe'\n              - '\\findDelegation_windows.exe'\n              - '\\GetADUsers_windows.exe'\n              - '\\GetNPUsers_windows.exe'\n              - '\\getPac_windows.exe'\n              - '\\getST_windows.exe'\n              - '\\getTGT_windows.exe'\n              - '\\GetUserSPNs_windows.exe'\n              - '\\gmer.exe'\n              - '\\hashcat.exe'\n              - '\\htran.exe'\n              - '\\ifmap_windows.exe'\n              - '\\impersonate.exe'\n              - '\\Inveigh.exe'\n              - '\\LocalPotato.exe'\n              - '\\mimikatz_windows.exe'\n              - '\\mimikatz.exe'\n              - '\\netview_windows.exe'\n              - '\\nmapAnswerMachine_windows.exe'\n              - '\\opdump_windows.exe'\n              - '\\PasswordDump.exe'\n              - '\\Potato.exe'\n              - '\\PowerTool.exe'\n              - '\\PowerTool64.exe'\n              - '\\psexec_windows.exe'\n              - '\\PurpleSharp.exe'\n              - '\\pypykatz.exe'\n              - '\\QuarksPwDump.exe'\n              - '\\rdp_check_windows.exe'\n              - '\\Rubeus.exe'\n              - '\\SafetyKatz.exe'\n              - '\\sambaPipe_windows.exe'\n              - '\\SelectMyParent.exe'\n              - '\\SharpChisel.exe'\n              - '\\SharPersist.exe'\n              - '\\SharpEvtMute.exe'\n              - '\\SharpImpersonation.exe'\n              - '\\SharpLDAPmonitor.exe'\n              - '\\SharpLdapWhoami.exe'\n              - '\\SharpUp.exe'\n              - '\\SharpView.exe'\n              - '\\smbclient_windows.exe'\n              - '\\smbserver_windows.exe'\n              - '\\sniff_windows.exe'\n              - '\\sniffer_windows.exe'\n              - '\\split_windows.exe'\n              - '\\SpoolSample.exe'\n              - '\\Stracciatella.exe'\n              - '\\SysmonEOP.exe'\n              - '\\temp\\rot.exe'\n              - '\\ticketer_windows.exe'\n              - '\\TruffleSnout.exe'\n              - '\\winPEASany_ofs.exe'\n              - '\\winPEASany.exe'\n              - '\\winPEASx64_ofs.exe'\n              - '\\winPEASx64.exe'\n              - '\\winPEASx86_ofs.exe'\n              - '\\winPEASx86.exe'\n              - '\\xordump.exe'\n        - SourceImage|contains:\n              - '\\goldenPac'\n              - '\\just_dce_'\n              - '\\karmaSMB'\n              - '\\kintercept'\n              - '\\LocalPotato'\n              - '\\ntlmrelayx'\n              - '\\rpcdump'\n              - '\\samrdump'\n              - '\\secretsdump'\n              - '\\smbexec'\n              - '\\smbrelayx'\n              - '\\wmiexec'\n              - '\\wmipersist'\n              - 'HotPotato'\n              - 'Juicy Potato'\n              - 'JuicyPotato'\n              - 'PetitPotam'\n              - 'RottenPotato'\n    condition: selection\nfalsepositives:\n    - Unlikely\nlevel: high\n"},{"path":"process_access\\proc_access_win_hktl_cobaltstrike_bof_injection_pattern.yml","content":"title: HackTool - CobaltStrike BOF Injection Pattern\nid: 09706624-b7f6-455d-9d02-adee024cee1d\nstatus: test\ndescription: Detects a typical pattern of a CobaltStrike BOF which inject into other processes\nreferences:\n    - https://github.com/boku7/injectAmsiBypass\n    - https://github.com/boku7/spawn\nauthor: Christian Burkard (Nextron Systems)\ndate: 2021-08-04\nmodified: 2023-11-28\ntags:\n    - attack.execution\n    - attack.t1106\n    - attack.defense-evasion\n    - attack.t1562.001\nlogsource:\n    category: process_access\n    product: windows\ndetection:\n    selection:\n        CallTrace|re: '^C:\\\\Windows\\\\SYSTEM32\\\\ntdll\\.dll\\+[a-z0-9]{4,6}\\|C:\\\\Windows\\\\System32\\\\KERNELBASE\\.dll\\+[a-z0-9]{4,6}\\|UNKNOWN\\([A-Z0-9]{16}\\)$'\n        GrantedAccess:\n            - '0x1028'\n            - '0x1fffff'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"process_access\\proc_access_win_cmstp_execution_by_access.yml","content":"title: CMSTP Execution Process Access\nid: 3b4b232a-af90-427c-a22f-30b0c0837b95\nstatus: stable\ndescription: Detects various indicators of Microsoft Connection Manager Profile Installer execution\nreferences:\n    - https://web.archive.org/web/20190720093911/http://www.endurant.io/cmstp/detecting-cmstp-enabled-code-execution-and-uac-bypass-with-sysmon/\nauthor: Nik Seetharaman\ndate: 2018-07-16\nmodified: 2021-06-27\ntags:\n    - attack.defense-evasion\n    - attack.t1218.003\n    - attack.execution\n    - attack.t1559.001\n    - attack.g0069\n    - attack.g0080\n    - car.2019-04-001\nlogsource:\n    product: windows\n    category: process_access\ndetection:\n    # Process Access Call Trace\n    selection:\n        CallTrace|contains: 'cmlua.dll'\n    condition: selection\nfalsepositives:\n    - Legitimate CMSTP use (unlikely in modern enterprise environments)\nlevel: high\n"}]