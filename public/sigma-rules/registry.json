[{"path":"registry\\registry_set\\registry_set_winlogon_notify_key.yml","content":"title: Winlogon Notify Key Logon Persistence\nid: bbf59793-6efb-4fa1-95ca-a7d288e52c88\nstatus: test\ndescription: |\n    Adversaries may abuse features of Winlogon to execute DLLs and/or executables when a user logs in.\n    Winlogon.exe is a Windows component responsible for actions at logon/logoff as well as the secure attention sequence (SAS) triggered by Ctrl-Alt-Delete.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1547.004/T1547.004.md#atomic-test-3---winlogon-notify-key-logon-persistence---powershell\nauthor: frack113\ndate: 2021-12-30\nmodified: 2023-08-17\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547.004\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: '\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Notify\\logon'\n        Details|endswith: '.dll'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_winlogon_allow_multiple_tssessions.yml","content":"title: Winlogon AllowMultipleTSSessions Enable\nid: f7997770-92c3-4ec9-b112-774c4ef96f96\nstatus: test\ndescription: |\n  Detects when the 'AllowMultipleTSSessions' value is enabled.\n  Which allows for multiple Remote Desktop connection sessions to be opened at once.\n  This is often used by attacker as a way to connect to an RDP session without disconnecting the other users\nreferences:\n    - http://blog.talosintelligence.com/2022/09/lazarus-three-rats.html\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-09-09\nmodified: 2023-08-17\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: '\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\AllowMultipleTSSessions'\n        Details|endswith: DWORD (0x00000001)\n    condition: selection\nfalsepositives:\n    - Legitimate use of the multi session functionality\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_winget_enable_local_manifest.yml","content":"title: Enable Local Manifest Installation With Winget\nid: fa277e82-9b78-42dd-b05c-05555c7b6015\nstatus: test\ndescription: Detects changes to the AppInstaller (winget) policy. Specifically the activation of the local manifest installation, which allows a user to install new packages via custom manifests.\nreferences:\n    - https://github.com/nasbench/Misc-Research/tree/b9596e8109dcdb16ec353f316678927e507a5b8d/LOLBINs/Winget\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-04-17\nmodified: 2023-08-17\ntags:\n    - attack.defense-evasion\n    - attack.persistence\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection:\n        TargetObject|endswith: '\\AppInstaller\\EnableLocalManifestFiles'\n        Details: 'DWORD (0x00000001)'\n    condition: selection\nfalsepositives:\n    - Administrators or developers might enable this for testing purposes or to install custom private packages\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_winget_admin_settings_tampering.yml","content":"title: Winget Admin Settings Modification\nid: 6db5eaf9-88f7-4ed9-af7d-9ef2ad12f236\nstatus: test\ndescription: Detects changes to the AppInstaller (winget) admin settings. Such as enabling local manifest installations or disabling installer hash checks\nreferences:\n    - https://github.com/nasbench/Misc-Research/tree/b9596e8109dcdb16ec353f316678927e507a5b8d/LOLBINs/Winget\n    - https://github.com/microsoft/winget-cli/blob/02d2f93807c9851d73eaacb4d8811a76b64b7b01/src/AppInstallerCommonCore/Public/winget/AdminSettings.h#L13\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-04-17\nmodified: 2023-08-17\ntags:\n    - attack.defense-evasion\n    - attack.persistence\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection:\n        Image|endswith: '\\winget.exe'\n        TargetObject|startswith: '\\REGISTRY\\A\\'\n        TargetObject|endswith: '\\LocalState\\admin_settings'\n    condition: selection\nfalsepositives:\n    - The event doesn't contain information about the type of change. False positives are expected with legitimate changes\nlevel: low\n"},{"path":"registry\\registry_set\\registry_set_windows_defender_tamper.yml","content":"title: Disable Windows Defender Functionalities Via Registry Keys\nid: 0eb46774-f1ab-4a74-8238-1155855f2263\nrelated:\n    - id: a64e4198-c1c8-46a5-bc9c-324c86455fd4\n      type: obsolete\n    - id: fd115e64-97c7-491f-951c-fc8da7e042fa\n      type: obsolete\nstatus: test\ndescription: Detects when attackers or tools disable Windows Defender functionalities via the Windows registry\nreferences:\n    - https://thedfirreport.com/2021/10/18/icedid-to-xinglocker-ransomware-in-24-hours/\n    - https://gist.github.com/anadr/7465a9fde63d41341136949f14c21105\n    - https://admx.help/?Category=Windows_7_2008R2&Policy=Microsoft.Policies.WindowsDefender::SpyNetReporting\n    - https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/ransomware-hive-conti-avoslocker\n    - https://www.tenforums.com/tutorials/32236-enable-disable-microsoft-defender-pua-protection-windows-10-a.html\n    - https://www.tenforums.com/tutorials/105533-enable-disable-windows-defender-exploit-protection-settings.html\n    - https://www.tenforums.com/tutorials/123792-turn-off-tamper-protection-microsoft-defender-antivirus.html\n    - https://securelist.com/key-group-ransomware-samples-and-telegram-schemes/114025/\nauthor: AlertIQ, Ján Trenčanský, frack113, Nasreddine Bencherchali, Swachchhanda Shrawan Poudel\ndate: 2022-08-01\nmodified: 2024-10-07\ntags:\n    - attack.defense-evasion\n    - attack.t1562.001\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection_main:\n        TargetObject|contains:\n            - '\\SOFTWARE\\Microsoft\\Windows Defender\\'\n            - '\\SOFTWARE\\Policies\\Microsoft\\Windows Defender Security Center\\'\n            - '\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\'\n    selection_dword_1:\n        TargetObject|endswith:\n            - '\\DisableAntiSpyware'\n            - '\\DisableAntiVirus'\n            - '\\DisableBehaviorMonitoring'\n            - '\\DisableBlockAtFirstSeen'\n            - '\\DisableEnhancedNotifications'\n            - '\\DisableIntrusionPreventionSystem'\n            - '\\DisableIOAVProtection'\n            - '\\DisableOnAccessProtection'\n            - '\\DisableRealtimeMonitoring'\n            - '\\DisableScanOnRealtimeEnable'\n            - '\\DisableScriptScanning'\n        Details: 'DWORD (0x00000001)'\n    selection_dword_0:\n        TargetObject|endswith:\n            - '\\DisallowExploitProtectionOverride'\n            - '\\Features\\TamperProtection'\n            - '\\MpEngine\\MpEnablePus'\n            - '\\PUAProtection'\n            - '\\Signature Update\\ForceUpdateFromMU'\n            - '\\SpyNet\\SpynetReporting'\n            - '\\SpyNet\\SubmitSamplesConsent'\n            - '\\Windows Defender Exploit Guard\\Controlled Folder Access\\EnableControlledFolderAccess'\n        Details: 'DWORD (0x00000000)'\n    filter_optional_symantec:\n        Image|startswith: 'C:\\Program Files\\Symantec\\Symantec Endpoint Protection\\'\n        Image|endswith: '\\sepWscSvc64.exe'\n    condition: selection_main and 1 of selection_dword_* and not 1 of filter_optional_*\nfalsepositives:\n    - Administrator actions via the Windows Defender interface\n    - Third party Antivirus\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_wdigest_enable_uselogoncredential.yml","content":"title: Wdigest Enable UseLogonCredential\nid: d6a9b252-c666-4de6-8806-5561bbbd3bdc\nstatus: test\ndescription: Detects potential malicious modification of the property value of UseLogonCredential from HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest to enable clear-text credentials\nreferences:\n    - https://threathunterplaybook.com/hunts/windows/190510-RegModWDigestDowngrade/notebook.html\n    - https://support.microsoft.com/en-us/topic/microsoft-security-advisory-update-to-improve-credentials-protection-and-management-may-13-2014-93434251-04ac-b7f3-52aa-9f951c14b649\n    - https://github.com/redcanaryco/atomic-red-team/blob/73fcfa1d4863f6a4e17f90e54401de6e30a312bb/atomics/T1112/T1112.md#atomic-test-3---modify-registry-to-store-logon-credentials\nauthor: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)\ndate: 2019-09-12\nmodified: 2023-08-17\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: 'WDigest\\UseLogonCredential'\n        Details: DWORD (0x00000001)\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_wab_dllpath_reg_change.yml","content":"title: Execution DLL of Choice Using WAB.EXE\nid: fc014922-5def-4da9-a0fc-28c973f41bfb\nstatus: test\ndescription: This rule detects that the path to the DLL written in the registry is different from the default one. Launched WAB.exe tries to load the DLL from Registry.\nreferences:\n    - https://github.com/LOLBAS-Project/LOLBAS/blob/8283d8d91552213ded165fd36deb6cb9534cb443/yml/OSBinaries/Wab.yml\n    - https://twitter.com/Hexacorn/status/991447379864932352\n    - http://www.hexacorn.com/blog/2018/05/01/wab-exe-as-a-lolbin/\nauthor: oscd.community, Natalia Shornikova\ndate: 2020-10-13\nmodified: 2023-08-17\ntags:\n    - attack.defense-evasion\n    - attack.t1218\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: '\\Software\\Microsoft\\WAB\\DLLPath'\n    filter:\n        Details: '%CommonProgramFiles%\\System\\wab32.dll'\n    condition: selection and not filter\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_vbs_payload_stored.yml","content":"title: VBScript Payload Stored in Registry\nid: 46490193-1b22-4c29-bdd6-5bf63907216f\nstatus: test\ndescription: Detects VBScript content stored into registry keys as seen being used by UNC2452 group\nreferences:\n    - https://www.microsoft.com/security/blog/2021/03/04/goldmax-goldfinder-sibot-analyzing-nobelium-malware/\nauthor: Florian Roth (Nextron Systems)\ndate: 2021-03-05\nmodified: 2023-08-17\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547.001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: 'Software\\Microsoft\\Windows\\CurrentVersion'\n        Details|contains:\n            - 'vbscript:'\n            - 'jscript:'\n            - 'mshtml,'\n            - 'RunHTMLApplication'\n            - 'Execute('\n            - 'CreateObject'\n            - 'window.close'\n    filter:\n        TargetObject|contains: 'Software\\Microsoft\\Windows\\CurrentVersion\\Run'\n    filter_dotnet:\n        Image|endswith: '\\msiexec.exe'\n        TargetObject|contains: '\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Installer\\UserData\\'\n        Details|contains:\n            - '\\Microsoft.NET\\Primary Interop Assemblies\\Microsoft.mshtml.dll'\n            - '<\\Microsoft.mshtml,fileVersion='\n            - '_mshtml_dll_'\n            - '<\\Microsoft.mshtml,culture='\n    condition: selection and not 1 of filter*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_uac_disable_secure_desktop_prompt.yml","content":"title: UAC Secure Desktop Prompt Disabled\nid: 0d7ceeef-3539-4392-8953-3dc664912714\nrelated:\n    - id: c5f6a85d-b647-40f7-bbad-c10b66bab038\n      type: similar\n    - id: 48437c39-9e5f-47fb-af95-3d663c3f2919\n      type: similar\nstatus: test\ndescription: |\n    Detects when an attacker tries to change User Account Control (UAC) elevation request destination via the \"PromptOnSecureDesktop\" value.\n    The \"PromptOnSecureDesktop\" setting specifically determines whether UAC prompts are displayed on the secure desktop. The secure desktop is a separate desktop environment that's isolated from other processes running on the system. It's designed to prevent malicious software from intercepting or tampering with UAC prompts.\n    When \"PromptOnSecureDesktop\" is set to 0, UAC prompts are displayed on the user's current desktop instead of the secure desktop. This reduces the level of security because it potentially exposes the prompts to manipulation by malicious software.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/7e11e9b79583545f208a6dc3fa062f2ed443d999/atomics/T1548.002/T1548.002.md\nauthor: frack113\ndate: 2024-05-10\ntags:\n    - attack.privilege-escalation\n    - attack.defense-evasion\n    - attack.t1548.002\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\PromptOnSecureDesktop'\n        Details: 'DWORD (0x00000000)'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_uac_disable_notification.yml","content":"title: UAC Notification Disabled\nid: c5f6a85d-b647-40f7-bbad-c10b66bab038\nrelated:\n    - id: 0d7ceeef-3539-4392-8953-3dc664912714\n      type: similar\n    - id: 48437c39-9e5f-47fb-af95-3d663c3f2919\n      type: similar\nstatus: test\ndescription: |\n    Detects when an attacker tries to disable User Account Control (UAC) notification by tampering with the \"UACDisableNotify\" value.\n    UAC is a critical security feature in Windows that prevents unauthorized changes to the operating system. It prompts the user for permission or an administrator password before allowing actions that could affect the system's operation or change settings that affect other users.\n    When \"UACDisableNotify\" is set to 1, UAC prompts are suppressed.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/7e11e9b79583545f208a6dc3fa062f2ed443d999/atomics/T1548.002/T1548.002.md\n    - https://securityintelligence.com/x-force/x-force-hive0129-targeting-financial-institutions-latam-banking-trojan/\nauthor: frack113, Nasreddine Bencherchali (Nextron Systems)\ndate: 2024-05-10\ntags:\n    - attack.privilege-escalation\n    - attack.defense-evasion\n    - attack.t1548.002\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\Microsoft\\Security Center\\UACDisableNotify'\n        Details: 'DWORD (0x00000001)'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_uac_disable.yml","content":"title: UAC Disabled\nid: 48437c39-9e5f-47fb-af95-3d663c3f2919\nrelated:\n    - id: c5f6a85d-b647-40f7-bbad-c10b66bab038\n      type: similar\n    - id: 0d7ceeef-3539-4392-8953-3dc664912714\n      type: similar\nstatus: stable\ndescription: |\n    Detects when an attacker tries to disable User Account Control (UAC) by setting the registry value \"EnableLUA\" to 0.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/7e11e9b79583545f208a6dc3fa062f2ed443d999/atomics/T1548.002/T1548.002.md\nauthor: frack113\ndate: 2022-01-05\nmodified: 2024-05-10\ntags:\n    - attack.privilege-escalation\n    - attack.defense-evasion\n    - attack.t1548.002\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\EnableLUA'\n        Details: 'DWORD (0x00000000)'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_uac_bypass_wmp.yml","content":"title: UAC Bypass Using Windows Media Player - Registry\nid: 5f9db380-ea57-4d1e-beab-8a2d33397e93\nstatus: test\ndescription: Detects the pattern of UAC Bypass using Windows Media Player osksupport.dll (UACMe 32)\nreferences:\n    - https://github.com/hfiref0x/UACME\nauthor: Christian Burkard (Nextron Systems)\ndate: 2021-08-23\nmodified: 2023-08-17\ntags:\n    - attack.defense-evasion\n    - attack.privilege-escalation\n    - attack.t1548.002\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: '\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Compatibility Assistant\\Store\\C:\\Program Files\\Windows Media Player\\osk.exe'\n        Details: 'Binary Data'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_uac_bypass_winsat.yml","content":"title: UAC Bypass Abusing Winsat Path Parsing - Registry\nid: 6597be7b-ac61-4ac8-bef4-d3ec88174853\nstatus: test\ndescription: Detects the pattern of UAC Bypass using a path parsing issue in winsat.exe (UACMe 52)\nreferences:\n    - https://github.com/hfiref0x/UACME\nauthor: Christian Burkard (Nextron Systems)\ndate: 2021-08-30\nmodified: 2023-08-17\ntags:\n    - attack.defense-evasion\n    - attack.privilege-escalation\n    - attack.t1548.002\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\Root\\InventoryApplicationFile\\winsat.exe|'\n        TargetObject|endswith: '\\LowerCaseLongPath'\n        Details|startswith: 'c:\\users\\'\n        Details|endswith: '\\appdata\\local\\temp\\system32\\winsat.exe'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_uac_bypass_sdclt.yml","content":"title: UAC Bypass via Sdclt\nid: 5b872a46-3b90-45c1-8419-f675db8053aa\nstatus: test\ndescription: Detects the pattern of UAC Bypass using registry key manipulation of sdclt.exe (e.g. UACMe 53)\nreferences:\n    - https://enigma0x3.net/2017/03/17/fileless-uac-bypass-using-sdclt-exe/\n    - https://github.com/hfiref0x/UACME\nauthor: Omer Yampel, Christian Burkard (Nextron Systems)\ndate: 2017-03-17\nmodified: 2023-08-17\ntags:\n    - attack.defense-evasion\n    - attack.privilege-escalation\n    - attack.t1548.002\n    - car.2019-04-001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection1:\n        TargetObject|endswith: 'Software\\Classes\\exefile\\shell\\runas\\command\\isolatedCommand'\n    selection2:\n        TargetObject|endswith: 'Software\\Classes\\Folder\\shell\\open\\command\\SymbolicLinkValue'\n        Details|re: '-1[0-9]{3}\\\\Software\\\\Classes\\\\'\n    condition: 1 of selection*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_uac_bypass_eventvwr.yml","content":"title: UAC Bypass via Event Viewer\nid: 7c81fec3-1c1d-43b0-996a-46753041b1b6\nstatus: test\ndescription: Detects UAC bypass method using Windows event viewer\nreferences:\n    - https://enigma0x3.net/2016/08/15/fileless-uac-bypass-using-eventvwr-exe-and-registry-hijacking/\n    - https://www.hybrid-analysis.com/sample/e122bc8bf291f15cab182a5d2d27b8db1e7019e4e96bb5cdbd1dfe7446f3f51f?environmentId=100\nauthor: Florian Roth (Nextron Systems)\ndate: 2017-03-19\nmodified: 2023-09-28\ntags:\n    - attack.defense-evasion\n    - attack.privilege-escalation\n    - attack.t1548.002\n    - car.2019-04-001\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection:\n        TargetObject|endswith: '\\mscfile\\shell\\open\\command'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_turn_on_dev_features.yml","content":"title: Potential Signing Bypass Via Windows Developer Features - Registry\nid: b110ebaf-697f-4da1-afd5-b536fa27a2c1\nrelated:\n    - id: a383dec4-deec-4e6e-913b-ed9249670848\n      type: similar\nstatus: test\ndescription: Detects when the enablement of developer features such as \"Developer Mode\" or \"Application Sideloading\". Which allows the user to install untrusted packages.\nreferences:\n    - https://twitter.com/malmoeb/status/1560536653709598721\n    - https://www.sentinelone.com/labs/inside-malicious-windows-apps-for-malware-deployment/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-01-12\nmodified: 2023-08-17\ntags:\n    - attack.defense-evasion\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains:\n            - '\\Microsoft\\Windows\\CurrentVersion\\AppModelUnlock'\n            - '\\Policies\\Microsoft\\Windows\\Appx\\'\n        TargetObject|endswith:\n            - '\\AllowAllTrustedApps'\n            - '\\AllowDevelopmentWithoutDevLicense'\n        Details: 'DWORD (0x00000001)'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_treatas_persistence.yml","content":"title: COM Hijacking via TreatAs\nid: dc5c24af-6995-49b2-86eb-a9ff62199e82\nstatus: test\ndescription: Detect modification of TreatAs key to enable \"rundll32.exe -sta\" command\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/40b77d63808dd4f4eafb83949805636735a1fd15/atomics/T1546.015/T1546.015.md\n    - https://www.youtube.com/watch?v=3gz1QmiMhss&t=1251s\nauthor: frack113\ndate: 2022-08-28\nmodified: 2025-07-11\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1546.015\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: 'TreatAs\\(Default)'\n    filter_office:\n        Image|startswith: 'C:\\Program Files\\Common Files\\Microsoft Shared\\ClickToRun\\'\n        Image|endswith: '\\OfficeClickToRun.exe'\n    filter_office2:\n        Image:\n            - 'C:\\Program Files\\Microsoft Office\\root\\integration\\integrator.exe'\n            - 'C:\\Program Files (x86)\\Microsoft Office\\root\\integration\\integrator.exe'\n    filter_svchost:\n        # Example of target object by svchost\n        # TargetObject: HKLM\\SOFTWARE\\Microsoft\\MsixRegistryCompatibility\\Package\\Microsoft.Paint_11.2208.6.0_x64__8wekyb3d8bbwe\\User\\SOFTWARE\\Classes\\CLSID\\{0003000A-0000-0000-C000-000000000046}\\TreatAs\\(Default)\n        # TargetObject: HKU\\S-1-5-21-1000000000-000000000-000000000-0000_Classes\\CLSID\\{0003000A-0000-0000-C000-000000000046}\\TreatAs\\(Default)\n        Image: 'C:\\Windows\\system32\\svchost.exe'\n    filter_misexec:\n        # This FP has been seen during installation/updates\n        Image:\n            - 'C:\\Windows\\system32\\msiexec.exe'\n            - 'C:\\Windows\\SysWOW64\\msiexec.exe'\n    condition: selection and not 1 of filter_*\nfalsepositives:\n    - Legitimate use\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_tls_protocol_old_version_enabled.yml","content":"title: Old TLS1.0/TLS1.1 Protocol Version Enabled\nid: 439957a7-ad86-4a8f-9705-a28131c6821b\nstatus: test\ndescription: Detects applications or users re-enabling old TLS versions by setting the \"Enabled\" value to \"1\" for the \"Protocols\" registry key.\nreferences:\n    - https://techcommunity.microsoft.com/t5/windows-it-pro-blog/tls-1-0-and-tls-1-1-soon-to-be-disabled-in-windows/ba-p/3887947\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-09-05\ntags:\n    - attack.defense-evasion\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains:\n            - '\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.0\\'\n            - '\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.1\\'\n        TargetObject|endswith: '\\Enabled'\n        Details: 'DWORD (0x00000001)'\n    condition: selection\nfalsepositives:\n    - Legitimate enabling of the old tls versions due to incompatibility\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_timeproviders_dllname.yml","content":"title: New TimeProviders Registered With Uncommon DLL Name\nid: e88a6ddc-74f7-463b-9b26-f69fc0d2ce85\nstatus: test\ndescription: |\n    Detects processes setting a new DLL in DllName in under HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\W32Time\\TimeProvider.\n    Adversaries may abuse time providers to execute DLLs when the system boots.\n    The Windows Time service (W32Time) enables time synchronization across and within domains.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1547.003/T1547.003.md\nauthor: frack113\ndate: 2022-06-19\nmodified: 2024-03-26\ntags:\n    - attack.persistence\n    - attack.privilege-escalation\n    - attack.t1547.003\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\Services\\W32Time\\TimeProviders'\n        TargetObject|endswith: '\\DllName'\n    filter_main_w32time:\n        Details:\n            - '%SystemRoot%\\System32\\vmictimeprovider.dll'\n            - '%systemroot%\\system32\\w32time.dll'\n            - 'C:\\Windows\\SYSTEM32\\w32time.DLL'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_terminal_server_tampering.yml","content":"title: RDP Sensitive Settings Changed\nid: 3f6b7b62-61aa-45db-96bd-9c31b36b653c\nrelated:\n    - id: 171b67e1-74b4-460e-8d55-b331f3e32d67\n      type: obsolete\n    - id: 41904ebe-d56c-4904-b9ad-7a77bdf154b3\n      type: obsolete\n    - id: a2863fbc-d5cb-48d5-83fb-d976d4b1743b\n      type: similar\nstatus: test\ndescription: |\n    Detects tampering of RDP Terminal Service/Server sensitive settings.\n    Such as allowing unauthorized users access to a system via the 'fAllowUnsolicited' or enabling RDP via 'fDenyTSConnections', etc.\n\n    Below is a list of registry keys/values that are monitored by this rule:\n\n    - Shadow: Used to enable Remote Desktop shadowing, which allows an administrator to view or control a user's session.\n    - DisableRemoteDesktopAntiAlias: Disables anti-aliasing for remote desktop sessions.\n    - DisableSecuritySettings: Disables certain security settings for Remote Desktop connections.\n    - fAllowUnsolicited: Allows unsolicited remote assistance offers.\n    - fAllowUnsolicitedFullControl: Allows unsolicited remote assistance offers with full control.\n    - InitialProgram: Specifies a program to run automatically when a user logs on to a remote computer.\n    - ServiceDll: Used in RDP hijacking techniques to specify a custom DLL to be loaded by the Terminal Services service.\n    - SecurityLayer: Specifies the security layer used for RDP connections.\nreferences:\n    - http://etutorials.org/Microsoft+Products/microsoft+windows+server+2003+terminal+services/Chapter+6+Registry/Registry+Keys+for+Terminal+Services/ # Contains description for most of the keys mentioned here (check it out if you want more information)\n    - http://woshub.com/rds-shadow-how-to-connect-to-a-user-session-in-windows-server-2012-r2/ # Related to the Shadow RPD technique\n    - https://admx.help/HKLM/SOFTWARE/Policies/Microsoft/Windows%20NT/Terminal%20Services # Contains description for most of the keys mentioned here (check it out if you want more information)\n    - https://bazaar.abuse.ch/sample/6f3aa9362d72e806490a8abce245331030d1ab5ac77e400dd475748236a6cc81/\n    - https://blog.sekoia.io/darkgate-internals/\n    - https://blog.talosintelligence.com/understanding-the-phobos-affiliate-structure/\n    - https://github.com/redcanaryco/atomic-red-team/blob/02c7d02fe1f1feb0fc7944550408ea8224273994/atomics/T1112/T1112.md#atomic-test-63---disable-remote-desktop-anti-alias-setting-through-registry\n    - https://github.com/redcanaryco/atomic-red-team/blob/02c7d02fe1f1feb0fc7944550408ea8224273994/atomics/T1112/T1112.md#atomic-test-64---disable-remote-desktop-security-settings-through-registry\n    - https://github.com/redcanaryco/atomic-red-team/blob/dd526047b8c399c312fee47d1e6fb531164da54d/atomics/T1112/T1112.yaml#L790\n    - https://learn.microsoft.com/en-us/windows-hardware/customize/desktop/unattend/microsoft-windows-terminalservices-rdp-winstationextensions-securitylayer\n    - https://threathunterplaybook.com/hunts/windows/190407-RegModEnableRDPConnections/notebook.html\n    - https://twitter.com/SagieSec/status/1469001618863624194?t=HRf0eA0W1YYzkTSHb-Ky1A&s=03 # Related to the Shadow RPD technique\n    - https://web.archive.org/web/20200929062532/https://blog.menasec.net/2019/02/threat-hunting-rdp-hijacking-via.html # Related to RDP hijacking via the \"ServiceDll\" key\n    - https://www.trendmicro.com/en_us/research/25/i/unmasking-the-gentlemen-ransomware.html\nauthor: Samir Bousseaden, David ANDRE, Roberto Rodriguez @Cyb3rWard0g, Nasreddine Bencherchali\ndate: 2022-08-06\nmodified: 2025-11-22\ntags:\n    - attack.defense-evasion\n    - attack.persistence\n    - attack.t1112\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_shadow:\n        TargetObject|contains:\n            - '\\Control\\Terminal Server\\'\n            - '\\Windows NT\\Terminal Services\\'\n        TargetObject|endswith: '\\Shadow'\n        Details:\n            - 'DWORD (0x00000001)' # Full Control with user’s permission\n            - 'DWORD (0x00000002)' # Full Control without user’s permission\n            - 'DWORD (0x00000003)' # View Session with user’s permission\n            - 'DWORD (0x00000004)' # View Session without user’s permission\n    selection_terminal_services_key:\n        TargetObject|contains:\n            - '\\Control\\Terminal Server\\'\n            - '\\Windows NT\\Terminal Services\\'\n        TargetObject|endswith:\n            - '\\DisableRemoteDesktopAntiAlias' # Disable anti-aliasing for remote desktop (DarkGate malware)\n            - '\\DisableSecuritySettings' # Disable security settings, allowing access to programs/entire desktop (DarkGate malware)\n            - '\\fAllowUnsolicited' # Allow unsolicited remote assistance offers\n            - '\\fAllowUnsolicitedFullControl'\n        Details: 'DWORD (0x00000001)'\n    selection_tamper_only:\n        # Any changes to these keys should be suspicious and looked at\n        TargetObject|contains:\n            - '\\Control\\Terminal Server\\InitialProgram' # This value can be set to specify a program to run automatically when a user logs on to a remote computer.\n            - '\\Control\\Terminal Server\\WinStations\\RDP-Tcp\\InitialProgram' # This value can be set to specify a program to run automatically when a user logs on to a remote computer.\n            - '\\services\\TermService\\Parameters\\ServiceDll' # RDP hijacking\n            - '\\Terminal Server\\WinStations\\RDP-Tcp\\SecurityLayer'\n            - '\\Windows NT\\Terminal Services\\InitialProgram' # This value can be set to specify a program to run automatically when a user logs on to a remote computer.\n    filter_main_securitylayer_tls:\n        TargetObject|endswith: '\\SecurityLayer'\n        Details: 'DWORD (0x00000002)' # TLS Enabled\n    condition: (selection_shadow or selection_terminal_services_key or selection_tamper_only) and not 1 of filter_main_*\nfalsepositives:\n    - Some of the keys mentioned here could be modified by an administrator while setting group policy (it should be investigated either way)\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_terminal_server_suspicious.yml","content":"title: RDP Sensitive Settings Changed to Zero\nid: a2863fbc-d5cb-48d5-83fb-d976d4b1743b\nrelated:\n    - id: 3f6b7b62-61aa-45db-96bd-9c31b36b653c\n      type: similar\n    - id: 4b8f6d3a-9c5e-4f2a-a7d8-6b9c3e5f2a8d\n      type: similar\nstatus: test\ndescription: |\n    Detects tampering of RDP Terminal Service/Server sensitive settings.\n    Such as allowing unauthorized users access to a system via the 'fAllowUnsolicited' or enabling RDP via 'fDenyTSConnections', etc.\nreferences:\n    - https://web.archive.org/web/20200929062532/https://blog.menasec.net/2019/02/threat-hunting-rdp-hijacking-via.html # Related to RDP hijacking via the \"ServiceDll\" key\n    - http://woshub.com/rds-shadow-how-to-connect-to-a-user-session-in-windows-server-2012-r2/ # Related to the Shadow RPD technique\n    - https://twitter.com/SagieSec/status/1469001618863624194?t=HRf0eA0W1YYzkTSHb-Ky1A&s=03 # Related to the Shadow RPD technique\n    - https://threathunterplaybook.com/hunts/windows/190407-RegModEnableRDPConnections/notebook.html\n    - https://bazaar.abuse.ch/sample/6f3aa9362d72e806490a8abce245331030d1ab5ac77e400dd475748236a6cc81/\n    - http://etutorials.org/Microsoft+Products/microsoft+windows+server+2003+terminal+services/Chapter+6+Registry/Registry+Keys+for+Terminal+Services/ # Contain description for most of the keys mentioned here (check it out if you want more information\n    - https://admx.help/HKLM/SOFTWARE/Policies/Microsoft/Windows%20NT/Terminal%20Services # Contain description for most of the keys mentioned here (check it out if you want more information)\nauthor: Samir Bousseaden, David ANDRE, Roberto Rodriguez @Cyb3rWard0g, Nasreddine Bencherchali\ndate: 2022-09-29\nmodified: 2022-11-26\ntags:\n    - attack.defense-evasion\n    - attack.persistence\n    - attack.t1112\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith:\n            - '\\fDenyTSConnections' # Specifies whether Remote Desktop connections are enabled - When set to zero RDP is enabled\n            - '\\fSingleSessionPerUser' # When changed to 0 it allows multiple RDP sessions\n            - '\\UserAuthentication' # Specifies that Network-Level user authentication is not required before the remote desktop connection is established\n        Details: 'DWORD (0x00000000)'\n    condition: selection\nfalsepositives:\n    - Some of the keys mentioned here could be modified by an administrator while setting group policy (it should be investigated either way)\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_telemetry_persistence.yml","content":"title: Potential Registry Persistence Attempt Via Windows Telemetry\nid: 73a883d0-0348-4be4-a8d8-51031c2564f8\nrelated:\n    - id: 4e8d5fd3-c959-441f-a941-f73d0cdcdca5\n      type: obsolete\nstatus: test\ndescription: |\n    Detects potential persistence behavior using the windows telemetry registry key.\n    Windows telemetry makes use of the binary CompatTelRunner.exe to run a variety of commands and perform the actual telemetry collections.\n    This binary was created to be easily extensible, and to that end, it relies on the registry to instruct on which commands to run.\n    The problem is, it will run any arbitrary command without restriction of location or type.\nreferences:\n    - https://www.trustedsec.com/blog/abusing-windows-telemetry-for-persistence/\nauthor: Lednyov Alexey, oscd.community, Sreeman\ndate: 2020-10-16\nmodified: 2023-08-17\ntags:\n    - attack.privilege-escalation\n    - attack.execution\n    - attack.persistence\n    - attack.t1053.005\nlogsource:\n    category: registry_set\n    product: windows\n    definition: 'Requirements: Sysmon config that monitors \\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\TelemetryController subkey of the HKLM hives'\ndetection:\n    selection:\n        TargetObject|contains: '\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\TelemetryController\\'\n        TargetObject|endswith: '\\Command'\n        Details|contains:\n            - '.bat'\n            - '.bin'\n            - '.cmd'\n            - '.dat'\n            - '.dll'\n            - '.exe'\n            - '.hta'\n            - '.jar'\n            - '.js'\n            - '.msi'\n            - '.ps'\n            - '.sh'\n            - '.vb'\n    filter_main_generic:\n        Details|contains:\n            - '\\system32\\CompatTelRunner.exe'\n            - '\\system32\\DeviceCensus.exe'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_taskcache_entry.yml","content":"title: Scheduled TaskCache Change by Uncommon Program\nid: 4720b7df-40c3-48fd-bbdf-fd4b3c464f0d\nstatus: test\ndescription: Monitor the creation of a new key under 'TaskCache' when a new scheduled task is registered by a process that is not svchost.exe, which is suspicious\nreferences:\n    - https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/\n    - https://labs.f-secure.com/blog/scheduled-task-tampering/\nauthor: Syed Hasan (@syedhasan009)\ndate: 2021-06-18\nmodified: 2025-10-22\ntags:\n    - attack.privilege-escalation\n    - attack.execution\n    - attack.persistence\n    - attack.t1053\n    - attack.t1053.005\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: 'SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\'\n    filter_main_empty:\n        Details: '(Empty)'\n    filter_main_null:\n        Details: null\n    filter_main_other:\n        TargetObject|contains:\n            - 'Microsoft\\Windows\\UpdateOrchestrator'\n            - 'Microsoft\\Windows\\SoftwareProtectionPlatform\\SvcRestartTask\\Index'\n            - 'Microsoft\\Windows\\Flighting\\OneSettings\\RefreshCache\\Index'\n    filter_main_mousocoreworker:\n        Image|endswith: 'C:\\Windows\\System32\\MoUsoCoreWorker.exe'\n    filter_main_services:\n        Image|endswith: 'C:\\Windows\\System32\\services.exe'\n    filter_main_tiworker:\n        Image|startswith: 'C:\\Windows\\'\n        Image|endswith: '\\TiWorker.exe'\n    filter_main_svchost:\n        Image: 'C:\\WINDOWS\\system32\\svchost.exe'\n    filter_main_ngen:\n        Image|startswith: 'C:\\Windows\\Microsoft.NET\\Framework' # \\Framework\\ and \\Framework64\\\n        Image|endswith: '\\ngen.exe'\n        TargetObject|contains:\n            - '\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tasks\\{B66B135D-DA06-4FC4-95F8-7458E1D10129}'\n            - '\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tree\\Microsoft\\Windows\\.NET Framework\\.NET Framework NGEN'\n    filter_main_office:\n        Image:\n            - 'C:\\Program Files\\Microsoft Office\\root\\Integration\\Integrator.exe'\n            - 'C:\\Program Files (x86)\\Microsoft Office\\root\\Integration\\Integrator.exe'\n            - 'C:\\Program Files\\Common Files\\microsoft shared\\ClickToRun\\OfficeC2RClient.exe'\n            - 'C:\\Program Files (x86)\\Common Files\\microsoft shared\\ClickToRun\\OfficeC2RClient.exe'\n    filter_main_msiexec:\n        Image: 'C:\\Windows\\System32\\msiexec.exe'\n    filter_main_explorer:\n        Image: 'C:\\Windows\\explorer.exe'\n        TargetObject|contains: '\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tree\\Microsoft\\Windows\\PLA\\Server Manager Performance Monitor\\'\n    filter_main_system:\n        Image: 'System'\n    filter_main_runtimebroker:\n        Image: 'C:\\Windows\\System32\\RuntimeBroker.exe'\n    filter_optional_dropbox_updater:\n        Image:\n            - 'C:\\Program Files (x86)\\Dropbox\\Update\\DropboxUpdate.exe'\n            - 'C:\\Program Files\\Dropbox\\Update\\DropboxUpdate.exe'\n    filter_optional_edge:\n        Image|endswith:\n            - 'C:\\Program Files (x86)\\Microsoft\\EdgeUpdate\\MicrosoftEdgeUpdate.exe'\n            - 'C:\\Program Files\\Microsoft\\EdgeUpdate\\MicrosoftEdgeUpdate.exe'\n    filter_optional_onedrive:\n        Image|endswith:\n            - 'C:\\Program Files (x86)\\Microsoft OneDrive\\OneDrive.exe'\n            - 'C:\\Program Files\\Microsoft OneDrive\\OneDrive.exe'\n    condition: selection and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_system_lsa_nolmhash.yml","content":"title: Enable LM Hash Storage\nid: c420410f-c2d8-4010-856b-dffe21866437\nrelated:\n    - id: 98dedfdd-8333-49d4-9f23-d7018cccae53 # process_creation\n      type: similar\nstatus: test\ndescription: |\n    Detects changes to the \"NoLMHash\" registry value in order to allow Windows to store LM Hashes.\n    By setting this registry value to \"0\" (DWORD), Windows will be allowed to store a LAN manager hash of your password in Active Directory and local SAM databases.\nreferences:\n    - https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-347a\n    - https://learn.microsoft.com/en-us/troubleshoot/windows-server/windows-security/prevent-windows-store-lm-hash-password\n    - https://www.sans.org/blog/protecting-privileged-domain-accounts-lm-hashes-the-good-the-bad-and-the-ugly/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-12-15\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection:\n        TargetObject|endswith: 'System\\CurrentControlSet\\Control\\Lsa\\NoLMHash'\n        Details: 'DWORD (0x00000000)'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_susp_wfp_filter_added.yml","content":"title: WFP Filter Added via Registry\nid: 1f1d8209-636e-4c6c-a137-781cca8b82f9\nstatus: experimental\ndescription: |\n    Detects registry modifications that add Windows Filtering Platform (WFP) filters, which may be used to block security tools and EDR agents from reporting events.\nreferences:\n    - https://github.com/netero1010/EDRSilencer/blob/0e73a7037ec65c52894d8208e6f605a7da0a34a6/EDRSilencer.c\n    - https://www.huntress.com/blog/silencing-the-edr-silencers\n    - https://www.trendmicro.com/en_us/research/24/j/edrsilencer-disrupting-endpoint-security-solutions.html\nauthor: Frack113\ndate: 2025-10-23\ntags:\n    - attack.defense-evasion\n    - attack.execution\n    - attack.t1562\n    - attack.t1569.002\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\BFE\\Parameters\\Policy\\Persistent\\Filter\\'\n    filter_main_svchost:\n        Image:\n            - 'C:\\Windows\\System32\\svchost.exe'\n            - 'C:\\Windows\\SysWOW64\\svchost.exe'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_susp_user_shell_folders.yml","content":"title: Modify User Shell Folders Startup Value\nid: 9c226817-8dc9-46c2-a58d-66655aafd7dc\nstatus: test\ndescription: Detect modification of the startup key to a path where a payload could be stored to be launched during startup\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/9e5b12c4912c07562aec7500447b11fa3e17e254/atomics/T1547.001/T1547.001.md\nauthor: frack113\ndate: 2022-10-01\nmodified: 2023-08-17\ntags:\n    - attack.persistence\n    - attack.privilege-escalation\n    - attack.t1547.001\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection:\n        TargetObject|contains: 'SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders'\n        TargetObject|endswith: 'Startup' # cover Common Startup and Startup\n        # can use Details|contains: path if get too many FP\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_susp_typedpaths_space_characters.yml","content":"title: Suspicious Space Characters in TypedPaths Registry Path - FileFix\nid: 8f2a5c3d-9e4b-4a7c-8d1f-2e5a6b9c3d7e\nrelated:\n    - id: 3ae9974a-eb09-4044-8e70-8980a50c12c8\n      type: similar\nstatus: experimental\ndescription: |\n    Detects the occurrence of numerous space characters in TypedPaths registry paths, which may indicate execution via phishing lures using file-fix techniques to hide malicious commands.\nreferences:\n    - https://expel.com/blog/cache-smuggling-when-a-picture-isnt-a-thousand-words/\n    - https://mrd0x.com/filefix-clickfix-alternative/\nauthor: Swachchhanda Shrawan Poudel (Nextron Systems)\ndate: 2025-11-04\ntags:\n    - attack.execution\n    - attack.t1204.004\n    - attack.defense-evasion\n    - attack.t1027.010\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_key:\n        TargetObject|endswith: '\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\TypedPaths\\url1'\n        Details|contains: '#'\n    selection_space_variation:\n        Details|contains:\n            - '            ' # En Quad (U+2000)\n            - '            ' # Em Quad (U+2001)\n            - '            ' # En Space (U+2002)\n            - '            ' # Em Space (U+2003)\n            - '            ' # Three-Per-Em Space (U+2004)\n            - '            ' # Four-Per-Em Space (U+2005)\n            - '            ' # Six-Per-Em Space (U+2006)\n            - '            ' # Figure Space (U+2007)\n            - '            ' # Punctuation Space (U+2008)\n            - '            ' # Thin Space (U+2009)\n            - '            ' # Hair Space (U+200A)\n            - '            ' # No-Break Space (U+00A0)\n            - '            ' # Normal space\n    condition: all of selection_*\nfalsepositives:\n    - Unlikely\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_susp_service_installed.yml","content":"title: Suspicious Service Installed\nid: f2485272-a156-4773-82d7-1d178bc4905b\nstatus: test\ndescription: |\n  Detects installation of NalDrv or PROCEXP152 services via registry-keys to non-system32 folders.\n  Both services are used in the tool Ghost-In-The-Logs (https://github.com/bats3c/Ghost-In-The-Logs), which uses KDU (https://github.com/hfiref0x/KDU)\nreferences:\n    - https://web.archive.org/web/20200419024230/https://blog.dylan.codes/evading-sysmon-and-windows-event-logging/\nauthor: xknow (@xknow_infosec), xorxes (@xor_xes)\ndate: 2019-04-08\nmodified: 2023-08-17\ntags:\n    - attack.t1562.001\n    - attack.defense-evasion\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject:\n            - 'HKLM\\System\\CurrentControlSet\\Services\\NalDrv\\ImagePath'\n            - 'HKLM\\System\\CurrentControlSet\\Services\\PROCEXP152\\ImagePath'\n    filter:\n        Image|endswith:\n            # Please add the full paths that you use in your environment to tighten the rule\n            - '\\procexp64.exe'\n            - '\\procexp.exe'\n            - '\\procmon64.exe'\n            - '\\procmon.exe'\n            - '\\handle.exe'\n            - '\\handle64.exe'\n        Details|contains: '\\WINDOWS\\system32\\Drivers\\PROCEXP152.SYS'\n    condition: selection and not filter\nfalsepositives:\n    - Other legimate tools using this service names and drivers. Note - clever attackers may easily bypass this detection by just renaming the services. Therefore just Medium-level and don't rely on it.\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_susp_run_key_img_folder.yml","content":"title: New RUN Key Pointing to Suspicious Folder\nid: 02ee49e2-e294-4d0f-9278-f5b3212fc588\nstatus: experimental\ndescription: Detects suspicious new RUN key element pointing to an executable in a suspicious folder\nreferences:\n    - https://www.fireeye.com/blog/threat-research/2018/08/fin7-pursuing-an-enigmatic-and-evasive-global-criminal-operation.html\n    - https://github.com/HackTricks-wiki/hacktricks/blob/e4c7b21b8f36c97c35b7c622732b38a189ce18f7/src/windows-hardening/windows-local-privilege-escalation/privilege-escalation-with-autorun-binaries.md\nauthor: Florian Roth (Nextron Systems), Markus Neis, Sander Wiebing, Swachchhanda Shrawan Poudel (Nextron Systems)\ndate: 2018-08-25\nmodified: 2025-10-06\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547.001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_target:\n        TargetObject|contains:\n            - '\\Software\\Microsoft\\Windows\\CurrentVersion\\Run'\n            - '\\Software\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Run'\n            - '\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run'\n    selection_suspicious_paths_1:\n        Details|contains:\n            - ':\\Perflogs'\n            - :\\ProgramData'\n            - ':\\Windows\\Temp'\n            - ':\\Temp'\n            - '\\AppData\\Local\\Temp'\n            - '\\AppData\\Roaming'\n            - ':\\$Recycle.bin'\n            - ':\\Users\\Default'\n            - ':\\Users\\public'\n            - '%temp%'\n            - '%tmp%'\n            - '%Public%'\n            - '%AppData%'\n    selection_suspicious_paths_user_1:\n        Details|contains: ':\\Users\\'\n    selection_suspicious_paths_user_2:\n        Details|contains:\n            - '\\Favorites'\n            - '\\Favourites'\n            - '\\Contacts'\n            - '\\Music'\n            - '\\Pictures'\n            - '\\Documents'\n            - '\\Photos'\n    filter_main_windows_update:\n        TargetObject|contains: '\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\'\n        Image|startswith: 'C:\\Windows\\SoftwareDistribution\\Download\\'\n        Details|contains|all:\n            - 'rundll32.exe '\n            - 'C:\\WINDOWS\\system32\\advpack.dll,DelNodeRunDLL32'\n        Details|contains:\n            - '\\AppData\\Local\\Temp\\'\n            - 'C:\\Windows\\Temp\\'\n    filter_optional_spotify:\n        Image|endswith:\n            - 'C:\\Program Files\\Spotify\\Spotify.exe'\n            - 'C:\\Program Files (x86)\\Spotify\\Spotify.exe'\n            - '\\AppData\\Roaming\\Spotify\\Spotify.exe'\n        TargetObject|endswith: 'SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\Spotify'\n        Details|endswith: 'Spotify.exe --autostart --minimized'\n    condition: selection_target and (selection_suspicious_paths_1 or (all of selection_suspicious_paths_user_* )) and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Software using weird folders for updates\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_susp_runmru_space_character.yml","content":"title: Suspicious Space Characters in RunMRU Registry Path - ClickFix\nid: 7a1b4c5e-8f3d-4b9a-7c2e-1f4a5b8c6d9e\nrelated:\n    - id: 3ae9974a-eb09-4044-8e70-8980a50c12c8\n      type: similar\nstatus: experimental\ndescription: |\n    Detects the occurrence of numerous space characters in RunMRU registry paths, which may indicate execution via phishing lures using clickfix techniques to hide malicious commands in the Windows Run dialog box from naked eyes.\nreferences:\n    - https://expel.com/blog/cache-smuggling-when-a-picture-isnt-a-thousand-words/\n    - https://github.com/JohnHammond/recaptcha-phish\nauthor: Swachchhanda Shrawan Poudel (Nextron Systems)\ndate: 2025-11-04\ntags:\n    - attack.execution\n    - attack.t1204.004\n    - attack.defense-evasion\n    - attack.t1027.010\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_key:\n        TargetObject|contains: '\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\RunMRU\\'\n        Details|contains: '#'\n    selection_space_variation:\n        Details|contains:\n            - '            ' # En Quad (U+2000)\n            - '            ' # Em Quad (U+2001)\n            - '            ' # En Space (U+2002)\n            - '            ' # Em Space (U+2003)\n            - '            ' # Three-Per-Em Space (U+2004)\n            - '            ' # Four-Per-Em Space (U+2005)\n            - '            ' # Six-Per-Em Space (U+2006)\n            - '            ' # Figure Space (U+2007)\n            - '            ' # Punctuation Space (U+2008)\n            - '            ' # Thin Space (U+2009)\n            - '            ' # Hair Space (U+200A)\n            - '            ' # No-Break Space (U+00A0)\n            - '            ' # Normal space\n    condition: all of selection_*\nfalsepositives:\n    - Unlikely\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_susp_reg_persist_explorer_run.yml","content":"title: Registry Persistence via Explorer Run Key\nid: b7916c2a-fa2f-4795-9477-32b731f70f11\nstatus: test\ndescription: Detects a possible persistence mechanism using RUN key for Windows Explorer and pointing to a suspicious folder\nreferences:\n    - https://researchcenter.paloaltonetworks.com/2018/07/unit42-upatre-continues-evolve-new-anti-analysis-techniques/\nauthor: Florian Roth (Nextron Systems), oscd.community\ndate: 2018-07-18\nmodified: 2023-12-11\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547.001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: '\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run'\n        Details|contains:\n            - ':\\$Recycle.bin\\'\n            - ':\\ProgramData\\'\n            - ':\\Temp\\'\n            - ':\\Users\\Default\\'\n            - ':\\Users\\Public\\'\n            - ':\\Windows\\Temp\\'\n            - '\\AppData\\Local\\Temp\\'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_susp_printer_driver.yml","content":"title: Suspicious Printer Driver Empty Manufacturer\nid: e0813366-0407-449a-9869-a2db1119dc41\nstatus: test\ndescription: Detects a suspicious printer driver installation with an empty Manufacturer value\nreferences:\n    - https://twitter.com/SBousseaden/status/1410545674773467140\nauthor: Florian Roth (Nextron Systems)\ndate: 2020-07-01\nmodified: 2023-08-17\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.privilege-escalation\n    - attack.t1574\n    - cve.2021-1675\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains|all:\n            - '\\Control\\Print\\Environments\\Windows x64\\Drivers'\n            - '\\Manufacturer'\n        Details: '(Empty)'\n    filter_cutepdf:\n        TargetObject|contains: '\\CutePDF Writer v4.0\\'\n    filter_vnc:\n        TargetObject|contains:\n            - '\\VNC Printer (PS)\\'\n            - '\\VNC Printer (UD)\\'\n    filter_pdf24:\n        TargetObject|contains: '\\Version-3\\PDF24\\'\n    condition: selection and not 1 of filter_*\nfalsepositives:\n    - Alerts on legitimate printer drivers that do not set any more details in the Manufacturer value\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_susp_pendingfilerenameoperations.yml","content":"title: Potential PendingFileRenameOperations Tampering\nid: 4eec988f-7bf0-49f1-8675-1e6a510b3a2a\nstatus: test\ndescription: |\n    Detect changes to the \"PendingFileRenameOperations\" registry key from uncommon or suspicious images locations to stage currently used files for rename or deletion after reboot.\nreferences:\n    - https://any.run/report/3ecd4763ffc944fdc67a9027e459cd4f448b1a8d1b36147977afaf86bbf2a261/64b0ba45-e7ce-423b-9a1d-5b4ea59521e6\n    - https://devblogs.microsoft.com/scripting/determine-pending-reboot-statuspowershell-style-part-1/\n    - https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-2000-server/cc960241(v=technet.10)?redirectedfrom=MSDN\n    - https://www.trendmicro.com/en_us/research/21/j/purplefox-adds-new-backdoor-that-uses-websockets.html\n    - https://www.trendmicro.com/en_us/research/19/i/purple-fox-fileless-malware-with-rookit-component-delivered-by-rig-exploit-kit-now-abuses-powershell.html\nauthor: frack113\ndate: 2023-01-27\nmodified: 2025-10-07\ntags:\n    - attack.defense-evasion\n    - attack.t1036.003\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_main:\n        TargetObject|contains: '\\CurrentControlSet\\Control\\Session Manager\\PendingFileRenameOperations'\n    selection_susp_paths:\n        Image|contains: '\\Users\\Public\\'\n            # - '\\AppData\\Local\\Temp\\'  # Commented out as it's used by legitimate installers\n    selection_susp_images:\n        Image|endswith:\n            - '\\reg.exe'\n            - '\\regedit.exe'\n    condition: selection_main and 1 of selection_susp_*\nfalsepositives:\n    - Installers and updaters may set currently in use files for rename or deletion after a reboot.\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_susp_keyboard_layout_load.yml","content":"title: Suspicious Keyboard Layout Load\nid: 34aa0252-6039-40ff-951f-939fd6ce47d8\nstatus: test\ndescription: Detects the keyboard preload installation with a suspicious keyboard layout, e.g. Chinese, Iranian or Vietnamese layout load in user session on systems maintained by US staff only\nreferences:\n    - https://renenyffenegger.ch/notes/Windows/registry/tree/HKEY_CURRENT_USER/Keyboard-Layout/Preload/index\n    - https://github.com/SwiftOnSecurity/sysmon-config/pull/92/files\nauthor: Florian Roth (Nextron Systems)\ndate: 2019-10-12\nmodified: 2023-08-17\ntags:\n    - attack.resource-development\n    - attack.t1588.002\nlogsource:\n    category: registry_set\n    product: windows\n    definition: 'Requirements: Sysmon config that monitors \\Keyboard Layout\\Preload subkey of the HKLU hives - see https://github.com/SwiftOnSecurity/sysmon-config/pull/92/files'\ndetection:\n    selection_registry:\n        TargetObject|contains:\n            - '\\Keyboard Layout\\Preload\\'\n            - '\\Keyboard Layout\\Substitutes\\'\n        Details|contains:\n            - 00000429  # Persian (Iran)\n            - 00050429  # Persian (Iran)\n            - 0000042a  # Vietnamese\n    condition: selection_registry\nfalsepositives:\n    - Administrators or users that actually use the selected keyboard layouts (heavily depends on the organisation's user base)\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_suspicious_env_variables.yml","content":"title: Suspicious Environment Variable Has Been Registered\nid: 966315ef-c5e1-4767-ba25-fce9c8de3660\nstatus: test\ndescription: Detects the creation of user-specific or system-wide environment variables via the registry. Which contains suspicious commands and strings\nreferences:\n    - https://infosec.exchange/@sbousseaden/109542254124022664\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-12-20\nmodified: 2023-08-17\ntags:\n    - attack.defense-evasion\n    - attack.persistence\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection_main:\n        TargetObject|contains: '\\Environment\\'\n    selection_details:\n        - Details:\n              - 'powershell'\n              - 'pwsh'\n        - Details|contains:\n              # Add more suspicious strings in env variables below\n              - '\\AppData\\Local\\Temp\\'\n              - 'C:\\Users\\Public\\'\n              # Base64 MZ Header\n              - 'TVqQAAMAAAAEAAAA' # MZ..........\n              - 'TVpQAAIAAAAEAA8A'\n              - 'TVqAAAEAAAAEABAA'\n              - 'TVoAAAAAAAAAAAAA'\n              - 'TVpTAQEAAAAEAAAA'\n              # Base64 Invoke- (UTF-8)\n              - 'SW52b2tlL'\n              - 'ludm9rZS'\n              - 'JbnZva2Ut'\n              # Base64 Invoke- (UTF-16LE)\n              - 'SQBuAHYAbwBrAGUALQ'\n              - 'kAbgB2AG8AawBlAC0A'\n              - 'JAG4AdgBvAGsAZQAtA'\n        - Details|startswith:  # https://gist.github.com/Neo23x0/6af876ee72b51676c82a2db8d2cd3639\n              - 'SUVY'\n              - 'SQBFAF'\n              - 'SQBuAH'\n              - 'cwBhA'\n              - 'aWV4'\n              - 'aQBlA'\n              - 'R2V0'\n              - 'dmFy'\n              - 'dgBhA'\n              - 'dXNpbm'\n              - 'H4sIA'\n              - 'Y21k'\n              - 'cABhAH'\n              - 'Qzpc'\n              - 'Yzpc'\n    condition: all of selection_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_suppress_defender_notifications.yml","content":"title: Activate Suppression of Windows Security Center Notifications\nid: 0c93308a-3f1b-40a9-b649-57ea1a1c1d63\nstatus: test\ndescription: Detect set Notification_Suppress to 1 to disable the Windows security center notification\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/40b77d63808dd4f4eafb83949805636735a1fd15/atomics/T1112/T1112.md\nauthor: frack113\ndate: 2022-08-19\nmodified: 2023-08-17\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: 'SOFTWARE\\Policies\\Microsoft\\Windows Defender\\UX Configuration\\Notification_Suppress'\n        Details: DWORD (0x00000001)\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_special_accounts.yml","content":"title: Hiding User Account Via SpecialAccounts Registry Key\nid: f8aebc67-a56d-4ec9-9fbe-7b0e8b7b4efd\nrelated:\n    - id: 8a58209c-7ae6-4027-afb0-307a78e4589a\n      type: obsolete\n    - id: 9ec9fb1b-e059-4489-9642-f270c207923d\n      type: similar\nstatus: test\ndescription: Detects modifications to the registry key \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\SpecialAccounts\\Userlist\" where the value is set to \"0\" in order to hide user account from being listed on the logon screen.\nreferences:\n    - https://thedfirreport.com/2022/07/11/select-xmrig-from-sqlserver/\n    - https://github.com/redcanaryco/atomic-red-team/blob/40b77d63808dd4f4eafb83949805636735a1fd15/atomics/T1564.002/T1564.002.md#atomic-test-3---create-hidden-user-in-registry\nauthor: Nasreddine Bencherchali (Nextron Systems), frack113\ndate: 2022-07-12\nmodified: 2023-01-26\ntags:\n    - attack.defense-evasion\n    - attack.t1564.002\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\SpecialAccounts\\UserList'\n        Details: 'DWORD (0x00000000)'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\nregression_tests_path: regression_data/rules/windows/registry/registry_set/registry_set_special_accounts/info.yml\nsimulation:\n    - type: atomic-red-team\n      name: Create Hidden User in Registry\n      technique: T1564.002\n      atomic_guid: 173126b7-afe4-45eb-8680-fa9f6400431c\n"},{"path":"registry\\registry_set\\registry_set_sophos_av_tamper.yml","content":"title: Tamper With Sophos AV Registry Keys\nid: 9f4662ac-17ca-43aa-8f12-5d7b989d0101\nstatus: test\ndescription: Detects tamper attempts to sophos av functionality via registry key modification\nreferences:\n    - https://redacted.com/blog/bianlian-ransomware-gang-gives-it-a-go/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-09-02\nmodified: 2023-08-17\ntags:\n    - attack.defense-evasion\n    - attack.t1562.001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains:\n            - '\\Sophos Endpoint Defense\\TamperProtection\\Config\\SAVEnabled'\n            - '\\Sophos Endpoint Defense\\TamperProtection\\Config\\SEDEnabled'\n            - '\\Sophos\\SAVService\\TamperProtection\\Enabled'\n        Details: DWORD (0x00000000)\n    condition: selection\nfalsepositives:\n    - Some FP may occur when the feature is disabled by the AV itself, you should always investigate if the action was legitimate\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_sip_persistence.yml","content":"title: Persistence Via New SIP Provider\nid: 5a2b21ee-6aaa-4234-ac9d-59a59edf90a1\nstatus: test\ndescription: Detects when an attacker register a new SIP provider for persistence and defense evasion\nreferences:\n    - https://persistence-info.github.io/Data/codesigning.html\n    - https://github.com/gtworek/PSBits/tree/master/SIP\n    - https://specterops.io/assets/resources/SpecterOps_Subverting_Trust_in_Windows.pdf\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-07-21\nmodified: 2023-08-17\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1553.003\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_root:\n        TargetObject|contains:\n            - '\\SOFTWARE\\Microsoft\\Cryptography\\Providers\\'\n            - '\\SOFTWARE\\Microsoft\\Cryptography\\OID\\EncodingType'\n            - '\\SOFTWARE\\WOW6432Node\\Microsoft\\Cryptography\\Providers\\'\n            - '\\SOFTWARE\\WOW6432Node\\Microsoft\\Cryptography\\OID\\EncodingType'\n    selection_dll:\n        TargetObject|contains:\n            - '\\Dll'\n            - '\\$DLL'\n    filter:\n        Details:\n            # Add more legitimate SIP providers according to your env\n            - WINTRUST.DLL\n            - mso.dll\n    filter_poqexec:\n        Image: 'C:\\Windows\\System32\\poqexec.exe'\n        TargetObject|contains: '\\CryptSIPDll'\n        Details: 'C:\\Windows\\System32\\PsfSip.dll'\n    condition: all of selection_* and not 1 of filter*\nfalsepositives:\n    - Legitimate SIP being registered by the OS or different software.\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_set_nopolicies_user.yml","content":"title: Registry Explorer Policy Modification\nid: 1c3121ed-041b-4d97-a075-07f54f20fb4a\nstatus: test\ndescription: Detects registry modifications that disable internal tools or functions in explorer (malware like Agent Tesla uses this technique)\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1112/T1112.md\nauthor: frack113\ndate: 2022-03-18\nmodified: 2023-08-17\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_set_1:\n        TargetObject|endswith:\n            - 'SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\NoLogOff'\n            - 'SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\NoDesktop'\n            - 'SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\NoRun'\n            - 'SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\NoFind'\n            - 'SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\NoControlPanel'\n            - 'SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\NoFileMenu'\n            - 'SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\NoClose'\n            - 'SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\NoSetTaskbar'\n            - 'SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\NoPropertiesMyDocuments'\n            - 'SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\NoTrayContextMenu'\n        Details: 'DWORD (0x00000001)'\n    condition: selection_set_1\nfalsepositives:\n    - Legitimate admin script\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_services_etw_tamper.yml","content":"title: ETW Logging Disabled For SCM\nid: 4f281b83-0200-4b34-bf35-d24687ea57c2\nstatus: test\ndescription: Detects changes to the \"TracingDisabled\" key in order to disable ETW logging for services.exe (SCM)\nreferences:\n    - http://redplait.blogspot.com/2020/07/whats-wrong-with-etw.html\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-12-09\nmodified: 2023-08-17\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\n    - attack.t1562\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection:\n        TargetObject|endswith: 'Software\\Microsoft\\Windows NT\\CurrentVersion\\Tracing\\SCM\\Regular\\TracingDisabled'\n        Details: 'DWORD (0x00000001)' # Funny (sad) enough, this value is by default 1.\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: low\n"},{"path":"registry\\registry_set\\registry_set_servicedll_hijack.yml","content":"title: ServiceDll Hijack\nid: 612e47e9-8a59-43a6-b404-f48683f45bd6\nstatus: test\ndescription: |\n    Detects changes to the \"ServiceDLL\" value related to a service in the registry.\n    This is often used as a method of persistence.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1543.003/T1543.003.md#atomic-test-4---tinyturla-backdoor-service-w64time\n    - https://www.hexacorn.com/blog/2013/09/19/beyond-good-ol-run-key-part-4/\nauthor: frack113\ndate: 2022-02-04\nmodified: 2024-04-03\ntags:\n    - attack.persistence\n    - attack.privilege-escalation\n    - attack.t1543.003\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains|all:\n            - '\\System\\'\n            - 'ControlSet'\n            - '\\Services\\'\n        TargetObject|endswith: '\\Parameters\\ServiceDll'\n    filter_main_printextensionmanger:\n        Details: 'C:\\Windows\\system32\\spool\\drivers\\x64\\3\\PrintConfig.dll'\n    filter_main_domain_controller:\n        Image: 'C:\\Windows\\system32\\lsass.exe'\n        TargetObject|endswith: '\\Services\\NTDS\\Parameters\\ServiceDll'\n        Details: '%%systemroot%%\\system32\\ntdsa.dll'\n    filter_main_poqexec:\n        Image: 'C:\\Windows\\System32\\poqexec.exe'\n    filter_optional_safetica:\n        Image|endswith: '\\regsvr32.exe'\n        Details: 'C:\\Windows\\System32\\STAgent.dll'\n    condition: selection and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Administrative scripts\n    - Installation of a service\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_sentinelone_shell_context_tampering.yml","content":"title: Potential SentinelOne Shell Context Menu Scan Command Tampering\nid: 6c304b02-06e6-402d-8be4-d5833cdf8198\nstatus: test\ndescription: Detects potentially suspicious changes to the SentinelOne context menu scan command by a process other than SentinelOne.\nreferences:\n    - https://mrd0x.com/sentinelone-persistence-via-menu-context/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2024-03-06\ntags:\n    - attack.persistence\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\shell\\SentinelOneScan\\command\\'\n    filter_main_sentinelone_default_scan_binary:\n        Details|startswith:\n            - 'C:\\Program Files\\SentinelOne\\Sentinel Agent'\n            - 'C:\\Program Files (x86)\\SentinelOne\\Sentinel Agent'\n        Details|contains: '\\SentinelScanFromContextMenu.exe'\n    filter_main_sentinelone_binary:\n        Image|endswith:\n            - 'C:\\Program Files\\SentinelOne\\'\n            - 'C:\\Program Files (x86)\\SentinelOne\\'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_scr_file_executed_by_rundll32.yml","content":"title: ScreenSaver Registry Key Set\nid: 40b6e656-4e11-4c0c-8772-c1cc6dae34ce\nstatus: test\ndescription: Detects registry key established after masqueraded .scr file execution using Rundll32 through desk.cpl\nreferences:\n    - https://twitter.com/VakninHai/status/1517027824984547329\n    - https://twitter.com/pabraeken/status/998627081360695297\n    - https://jstnk9.github.io/jstnk9/research/InstallScreenSaver-SCR-files\nauthor: Jose Luis Sanchez Martinez (@Joseliyo_Jstnk)\ndate: 2022-05-04\nmodified: 2023-08-17\ntags:\n    - attack.defense-evasion\n    - attack.t1218.011\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection:\n        Image|endswith: '\\rundll32.exe'\n    registry:\n        TargetObject|contains: '\\Control Panel\\Desktop\\SCRNSAVE.EXE'\n        Details|endswith: '.scr'\n    filter:\n        Details|contains:\n            - 'C:\\Windows\\System32\\'\n            - 'C:\\Windows\\SysWOW64\\'\n    condition: selection and registry and not filter\nfalsepositives:\n    - Legitimate use of screen saver\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_runmru_susp_command_execution.yml","content":"title: Potentially Suspicious Command Executed Via Run Dialog Box - Registry\nid: a7df0e9e-91a5-459a-a003-4cde67c2ff5d\nrelated:\n    - id: f9d091f6-f1c7-4873-a24f-050b4a02b4dd\n      type: derived\nstatus: test\ndescription: |\n    Detects execution of commands via the run dialog box on Windows by checking values of the \"RunMRU\" registry key.\n    This technique was seen being abused by threat actors to deceive users into pasting and executing malicious commands, often disguised as CAPTCHA verification steps.\nreferences:\n    - https://medium.com/@ahmed.moh.farou2/fake-captcha-campaign-on-arabic-pirated-movie-sites-delivers-lumma-stealer-4f203f7adabf\n    - https://medium.com/@shaherzakaria8/downloading-trojan-lumma-infostealer-through-capatcha-1f25255a0e71\n    - https://www.forensafe.com/blogs/runmrukey.html\n    - https://redcanary.com/blog/threat-intelligence/intelligence-insights-october-2024/\nauthor: Ahmed Farouk, Nasreddine Bencherchali\ndate: 2024-11-01\ntags:\n    - attack.execution\n    - attack.t1059.001\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection_key:\n        TargetObject|contains: '\\Microsoft\\Windows\\CurrentVersion\\Explorer\\RunMRU'\n    selection_powershell_command:\n        Details|contains:\n            - 'powershell'\n            - 'pwsh'\n    selection_powershell_susp_keywords:\n        Details|contains:\n            - ' -e '\n            - ' -ec '\n            - ' -en '\n            - ' -enc '\n            - ' -enco'\n            - 'ftp'\n            - 'Hidden'\n            - 'http'\n            - 'iex'\n            - 'Invoke-'\n    selection_wmic_command:\n        Details|contains: 'wmic'\n    selection_wmic_susp_keywords:\n        Details|contains:\n            - 'shadowcopy'\n            - 'process call create'\n    condition: selection_key and (all of selection_powershell_* or all of selection_wmic_*)\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_rpcrt4_etw_tamper.yml","content":"title: ETW Logging Disabled For rpcrt4.dll\nid: 90f342e1-1aaa-4e43-b092-39fda57ed11e\nstatus: test\ndescription: Detects changes to the \"ExtErrorInformation\" key in order to disable ETW logging for rpcrt4.dll\nreferences:\n    - http://redplait.blogspot.com/2020/07/whats-wrong-with-etw.html\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-12-09\nmodified: 2023-08-17\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\n    - attack.t1562\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection:\n        TargetObject|endswith: '\\Microsoft\\Windows NT\\Rpc\\ExtErrorInformation'\n        Details:\n            # This is disabled by default for some reason\n            - 'DWORD (0x00000000)' # Off\n            - 'DWORD (0x00000002)' # Off with exceptions\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: low\n"},{"path":"registry\\registry_set\\registry_set_renamed_sysinternals_eula_accepted.yml","content":"title: Usage of Renamed Sysinternals Tools - RegistrySet\nid: 8023f872-3f1d-4301-a384-801889917ab4\nrelated:\n    - id: 25ffa65d-76d8-4da5-a832-3f2b0136e133\n      type: derived\n    - id: f50f3c09-557d-492d-81db-9064a8d4e211\n      type: similar\nstatus: test\ndescription: Detects non-sysinternals tools setting the \"accepteula\" key which normally is set on sysinternals tool execution\nreferences:\n    - Internal Research\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-08-24\nmodified: 2023-08-17\ntags:\n    - attack.resource-development\n    - attack.t1588.002\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection:\n        TargetObject|contains:\n            - '\\PsExec'\n            - '\\ProcDump'\n            - '\\Handle'\n            - '\\LiveKd'\n            - '\\Process Explorer'\n            - '\\PsLoglist'\n            - '\\PsPasswd'\n            - '\\Active Directory Explorer'\n        TargetObject|endswith: '\\EulaAccepted'\n    filter_main_image_names:\n        Image|endswith:\n            - '\\PsExec.exe'\n            - '\\PsExec64.exe'\n            - '\\procdump.exe'\n            - '\\procdump64.exe'\n            - '\\handle.exe'\n            - '\\handle64.exe'\n            - '\\livekd.exe'\n            - '\\livekd64.exe'\n            - '\\procexp.exe'\n            - '\\procexp64.exe'\n            - '\\psloglist.exe'\n            - '\\psloglist64.exe'\n            - '\\pspasswd.exe'\n            - '\\pspasswd64.exe'\n            - '\\ADExplorer.exe'\n            - '\\ADExplorer64.exe'\n    filter_optional_null:\n        Image: null # Race condition with some logging tools\n    condition: selection and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Unlikely\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_pua_sysinternals_susp_execution_via_eula.yml","content":"title: PUA - Sysinternals Tools Execution - Registry\nid: c7da8edc-49ae-45a2-9e61-9fd860e4e73d\nrelated:\n    - id: 25ffa65d-76d8-4da5-a832-3f2b0136e133\n      type: derived\n    - id: 9841b233-8df8-4ad7-9133-b0b4402a9014\n      type: obsolete\nstatus: test\ndescription: Detects the execution of some potentially unwanted tools such as PsExec, Procdump, etc. (part of the Sysinternals suite) via the creation of the \"accepteula\" registry key.\nreferences:\n    - https://twitter.com/Moti_B/status/1008587936735035392\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-08-24\nmodified: 2025-10-26\ntags:\n    - attack.resource-development\n    - attack.t1588.002\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection:\n        TargetObject|contains:\n            - '\\Active Directory Explorer'\n            - '\\Handle'\n            - '\\LiveKd'\n            - '\\Process Explorer'\n            - '\\ProcDump'\n            - '\\PsExec'\n            - '\\PsLoglist'\n            - '\\PsPasswd'\n            - '\\SDelete'\n            - '\\Sysinternals' # Global level https://twitter.com/leonzandman/status/1561736801953382400\n        TargetObject|endswith: '\\EulaAccepted'\n    condition: selection\nfalsepositives:\n    - Legitimate use of SysInternals tools. Filter the legitimate paths used in your environment\nlevel: medium\nregression_tests_path: regression_data/rules/windows/registry/registry_set/registry_set_pua_sysinternals_susp_execution_via_eula/info.yml\n"},{"path":"registry\\registry_set\\registry_set_pua_sysinternals_renamed_execution_via_eula.yml","content":"title: Suspicious Execution Of Renamed Sysinternals Tools - Registry\nid: f50f3c09-557d-492d-81db-9064a8d4e211\nrelated:\n    - id: 25ffa65d-76d8-4da5-a832-3f2b0136e133\n      type: derived\n    - id: 8023f872-3f1d-4301-a384-801889917ab4\n      type: similar\nstatus: test\ndescription: Detects the creation of the \"accepteula\" key related to the Sysinternals tools being created from executables with the wrong name (e.g. a renamed Sysinternals tool)\nreferences:\n    - Internal Research\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-08-24\nmodified: 2025-10-26\ntags:\n    - attack.resource-development\n    - attack.t1588.002\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection:\n        TargetObject|contains:\n            # Please add new values while respecting the alphabetical order\n            - '\\Active Directory Explorer'\n            - '\\Handle'\n            - '\\LiveKd'\n            - '\\ProcDump'\n            - '\\Process Explorer'\n            - '\\PsExec'\n            - '\\PsLoggedon'\n            - '\\PsLoglist'\n            - '\\PsPasswd'\n            - '\\PsPing'\n            - '\\PsService'\n            - '\\SDelete'\n        TargetObject|endswith: '\\EulaAccepted'\n    filter:\n        Image|endswith:\n            # Please add new values while respecting the alphabetical order\n            - '\\ADExplorer.exe'\n            - '\\ADExplorer64.exe'\n            - '\\handle.exe'\n            - '\\handle64.exe'\n            - '\\livekd.exe'\n            - '\\livekd64.exe'\n            - '\\procdump.exe'\n            - '\\procdump64.exe'\n            - '\\procexp.exe'\n            - '\\procexp64.exe'\n            - '\\PsExec.exe'\n            - '\\PsExec64.exe'\n            - '\\PsLoggedon.exe'\n            - '\\PsLoggedon64.exe'\n            - '\\psloglist.exe'\n            - '\\psloglist64.exe'\n            - '\\pspasswd.exe'\n            - '\\pspasswd64.exe'\n            - '\\PsPing.exe'\n            - '\\PsPing64.exe'\n            - '\\PsService.exe'\n            - '\\PsService64.exe'\n            - '\\sdelete.exe'\n    condition: selection and not filter\nfalsepositives:\n    - Unlikely\nlevel: high\nregression_tests_path: regression_data/rules/windows/registry/registry_set/registry_set_pua_sysinternals_renamed_execution_via_eula/info.yml\n"},{"path":"registry\\registry_set\\registry_set_pua_sysinternals_execution_via_eula.yml","content":"title: PUA - Sysinternal Tool Execution - Registry\nid: 25ffa65d-76d8-4da5-a832-3f2b0136e133\nstatus: test\ndescription: Detects the execution of a Sysinternals Tool via the creation of the \"accepteula\" registry key\nreferences:\n    - https://twitter.com/Moti_B/status/1008587936735035392\nauthor: Markus Neis\ndate: 2017-08-28\nmodified: 2025-10-26\ntags:\n    - attack.resource-development\n    - attack.t1588.002\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection:\n        TargetObject|endswith: '\\EulaAccepted'\n    condition: selection\nfalsepositives:\n    - Legitimate use of SysInternals tools\n    - Programs that use the same Registry Key\nlevel: low\nregression_tests_path: regression_data/rules/windows/registry/registry_set/registry_set_pua_sysinternals_execution_via_eula/info.yml\n"},{"path":"registry\\registry_set\\registry_set_provisioning_command_abuse.yml","content":"title: Potential Provisioning Registry Key Abuse For Binary Proxy Execution - REG\nid: 7021255e-5db3-4946-a8b9-0ba7a4644a69\nrelated:\n    - id: 7f5d1c9a-3e83-48df-95a7-2b98aae6c13c # CLI Generic\n      type: similar\n    - id: f9999590-1f94-4a34-a91e-951e47bedefd # CLI Abuse\n      type: similar\n    - id: 2a4b3e61-9d22-4e4a-b60f-6e8f0cde6f25 # CLI Registry\n      type: similar\nstatus: test\ndescription: Detects potential abuse of the provisioning registry key for indirect command execution through \"Provlaunch.exe\".\nreferences:\n    - https://lolbas-project.github.io/lolbas/Binaries/Provlaunch/\n    - https://twitter.com/0gtweet/status/1674399582162153472\nauthor: Swachchhanda Shrawan Poudel\ndate: 2023-08-02\nmodified: 2023-08-17\ntags:\n    - attack.defense-evasion\n    - attack.t1218\nlogsource:\n    category: registry_set\n    product: windows\n    definition: 'Requirements: The registry key \"\\SOFTWARE\\Microsoft\\Provisioning\\Commands\\\" and its subkey must be monitored'\ndetection:\n    selection:\n        TargetObject|contains: '\\SOFTWARE\\Microsoft\\Provisioning\\Commands\\'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_powershell_logging_disabled.yml","content":"title: PowerShell Logging Disabled Via Registry Key Tampering\nid: fecfd1a1-cc78-4313-a1ea-2ee2e8ec27a7\nstatus: test\ndescription: Detects changes to the registry for the currently logged-in user. In order to disable PowerShell module logging, script block logging or transcription and script execution logging\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1112/T1112.md#atomic-test-32---windows-powershell-logging-disabled\nauthor: frack113\ndate: 2022-04-02\nmodified: 2023-08-17\ntags:\n    - attack.defense-evasion\n    - attack.t1564.001\n    - attack.t1112\n    - attack.persistence\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains:\n            - '\\Microsoft\\Windows\\PowerShell\\' # PowerShell 5\n            - '\\Microsoft\\PowerShellCore\\' # PowerShell 7\n        TargetObject|endswith:\n            - '\\ModuleLogging\\EnableModuleLogging'\n            - '\\ScriptBlockLogging\\EnableScriptBlockLogging'\n            - '\\ScriptBlockLogging\\EnableScriptBlockInvocationLogging'\n            - '\\Transcription\\EnableTranscripting'\n            - '\\Transcription\\EnableInvocationHeader'\n            - '\\EnableScripts'\n        Details: 'DWORD (0x00000000)'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\nregression_tests_path: regression_data/rules/windows/registry/registry_set/registry_set_powershell_logging_disabled/info.yml\nsimulation:\n    - type: atomic-red-team\n      name: Disable PowerShell Logging via Registry\n      technique: T1112\n      atomic_guid: 95b25212-91a7-42ff-9613-124aca6845a8\n"},{"path":"registry\\registry_set\\registry_set_powershell_in_run_keys.yml","content":"title: Suspicious PowerShell In Registry Run Keys\nid: 8d85cf08-bf97-4260-ba49-986a2a65129c\nstatus: test\ndescription: Detects potential PowerShell commands or code within registry run keys\nreferences:\n    - https://github.com/frack113/atomic-red-team/blob/a9051c38de8a5320b31c7039efcbd3b56cf2d65a/atomics/T1547.001/T1547.001.md#atomic-test-9---systembc-malware-as-a-service-registry\n    - https://www.trendmicro.com/en_us/research/22/j/lv-ransomware-exploits-proxyshell-in-attack.html\n    - https://github.com/HackTricks-wiki/hacktricks/blob/e4c7b21b8f36c97c35b7c622732b38a189ce18f7/src/windows-hardening/windows-local-privilege-escalation/privilege-escalation-with-autorun-binaries.md\nauthor: frack113, Florian Roth (Nextron Systems)\ndate: 2022-03-17\nmodified: 2025-07-18\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547.001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains:\n            - '\\Software\\Microsoft\\Windows\\CurrentVersion\\Run' # Also covers \"RunOnce\" and \"RunOnceEx\"\n            - '\\Software\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Run'\n            - '\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run'\n        Details|contains:\n            - 'powershell'\n            - 'pwsh '\n            - 'FromBase64String'\n            - '.DownloadFile('\n            - '.DownloadString('\n            - ' -w hidden '\n            - ' -w 1 '\n            - '-windowstyle hidden'\n            - '-window hidden'\n            - ' -nop '\n            - ' -encodedcommand '\n            - '-ExecutionPolicy Bypass'\n            - 'Invoke-Expression'\n            - 'IEX ('\n            - 'Invoke-Command'\n            - 'ICM -'\n            - 'Invoke-WebRequest'\n            - 'IWR '\n            - 'Invoke-RestMethod'\n            - 'IRM '\n            - ' -noni '\n            - ' -noninteractive '\n    condition: selection\nfalsepositives:\n    - Legitimate admin or third party scripts. Baseline according to your environment\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_powershell_execution_policy.yml","content":"title: Potential PowerShell Execution Policy Tampering\nid: fad91067-08c5-4d1a-8d8c-d96a21b37814\nrelated:\n    - id: cf2e938e-9a3e-4fe8-a347-411642b28a9f # Registry\n      type: similar\n    - id: 87e3c4e8-a6a8-4ad9-bb4f-46e7ff99a180 # ProcCreation Cmdlet\n      type: similar\n    - id: 61d0475c-173f-4844-86f7-f3eebae1c66b # PowerShell ScriptBlock\n      type: similar\nstatus: test\ndescription: Detects changes to the PowerShell execution policy in order to bypass signing requirements for script execution\nreferences:\n    - https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.security/set-executionpolicy?view=powershell-7.3\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-01-11\nmodified: 2023-12-14\ntags:\n    - attack.defense-evasion\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith:\n            # Note for future readers: For PowerShell 7+ the ExecutionPolicy is handled via a setting file due to the fact that PWSH7 is available for mac and linux\n            # Attackers can create a per-user setting file (powershell.config.json) and set the execution policy there\n            # Learn more here: https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_powershell_config?view=powershell-7.3\n            - '\\ShellIds\\Microsoft.PowerShell\\ExecutionPolicy'\n            - '\\Policies\\Microsoft\\Windows\\PowerShell\\ExecutionPolicy'\n        Details|contains:\n            - 'Bypass'\n            - 'Unrestricted'\n    filter_main_svchost:\n        # Note: We filter out \"svchost\" to avoid FP with changes using \"gpedit\" for example.\n        Image|contains:\n            - ':\\Windows\\System32\\'\n            - ':\\Windows\\SysWOW64\\'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_powershell_enablescripts_enabled.yml","content":"title: PowerShell Script Execution Policy Enabled\nid: 8218c875-90b9-42e2-b60d-0b0069816d10\nrelated:\n    - id: fad91067-08c5-4d1a-8d8c-d96a21b37814\n      type: derived\nstatus: test\ndescription: Detects the enabling of the PowerShell script execution policy. Once enabled, this policy allows scripts to be executed.\nreferences:\n    - https://admx.help/?Category=Windows_10_2016&Policy=Microsoft.Policies.PowerShell::EnableScripts\nauthor: Nasreddine Bencherchali (Nextron Systems), Thurein Oo\ndate: 2023-10-18\ntags:\n    - attack.execution\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: '\\Policies\\Microsoft\\Windows\\PowerShell\\EnableScripts'\n        Details: 'DWORD (0x00000001)'\n    condition: selection\nfalsepositives:\n    - Likely\nlevel: low\n"},{"path":"registry\\registry_set\\registry_set_powershell_as_service.yml","content":"title: PowerShell as a Service in Registry\nid: 4a5f5a5e-ac01-474b-9b4e-d61298c9df1d\nstatus: test\ndescription: Detects that a powershell code is written to the registry as a service.\nreferences:\n    - https://speakerdeck.com/heirhabarov/hunting-for-powershell-abuse\nauthor: oscd.community, Natalia Shornikova\ndate: 2020-10-06\nmodified: 2023-08-17\ntags:\n    - attack.execution\n    - attack.t1569.002\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\Services\\'\n        TargetObject|endswith: '\\ImagePath'\n        Details|contains:\n            - 'powershell'\n            - 'pwsh'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_potential_clickfix_execution.yml","content":"title: Potential ClickFix Execution Pattern - Registry\nid: f5fe36cf-f1ec-4c23-903d-09a3110f6bbb\nrelated:\n    - id: d487ed4a-fd24-436d-a0b2-f4e95f7b2635\n      type: similar\nstatus: experimental\ndescription: |\n    Detects potential ClickFix malware execution patterns by monitoring registry modifications in RunMRU keys containing HTTP/HTTPS links.\n    ClickFix is known to be distributed through phishing campaigns and uses techniques like clipboard hijacking and fake CAPTCHA pages.\n    Through the fakecaptcha pages, the adversary tricks users into opening the Run dialog box and pasting clipboard-hijacked content,\n    such as one-liners that execute remotely hosted malicious files or scripts.\nreferences:\n    - https://github.com/JohnHammond/recaptcha-phish\n    - https://www.zscaler.com/blogs/security-research/deepseek-lure-using-captchas-spread-malware\n    - https://www.threatdown.com/blog/clipboard-hijacker-tries-to-install-a-trojan/\n    - https://app.any.run/tasks/5c16b4db-4b36-4039-a0ed-9b09abff8be2\n    - https://www.esentire.com/security-advisories/netsupport-rat-clickfix-distribution\n    - https://medium.com/@boutnaru/the-windows-foreniscs-journey-run-mru-run-dialog-box-most-recently-used-57375a02d724\n    - https://unit42.paloaltonetworks.com/preventing-clickfix-attack-vector/\n    - https://medium.com/@poudelswachchhanda123/preventing-lnk-and-fakecaptcha-threats-a-system-hardening-approach-2f7b7ed2e493\n    - https://www.scpx.com.au/2025/11/16/decades-old-finger-protocol-abused-in-clickfix-malware-attacks/\nauthor: Swachchhanda Shrawan Poudel (Nextron Systems)\ndate: 2025-03-25\nmodified: 2025-11-19\ntags:\n    - attack.execution\n    - attack.t1204.001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_registry:\n        TargetObject|contains: '\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\RunMRU\\'\n    selection_details:\n        Details|contains:\n            - 'http://'\n            - 'https://'\n    selection_susp_pattern:\n        - Details|contains:\n              # Add more suspicious keywords\n              - 'account'\n              - 'anti-bot'\n              - 'botcheck'\n              - 'captcha'\n              - 'challenge'\n              - 'confirmation'\n              - 'fraud'\n              - 'human'\n              - 'identification'\n              - 'identificator'\n              - 'identity'\n              - 'robot'\n              - 'validation'\n              - 'verification'\n              - 'verify'\n        - Details|contains:\n              - '%comspec%'\n              - 'bitsadmin'\n              - 'certutil'\n              - 'cmd'\n              - 'cscript'\n              - 'curl'\n              - 'finger'\n              - 'mshta'\n              - 'powershell'\n              - 'pwsh'\n              - 'regsvr32'\n              - 'rundll32'\n              - 'schtasks'\n              - 'wget'\n              - 'wscript'\n    condition: all of selection_*\nfalsepositives:\n    - Legitimate applications using RunMRU with HTTP links\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_policies_attachments_tamper.yml","content":"title: Potential Attachment Manager Settings Attachments Tamper\nid: ee77a5db-b0f3-4be2-bfd4-b58be1c6b15a\nstatus: test\ndescription: Detects tampering with attachment manager settings policies attachments (See reference for more information)\nreferences:\n    - https://support.microsoft.com/en-us/topic/information-about-the-attachment-manager-in-microsoft-windows-c48a4dcd-8de5-2af5-ee9b-cd795ae42738\n    - https://www.virustotal.com/gui/file/2bcd5702a7565952c44075ac6fb946c7780526640d1264f692c7664c02c68465\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-08-01\nmodified: 2023-08-17\ntags:\n    - attack.defense-evasion\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_main:\n        TargetObject|contains: '\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Attachments\\'\n    selection_value_hide_zone_info:\n        TargetObject|endswith: '\\HideZoneInfoOnProperties'\n        Details: 'DWORD (0x00000001)' # On\n    selection_value_save_zone_info:\n        TargetObject|endswith: '\\SaveZoneInformation'\n        Details: 'DWORD (0x00000002)' # Off\n    selection_value_scan_with_av:\n        TargetObject|endswith: '\\ScanWithAntiVirus'\n        Details: 'DWORD (0x00000001)' # Disabled\n    condition: selection_main and 1 of selection_value_*\nfalsepositives:\n    - Unlikely\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_policies_associations_tamper.yml","content":"title: Potential Attachment Manager Settings Associations Tamper\nid: a9b6c011-ab69-4ddb-bc0a-c4f21c80ec47\nstatus: test\ndescription: Detects tampering with attachment manager settings policies associations to lower the default file type risks (See reference for more information)\nreferences:\n    - https://support.microsoft.com/en-us/topic/information-about-the-attachment-manager-in-microsoft-windows-c48a4dcd-8de5-2af5-ee9b-cd795ae42738\n    - https://www.virustotal.com/gui/file/2bcd5702a7565952c44075ac6fb946c7780526640d1264f692c7664c02c68465\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-08-01\nmodified: 2023-08-17\ntags:\n    - attack.defense-evasion\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_main:\n        TargetObject|contains: '\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Associations\\'\n    selection_value_default_file_type_rsik:\n        TargetObject|endswith: '\\DefaultFileTypeRisk'\n        Details: 'DWORD (0x00006152)'\n    selection_value_low_risk_filetypes:\n        TargetObject|endswith: '\\LowRiskFileTypes'\n        Details|contains: # Add more as you see fit\n            - '.zip;'\n            - '.rar;'\n            - '.exe;'\n            - '.bat;'\n            - '.com;'\n            - '.cmd;'\n            - '.reg;'\n            - '.msi;'\n            - '.htm;'\n            - '.html;'\n    condition: selection_main and 1 of selection_value_*\nfalsepositives:\n    - Unlikely\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_persistence_xll.yml","content":"title: Potential Persistence Via Excel Add-in - Registry\nid: 961e33d1-4f86-4fcf-80ab-930a708b2f82\nstatus: test\ndescription: Detect potential persistence via the creation of an excel add-in (XLL) file to make it run automatically when Excel is started.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/4ae9580a1a8772db87a1b6cdb0d03e5af231e966/atomics/T1137.006/T1137.006.md\n    - https://labs.withsecure.com/publications/add-in-opportunities-for-office-persistence\nauthor: frack113\ndate: 2023-01-15\nmodified: 2023-08-17\ntags:\n    - attack.persistence\n    - attack.t1137.006\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection:\n        TargetObject|contains: 'Software\\Microsoft\\Office\\'\n        TargetObject|endswith: '\\Excel\\Options'\n        Details|startswith: '/R '\n        Details|endswith: '.xll'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_persistence_typed_paths.yml","content":"title: Potential Persistence Via TypedPaths\nid: 086ae989-9ca6-4fe7-895a-759c5544f247\nstatus: test\ndescription: Detects modification addition to the 'TypedPaths' key in the user or admin registry from a non standard application. Which might indicate persistence attempt\nreferences:\n    - https://twitter.com/dez_/status/1560101453150257154\n    - https://forensafe.com/blogs/typedpaths.html\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-08-22\nmodified: 2023-08-17\ntags:\n    - attack.persistence\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\TypedPaths\\'\n    filter:\n        Image:\n            - 'C:\\Windows\\explorer.exe'\n            - 'C:\\Windows\\SysWOW64\\explorer.exe'\n    condition: selection and not filter\nfalsepositives:\n    - Unlikely\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_persistence_shim_database_uncommon_location.yml","content":"title: Potential Persistence Via Shim Database In Uncommon Location\nid: 6b6976a3-b0e6-4723-ac24-ae38a737af41\nstatus: test\ndescription: Detects the installation of a new shim database where the file is located in a non-default location\nreferences:\n    - https://www.fireeye.com/blog/threat-research/2017/05/fin7-shim-databases-persistence.html\n    - https://andreafortuna.org/2018/11/12/process-injection-and-persistence-using-application-shimming/\n    - https://www.blackhat.com/docs/asia-14/materials/Erickson/Asia-14-Erickson-Persist-It-Using-And-Abusing-Microsofts-Fix-It-Patches.pdf\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-08-01\nmodified: 2023-08-17\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1546.011\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains|all:\n            - '\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\InstalledSDB\\'\n            - '\\DatabasePath'\n    filter_main_known_locations:\n        Details|contains: ':\\Windows\\AppPatch\\Custom'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_persistence_shim_database_susp_application.yml","content":"title: Suspicious Shim Database Patching Activity\nid: bf344fea-d947-4ef4-9192-34d008315d3a\nstatus: test\ndescription: Detects installation of new shim databases that try to patch sections of known processes for potential process injection or persistence.\nreferences:\n    - https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/pillowmint-fin7s-monkey-thief/\n    - https://www.fireeye.com/blog/threat-research/2017/05/fin7-shim-databases-persistence.html\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-08-01\nmodified: 2023-12-06\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1546.011\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Custom\\'\n        TargetObject|endswith:\n            # Note: add other application to increase coverage\n            - '\\csrss.exe'\n            - '\\dllhost.exe'\n            - '\\explorer.exe'\n            - '\\RuntimeBroker.exe'\n            - '\\services.exe'\n            - '\\sihost.exe'\n            - '\\svchost.exe'\n            - '\\taskhostw.exe'\n            - '\\winlogon.exe'\n            - '\\WmiPrvSe.exe'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_persistence_shim_database.yml","content":"title: Potential Persistence Via Shim Database Modification\nid: dfb5b4e8-91d0-4291-b40a-e3b0d3942c45\nstatus: test\ndescription: |\n    Adversaries may establish persistence and/or elevate privileges by executing malicious content triggered by application shims.\n    The Microsoft Windows Application Compatibility Infrastructure/Framework (Application Shim) was created to allow for backward compatibility of software as the operating system codebase changes over time\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1546.011/T1546.011.md#atomic-test-3---registry-key-creation-andor-modification-events-for-sdb\n    - https://www.fireeye.com/blog/threat-research/2017/05/fin7-shim-databases-persistence.html\n    - https://andreafortuna.org/2018/11/12/process-injection-and-persistence-using-application-shimming/\nauthor: frack113\ndate: 2021-12-30\nmodified: 2025-10-22\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1546.011\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains:\n            - '\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\InstalledSDB\\'\n            - '\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Custom\\'\n    filter_main_empty_string:\n        Details: ''\n    filter_main_empty_value:\n        Details: '(Empty)'\n    filter_main_null:\n        Details: null\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Legitimate custom SHIM installations will also trigger this rule\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_persistence_scrobj_dll.yml","content":"title: Potential Persistence Via Scrobj.dll COM Hijacking\nid: fe20dda1-6f37-4379-bbe0-a98d400cae90\nstatus: test\ndescription: Detect use of scrobj.dll as this DLL looks for the ScriptletURL key to get the location of the script to execute\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/40b77d63808dd4f4eafb83949805636735a1fd15/atomics/T1546.015/T1546.015.md\nauthor: frack113\ndate: 2022-08-20\nmodified: 2023-08-17\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1546.015\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: 'InprocServer32\\(Default)'\n        Details: 'C:\\WINDOWS\\system32\\scrobj.dll'\n    condition: selection\nfalsepositives:\n    - Legitimate use of the dll.\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_persistence_reflectdebugger.yml","content":"title: Potential WerFault ReflectDebugger Registry Value Abuse\nid: 0cf2e1c6-8d10-4273-8059-738778f981ad\nrelated:\n    - id: fabfb3a7-3ce1-4445-9c7c-3c27f1051cdd\n      type: derived\nstatus: test\ndescription: Detects potential WerFault \"ReflectDebugger\" registry value abuse for persistence.\nreferences:\n    - https://cocomelonc.github.io/malware/2022/11/02/malware-pers-18.html\n    - https://www.hexacorn.com/blog/2018/08/31/beyond-good-ol-run-key-part-85/\nauthor: X__Junior\ndate: 2023-05-18\ntags:\n    - attack.defense-evasion\n    - attack.t1036.003\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: '\\Microsoft\\Windows\\Windows Error Reporting\\Hangs\\ReflectDebugger'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_persistence_outlook_todaypage.yml","content":"title: Potential Persistence Via Outlook Today Page\nid: 487bb375-12ef-41f6-baae-c6a1572b4dd1\nrelated:\n    - id: ddd171b5-2cc6-4975-9e78-f0eccd08cc76\n      type: similar\nstatus: test\ndescription: |\n    Detects potential persistence activity via outlook today page.\n    An attacker can set a custom page to execute arbitrary code and link to it via the registry values \"URL\" and \"UserDefinedUrl\".\nreferences:\n    - https://speakerdeck.com/heirhabarov/hunting-for-persistence-via-microsoft-exchange-server-or-outlook?slide=74\n    - https://trustedsec.com/blog/specula-turning-outlook-into-a-c2-with-one-registry-change\nauthor: Tobias Michalski (Nextron Systems), David Bertho (@dbertho) & Eirik Sveen (@0xSV1), Storebrand\ndate: 2021-06-10\nmodified: 2024-08-07\ntags:\n    - attack.defense-evasion\n    - attack.persistence\n    - attack.t1112\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection_main:\n        TargetObject|contains|all:\n            - 'Software\\Microsoft\\Office\\'\n            - '\\Outlook\\Today\\'\n    selection_value_stamp:\n        TargetObject|endswith: '\\Stamp'\n        Details: 'DWORD (0x00000001)'\n    selection_value_url:\n        TargetObject|endswith:\n            - '\\URL'\n            - '\\UserDefinedUrl'\n    filter_main_office:\n        Image|startswith:\n            - 'C:\\Program Files\\Common Files\\Microsoft Shared\\ClickToRun\\'\n            - 'C:\\Program Files\\Common Files\\Microsoft Shared\\ClickToRun\\Updates\\'\n        Image|endswith: '\\OfficeClickToRun.exe'\n    condition: selection_main and 1 of selection_value_* and not 1 of filter_main_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_persistence_outlook_homepage.yml","content":"title: Potential Persistence Via Outlook Home Page\nid: ddd171b5-2cc6-4975-9e78-f0eccd08cc76\nrelated:\n    - id: 487bb375-12ef-41f6-baae-c6a1572b4dd1\n      type: similar\nstatus: test\ndescription: |\n    Detects potential persistence activity via outlook home page.\n    An attacker can set a home page to achieve code execution and persistence by editing the WebView registry keys.\nreferences:\n    - https://speakerdeck.com/heirhabarov/hunting-for-persistence-via-microsoft-exchange-server-or-outlook?slide=70\n    - https://support.microsoft.com/en-us/topic/outlook-home-page-feature-is-missing-in-folder-properties-d207edb7-aa02-46c5-b608-5d9dbed9bd04?ui=en-us&rs=en-us&ad=us\n    - https://trustedsec.com/blog/specula-turning-outlook-into-a-c2-with-one-registry-change\nauthor: Tobias Michalski (Nextron Systems), David Bertho (@dbertho) & Eirik Sveen (@0xSV1), Storebrand\ndate: 2021-06-09\nmodified: 2024-08-07\ntags:\n    - attack.defense-evasion\n    - attack.persistence\n    - attack.t1112\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection:\n        TargetObject|contains|all:\n            - '\\Software\\Microsoft\\Office\\'\n            - '\\Outlook\\WebView\\'\n        TargetObject|endswith: '\\URL'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_persistence_office_vsto.yml","content":"title: Potential Persistence Via Visual Studio Tools for Office\nid: 9d15044a-7cfe-4d23-8085-6ebc11df7685\nstatus: test\ndescription: Detects persistence via Visual Studio Tools for Office (VSTO) add-ins in Office applications.\nreferences:\n    - https://twitter.com/_vivami/status/1347925307643355138\n    - https://vanmieghem.io/stealth-outlook-persistence/\nauthor: Bhabesh Raj\ndate: 2021-01-10\nmodified: 2025-10-07\ntags:\n    - attack.t1137.006\n    - attack.persistence\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains:\n            - '\\Software\\Microsoft\\Office\\Outlook\\Addins\\'\n            - '\\Software\\Microsoft\\Office\\Word\\Addins\\'\n            - '\\Software\\Microsoft\\Office\\Excel\\Addins\\'\n            - '\\Software\\Microsoft\\Office\\Powerpoint\\Addins\\'\n            - '\\Software\\Microsoft\\VSTO\\Security\\Inclusion\\'\n    filter_main_system:\n        Image:\n            - 'C:\\Windows\\System32\\msiexec.exe'\n            - 'C:\\Windows\\SysWOW64\\msiexec.exe'\n            - 'C:\\Windows\\System32\\regsvr32.exe'\n            - 'C:\\Windows\\SysWOW64\\regsvr32.exe' # e.g. default Evernote installation\n    filter_main_office_click_to_run:\n        Image|startswith:\n            - 'C:\\Program Files\\Common Files (x86)\\Microsoft Shared\\ClickToRun\\'\n            - 'C:\\Program Files\\Common Files\\Microsoft Shared\\ClickToRun\\'\n        Image|endswith: '\\OfficeClickToRun.exe'\n    filter_main_integrator:\n        Image:\n            - 'C:\\Program Files (x86)\\Microsoft Office\\root\\integration\\integrator.exe'\n            - 'C:\\Program Files\\Microsoft Office\\root\\integration\\integrator.exe'\n    filter_main_office_apps:\n        Image|startswith:\n            - 'C:\\Program Files\\Microsoft Office\\OFFICE'\n            - 'C:\\Program Files (x86)\\Microsoft Office\\OFFICE'\n            - 'C:\\Program Files\\Microsoft Office\\Root\\OFFICE'\n            - 'C:\\Program Files (x86)\\Microsoft Office\\Root\\OFFICE'\n        Image|endswith:\n            - '\\excel.exe'\n            - '\\Integrator.exe'\n            - '\\outlook.exe'\n            - '\\powerpnt.exe'\n            - '\\Teams.exe'\n            - '\\visio.exe'\n            - '\\winword.exe'\n    filter_optional_avg:\n        Image:\n            - 'C:\\Program Files\\AVG\\Antivirus\\RegSvr.exe'\n            - 'C:\\Program Files (x86)\\AVG\\Antivirus\\RegSvr.exe'\n        TargetObject|contains: '\\Microsoft\\Office\\Outlook\\Addins\\Antivirus.AsOutExt\\'\n    filter_optional_avast:\n        Image:\n            - 'C:\\Program Files\\Avast Software\\Avast\\RegSvr.exe'\n            - 'C:\\Program Files (x86)\\Avast Software\\Avast\\RegSvr.exe'\n        TargetObject|contains: '\\Microsoft\\Office\\Outlook\\Addins\\Avast.AsOutExt\\'\n    condition: selection and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Legitimate Addin Installation\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_persistence_natural_language.yml","content":"title: Potential Persistence Via DLLPathOverride\nid: a1b1fd53-9c4a-444c-bae0-34a330fc7aa8\nstatus: test\ndescription: Detects when an attacker adds a new \"DLLPathOverride\" value to the \"Natural Language\" key in order to achieve persistence which will get invoked by \"SearchIndexer.exe\" process\nreferences:\n    - https://persistence-info.github.io/Data/naturallanguage6.html\n    - https://www.hexacorn.com/blog/2018/12/30/beyond-good-ol-run-key-part-98/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-07-21\nmodified: 2023-08-17\ntags:\n    - attack.persistence\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_root:\n        # The path can be for multiple languages\n        # Example:  HKLM\\System\\CurrentControlSet\\Control\\ContentIndex\\Language\\English_UK\n        #           HKLM\\System\\CurrentControlSet\\Control\\ContentIndex\\Language\\English_US\n        #           HKLM\\System\\CurrentControlSet\\Control\\ContentIndex\\Language\\Neutral\n        TargetObject|contains: '\\SYSTEM\\CurrentControlSet\\Control\\ContentIndex\\Language\\'\n    selection_values:\n        TargetObject|contains:\n            - '\\StemmerDLLPathOverride'\n            - '\\WBDLLPathOverride'\n            - '\\StemmerClass'\n            - '\\WBreakerClass'\n    condition: all of selection_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_persistence_mycomputer.yml","content":"title: Potential Persistence Via MyComputer Registry Keys\nid: 8fbe98a8-8f9d-44f8-aa71-8c572e29ef06\nstatus: test\ndescription: Detects modification to the \"Default\" value of the \"MyComputer\" key and subkeys to point to a custom binary that will be launched whenever the associated action is executed (see reference section for example)\nreferences:\n    - https://www.hexacorn.com/blog/2017/01/18/beyond-good-ol-run-key-part-55/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-08-09\nmodified: 2024-01-11\ntags:\n    - attack.persistence\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\Microsoft\\Windows\\CurrentVersion\\Explorer\\MyComputer'\n        TargetObject|endswith: '(Default)'\n    condition: selection\nfalsepositives:\n    - Unlikely but if you experience FPs add specific processes and locations you would like to monitor for\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_persistence_mpnotify.yml","content":"title: Potential Persistence Via Mpnotify\nid: 92772523-d9c1-4c93-9547-b0ca500baba3\nstatus: test\ndescription: Detects when an attacker register a new SIP provider for persistence and defense evasion\nreferences:\n    - https://persistence-info.github.io/Data/mpnotify.html\n    - https://www.youtube.com/watch?v=ggY3srD9dYs&ab_channel=GrzegorzTworek\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-07-21\nmodified: 2023-08-17\ntags:\n    - attack.persistence\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\mpnotify'\n    condition: selection\nfalsepositives:\n    - Might trigger if a legitimate new SIP provider is registered. But this is not a common occurrence in an environment and should be investigated either way\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_persistence_lsa_extension.yml","content":"title: Potential Persistence Via LSA Extensions\nid: 41f6531d-af6e-4c6e-918f-b946f2b85a36\nstatus: test\ndescription: |\n    Detects when an attacker modifies the \"REG_MULTI_SZ\" value named \"Extensions\" to include a custom DLL to achieve persistence via lsass.\n    The \"Extensions\" list contains filenames of DLLs being automatically loaded by lsass.exe. Each DLL has its InitializeLsaExtension() method called after loading.\nreferences:\n    - https://persistence-info.github.io/Data/lsaaextension.html\n    - https://twitter.com/0gtweet/status/1476286368385019906\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-07-21\nmodified: 2023-08-17\ntags:\n    - attack.persistence\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\SYSTEM\\CurrentControlSet\\Control\\LsaExtensionConfig\\LsaSrv\\Extensions'\n    condition: selection\nfalsepositives:\n    - Unlikely\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_persistence_logon_scripts_userinitmprlogonscript.yml","content":"title: Potential Persistence Via Logon Scripts - Registry\nid: 9ace0707-b560-49b8-b6ca-5148b42f39fb\nstatus: test\ndescription: Detects creation of \"UserInitMprLogonScript\" registry value which can be used as a persistence method by malicious actors\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1037.001/T1037.001.md\nauthor: Tom Ueltschi (@c_APT_ure)\ndate: 2019-01-12\nmodified: 2025-10-26\ntags:\n    - attack.privilege-escalation\n    - attack.t1037.001\n    - attack.persistence\n    - attack.lateral-movement\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: 'UserInitMprLogonScript'\n    condition: selection\nfalsepositives:\n    - Investigate the contents of the \"UserInitMprLogonScript\" value to determine of the added script is legitimate\nlevel: medium\nregression_tests_path: regression_data/rules/windows/registry/registry_set/registry_set_persistence_logon_scripts_userinitmprlogonscript/info.yml\nsimulation:\n    - type: atomic-red-team\n      name: Logon Scripts\n      technique: T1037.001\n      atomic_guid: d6042746-07d4-4c92-9ad8-e644c114a231\n"},{"path":"registry\\registry_set\\registry_set_persistence_ifilter.yml","content":"title: Register New IFiltre For Persistence\nid: b23818c7-e575-4d13-8012-332075ec0a2b\nstatus: test\ndescription: |\n    Detects when an attacker registers a new IFilter for an extension. Microsoft Windows Search uses filters to extract the content of items for inclusion in a full-text index.\n    You can extend Windows Search to index new or proprietary file types by writing filters to extract the content, and property handlers to extract the properties of files.\nreferences:\n    - https://persistence-info.github.io/Data/ifilters.html\n    - https://twitter.com/0gtweet/status/1468548924600459267\n    - https://github.com/gtworek/PSBits/tree/master/IFilter\n    - https://github.com/gtworek/PSBits/blob/8d767892f3b17eefa4d0668f5d2df78e844f01d8/IFilter/Dll.cpp#L281-L308\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-07-21\nmodified: 2024-03-26\ntags:\n    - attack.persistence\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_ext:\n        TargetObject|contains|all:\n            - '\\SOFTWARE\\Classes\\.'\n            - '\\PersistentHandler'\n    selection_clsid:\n        TargetObject|contains|all:\n            - '\\SOFTWARE\\Classes\\CLSID'\n            - '\\PersistentAddinsRegistered\\{89BCB740-6119-101A-BCB7-00DD010655AF}'\n    filter_default_targets:\n        TargetObject|contains:\n            # TODO: Add the default extension PersistentHandler.\n            # Note this could also offer blindspot as the attacker could use on of these and hijack them\n            - '\\CLSID\\{4F46F75F-199F-4C63-8B7D-86D48FE7970C}\\' # Office Open XML Format PowerPoint Persistent Handler\n            - '\\CLSID\\{4887767F-7ADC-4983-B576-88FB643D6F79}\\' # Office Open XML Format Excel Persistent Handler\n            - '\\CLSID\\{D3B41FA1-01E3-49AF-AA25-1D0D824275AE}\\' # Office Open XML Format Word Persistent Handler\n            - '\\CLSID\\{72773E1A-B711-4d8d-81FA-B9A43B0650DD}\\' # Microsoft OneNote Windows Desktop Search IFilter Persistent handler\n            - '\\CLSID\\{098f2470-bae0-11cd-b579-08002b30bfeb}\\' # Null persistent handler\n            - '\\CLSID\\{1AA9BF05-9A97-48c1-BA28-D9DCE795E93C}\\' # PDF Persistent Handler\n            - '\\CLSID\\{2e2294a9-50d7-4fe7-a09f-e6492e185884}\\' # rtf persistent handler\n            - '\\CLSID\\{34CEAC8D-CBC0-4f77-B7B1-8A60CB6DA0F7}\\' # Open Document Format ODT Persistent Handler\n            - '\\CLSID\\{3B224B11-9363-407e-850F-C9E1FFACD8FB}\\' # Zip Persistent Handler\n            - '\\CLSID\\{3DDEB7A4-8ABF-4D82-B9EE-E1F4552E95BE}\\' # Open Document Format ODS Persistent Handler\n            - '\\CLSID\\{5645C8C1-E277-11CF-8FDA-00AA00A14F93}\\' # Related to MIME Filter\n            - '\\CLSID\\{5645C8C4-E277-11CF-8FDA-00AA00A14F93}\\' # Related to MIME Filter\n            - '\\CLSID\\{58A9EBF6-5755-4554-A67E-A2467AD1447B}\\' # Setting Content File Persistent Handler\n            - '\\CLSID\\{5e941d80-bf96-11cd-b579-08002b30bfeb}\\' # Plain Text persistent handler\n            - '\\CLSID\\{698A4FFC-63A3-4E70-8F00-376AD29363FB}\\' # Wordpad OOXML Document Filter\n            - '\\CLSID\\{7E9D8D44-6926-426F-AA2B-217A819A5CCE}\\' # XML File Persistent Handler\n            - '\\CLSID\\{8CD34779-9F10-4f9b-ADFB-B3FAEABDAB5A}\\' # .url File Persistent Handler\n            - '\\CLSID\\{9694E38A-E081-46ac-99A0-8743C909ACB6}\\' # html persistent handler for mapi email\n            - '\\CLSID\\{98de59a0-d175-11cd-a7bd-00006b827d94}\\' # Microsoft Office Persistent Handler\n            - '\\CLSID\\{AA10385A-F5AA-4EFF-B3DF-71B701E25E18}\\' # Wordpad ODT Document Filter\n            - '\\CLSID\\{B4132098-7A03-423D-9463-163CB07C151F}\\' # Office Open XML Format Excel Persistent Handler\n            - '\\CLSID\\{d044309b-5da6-4633-b085-4ed02522e5a5}\\' # App Content File Persistent Handler\n            - '\\CLSID\\{D169C14A-5148-4322-92C8-754FC9D018D8}\\' # rtf persistent handler for mapi email\n            - '\\CLSID\\{DD75716E-B42E-4978-BB60-1497B92E30C4}\\' # text persistent handler for mapi email\n            - '\\CLSID\\{E2F83EED-62DE-4A9F-9CD0-A1D40DCD13B6}\\' # Open Document Format ODP Persistent Handler\n            - '\\CLSID\\{E772CEB3-E203-4828-ADF1-765713D981B8}\\' # Microsoft OneNote Section persistent handler\n            - '\\CLSID\\{eec97550-47a9-11cf-b952-00aa0051fe20}' # HTML File persistent handler\n            # - '\\CLSID\\{F6F00E65-9CAF-43BB-809A-38AA4621BCF2}' # XMind Persistent Handler (not present by default)\n            - '\\CLSID\\{FB10BD80-A331-4e9e-9EB7-00279903AD99}\\' # Office Outlook MSG Persistent Handler\n    filter_generic_paths:\n        Image|startswith:\n            # Note: We assume if an attacker has access to one of these directories. Then he already has admin.\n            - 'C:\\Windows\\System32\\'\n            - 'C:\\Program Files (x86)\\'\n            - 'C:\\Program Files\\'\n    condition: 1 of selection_* and not 1 of filter_*\nfalsepositives:\n    - Legitimate registration of IFilters by the OS or software\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_persistence_ie.yml","content":"title: Modification of IE Registry Settings\nid: d88d0ab2-e696-4d40-a2ed-9790064e66b3\nstatus: test\ndescription: Detects modification of the registry settings used for Internet Explorer and other Windows components that use these settings. An attacker can abuse this registry key to add a domain to the trusted sites Zone or insert JavaScript for persistence\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1112/T1112.md#atomic-test-4---add-domain-to-trusted-sites-zone\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1112/T1112.md#atomic-test-5---javascript-in-registry\nauthor: frack113\ndate: 2022-01-22\nmodified: 2025-10-22\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_domains:\n        TargetObject|contains: '\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings'\n    filter_main_dword:\n        Details|startswith: 'DWORD'\n    filter_main_null:\n        Details: null\n    filter_main_office:\n        Details:\n            - 'Cookie:'\n            - 'Visited:'\n            - '(Empty)'\n    filter_main_path:\n        TargetObject|contains:\n            - '\\Cache'\n            - '\\ZoneMap'\n            - '\\WpadDecision'\n    filter_main_binary:\n        Details: 'Binary Data'\n    filter_optional_accepted_documents:\n        # Spotted during Office installations\n        TargetObject|contains: '\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\Accepted Documents'\n    condition: selection_domains and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Unknown\nlevel: low\n"},{"path":"registry\\registry_set\\registry_set_persistence_globalflags.yml","content":"title: Potential Persistence Via GlobalFlags\nid: 36803969-5421-41ec-b92f-8500f79c23b0\nrelated:\n    - id: c81fe886-cac0-4913-a511-2822d72ff505\n      type: obsolete\nstatus: test\ndescription: Detects registry persistence technique using the GlobalFlags and SilentProcessExit keys\nreferences:\n    - https://oddvar.moe/2018/04/10/persistence-using-globalflags-in-image-file-execution-options-hidden-from-autoruns-exe/\n    - https://www.deepinstinct.com/2021/02/16/lsass-memory-dumps-are-stealthier-than-ever-before-part-2/\nauthor: Karneades, Jonhnathan Ribeiro, Florian Roth\ndate: 2018-04-11\nmodified: 2023-06-05\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1546.012\n    - car.2013-01-002\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_global_flag:\n        TargetObject|contains|all:\n            - '\\Microsoft\\Windows NT\\CurrentVersion\\'\n            - '\\Image File Execution Options\\'\n            - '\\GlobalFlag'\n    selection_silent_process:\n        TargetObject|contains|all:\n            - '\\Microsoft\\Windows NT\\CurrentVersion\\'\n            - '\\SilentProcessExit\\'\n        TargetObject|contains:\n            - '\\ReportingMode'\n            - '\\MonitorProcess'\n    condition: 1 of selection_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_persistence_event_viewer_events_asp.yml","content":"title: Potential Persistence Via Event Viewer Events.asp\nid: a1e11042-a74a-46e6-b07c-c4ce8ecc239b\nstatus: test\ndescription: Detects potential registry persistence technique using the Event Viewer \"Events.asp\" technique\nreferences:\n    - https://twitter.com/nas_bench/status/1626648985824788480\n    - https://admx.help/?Category=Windows_7_2008R2&Policy=Microsoft.Policies.InternetCommunicationManagement::EventViewer_DisableLinks\n    - https://www.hexacorn.com/blog/2019/02/15/beyond-good-ol-run-key-part-103/\n    - https://github.com/redcanaryco/atomic-red-team/blob/f296668303c29d3f4c07e42bdd2b28d8dd6625f9/atomics/T1112/T1112.md\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-02-17\nmodified: 2023-03-05\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        # Covers both \"\\Policies\\\" and \"\\Software\\\" paths for both \"Machine\" and \"User\" level configs\n        # Also \"MicrosoftRedirectionProgramCommandLineParameters\" key\n        TargetObject|contains:\n            - '\\Microsoft\\Windows NT\\CurrentVersion\\Event Viewer\\MicrosoftRedirectionProgram'\n            - '\\Microsoft\\Windows NT\\CurrentVersion\\Event Viewer\\MicrosoftRedirectionURL'\n    filter_default_redirect_program:\n        Image|endswith: 'C:\\WINDOWS\\system32\\svchost.exe' # Set via GPO\n        TargetObject|endswith: '\\Microsoft\\Windows NT\\CurrentVersion\\Event Viewer\\MicrosoftRedirectionProgram'\n        Details: '%%SystemRoot%%\\PCHealth\\HelpCtr\\Binaries\\HelpCtr.exe'\n    filter_default_redirect_program_cli:\n        Image|endswith: 'C:\\WINDOWS\\system32\\svchost.exe' # Set via GPO\n        TargetObject|endswith: '\\Microsoft\\Windows NT\\CurrentVersion\\Event Viewer\\MicrosoftRedirectionProgramCommandLineParameters'\n        Details: '-url hcp://services/centers/support?topic=%%s'\n    filter_url:\n        Details: 'http://go.microsoft.com/fwlink/events.asp'\n    filter_cleaner:\n        Details: '(Empty)'\n    condition: selection and not 1 of filter_*\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_persistence_custom_protocol_handler.yml","content":"title: Potential Persistence Via Custom Protocol Handler\nid: fdbf0b9d-0182-4c43-893b-a1eaab92d085\nstatus: test\ndescription: Detects potential persistence activity via the registering of a new custom protocole handlers. While legitimate applications register protocole handlers often times during installation. And attacker can abuse this by setting a custom handler to be used as a persistence mechanism.\nreferences:\n    - https://ladydebug.com/blog/2019/06/21/custom-protocol-handler-cph/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-05-30\nmodified: 2023-05-12\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|startswith: 'HKCR\\'\n        Details|startswith: 'URL:'\n    filter_main_ms_trusted:\n        Details|startswith: 'URL:ms-' # Microsoft Protocols usually start with \"ms-\"\n    filter_main_generic_locations:\n        Image|startswith: # Add more folders to avoid FP\n            - 'C:\\Program Files (x86)'\n            - 'C:\\Program Files\\'\n            - 'C:\\Windows\\System32\\'\n            - 'C:\\Windows\\SysWOW64\\'\n    # Uncomment This section to add specific Protocol Handler names that are know\n    # filter_specific:\n    #     Details: 'URL:'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Many legitimate applications can register a new custom protocol handler. Additional filters needs to applied according to your environment.\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_persistence_com_key_linking.yml","content":"title: Potential COM Object Hijacking Via TreatAs Subkey - Registry\nid: 9b0f8a61-91b2-464f-aceb-0527e0a45020\nstatus: test\ndescription: Detects COM object hijacking via TreatAs subkey\nreferences:\n    - https://bohops.com/2018/08/18/abusing-the-com-registry-structure-part-2-loading-techniques-for-evasion-and-persistence/\nauthor: Kutepov Anton, oscd.community\ndate: 2019-10-23\nmodified: 2025-10-26\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1546.015\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains|all:\n            - 'HKU\\'\n            - 'Classes\\CLSID\\'\n            - '\\TreatAs'\n    filter_main_svchost:\n        # Example of target object by svchost\n        # TargetObject: HKU\\S-1-5-21-1098798288-3663759343-897484398-1001_Classes\\CLSID\\{0003000A-0000-0000-C000-000000000046}\\TreatAs\n        Image: 'C:\\WINDOWS\\system32\\svchost.exe'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Maybe some system utilities in rare cases use linking keys for backward compatibility\nlevel: medium\nregression_tests_path: regression_data/rules/windows/registry/registry_set/registry_set_persistence_com_key_linking/info.yml\nsimulation:\n    - type: atomic-red-team\n      name: COM hijacking via TreatAs\n      technique: T1546.015\n      atomic_guid: 33eacead-f117-4863-8eb0-5c6304fbfaa9\n"},{"path":"registry\\registry_set\\registry_set_persistence_com_hijacking_builtin.yml","content":"title: COM Object Hijacking Via Modification Of Default System CLSID Default Value\nid: 790317c0-0a36-4a6a-a105-6e576bf99a14\nrelated:\n    - id: 3d968d17-ffa4-4bc0-bfdc-f139de76ce77\n      type: obsolete\n    - id: a0ff33d8-79e4-4cef-b4f3-9dc4133ccd12\n      type: obsolete\nstatus: experimental\ndescription: Detects potential COM object hijacking via modification of default system CLSID.\nreferences:\n    - https://www.microsoft.com/security/blog/2022/07/27/untangling-knotweed-european-private-sector-offensive-actor-using-0-day-exploits/ (idea)\n    - https://unit42.paloaltonetworks.com/snipbot-romcom-malware-variant/\n    - https://blog.talosintelligence.com/uat-5647-romcom/\n    - https://global.ptsecurity.com/analytics/pt-esc-threat-intelligence/darkhotel-a-cluster-of-groups-united-by-common-techniques\n    - https://threatbook.io/blog/Analysis-of-APT-C-60-Attack-on-South-Korea\n    - https://catalyst.prodaft.com/public/report/inside-the-latest-espionage-campaign-of-nebulous-mantis\n    - https://github.com/rtecCyberSec/BitlockMove\n    - https://cert.gov.ua/article/6284080\n    - https://securelist.com/forumtroll-apt-hacking-team-dante-spyware/117851/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2024-07-16\nmodified: 2025-11-10\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1546.015\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_target_root:\n        TargetObject|contains: '\\CLSID\\'\n        TargetObject|endswith:\n            - '\\InprocServer32\\(Default)'\n            - '\\LocalServer32\\(Default)'\n    selection_target_builtin_clsid:\n        TargetObject|contains:\n            # Note: Add other legitimate CLSID\n            - '\\{1f486a52-3cb1-48fd-8f50-b8dc300d9f9d}\\'\n            - '\\{2155fee3-2419-4373-b102-6843707eb41f}\\'\n            - '\\{4590f811-1d3a-11d0-891f-00aa004b2e24}\\'\n            - '\\{4de225bf-cf59-4cfc-85f7-68b90f185355}\\'\n            - '\\{ddc05a5a-351a-4e06-8eaf-54ec1bc2dcea}\\'\n            - '\\{F56F6FDD-AA9D-4618-A949-C1B91AF43B1A}\\'\n            - '\\{F82B4EF1-93A9-4DDE-8015-F7950A1A6E31}\\'\n            - '\\{7849596a-48ea-486e-8937-a2a3009f31a9}\\'\n            - '\\{0b91a74b-ad7c-4a9d-b563-29eef9167172}\\'\n            - '\\{603D3801-BD81-11d0-A3A5-00C04FD706EC}\\'\n            - '\\{30D49246-D217-465F-B00B-AC9DDD652EB7}\\'\n            - '\\{A7A63E5C-3877-4840-8727-C1EA9D7A4D50}\\'\n            - '\\{2227A280-3AEA-1069-A2DE-08002B30309D}\\'\n            - '\\{2DEA658F-54C1-4227-AF9B-260AB5FC3543}\\'\n            - '\\{AA509086-5Ca9-4C25-8F95-589D3C07B48A}\\'\n    selection_susp_location_1:\n        Details|contains:\n            # Note: Add more suspicious paths and locations\n            - ':\\Perflogs\\'\n            - '\\AppData\\Local\\'\n            - '\\Desktop\\'\n            - '\\Downloads\\'\n            - '\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\'\n            - '\\System32\\spool\\drivers\\color\\' # as seen in the knotweed blog\n            - '\\Temporary Internet'\n            - '\\Users\\Public\\'\n            - '\\Windows\\Temp\\'\n            - '%appdata%'\n            - '%temp%'\n            - '%tmp%'\n    selection_susp_location_2:\n        - Details|contains|all:\n              - ':\\Users\\'\n              - '\\Favorites\\'\n        - Details|contains|all:\n              - ':\\Users\\'\n              - '\\Favourites\\'\n        - Details|contains|all:\n              - ':\\Users\\'\n              - '\\Contacts\\'\n        - Details|contains|all:\n              - ':\\Users\\'\n              - '\\Pictures\\'\n    condition: all of selection_target_* and 1 of selection_susp_location_*\nfalsepositives:\n    - Unlikely\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_persistence_comhijack_psfactorybuffer.yml","content":"title: Potential PSFactoryBuffer COM Hijacking\nid: 243380fa-11eb-4141-af92-e14925e77c1b\nstatus: test\ndescription: Detects changes to the PSFactory COM InProcServer32 registry. This technique was used by RomCom to create persistence storing a malicious DLL.\nreferences:\n    - https://blogs.blackberry.com/en/2023/06/romcom-resurfaces-targeting-ukraine\n    - https://strontic.github.io/xcyclopedia/library/clsid_C90250F3-4D7D-4991-9B69-A5C5BC1C2AE6.html\n    - https://www.virustotal.com/gui/file/6d3ab9e729bb03ae8ae3fcd824474c5052a165de6cb4c27334969a542c7b261d/detection\n    - https://www.trendmicro.com/en_us/research/23/e/void-rabisu-s-use-of-romcom-backdoor-shows-a-growing-shift-in-th.html\nauthor: BlackBerry Threat Research and Intelligence Team - @Joseliyo_Jstnk\ndate: 2023-06-07\nmodified: 2023-08-17\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1546.015\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: '\\CLSID\\{c90250f3-4d7d-4991-9b69-a5c5bc1c2ae6}\\InProcServer32\\(Default)'\n    filter_main:\n        Details:\n            - '%windir%\\System32\\ActXPrxy.dll'\n            - 'C:\\Windows\\System32\\ActXPrxy.dll'\n    condition: selection and not filter_main\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_persistence_chm.yml","content":"title: Potential Persistence Via CHM Helper DLL\nid: 976dd1f2-a484-45ec-aa1d-0e87e882262b\nstatus: test\ndescription: Detects when an attacker modifies the registry key \"HtmlHelp Author\" to achieve persistence\nreferences:\n    - https://persistence-info.github.io/Data/htmlhelpauthor.html\n    - https://www.hexacorn.com/blog/2018/04/22/beyond-good-ol-run-key-part-76/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-07-21\nmodified: 2023-08-17\ntags:\n    - attack.persistence\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains:\n            - '\\Software\\Microsoft\\HtmlHelp Author\\Location'\n            - '\\Software\\WOW6432Node\\Microsoft\\HtmlHelp Author\\Location'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_persistence_autodial_dll.yml","content":"title: Potential Persistence Via AutodialDLL\nid: e6fe26ee-d063-4f5b-b007-39e90aaf50e3\nstatus: test\ndescription: Detects change the the \"AutodialDLL\" key which could be used as a persistence method to load custom DLL via the \"ws2_32\" library\nreferences:\n    - https://www.hexacorn.com/blog/2015/01/13/beyond-good-ol-run-key-part-24/\n    - https://persistence-info.github.io/Data/autodialdll.html\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-08-10\nmodified: 2023-08-17\ntags:\n    - attack.persistence\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\Services\\WinSock2\\Parameters\\AutodialDLL'\n    condition: selection\nfalsepositives:\n    - Unlikely\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_persistence_app_paths.yml","content":"title: Potential Persistence Via App Paths Default Property\nid: 707e097c-e20f-4f67-8807-1f72ff4500d6\nstatus: test\ndescription: |\n    Detects changes to the \"Default\" property for keys located in the \\Software\\Microsoft\\Windows\\CurrentVersion\\App Paths\\ registry. Which might be used as a method of persistence\n    The entries found under App Paths are used primarily for the following purposes.\n    First, to map an application's executable file name to that file's fully qualified path.\n    Second, to prepend information to the PATH environment variable on a per-application, per-process basis.\nreferences:\n    - https://www.hexacorn.com/blog/2013/01/19/beyond-good-ol-run-key-part-3/\n    - https://learn.microsoft.com/en-us/windows/win32/shell/app-registration\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-08-10\nmodified: 2023-08-17\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1546.012\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\App Paths'\n        TargetObject|endswith:\n            - '(Default)'\n            - 'Path'\n        Details|contains:\n            # Add more suspicious paths or binaries as you see fit.\n            - '\\Users\\Public'\n            - '\\AppData\\Local\\Temp\\'\n            - '\\Windows\\Temp\\'\n            - '\\Desktop\\'\n            - '\\Downloads\\'\n            - '%temp%'\n            - '%tmp%'\n            - 'iex'\n            - 'Invoke-'\n            - 'rundll32'\n            - 'regsvr32'\n            - 'mshta'\n            - 'cscript'\n            - 'wscript'\n            - '.bat'\n            - '.hta'\n            - '.dll'\n            - '.ps1'\n    condition: selection\nfalsepositives:\n    - Legitimate applications registering their binary from on of the suspicious locations mentioned above (tune it)\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_persistence_app_cpmpat_layer_registerapprestart.yml","content":"title: Potential Persistence Via AppCompat RegisterAppRestart Layer\nid: b86852fb-4c77-48f9-8519-eb1b2c308b59\nstatus: test\ndescription: |\n    Detects the setting of the REGISTERAPPRESTART compatibility layer on an application.\n    This compatibility layer allows an application to register for restart using the \"RegisterApplicationRestart\" API.\n    This can be potentially abused as a persistence mechanism.\nreferences:\n    - https://github.com/nasbench/Misc-Research/blob/d114d6a5e0a437d3818e492ef9864367152543e7/Other/Persistence-Via-RegisterAppRestart-Shim.md\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2024-01-01\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1546.011\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Layers\\'\n        Details|contains: 'REGISTERAPPRESTART'\n    condition: selection\nfalsepositives:\n    - Legitimate applications making use of this feature for compatibility reasons\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_persistence_appx_debugger.yml","content":"title: Potential Persistence Using DebugPath\nid: df4dc653-1029-47ba-8231-3c44238cc0ae\nstatus: test\ndescription: Detects potential persistence using Appx DebugPath\nreferences:\n    - https://oddvar.moe/2018/09/06/persistence-using-universal-windows-platform-apps-appx/\n    - https://github.com/rootm0s/WinPwnage\nauthor: frack113\ndate: 2022-07-27\nmodified: 2023-08-17\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1546.015\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_debug:\n        TargetObject|contains: 'Classes\\ActivatableClasses\\Package\\Microsoft.'\n        TargetObject|endswith: '\\DebugPath'\n    selection_default:\n        TargetObject|contains: '\\Software\\Microsoft\\Windows\\CurrentVersion\\PackagedAppXDebug\\Microsoft.'\n        TargetObject|endswith: '\\(Default)'\n    condition: 1 of selection_*\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_persistence_amsi_providers.yml","content":"title: Potential Persistence Via New AMSI Providers - Registry\nid: 33efc23c-6ea2-4503-8cfe-bdf82ce8f705\nstatus: test\ndescription: |\n    Detects when an attacker adds a new AMSI provider via the Windows Registry to bypass AMSI (Antimalware Scan Interface) protections.\n    Attackers may add custom AMSI providers to persist on the system and evade detection by security software that relies on AMSI for scanning scripts and other content.\n    This technique is often used in conjunction with fileless malware and script-based attacks to maintain persistence while avoiding detection.\nreferences:\n    - https://persistence-info.github.io/Data/amsi.html\n    - https://github.com/gtworek/PSBits/blob/8d767892f3b17eefa4d0668f5d2df78e844f01d8/FakeAMSI/FakeAMSI.c\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-07-21\nmodified: 2025-10-26\ntags:\n    - attack.persistence\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains:\n            - '\\SOFTWARE\\Microsoft\\AMSI\\Providers\\'\n            - '\\SOFTWARE\\WOW6432Node\\Microsoft\\AMSI\\Providers\\'\n    filter_optional_avast:\n        Image:\n            - 'C:\\Program Files\\Avast Software\\Avast\\RegSvr.exe'\n            - 'C:\\Program Files\\Avast Software\\Avast\\x86\\RegSvr.exe'\n        TargetObject|contains: '\\{FB904E4E-D2C7-4C8D-8492-B620BB9896B1}'\n    filter_optional_avg:\n        Image:\n            - 'C:\\Program Files\\AVG\\Antivirus\\RegSvr.exe'\n            - 'C:\\Program Files\\AVG\\Antivirus\\x86\\RegSvr.exe'\n        TargetObject|contains: '\\{FB904E4E-D2C7-4C8D-8492-B620BB9896B1}'\n    filter_optional_avira:\n        Image: 'C:\\Program Files\\Avira\\Endpoint Protection SDK\\endpointprotection.exe'\n        TargetObject|contains: '\\{00000001-3DCC-4B48-A82E-E2071FE58E05}'\n    condition: selection and not 1 of filter_optional_*\nfalsepositives:\n    - Legitimate security products adding their own AMSI providers. Filter these according to your environment.\nlevel: medium\nregression_tests_path: regression_data/rules/windows/registry/registry_set/registry_set_persistence_amsi_providers/info.yml\n"},{"path":"registry\\registry_set\\registry_set_optimize_file_sharing_network.yml","content":"title: MaxMpxCt Registry Value Changed\nid: 0e6a9e62-627e-496c-aef5-bfa39da29b5e\nstatus: test\ndescription: |\n    Detects changes to the \"MaxMpxCt\" registry value.\n    MaxMpxCt specifies the maximum outstanding network requests for the server per client, which is used when negotiating a Server Message Block (SMB) connection with a client. Note if the value is set beyond 125 older Windows 9x clients will fail to negotiate.\n    Ransomware threat actors and operators (specifically BlackCat) were seen increasing this value in order to handle a higher volume of traffic.\nreferences:\n    - https://www.huntress.com/blog/blackcat-ransomware-affiliate-ttps\n    - https://securityscorecard.com/research/deep-dive-into-alphv-blackcat-ransomware\n    - https://www.intrinsec.com/alphv-ransomware-gang-analysis/?cn-reloaded=1\n    - https://www.sentinelone.com/labs/blackcat-ransomware-highly-configurable-rust-driven-raas-on-the-prowl-for-victims/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2024-03-19\ntags:\n    - attack.defense-evasion\n    - attack.t1070.005\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: '\\Services\\LanmanServer\\Parameters\\MaxMpxCt'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: low\n"},{"path":"registry\\registry_set\\registry_set_office_vba_warnings_tamper.yml","content":"title: Office Macros Warning Disabled\nid: 91239011-fe3c-4b54-9f24-15c86bb65913\nrelated:\n    - id: 9b894e57-033f-46cf-b7fa-a52804181973\n      type: obsolete\nstatus: test\ndescription: Detects registry changes to Microsoft Office \"VBAWarning\" to a value of \"1\" which enables the execution of all macros, whether signed or unsigned.\nreferences:\n    - https://twitter.com/inversecos/status/1494174785621819397\n    - https://www.mcafee.com/blogs/other-blogs/mcafee-labs/zloader-with-a-new-infection-technique/\n    - https://securelist.com/scarcruft-surveilling-north-korean-defectors-and-human-rights-activists/105074/\nauthor: Trent Liffick (@tliffick), Nasreddine Bencherchali (Nextron Systems)\ndate: 2020-05-22\nmodified: 2024-03-19\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: '\\Security\\VBAWarnings'\n        Details: 'DWORD (0x00000001)'\n    condition: selection\nfalsepositives:\n    - Unlikely\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_office_trust_record_susp_location.yml","content":"title: Macro Enabled In A Potentially Suspicious Document\nid: a166f74e-bf44-409d-b9ba-ea4b2dd8b3cd\nrelated:\n    - id: 295a59c1-7b79-4b47-a930-df12c15fc9c2\n      type: derived\nstatus: test\ndescription: Detects registry changes to Office trust records where the path is located in a potentially suspicious location\nreferences:\n    - https://twitter.com/inversecos/status/1494174785621819397\n    - Internal Research\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-06-21\nmodified: 2023-08-17\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_value:\n        TargetObject|contains: '\\Security\\Trusted Documents\\TrustRecords'\n    selection_paths:\n        TargetObject|contains:\n            # Note: add more locations where you don't expect a user to executed macro enabled docs\n            - '/AppData/Local/Microsoft/Windows/INetCache/'\n            - '/AppData/Local/Temp/'\n            - '/PerfLogs/'\n            - 'C:/Users/Public/'\n            - 'file:///D:/'\n            - 'file:///E:/'\n    condition: all of selection_*\nfalsepositives:\n    - Unlikely\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_office_trusted_location_uncommon.yml","content":"title: Uncommon Microsoft Office Trusted Location Added\nid: f742bde7-9528-42e5-bd82-84f51a8387d2\nrelated:\n    - id: a0bed973-45fa-4625-adb5-6ecdf9be70ac\n      type: derived\nstatus: test\ndescription: Detects changes to registry keys related to \"Trusted Location\" of Microsoft Office where the path is set to something uncommon. Attackers might add additional trusted locations to avoid macro security restrictions.\nreferences:\n    - Internal Research\n    - https://admx.help/?Category=Office2016&Policy=excel16.Office.Microsoft.Policies.Windows::L_TrustedLoc01\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-06-21\nmodified: 2023-09-29\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: 'Security\\Trusted Locations\\Location'\n        TargetObject|endswith: '\\Path'\n    filter_exclude_known_paths:\n        Details|contains:\n            - '%APPDATA%\\Microsoft\\Templates'\n            - '%%APPDATA%%\\Microsoft\\Templates'\n            - '%APPDATA%\\Microsoft\\Word\\Startup'\n            - '%%APPDATA%%\\Microsoft\\Word\\Startup'\n            - ':\\Program Files (x86)\\Microsoft Office\\root\\Templates\\'\n            - ':\\Program Files\\Microsoft Office (x86)\\Templates'\n            - ':\\Program Files\\Microsoft Office\\root\\Templates\\'\n            - ':\\Program Files\\Microsoft Office\\Templates\\'\n    filter_main_office_click_to_run:\n        Image|contains: ':\\Program Files\\Common Files\\Microsoft Shared\\ClickToRun\\'\n        Image|endswith: '\\OfficeClickToRun.exe'\n    filter_main_office_apps:\n        Image|contains:\n            - ':\\Program Files\\Microsoft Office\\'\n            - ':\\Program Files (x86)\\Microsoft Office\\'\n    condition: selection and not 1 of filter_main_* and not 1 of filter_exclude_*\nfalsepositives:\n    - Other unknown legitimate or custom paths need to be filtered to avoid false positives\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_office_outlook_security_settings.yml","content":"title: Outlook Security Settings Updated - Registry\nid: c3cefdf4-6703-4e1c-bad8-bf422fc5015a\nrelated:\n    - id: 6763c6c8-bd01-4687-bc8d-4fa52cf8ba08 # EnableUnsafeClientMailRules\n      type: similar\nstatus: test\ndescription: Detects changes to the registry values related to outlook security settings\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1137/T1137.md\n    - https://learn.microsoft.com/en-us/outlook/troubleshoot/security/information-about-email-security-settings\nauthor: frack113\ndate: 2021-12-28\nmodified: 2023-08-17\ntags:\n    - attack.persistence\n    - attack.t1137\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains|all:\n            - '\\SOFTWARE\\Microsoft\\Office\\'\n            - '\\Outlook\\Security\\'\n    condition: selection\nfalsepositives:\n    - Administrative activity\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_office_outlook_enable_unsafe_client_mail_rules.yml","content":"title: Outlook EnableUnsafeClientMailRules Setting Enabled - Registry\nid: 6763c6c8-bd01-4687-bc8d-4fa52cf8ba08\nrelated:\n    - id: c3cefdf4-6703-4e1c-bad8-bf422fc5015a\n      type: similar\n    - id: 55f0a3a1-846e-40eb-8273-677371b8d912 # ProcCreation variation\n      type: similar\nstatus: test\ndescription: Detects an attacker trying to enable the outlook security setting \"EnableUnsafeClientMailRules\" which allows outlook to run applications or execute macros\nreferences:\n    - https://support.microsoft.com/en-us/topic/how-to-control-the-rule-actions-to-start-an-application-or-run-a-macro-in-outlook-2016-and-outlook-2013-e4964b72-173c-959d-5d7b-ead562979048\n    - https://speakerdeck.com/heirhabarov/hunting-for-persistence-via-microsoft-exchange-server-or-outlook?slide=44\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-02-08\nmodified: 2023-08-17\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: '\\Outlook\\Security\\EnableUnsafeClientMailRules'\n        Details: 'DWORD (0x00000001)'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_office_outlook_enable_macro_execution.yml","content":"title: Outlook Macro Execution Without Warning Setting Enabled\nid: e3b50fa5-3c3f-444e-937b-0a99d33731cd\nstatus: test\ndescription: Detects the modification of Outlook security setting to allow unprompted execution of macros.\nreferences:\n    - https://www.mdsec.co.uk/2020/11/a-fresh-outlook-on-mail-based-persistence/\n    - https://speakerdeck.com/heirhabarov/hunting-for-persistence-via-microsoft-exchange-server-or-outlook?slide=53\nauthor: '@ScoubiMtl'\ndate: 2021-04-05\nmodified: 2023-08-17\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.command-and-control\n    - attack.t1137\n    - attack.t1008\n    - attack.t1546\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: '\\Outlook\\Security\\Level'\n        Details|contains: '0x00000001' # Enable all Macros\n    condition: selection\nfalsepositives:\n    - Unlikely\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_office_outlook_enable_load_macro_provider_on_boot.yml","content":"title: Potential Persistence Via Outlook LoadMacroProviderOnBoot Setting\nid: 396ae3eb-4174-4b9b-880e-dc0364d78a19\nstatus: test\ndescription: Detects the modification of Outlook setting \"LoadMacroProviderOnBoot\" which if enabled allows the automatic loading of any configured VBA project/module\nreferences:\n    - https://speakerdeck.com/heirhabarov/hunting-for-persistence-via-microsoft-exchange-server-or-outlook?slide=53\n    - https://www.linkedin.com/pulse/outlook-backdoor-using-vba-samir-b-/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2021-04-05\nmodified: 2023-08-17\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.command-and-control\n    - attack.t1137\n    - attack.t1008\n    - attack.t1546\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: '\\Outlook\\LoadMacroProviderOnBoot'\n        Details|contains: '0x00000001'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_office_enable_dde.yml","content":"title: Enable Microsoft Dynamic Data Exchange\nid: 63647769-326d-4dde-a419-b925cc0caf42\nstatus: test\ndescription: Enable Dynamic Data Exchange protocol (DDE) in all supported editions of Microsoft Word or Excel.\nreferences:\n    - https://msrc.microsoft.com/update-guide/vulnerability/ADV170021\nauthor: frack113\ndate: 2022-02-26\nmodified: 2023-08-17\ntags:\n    - attack.execution\n    - attack.t1559.002\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_word:\n        TargetObject|endswith: '\\Word\\Security\\AllowDDE'\n        Details:\n            - 'DWORD (0x00000001)'\n            - 'DWORD (0x00000002)'\n    selection_excel:\n        TargetObject|endswith:\n            - '\\Excel\\Security\\DisableDDEServerLaunch'\n            - '\\Excel\\Security\\DisableDDEServerLookup'\n        Details: 'DWORD (0x00000000)'\n    condition: 1 of selection_*\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_office_disable_python_security_warnings.yml","content":"title: Python Function Execution Security Warning Disabled In Excel - Registry\nid: 17e53739-a1fc-4a62-b1b9-87711c2d5e44\nrelated:\n    - id: 023c654f-8f16-44d9-bb2b-00ff36a62af9\n      type: similar\nstatus: test\ndescription: |\n    Detects changes to the registry value \"PythonFunctionWarnings\" that would prevent any warnings or alerts from showing when Python functions are about to be executed.\n    Threat actors could run malicious code through the new Microsoft Excel feature that allows Python to run within the spreadsheet.\nreferences:\n    - https://support.microsoft.com/en-us/office/data-security-and-python-in-excel-33cc88a4-4a87-485e-9ff9-f35958278327\nauthor: Nasreddine Bencherchali (Nextron Systems), @Kostastsale\ndate: 2024-08-23\ntags:\n    - attack.defense-evasion\n    - attack.t1562.001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\Microsoft\\Office\\'\n        TargetObject|endswith: '\\Excel\\Security\\PythonFunctionWarnings'\n        Details: 'DWORD (0x00000001)'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_office_disable_protected_view_features.yml","content":"title: Microsoft Office Protected View Disabled\nid: a5c7a43f-6009-4a8c-80c5-32abf1c53ecc\nrelated:\n    - id: 7c637634-c95d-4bbf-b26c-a82510874b34\n      type: obsolete\nstatus: test\ndescription: Detects changes to Microsoft Office protected view registry keys with which the attacker disables this feature.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.001/T1562.001.md\n    - https://unit42.paloaltonetworks.com/unit42-gorgon-group-slithering-nation-state-cybercrime/\n    - https://yoroi.company/research/cyber-criminal-espionage-operation-insists-on-italian-manufacturing/\n    - https://admx.help/HKCU/software/policies/microsoft/office/16.0/excel/security/protectedview\nauthor: frack113, Nasreddine Bencherchali (Nextron Systems)\ndate: 2021-06-08\nmodified: 2023-08-17\ntags:\n    - attack.defense-evasion\n    - attack.t1562.001\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection_path:\n        TargetObject|contains|all:\n            - '\\SOFTWARE\\Microsoft\\Office\\'\n            - '\\Security\\ProtectedView\\'\n    selection_values_1:\n        Details: 'DWORD (0x00000001)'\n        TargetObject|endswith:\n            - '\\DisableAttachementsInPV' # Turn off Protected View for attachments opened from Outlook\n            - '\\DisableInternetFilesInPV' # Turn off Protected View for files downloaded from Internet zone\n            - '\\DisableIntranetCheck' # Turn off Protected View for file located in UNC paths\n            - '\\DisableUnsafeLocationsInPV' # Turn off Protected View for unsafe locations\n    selection_values_0:\n        Details: 'DWORD (0x00000000)'\n        TargetObject|endswith:\n            - '\\enabledatabasefileprotectedview'\n            - '\\enableforeigntextfileprotectedview'\n    condition: selection_path and 1 of selection_values_*\nfalsepositives:\n    - Unlikely\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_office_access_vbom_tamper.yml","content":"title: Trust Access Disable For VBApplications\nid: 1a5c46e9-f32f-42f7-b2bc-6e9084db7fbf\nrelated:\n    - id: 9b894e57-033f-46cf-b7fa-a52804181973\n      type: obsolete\nstatus: test\ndescription: Detects registry changes to Microsoft Office \"AccessVBOM\" to a value of \"1\" which disables trust access for VBA on the victim machine and lets attackers execute malicious macros without any Microsoft Office warnings.\nreferences:\n    - https://twitter.com/inversecos/status/1494174785621819397\n    - https://www.mcafee.com/blogs/other-blogs/mcafee-labs/zloader-with-a-new-infection-technique/\n    - https://securelist.com/scarcruft-surveilling-north-korean-defectors-and-human-rights-activists/105074/\nauthor: Trent Liffick (@tliffick), Nasreddine Bencherchali (Nextron Systems)\ndate: 2020-05-22\nmodified: 2023-08-17\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: '\\Security\\AccessVBOM'\n        Details: 'DWORD (0x00000001)'\n    condition: selection\nfalsepositives:\n    - Unlikely\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_odbc_driver_registered_susp.yml","content":"title: Potentially Suspicious ODBC Driver Registered\nid: e4d22291-f3d5-4b78-9a0c-a1fbaf32a6a4\nstatus: test\ndescription: Detects the registration of a new ODBC driver where the driver is located in a potentially suspicious location\nreferences:\n    - https://www.hexacorn.com/blog/2020/08/23/odbcconf-lolbin-trifecta/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-05-23\nmodified: 2023-08-17\ntags:\n    - attack.credential-access\n    - attack.persistence\n    - attack.t1003\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\SOFTWARE\\ODBC\\ODBCINST.INI\\'\n        TargetObject|endswith:\n            - '\\Driver'\n            - '\\Setup'\n        Details|contains:\n            - ':\\PerfLogs\\'\n            - ':\\ProgramData\\'\n            - ':\\Temp\\'\n            - ':\\Users\\Public\\'\n            - ':\\Windows\\Registration\\CRMLog'\n            - ':\\Windows\\System32\\com\\dmp\\'\n            - ':\\Windows\\System32\\FxsTmp\\'\n            - ':\\Windows\\System32\\Microsoft\\Crypto\\RSA\\MachineKeys\\'\n            - ':\\Windows\\System32\\spool\\drivers\\color\\'\n            - ':\\Windows\\System32\\spool\\PRINTERS\\'\n            - ':\\Windows\\System32\\spool\\SERVERS\\'\n            - ':\\Windows\\System32\\Tasks_Migrated\\'\n            - ':\\Windows\\System32\\Tasks\\Microsoft\\Windows\\SyncCenter\\'\n            - ':\\Windows\\SysWOW64\\com\\dmp\\'\n            - ':\\Windows\\SysWOW64\\FxsTmp\\'\n            - ':\\Windows\\SysWOW64\\Tasks\\Microsoft\\Windows\\PLA\\System\\'\n            - ':\\Windows\\SysWOW64\\Tasks\\Microsoft\\Windows\\SyncCenter\\'\n            - ':\\Windows\\Tasks\\'\n            - ':\\Windows\\Temp\\'\n            - ':\\Windows\\Tracing\\'\n            - '\\AppData\\Local\\Temp\\'\n            - '\\AppData\\Roaming\\'\n    condition: selection\nfalsepositives:\n    - Unlikely\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_odbc_driver_registered.yml","content":"title: New ODBC Driver Registered\nid: 3390fbef-c98d-4bdd-a863-d65ed7c610dd\nstatus: test\ndescription: Detects the registration of a new ODBC driver.\nreferences:\n    - https://www.hexacorn.com/blog/2020/08/23/odbcconf-lolbin-trifecta/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-05-23\nmodified: 2023-08-17\ntags:\n    - attack.persistence\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\SOFTWARE\\ODBC\\ODBCINST.INI\\'\n        TargetObject|endswith: '\\Driver'\n    filter_main_sqlserver:\n        TargetObject|contains: '\\SQL Server\\'\n        Details: '%WINDIR%\\System32\\SQLSRV32.dll'\n    filter_optional_office_access:\n        TargetObject|contains: '\\Microsoft Access '\n        Details|startswith: 'C:\\Progra'\n        Details|endswith: '\\ACEODBC.DLL'\n    filter_optional_office_excel:\n        TargetObject|contains: '\\Microsoft Excel Driver'\n        Details|startswith: 'C:\\Progra'\n        Details|endswith: '\\ACEODBC.DLL'\n    condition: selection and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Likely\nlevel: low\n"},{"path":"registry\\registry_set\\registry_set_new_network_provider.yml","content":"title: Potential Credential Dumping Attempt Using New NetworkProvider - REG\nid: 0442defa-b4a2-41c9-ae2c-ea7042fc4701\nrelated:\n    - id: baef1ec6-2ca9-47a3-97cc-4cf2bda10b77\n      type: similar\nstatus: test\ndescription: Detects when an attacker tries to add a new network provider in order to dump clear text credentials, similar to how the NPPSpy tool does it\nreferences:\n    - https://learn.microsoft.com/en-us/troubleshoot/windows-client/setup-upgrade-and-drivers/network-provider-settings-removed-in-place-upgrade\n    - https://github.com/gtworek/PSBits/tree/master/PasswordStealing/NPPSpy\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-08-23\nmodified: 2023-08-17\ntags:\n    - attack.credential-access\n    - attack.t1003\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains|all:\n            - '\\System\\CurrentControlSet\\Services\\'\n            - '\\NetworkProvider'\n    filter:\n        TargetObject|contains:\n            - '\\System\\CurrentControlSet\\Services\\WebClient\\NetworkProvider'\n            - '\\System\\CurrentControlSet\\Services\\LanmanWorkstation\\NetworkProvider'\n            - '\\System\\CurrentControlSet\\Services\\RDPNP\\NetworkProvider'\n            # - '\\System\\CurrentControlSet\\Services\\P9NP\\NetworkProvider' # Related to WSL remove the comment if you use WSL in your ENV\n    filter_valid_procs:\n        Image: C:\\Windows\\System32\\poqexec.exe\n    condition: selection and not 1 of filter*\nfalsepositives:\n    - Other legitimate network providers used and not filtred in this rule\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_new_application_appcompat.yml","content":"title: New Application in AppCompat\nid: 60936b49-fca0-4f32-993d-7415edcf9a5d\nstatus: test\ndescription: A General detection for a new application in AppCompat. This indicates an application executing for the first time on an endpoint.\nreferences:\n    - https://github.com/OTRF/detection-hackathon-apt29/issues/1\n    - https://github.com/OTRF/ThreatHunter-Playbook/blob/2d4257f630f4c9770f78d0c1df059f891ffc3fec/docs/evals/apt29/detections/1.A.1_DFD6A782-9BDB-4550-AB6B-525E825B095E.md\nauthor: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)\ndate: 2020-05-02\nmodified: 2023-08-17\ntags:\n    - attack.execution\n    - attack.t1204.002\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection:\n        TargetObject|contains: '\\AppCompatFlags\\Compatibility Assistant\\Store\\'\n    condition: selection\nfalsepositives:\n    - This rule is to explore new applications on an endpoint. False positives depends on the organization.\n    - Newly setup system.\n    - Legitimate installation of new application.\nlevel: informational\n"},{"path":"registry\\registry_set\\registry_set_net_cli_ngenassemblyusagelog.yml","content":"title: NET NGenAssemblyUsageLog Registry Key Tamper\nid: 28036918-04d3-423d-91c0-55ecf99fb892\nstatus: test\ndescription: |\n  Detects changes to the NGenAssemblyUsageLog registry key.\n  .NET Usage Log output location can be controlled by setting the NGenAssemblyUsageLog CLR configuration knob in the Registry or by configuring an environment variable (as described in the next section).\n  By simplify specifying an arbitrary value (e.g. fake output location or junk data) for the expected value, a Usage Log file for the .NET execution context will not be created.\nreferences:\n    - https://bohops.com/2021/03/16/investigating-net-clr-usage-log-tampering-techniques-for-edr-evasion/\nauthor: frack113\ndate: 2022-11-18\nmodified: 2023-08-17\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection:\n        TargetObject|endswith: 'SOFTWARE\\Microsoft\\.NETFramework\\NGenAssemblyUsageLog'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_netsh_help_dll_persistence_susp_location.yml","content":"title: New Netsh Helper DLL Registered From A Suspicious Location\nid: e7b18879-676e-4a0e-ae18-27039185a8e7\nrelated:\n    - id: 56321594-9087-49d9-bf10-524fe8479452\n      type: similar\n    - id: c90362e0-2df3-4e61-94fe-b37615814cb1\n      type: similar\nstatus: test\ndescription: |\n    Detects changes to the Netsh registry key to add a new DLL value that is located on a suspicious location. This change might be an indication of a potential persistence attempt by adding a malicious Netsh helper\nreferences:\n    - https://www.ired.team/offensive-security/persistence/t1128-netsh-helper-dll\n    - https://pentestlab.blog/2019/10/29/persistence-netsh-helper-dll/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-11-28\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1546.007\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_target:\n        TargetObject|contains: '\\SOFTWARE\\Microsoft\\NetSh'\n    selection_folders_1:\n        Details|contains:\n            - ':\\Perflogs\\'\n            - ':\\Users\\Public\\'\n            - ':\\Windows\\Temp\\'\n            - '\\AppData\\Local\\Temp\\'\n            - '\\Temporary Internet'\n    selection_folders_2:\n        - Details|contains|all:\n              - ':\\Users\\'\n              - '\\Favorites\\'\n        - Details|contains|all:\n              - ':\\Users\\'\n              - '\\Favourites\\'\n        - Details|contains|all:\n              - ':\\Users\\'\n              - '\\Contacts\\'\n        - Details|contains|all:\n              - ':\\Users\\'\n              - '\\Pictures\\'\n    condition: selection_target and 1 of selection_folders_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_netsh_helper_dll_potential_persistence.yml","content":"title: Potential Persistence Via Netsh Helper DLL - Registry\nid: c90362e0-2df3-4e61-94fe-b37615814cb1\nrelated:\n    - id: 56321594-9087-49d9-bf10-524fe8479452\n      type: similar\n    - id: e7b18879-676e-4a0e-ae18-27039185a8e7\n      type: similar\nstatus: test\ndescription: |\n    Detects changes to the Netsh registry key to add a new DLL value. This change might be an indication of a potential persistence attempt by adding a malicious Netsh helper\nreferences:\n    - https://www.ired.team/offensive-security/persistence/t1128-netsh-helper-dll\n    - https://pentestlab.blog/2019/10/29/persistence-netsh-helper-dll/\nauthor: Anish Bogati\ndate: 2023-11-28\nmodified: 2025-10-08\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1546.007\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\SOFTWARE\\Microsoft\\NetSh'\n        Details|contains: '.dll'\n    filter_main_poqexec:\n        Image: 'C:\\Windows\\System32\\poqexec.exe'\n        Details:\n            - 'ipmontr.dll'\n            - 'iasmontr.dll'\n            - 'ippromon.dll'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Legitimate helper added by different programs and the OS\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_lsa_disablerestrictedadmin.yml","content":"title: RestrictedAdminMode Registry Value Tampering\nid: d6ce7ebd-260b-4323-9768-a9631c8d4db2\nrelated:\n    - id: 28ac00d6-22d9-4a3c-927f-bbd770104573 # process_creation\n      type: similar\nstatus: test\ndescription: |\n    Detects changes to the \"DisableRestrictedAdmin\" registry value in order to disable or enable RestrictedAdmin mode.\n    RestrictedAdmin mode prevents the transmission of reusable credentials to the remote system to which you connect using Remote Desktop.\n    This prevents your credentials from being harvested during the initial connection process if the remote server has been compromise\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/a8e3cf63e97b973a25903d3df9fd55da6252e564/atomics/T1112/T1112.md\n    - https://social.technet.microsoft.com/wiki/contents/articles/32905.remote-desktop-services-enable-restricted-admin-mode.aspx\nauthor: frack113\ndate: 2023-01-13\nmodified: 2024-08-23\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection:\n        TargetObject|endswith: 'System\\CurrentControlSet\\Control\\Lsa\\DisableRestrictedAdmin'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_lsass_usermode_dumping.yml","content":"title: Lsass Full Dump Request Via DumpType Registry Settings\nid: 33efc23c-6ea2-4503-8cfe-bdf82ce8f719\nstatus: test\ndescription: Detects the setting of the \"DumpType\" registry value to \"2\" which stands for a \"Full Dump\". Technique such as LSASS Shtinkering requires this value to be \"2\" in order to dump LSASS.\nreferences:\n    - https://github.com/deepinstinct/Lsass-Shtinkering\n    - https://learn.microsoft.com/en-us/windows/win32/wer/collecting-user-mode-dumps\n    - https://media.defcon.org/DEF%20CON%2030/DEF%20CON%2030%20presentations/Asaf%20Gilboa%20-%20LSASS%20Shtinkering%20Abusing%20Windows%20Error%20Reporting%20to%20Dump%20LSASS.pdf\nauthor: '@pbssubhash'\ndate: 2022-12-08\nmodified: 2023-08-17\ntags:\n    - attack.credential-access\n    - attack.t1003.001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains:\n            - '\\SOFTWARE\\Microsoft\\Windows\\Windows Error Reporting\\LocalDumps\\DumpType'\n            - '\\SOFTWARE\\Microsoft\\Windows\\Windows Error Reporting\\LocalDumps\\lsass.exe\\DumpType'\n        Details: 'DWORD (0x00000002)' # Full Dump\n    condition: selection\nfalsepositives:\n    - Legitimate application that needs to do a full dump of their process\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_lolbin_onedrivestandaloneupdater.yml","content":"title: Lolbas OneDriveStandaloneUpdater.exe Proxy Download\nid: 3aff0be0-7802-4a7e-a4fa-c60c74bc5e1d\nstatus: test\ndescription: |\n    Detects setting a custom URL for OneDriveStandaloneUpdater.exe to download a file from the Internet without executing any\n    anomalous executables with suspicious arguments. The downloaded file will be in C:\\Users\\redacted\\AppData\\Local\\Microsoft\\OneDrive\\StandaloneUpdaterreSignInSettingsConfig.json\nreferences:\n    - https://lolbas-project.github.io/lolbas/Binaries/OneDriveStandaloneUpdater/\nauthor: frack113\ndate: 2022-05-28\nmodified: 2023-08-17\ntags:\n    - attack.command-and-control\n    - attack.t1105\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\SOFTWARE\\Microsoft\\OneDrive\\UpdateOfficeConfig\\UpdateRingSettingURLFromOC'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_legalnotice_susp_message.yml","content":"title: Potential Ransomware Activity Using LegalNotice Message\nid: 8b9606c9-28be-4a38-b146-0e313cc232c1\nstatus: test\ndescription: Detect changes to the \"LegalNoticeCaption\" or \"LegalNoticeText\" registry values where the message set contains keywords often used in ransomware ransom messages\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/5c1e6f1b4fafd01c8d1ece85f510160fc1275fbf/atomics/T1491.001/T1491.001.md\nauthor: frack113\ndate: 2022-12-11\nmodified: 2023-08-17\ntags:\n    - attack.impact\n    - attack.t1491.001\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection:\n        TargetObject|contains:\n            - '\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\LegalNoticeCaption'\n            - '\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\LegalNoticeText'\n        Details|contains:\n            - 'encrypted'\n            - 'Unlock-Password'\n            - 'paying'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_internet_explorer_disable_first_run_customize.yml","content":"title: Internet Explorer DisableFirstRunCustomize Enabled\nid: ab567429-1dfb-4674-b6d2-979fd2f9d125\nstatus: test\ndescription: |\n    Detects changes to the Internet Explorer \"DisableFirstRunCustomize\" value, which prevents Internet Explorer from running the first run wizard the first time a user starts the browser after installing Internet Explorer or Windows.\nreferences:\n    - https://www.ncsc.gov.uk/static-assets/documents/malware-analysis-reports/devil-bait/NCSC-MAR-Devil-Bait.pdf\n    - https://unit42.paloaltonetworks.com/operation-ke3chang-resurfaces-with-new-tidepool-malware/\n    - https://admx.help/?Category=InternetExplorer&Policy=Microsoft.Policies.InternetExplorer::NoFirstRunCustomise\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-05-16\nmodified: 2025-10-07\ntags:\n    - attack.defense-evasion\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection:\n        TargetObject|endswith: '\\Microsoft\\Internet Explorer\\Main\\DisableFirstRunCustomize'\n        Details:\n            - 'DWORD (0x00000001)' # Home Page\n            - 'DWORD (0x00000002)' # Welcome To IE\n    filter_main_generic:\n        Image:\n            - 'C:\\Windows\\explorer.exe'\n            - 'C:\\Windows\\System32\\ie4uinit.exe'\n    filter_optional_avira:\n        Image|contains|all:\n            - '\\Temp\\'\n            - '\\.cr\\avira_'\n        Details|contains: 'DWORD (0x00000001)'\n    filter_optional_foxit:\n        Image:\n            - 'C:\\Program Files (x86)\\Foxit Software\\Foxit PDF Reader\\FoxitPDFReader.exe'\n            - 'C:\\Program Files\\Foxit Software\\Foxit PDF Reader\\FoxitPDFReader.exe'\n        Details|contains: 'DWORD (0x00000001)'\n    condition: selection and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - As this is controlled by group policy as well as user settings. Some false positives may occur.\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_install_root_or_ca_certificat.yml","content":"title: New Root or CA or AuthRoot Certificate to Store\nid: d223b46b-5621-4037-88fe-fda32eead684\nstatus: test\ndescription: Detects the addition of new root, CA or AuthRoot certificates to the Windows registry\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1553.004/T1553.004.md#atomic-test-6---add-root-certificate-to-currentuser-certificate-store\n    - https://posts.specterops.io/code-signing-certificate-cloning-attacks-and-defenses-6f98657fc6ec\nauthor: frack113\ndate: 2022-04-04\nmodified: 2023-08-17\ntags:\n    - attack.impact\n    - attack.t1490\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains:\n            - '\\SOFTWARE\\Microsoft\\SystemCertificates\\Root\\Certificates\\'\n            - '\\SOFTWARE\\Policies\\Microsoft\\SystemCertificates\\Root\\Certificates\\'\n            - '\\SOFTWARE\\Microsoft\\EnterpriseCertificates\\Root\\Certificates\\'\n            - '\\SOFTWARE\\Microsoft\\SystemCertificates\\CA\\Certificates\\'\n            - '\\SOFTWARE\\Policies\\Microsoft\\SystemCertificates\\CA\\Certificates\\'\n            - '\\SOFTWARE\\Microsoft\\EnterpriseCertificates\\CA\\Certificates\\'\n            - '\\SOFTWARE\\Microsoft\\SystemCertificates\\AuthRoot\\Certificates\\'\n            - '\\SOFTWARE\\Policies\\Microsoft\\SystemCertificates\\AuthRoot\\Certificates\\'\n            - '\\SOFTWARE\\Microsoft\\EnterpriseCertificates\\AuthRoot\\Certificates\\'\n        TargetObject|endswith: '\\Blob'\n        Details: 'Binary Data'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_ime_suspicious_paths.yml","content":"title: Suspicious Path In Keyboard Layout IME File Registry Value\nid: 9d8f9bb8-01af-4e15-a3a2-349071530530\nrelated:\n    - id: b888e3f2-224d-4435-b00b-9dd66e9ea1f1\n      type: derived\nstatus: test\ndescription: |\n    Detects usage of Windows Input Method Editor (IME) keyboard layout feature, which allows an attacker to load a DLL into the process after sending the WM_INPUTLANGCHANGEREQUEST message.\n    Before doing this, the client needs to register the DLL in a special registry key that is assumed to implement this keyboard layout. This registry key should store a value named \"Ime File\" with a DLL path.\n    IMEs are essential for languages that have more characters than can be represented on a standard keyboard, such as Chinese, Japanese, and Korean.\nreferences:\n    - https://www.linkedin.com/pulse/guntior-story-advanced-bootkit-doesnt-rely-windows-disk-baranov-wue8e/\nauthor: X__Junior (Nextron Systems)\ndate: 2023-11-21\ntags:\n    - attack.defense-evasion\n    - attack.t1562.001\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection_registry:\n        TargetObject|contains|all:\n            - '\\Control\\Keyboard Layouts\\'\n            - 'Ime File'\n    selection_folders_1:\n        Details|contains:\n            - ':\\Perflogs\\'\n            - ':\\Users\\Public\\'\n            - ':\\Windows\\Temp\\'\n            - '\\AppData\\Local\\Temp\\'\n            - '\\AppData\\Roaming\\'\n            - '\\Temporary Internet'\n    selection_folders_2:\n        - Details|contains|all:\n              - ':\\Users\\'\n              - '\\Favorites\\'\n        - Details|contains|all:\n              - ':\\Users\\'\n              - '\\Favourites\\'\n        - Details|contains|all:\n              - ':\\Users\\'\n              - '\\Contacts\\'\n    condition: selection_registry and 1 of selection_folders_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_ime_non_default_extension.yml","content":"title: Uncommon Extension In Keyboard Layout IME File Registry Value\nid: b888e3f2-224d-4435-b00b-9dd66e9ea1f1\nrelated:\n    - id: 9d8f9bb8-01af-4e15-a3a2-349071530530\n      type: derived\nstatus: test\ndescription: |\n    Detects usage of Windows Input Method Editor (IME) keyboard layout feature, which allows an attacker to load a DLL into the process after sending the WM_INPUTLANGCHANGEREQUEST message.\n    Before doing this, the client needs to register the DLL in a special registry key that is assumed to implement this keyboard layout. This registry key should store a value named \"Ime File\" with a DLL path.\n    IMEs are essential for languages that have more characters than can be represented on a standard keyboard, such as Chinese, Japanese, and Korean.\nreferences:\n    - https://www.linkedin.com/pulse/guntior-story-advanced-bootkit-doesnt-rely-windows-disk-baranov-wue8e/\nauthor: X__Junior (Nextron Systems)\ndate: 2023-11-21\ntags:\n    - attack.defense-evasion\n    - attack.t1562.001\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection:\n        TargetObject|contains|all:\n            - '\\Control\\Keyboard Layouts\\'\n            - 'Ime File'\n    filter_main_known_extension:\n        Details|endswith: '.ime'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - IMEs are essential for languages that have more characters than can be represented on a standard keyboard, such as Chinese, Japanese, and Korean.\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_ie_security_zone_protocol_defaults_downgrade.yml","content":"title: IE ZoneMap Setting Downgraded To MyComputer Zone For HTTP Protocols\nid: 3fd4c8d7-8362-4557-a8e6-83b29cc0d724\nrelated:\n    - id: 10344bb3-7f65-46c2-b915-2d00d47be5b0\n      type: similar\nstatus: test\ndescription: |\n    Detects changes to Internet Explorer's (IE / Windows Internet properties) ZoneMap configuration of the \"HTTP\" and \"HTTPS\" protocols to point to the \"My Computer\" zone. This allows downloaded files from the Internet to be granted the same level of trust as files stored locally.\nreferences:\n    - https://twitter.com/M_haggis/status/1699056847154725107\n    - https://twitter.com/JAMESWT_MHT/status/1699042827261391247\n    - https://learn.microsoft.com/en-us/troubleshoot/developer/browsers/security-privacy/ie-security-zones-registry-entries\n    - https://www.virustotal.com/gui/file/339ff720c74dc44265b917b6d3e3ba0411d61f3cd3c328e9a2bae81592c8a6e5/content\nauthor: Nasreddine Bencherchali (Nextron Systems), Michael Haag (idea)\ndate: 2023-09-05\ntags:\n    - attack.defense-evasion\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection:\n        TargetObject|contains: '\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ZoneMap\\ProtocolDefaults'\n        TargetObject|endswith:\n            - '\\http'\n            - '\\https'\n        Details|contains: 'DWORD (0x00000000)'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_hvci_disallowed_images.yml","content":"title: Driver Added To Disallowed Images In HVCI - Registry\nid: 555155a2-03bf-4fe7-af74-d176b3fdbe16\nrelated:\n    - id: 44cee399-f6b1-45cc-a87c-ea14c6064d6b\n      type: similar\nstatus: test\ndescription: |\n    Detects changes to the \"HVCIDisallowedImages\" registry value to potentially add a driver to the list, in order to prevent it from loading.\nreferences:\n    - https://github.com/yardenshafir/conference_talks/blob/3de1f5d7c02656c35117f067fbff0a219c304b09/OffensiveCon_2023_Your_Mitigations_are_My_Opportunities.pdf\n    - https://x.com/yarden_shafir/status/1822667605175324787\nauthor: Nasreddine Bencherchali (Nextron Systems), Omar Khaled (@beacon_exe)\ndate: 2023-12-05\nmodified: 2024-08-21\ntags:\n    - attack.defense-evasion\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains|all:\n            - '\\Control\\CI\\'\n            - '\\HVCIDisallowedImages'\n    condition: selection\nfalsepositives:\n    - Legitimate usage of this key would also trigger this. Investigate the driver being added and make sure its intended\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_hide_scheduled_task_via_index_tamper.yml","content":"title: Hide Schedule Task Via Index Value Tamper\nid: 5b16df71-8615-4f7f-ac9b-6c43c0509e61\nrelated:\n    - id: acd74772-5f88-45c7-956b-6a7b36c294d2\n      type: similar\n    - id: 526cc8bc-1cdc-48ad-8b26-f19bff969cec\n      type: similar\nstatus: test\ndescription: |\n  Detects when the \"index\" value of a scheduled task is modified from the registry\n  Which effectively hides it from any tooling such as \"schtasks /query\" (Read the referenced link for more information about the effects of this technique)\nreferences:\n    - https://blog.qualys.com/vulnerabilities-threat-research/2022/06/20/defending-against-scheduled-task-attacks-in-windows-environments\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-08-26\nmodified: 2023-08-17\ntags:\n    - attack.defense-evasion\n    - attack.t1562\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains|all:\n            - '\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tree\\'\n            - 'Index'\n        Details: DWORD (0x00000000)\n    condition: selection\nfalsepositives:\n    - Unlikely\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_hide_function_user.yml","content":"title: Registry Hide Function from User\nid: 5a93eb65-dffa-4543-b761-94aa60098fb6\nstatus: test\ndescription: Detects registry modifications that hide internal tools or functions from the user (malware like Agent Tesla, Hermetic Wiper uses this technique)\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1564.001/T1564.001.md\nauthor: frack113\ndate: 2022-03-18\nmodified: 2023-08-17\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_set_1:\n        TargetObject|endswith:\n            - 'SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\HideClock'\n            - 'SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\HideSCAHealth'\n            - 'SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\HideSCANetwork'\n            - 'SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\HideSCAPower'\n            - 'SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\HideSCAVolume'\n        Details: 'DWORD (0x00000001)'\n    selection_set_0:\n        TargetObject|endswith:\n            - 'SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced\\ShowInfoTip'\n            - 'SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced\\ShowCompColor'\n        Details: 'DWORD (0x00000000)'\n    condition: 1 of selection_set_*\nfalsepositives:\n    - Legitimate admin script\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_hide_file.yml","content":"title: Displaying Hidden Files Feature Disabled\nid: 5a5152f1-463f-436b-b2f5-8eceb3964b42\nstatus: test\ndescription: |\n    Detects modifications to the \"Hidden\" and \"ShowSuperHidden\" explorer registry values in order to disable showing of hidden files and system files.\n    This technique is abused by several malware families to hide their files from normal users.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1564.001/T1564.001.md#atomic-test-8---hide-files-through-registry\nauthor: frack113\ndate: 2022-04-02\nmodified: 2024-03-26\ntags:\n    - attack.defense-evasion\n    - attack.t1564.001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith:\n            - '\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced\\ShowSuperHidden'\n            - '\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced\\Hidden'\n        Details: 'DWORD (0x00000000)'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_hidden_extention.yml","content":"title: Registry Modification to Hidden File Extension\nid: 5df86130-4e95-4a54-90f7-26541b40aec2\nstatus: test\ndescription: Hides the file extension through modification of the registry\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1112/T1112.md#atomic-test-1---modify-registry-of-current-user-profile---cmd\n    - https://unit42.paloaltonetworks.com/ransomware-families/\n    - https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?name=TrojanSpy%3aMSIL%2fHakey.A\nauthor: frack113\ndate: 2022-01-22\nmodified: 2023-08-17\ntags:\n    - attack.persistence\n    - attack.t1137\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_HideFileExt:\n        TargetObject|endswith: '\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced\\HideFileExt'\n        Details: 'DWORD (0x00000001)'\n    selection_Hidden:\n        TargetObject|endswith: '\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced\\Hidden'\n        Details: 'DWORD (0x00000002)'\n    condition: 1 of selection_*\nfalsepositives:\n    - Administrative scripts\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_hhctrl_persistence.yml","content":"title: Persistence Via Hhctrl.ocx\nid: f10ed525-97fe-4fed-be7c-2feecca941b1\nstatus: test\ndescription: Detects when an attacker modifies the registry value of the \"hhctrl\" to point to a custom binary\nreferences:\n    - https://persistence-info.github.io/Data/hhctrl.html\n    - https://www.hexacorn.com/blog/2018/04/23/beyond-good-ol-run-key-part-77/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-07-21\nmodified: 2023-08-17\ntags:\n    - attack.persistence\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\CLSID\\{52A2AAAE-085D-4187-97EA-8C30DB990436}\\InprocServer32\\(Default)'\n    filter:\n        Details: 'C:\\Windows\\System32\\hhctrl.ocx'\n    condition: selection and not filter\nfalsepositives:\n    - Unlikely\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_hangs_debugger_persistence.yml","content":"title: Add Debugger Entry To Hangs Key For Persistence\nid: 833ef470-fa01-4631-a79b-6f291c9ac498\nstatus: test\ndescription: Detects when an attacker adds a new \"Debugger\" value to the \"Hangs\" key in order to achieve persistence which will get invoked when an application crashes\nreferences:\n    - https://persistence-info.github.io/Data/wer_debugger.html\n    - https://www.hexacorn.com/blog/2019/09/20/beyond-good-ol-run-key-part-116/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-07-21\nmodified: 2023-08-17\ntags:\n    - attack.persistence\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\SOFTWARE\\Microsoft\\Windows\\Windows Error Reporting\\Hangs\\Debugger'\n    condition: selection\nfalsepositives:\n    - This value is not set by default but could be rarly used by administrators\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_file_association_exefile.yml","content":"title: New File Association Using Exefile\nid: 44a22d59-b175-4f13-8c16-cbaef5b581ff\nstatus: test\ndescription: Detects the abuse of the exefile handler in new file association. Used for bypass of security products.\nreferences:\n    - https://twitter.com/mrd0x/status/1461041276514623491\nauthor: Andreas Hunkeler (@Karneades)\ndate: 2021-11-19\nmodified: 2023-08-17\ntags:\n    - attack.defense-evasion\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: 'Classes\\.'\n        Details: 'exefile'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_filefix_typedpath_commands.yml","content":"title: FileFix - Command Evidence in TypedPaths\nid: 4fee3d51-8069-4a4c-a0f7-924fcaff2c70\nrelated:\n    - id: 4be03877-d5b6-4520-85c9-a5911c0a656c\n      type: similar\nstatus: experimental\ndescription: |\n    Detects commonly-used chained commands and strings in the most recent 'url' value of the 'TypedPaths' key, which could be indicative of a user being targeted by the FileFix technique.\nreferences:\n    - https://x.com/russianpanda9xx/status/1940831134759506029\n    - https://mrd0x.com/filefix-clickfix-alternative/\n    - https://www.scpx.com.au/2025/11/16/decades-old-finger-protocol-abused-in-clickfix-malware-attacks/\nauthor: Alfie Champion (delivr.to), Swachchhanda Shrawan Poudel (Nextron Systems)\ndate: 2025-07-05\nmodified: 2025-11-19\ntags:\n    - attack.execution\n    - attack.t1204.004\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_base:\n        TargetObject|endswith: '\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\TypedPaths\\url1'\n        Details|contains|all:\n            - '#'\n            - 'http'\n    selection_cmd:\n        - Details|contains:\n              # Add more suspicious keywords\n              - 'account'\n              - 'anti-bot'\n              - 'botcheck'\n              - 'captcha'\n              - 'challenge'\n              - 'confirmation'\n              - 'fraud'\n              - 'human'\n              - 'identification'\n              - 'identificator'\n              - 'identity'\n              - 'robot'\n              - 'validation'\n              - 'verification'\n              - 'verify'\n        - Details|contains:\n              - '%comspec%'\n              - 'bitsadmin'\n              - 'certutil'\n              - 'cmd'\n              - 'cscript'\n              - 'curl'\n              - 'finger'\n              - 'mshta'\n              - 'powershell'\n              - 'pwsh'\n              - 'regsvr32'\n              - 'rundll32'\n              - 'schtasks'\n              - 'wget'\n              - 'wscript'\n    condition: all of selection_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_fax_dll_persistance.yml","content":"title: Change the Fax Dll\nid: 9e3357ba-09d4-4fbd-a7c5-ad6386314513\nstatus: test\ndescription: Detect possible persistence using Fax DLL load when service restart\nreferences:\n    - https://twitter.com/dottor_morte/status/1544652325570191361\n    - https://raw.githubusercontent.com/RiccardoAncarani/talks/master/F-Secure/unorthodox-lateral-movement.pdf\nauthor: frack113\ndate: 2022-07-17\nmodified: 2022-12-30\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection:\n        TargetObject|contains|all:\n            - '\\Software\\Microsoft\\Fax\\Device Providers\\'\n            - '\\ImageName'\n    filter:\n        Details: '%systemroot%\\system32\\fxst30.dll' # Windows 10\n    condition: selection and not filter\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_fax_change_service_user.yml","content":"title: Change User Account Associated with the FAX Service\nid: e3fdf743-f05b-4051-990a-b66919be1743\nstatus: test\ndescription: Detect change of the user account associated with the FAX service to avoid the escalation problem.\nreferences:\n    - https://twitter.com/dottor_morte/status/1544652325570191361\n    - https://raw.githubusercontent.com/RiccardoAncarani/talks/master/F-Secure/unorthodox-lateral-movement.pdf\nauthor: frack113\ndate: 2022-07-17\nmodified: 2022-12-30\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection:\n        TargetObject: HKLM\\System\\CurrentControlSet\\Services\\Fax\\ObjectName\n    filter:\n        Details|contains: NetworkService\n    condition: selection and not filter\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_exploit_guard_susp_allowed_apps.yml","content":"title: Suspicious Application Allowed Through Exploit Guard\nid: 42205c73-75c8-4a63-9db1-e3782e06fda0\nstatus: test\ndescription: Detects applications being added to the \"allowed applications\" list of exploit guard in order to bypass controlled folder settings\nreferences:\n    - https://www.microsoft.com/security/blog/2017/10/23/windows-defender-exploit-guard-reduce-the-attack-surface-against-next-generation-malware/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-08-05\nmodified: 2023-08-17\ntags:\n    - attack.defense-evasion\n    - attack.t1562.001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_key:\n        TargetObject|contains: 'SOFTWARE\\Microsoft\\Windows Defender\\Windows Defender Exploit Guard\\Controlled Folder Access\\AllowedApplications'\n    selection_paths:\n        TargetObject|contains:\n            # Add more paths you don't allow in your org\n            - '\\Users\\Public\\'\n            - '\\AppData\\Local\\Temp\\'\n            - '\\Desktop\\'\n            - '\\PerfLogs\\'\n            - '\\Windows\\Temp\\'\n    condition: all of selection_*\nfalsepositives:\n    - Unlikely\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_evtx_file_key_tamper.yml","content":"title: Potential EventLog File Location Tampering\nid: 0cb8d736-995d-4ce7-a31e-1e8d452a1459\nstatus: test\ndescription: Detects tampering with EventLog service \"file\" key. In order to change the default location of an Evtx file. This technique is used to tamper with log collection and alerting\nreferences:\n    - https://learn.microsoft.com/en-us/windows/win32/eventlog/eventlog-key\nauthor: D3F7A5105\ndate: 2023-01-02\nmodified: 2023-08-17\ntags:\n    - attack.defense-evasion\n    - attack.t1562.002\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\SYSTEM\\CurrentControlSet\\Services\\EventLog\\'\n        TargetObject|endswith: '\\File'\n    filter:\n        Details|contains: '\\System32\\Winevt\\Logs\\'\n    condition: selection and not filter\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_enabling_turnoffcheck.yml","content":"title: Scripted Diagnostics Turn Off Check Enabled - Registry\nid: 7d995e63-ec83-4aa3-89d5-8a17b5c87c86\nstatus: test\ndescription: Detects enabling TurnOffCheck which can be used to bypass defense of MSDT Follina vulnerability\nreferences:\n    - https://twitter.com/wdormann/status/1537075968568877057?s=20&t=0lr18OAnmAGoGpma6grLUw\nauthor: 'Christopher Peacock @securepeacock, SCYTHE @scythe_io'\ndate: 2022-06-15\nmodified: 2023-08-17\ntags:\n    - attack.defense-evasion\n    - attack.t1562.001\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection:\n        TargetObject|endswith: '\\Policies\\Microsoft\\Windows\\ScriptedDiagnostics\\TurnOffCheck'\n        Details: 'DWORD (0x00000001)'\n    condition: selection\nfalsepositives:\n    - Administrator actions\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_enabling_cor_profiler_env_variables.yml","content":"title: Enabling COR Profiler Environment Variables\nid: ad89044a-8f49-4673-9a55-cbd88a1b374f\nstatus: test\ndescription: Detects .NET Framework CLR and .NET Core CLR \"cor_enable_profiling\" and \"cor_profiler\" variables being set and configured.\nreferences:\n    - https://twitter.com/jamieantisocial/status/1304520651248668673\n    - https://www.slideshare.net/JamieWilliams130/started-from-the-bottom-exploiting-data-sources-to-uncover-attck-behaviors\n    - https://www.sans.org/cyber-security-summit/archives\n    - https://learn.microsoft.com/en-us/dotnet/core/runtime-config/debugging-profiling\nauthor: Jose Rodriguez (@Cyb3rPandaH), OTR (Open Threat Research), Jimmy Bayne (@bohops)\ndate: 2020-09-10\nmodified: 2023-11-24\ntags:\n    - attack.persistence\n    - attack.privilege-escalation\n    - attack.defense-evasion\n    - attack.t1574.012\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_1:\n        TargetObject|endswith:\n            - '\\COR_ENABLE_PROFILING'\n            - '\\COR_PROFILER'\n            - '\\CORECLR_ENABLE_PROFILING'\n    selection_2:\n        TargetObject|contains: '\\CORECLR_PROFILER_PATH'\n    condition: 1 of selection_*\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_enable_windows_recall.yml","content":"title: Windows Recall Feature Enabled - Registry\nid: 75180c5f-4ea1-461a-a4f6-6e4700c065d4\nrelated:\n    - id: 5dfc1465-8f65-4fde-8eb5-6194380c6a62\n      type: similar\n    - id: 817f252c-5143-4dae-b418-48c3e9f63728\n      type: similar\nstatus: test\ndescription: |\n    Detects the enabling of the Windows Recall feature via registry manipulation. Windows Recall can be enabled by setting the value of \"DisableAIDataAnalysis\" to \"0\".\n    Adversaries may enable Windows Recall as part of post-exploitation discovery and collection activities.\n    This rule assumes that Recall is already explicitly disabled on the host, and subsequently enabled by the adversary.\nreferences:\n    - https://learn.microsoft.com/en-us/windows/client-management/manage-recall\n    - https://learn.microsoft.com/en-us/windows/client-management/mdm/policy-csp-windowsai#disableaidataanalysis\nauthor: Sajid Nawaz Khan\ndate: 2024-06-02\ntags:\n    - attack.collection\n    - attack.t1113\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        # HKEY_CURRENT_USER\\Software\\Policies\\Microsoft\\Windows\\WindowsAI\\DisableAIDataAnalysis\n        # HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsAI\\DisableAIDataAnalysis\n        TargetObject|endswith: '\\Software\\Policies\\Microsoft\\Windows\\WindowsAI\\DisableAIDataAnalysis'\n        Details: 'DWORD (0x00000000)'\n    condition: selection\nfalsepositives:\n    - Legitimate use/activation of Windows Recall\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_enable_periodic_backup.yml","content":"title: Periodic Backup For System Registry Hives Enabled\nid: 973ef012-8f1a-4c40-93b4-7e659a5cd17f\nstatus: test\ndescription: |\n    Detects the enabling of the \"EnablePeriodicBackup\" registry value. Once enabled, The OS will backup System registry hives on restarts to the \"C:\\Windows\\System32\\config\\RegBack\" folder. Windows creates a \"RegIdleBackup\" task to manage subsequent backups.\n    Registry backup was a default behavior on Windows and was disabled as of \"Windows 10, version 1803\".\nreferences:\n    - https://learn.microsoft.com/en-us/troubleshoot/windows-client/installing-updates-features-roles/system-registry-no-backed-up-regback-folder\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2024-07-01\ntags:\n    - attack.collection\n    - attack.t1113\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: '\\Control\\Session Manager\\Configuration Manager\\EnablePeriodicBackup'\n        Details: 'DWORD (0x00000001)'\n    condition: selection\nfalsepositives:\n    - Legitimate need for RegBack feature by administrators.\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_dsrm_tampering.yml","content":"title: Directory Service Restore Mode(DSRM) Registry Value Tampering\nid: b61e87c0-50db-4b2e-8986-6a2be94b33b0\nrelated:\n    - id: 53ad8e36-f573-46bf-97e4-15ba5bf4bb51\n      type: similar\nstatus: test\ndescription: |\n    Detects changes to \"DsrmAdminLogonBehavior\" registry value.\n    During a Domain Controller (DC) promotion, administrators create a Directory Services Restore Mode (DSRM) local administrator account with a password that rarely changes. The DSRM account is an “Administrator” account that logs in with the DSRM mode when the server is booting up to restore AD backups or recover the server from a failure.\n    Attackers could abuse DSRM account to maintain their persistence and access to the organization's Active Directory.\n    If the \"DsrmAdminLogonBehavior\" value is set to \"0\", the administrator account can only be used if the DC starts in DSRM.\n    If the \"DsrmAdminLogonBehavior\" value is set to \"1\", the administrator account can only be used if the local AD DS service is stopped.\n    If the \"DsrmAdminLogonBehavior\" value is set to \"2\", the administrator account can always be used.\nreferences:\n    - https://adsecurity.org/?p=1785\n    - https://www.sentinelone.com/blog/detecting-dsrm-account-misconfigurations/\n    - https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/dsrm-credentials\nauthor: Nischal Khadgi\ndate: 2024-07-11\ntags:\n    - attack.defense-evasion\n    - attack.credential-access\n    - attack.persistence\n    - attack.t1556\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: '\\Control\\Lsa\\DsrmAdminLogonBehavior'\n    filter_main_default_value:\n        Details: 'DWORD (0x00000000)' # Default value\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_dot_net_etw_tamper.yml","content":"title: ETW Logging Disabled In .NET Processes - Sysmon Registry\nid: bf4fc428-dcc3-4bbd-99fe-2422aeee2544\nrelated:\n    - id: a4c90ea1-2634-4ca0-adbb-35eae169b6fc\n      type: similar\nstatus: test\ndescription: Potential adversaries stopping ETW providers recording loaded .NET assemblies.\nreferences:\n    - https://twitter.com/_xpn_/status/1268712093928378368\n    - https://social.msdn.microsoft.com/Forums/vstudio/en-US/0878832e-39d7-4eaf-8e16-a729c4c40975/what-can-i-use-e13c0d23ccbc4e12931bd9cc2eee27e4-for?forum=clr\n    - https://github.com/dotnet/runtime/blob/ee2355c801d892f2894b0f7b14a20e6cc50e0e54/docs/design/coreclr/jit/viewing-jit-dumps.md#setting-configuration-variables\n    - https://github.com/dotnet/runtime/blob/f62e93416a1799aecc6b0947adad55a0d9870732/src/coreclr/src/inc/clrconfigvalues.h#L35-L38\n    - https://github.com/dotnet/runtime/blob/7abe42dc1123722ed385218268bb9fe04556e3d3/src/coreclr/src/inc/clrconfig.h#L33-L39\n    - https://github.com/dotnet/runtime/search?p=1&q=COMPlus_&unscoped_q=COMPlus_\n    - https://bunnyinside.com/?term=f71e8cb9c76a\n    - http://managed670.rssing.com/chan-5590147/all_p1.html\n    - https://github.com/dotnet/runtime/blob/4f9ae42d861fcb4be2fcd5d3d55d5f227d30e723/docs/coding-guidelines/clr-jit-coding-conventions.md#1412-disabling-code\n    - https://blog.xpnsec.com/hiding-your-dotnet-complus-etwenabled/\n    - https://i.blackhat.com/EU-21/Wednesday/EU-21-Teodorescu-Veni-No-Vidi-No-Vici-Attacks-On-ETW-Blind-EDRs.pdf\nauthor: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)\ndate: 2020-06-05\nmodified: 2023-08-17\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\n    - attack.t1562\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection_etw_enabled:\n        TargetObject|endswith: 'SOFTWARE\\Microsoft\\.NETFramework\\ETWEnabled'\n        Details: 'DWORD (0x00000000)'\n    selection_complus:\n        TargetObject|endswith:\n            - '\\COMPlus_ETWEnabled'\n            - '\\COMPlus_ETWFlags'\n        Details:\n            - 0 # For REG_SZ type\n            - 'DWORD (0x00000000)'\n    condition: 1 of selection_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_dns_server_level_plugin_dll.yml","content":"title: New DNS ServerLevelPluginDll Installed\nid: e61e8a88-59a9-451c-874e-70fcc9740d67\nrelated:\n    - id: cbe51394-cd93-4473-b555-edf0144952d9\n      type: derived\n    - id: f63b56ee-3f79-4b8a-97fb-5c48007e8573\n      type: derived\nstatus: test\ndescription: Detects the installation of a DNS plugin DLL via ServerLevelPluginDll parameter in registry, which can be used to execute code in context of the DNS server (restart required)\nreferences:\n    - https://medium.com/@esnesenon/feature-not-bug-dnsadmin-to-dc-compromise-in-one-line-a0f779b8dc83\n    - https://blog.3or.de/hunting-dns-server-level-plugin-dll-injection.html\nauthor: Florian Roth (Nextron Systems)\ndate: 2017-05-08\nmodified: 2023-08-17\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1574.001\n    - attack.t1112\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection:\n        TargetObject|endswith: '\\services\\DNS\\Parameters\\ServerLevelPluginDll'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_dns_over_https_enabled.yml","content":"title: DNS-over-HTTPS Enabled by Registry\nid: 04b45a8a-d11d-49e4-9acc-4a1b524407a5\nstatus: test\ndescription: |\n    Detects when a user enables DNS-over-HTTPS.\n    This can be used to hide internet activity or be used to hide the process of exfiltrating data.\n    With this enabled organization will lose visibility into data such as query type, response and originating IP that are used to determine bad actors.\nreferences:\n    - https://www.tenforums.com/tutorials/151318-how-enable-disable-dns-over-https-doh-microsoft-edge.html\n    - https://github.com/elastic/detection-rules/issues/1371\n    - https://chromeenterprise.google/policies/?policy=DnsOverHttpsMode\n    - https://admx.help/HKLM/Software/Policies/Mozilla/Firefox/DNSOverHTTPS\nauthor: Austin Songer\ndate: 2021-07-22\nmodified: 2023-08-17\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1140\n    - attack.t1112\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection_edge:\n        TargetObject|endswith: '\\SOFTWARE\\Policies\\Microsoft\\Edge\\BuiltInDnsClientEnabled'\n        Details: DWORD (0x00000001)\n    selection_chrome:\n        TargetObject|endswith: '\\SOFTWARE\\Google\\Chrome\\DnsOverHttpsMode'\n        Details: 'secure'\n    selection_firefox:\n        TargetObject|endswith: '\\SOFTWARE\\Policies\\Mozilla\\Firefox\\DNSOverHTTPS\\Enabled'\n        Details: DWORD (0x00000001)\n    condition: 1 of selection_*\nfalsepositives:\n    - Unlikely\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_disk_cleanup_handler_autorun_persistence.yml","content":"title: Persistence Via Disk Cleanup Handler - Autorun\nid: d4e2745c-f0c6-4bde-a3ab-b553b3f693cc\nstatus: test\ndescription: |\n    Detects when an attacker modifies values of the Disk Cleanup Handler in the registry to achieve persistence via autorun.\n    The disk cleanup manager is part of the operating system.\n    It displays the dialog box […] The user has the option of enabling or disabling individual handlers by selecting or clearing their check box in the disk cleanup manager's UI.\n    Although Windows comes with a number of disk cleanup handlers, they aren't designed to handle files produced by other applications.\n    Instead, the disk cleanup manager is designed to be flexible and extensible by enabling any developer to implement and register their own disk cleanup handler.\n    Any developer can extend the available disk cleanup services by implementing and registering a disk cleanup handler.\nreferences:\n    - https://persistence-info.github.io/Data/diskcleanuphandler.html\n    - https://www.hexacorn.com/blog/2018/09/02/beyond-good-ol-run-key-part-86/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-07-21\nmodified: 2023-08-17\ntags:\n    - attack.persistence\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    root:\n        TargetObject|contains: '\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\VolumeCaches\\'\n    selection_autorun:\n        # Launching PreCleanupString / CleanupString programs w/o gui, i.e. while using e.g. /autoclean\n        TargetObject|contains: '\\Autorun'\n        Details: 'DWORD (0x00000001)'\n    selection_pre_after:\n        TargetObject|contains:\n            - '\\CleanupString'\n            - '\\PreCleanupString'\n        Details|contains:\n            # Add more as you see fit\n            - 'cmd'\n            - 'powershell'\n            - 'rundll32'\n            - 'mshta'\n            - 'cscript'\n            - 'wscript'\n            - 'wsl'\n            - '\\Users\\Public\\'\n            - '\\Windows\\TEMP\\'\n            - '\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\'\n    condition: root and 1 of selection_*\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_disallowrun_execution.yml","content":"title: Add DisallowRun Execution to Registry\nid: 275641a5-a492-45e2-a817-7c81e9d9d3e9\nstatus: test\ndescription: Detect set DisallowRun to 1 to prevent user running specific computer program\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/40b77d63808dd4f4eafb83949805636735a1fd15/atomics/T1112/T1112.md\nauthor: frack113\ndate: 2022-08-19\nmodified: 2023-08-17\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: 'Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\DisallowRun'\n        Details: 'DWORD (0x00000001)'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_disable_winevt_logging.yml","content":"title: Disable Windows Event Logging Via Registry\nid: 2f78da12-f7c7-430b-8b19-a28f269b77a3\nstatus: test\ndescription: Detects tampering with the \"Enabled\" registry key in order to disable Windows logging of a Windows event channel\nreferences:\n    - https://twitter.com/WhichbufferArda/status/1543900539280293889\n    - https://github.com/DebugPrivilege/CPP/blob/c39d365617dbfbcb01fffad200d52b6239b2918c/Windows%20Defender/RestoreDefenderConfig.cpp\nauthor: frack113, Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-07-04\nmodified: 2024-03-25\ntags:\n    - attack.defense-evasion\n    - attack.t1562.002\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\Microsoft\\Windows\\CurrentVersion\\WINEVT\\Channels\\'\n        TargetObject|endswith: '\\Enabled'\n        Details: 'DWORD (0x00000000)'\n    filter_main_wevutil:\n        Image: 'C:\\Windows\\system32\\wevtutil.exe' # FP generated during installation of manifests via wevtutil\n    filter_main_iis:\n        Image|startswith: 'C:\\Windows\\winsxs\\'\n        Image|endswith: '\\TiWorker.exe'  # Many different TargetObjects\n    filter_main_svchost:\n        Image: 'C:\\Windows\\System32\\svchost.exe'\n        TargetObject|contains:\n            - '\\Microsoft\\Windows\\CurrentVersion\\WINEVT\\Channels\\Microsoft-Windows-FileInfoMinifilter'\n            - '\\Microsoft\\Windows\\CurrentVersion\\WINEVT\\Channels\\Microsoft-Windows-ASN1\\'\n            - '\\Microsoft\\Windows\\CurrentVersion\\WINEVT\\Channels\\Microsoft-Windows-Kernel-AppCompat\\'\n            - '\\Microsoft\\Windows\\CurrentVersion\\WINEVT\\Channels\\Microsoft-Windows-Runtime\\Error\\'\n            - '\\Microsoft\\Windows\\CurrentVersion\\WINEVT\\Channels\\Microsoft-Windows-CAPI2/Operational\\'\n    filter_main_trusted_installer:\n        Image: C:\\Windows\\servicing\\TrustedInstaller.exe\n        TargetObject|contains: '\\Microsoft\\Windows\\CurrentVersion\\WINEVT\\Channels\\Microsoft-Windows-Compat-Appraiser'\n    filter_optional_empty: # This filter is related to aurora. Should be removed when fix is deployed. # TODO: Remove later\n        Image: ''\n    filter_optional_null: # This filter is related to aurora. Should be removed when fix is deployed. # TODO: Remove later\n        Image: null\n    condition: selection and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Rare falsepositives may occur from legitimate administrators disabling specific event log for troubleshooting\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_disable_windows_firewall.yml","content":"title: Disable Windows Firewall by Registry\nid: e78c408a-e2ea-43cd-b5ea-51975cf358c0\nstatus: test\ndescription: Detect set EnableFirewall to 0 to disable the Windows firewall\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/40b77d63808dd4f4eafb83949805636735a1fd15/atomics/T1562.004/T1562.004.md\nauthor: frack113\ndate: 2022-08-19\nmodified: 2023-08-17\ntags:\n    - attack.defense-evasion\n    - attack.t1562.004\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith:\n            - \\SOFTWARE\\Policies\\Microsoft\\WindowsFirewall\\StandardProfile\\EnableFirewall\n            - \\SOFTWARE\\Policies\\Microsoft\\WindowsFirewall\\DomainProfile\\EnableFirewall\n        Details: DWORD (0x00000000)\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_disable_windows_event_log_access.yml","content":"title: Windows Event Log Access Tampering Via Registry\nid: ba226dcf-d390-4642-b9af-b534872f1156\nstatus: experimental\ndescription: |\n    Detects changes to the Windows EventLog channel permission values. It focuses on changes to the Security Descriptor Definition Language (SDDL) string, as modifications to these values can restrict access to specific users or groups, potentially aiding in defense evasion by controlling who can view or modify a event log channel. Upon execution, the user shouldn't be able to access the event log channel via the event viewer or via utilities such as \"Get-EventLog\" or \"wevtutil\".\nreferences:\n    - https://www.atomicredteam.io/atomic-red-team/atomics/T1562.002#atomic-test-8---modify-event-log-channel-access-permissions-via-registry---powershell\n    - https://www.youtube.com/watch?v=uSYvHUVU8xY\n    - https://learn.microsoft.com/en-us/windows/win32/secauthz/security-descriptor-definition-language\nauthor: X__Junior\ndate: 2025-01-16\nmodified: 2025-08-16\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1547.001\n    - attack.t1112\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    # O:SYG:SYD:(D;;0x1;;;WD)\n    # O:BAG:SYD:(A;;0x2;;;S-1-15-2-1)(D;;0x1;;;WD)\n    selection_key_1:\n        TargetObject|contains: '\\SYSTEM\\CurrentControlSet\\Services\\EventLog\\'\n        TargetObject|endswith: '\\CustomSD'\n    selection_key_2:\n        TargetObject|contains:\n            - '\\Policies\\Microsoft\\Windows\\EventLog\\'\n            - '\\Microsoft\\Windows\\CurrentVersion\\WINEVT\\Channels'\n        TargetObject|endswith: '\\ChannelAccess'\n    selection_details:\n        - Details|contains: 'D:(D;'\n        - Details|contains|all:\n              - 'D:('\n              - ')(D;'\n    filter_main_trustedinstaller:\n        Image: 'C:\\Windows\\servicing\\TrustedInstaller.exe'\n    filter_main_tiworker:\n        Image|startswith: 'C:\\Windows\\WinSxS\\'\n        Image|endswith: '\\TiWorker.exe'\n    filter_optional_empty:\n        Image: ''\n    filter_optional_null:\n        Image: null\n    condition: 1 of selection_key_* and selection_details and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Administrative activity, still unlikely\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_disable_windows_defender_service.yml","content":"title: Windows Defender Service Disabled - Registry\nid: e1aa95de-610a-427d-b9e7-9b46cfafbe6a\nstatus: test\ndescription: Detects when an attacker or tool disables the  Windows Defender service (WinDefend) via the registry\nreferences:\n    - https://thedfirreport.com/2021/10/18/icedid-to-xinglocker-ransomware-in-24-hours/\n    - https://gist.github.com/anadr/7465a9fde63d41341136949f14c21105\nauthor: Ján Trenčanský, frack113, AlertIQ, Nasreddine Bencherchali\ndate: 2022-08-01\nmodified: 2024-03-25\ntags:\n    - attack.defense-evasion\n    - attack.t1562.001\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection:\n        TargetObject|endswith: '\\Services\\WinDefend\\Start'\n        Details: 'DWORD (0x00000004)'\n    condition: selection\nfalsepositives:\n    - Administrator actions\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_disable_system_restore.yml","content":"title: Registry Disable System Restore\nid: 5de03871-5d46-4539-a82d-3aa992a69a83\nstatus: test\ndescription: Detects the modification of the registry to disable a system restore on the computer\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1490/T1490.md#atomic-test-9---disable-system-restore-through-registry\nauthor: frack113\ndate: 2022-04-04\nmodified: 2023-08-17\ntags:\n    - attack.impact\n    - attack.t1490\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains:\n            - '\\Policies\\Microsoft\\Windows NT\\SystemRestore'\n            - '\\Microsoft\\Windows NT\\CurrentVersion\\SystemRestore'\n        TargetObject|endswith:\n            - DisableConfig\n            - DisableSR\n        Details: 'DWORD (0x00000001)'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_disable_security_center_notifications.yml","content":"title: Disable Windows Security Center Notifications\nid: 3ae1a046-f7db-439d-b7ce-b8b366b81fa6\nstatus: test\ndescription: Detect set UseActionCenterExperience to 0 to disable the Windows security center notification\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/40b77d63808dd4f4eafb83949805636735a1fd15/atomics/T1112/T1112.md\nauthor: frack113\ndate: 2022-08-19\nmodified: 2023-08-17\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: 'Windows\\CurrentVersion\\ImmersiveShell\\UseActionCenterExperience'\n        Details: 'DWORD (0x00000000)'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: medium\nregression_tests_path: regression_data/rules/windows/registry/registry_set/registry_set_disable_security_center_notifications/info.yml\nsimulation:\n    - type: atomic-red-team\n      name: Disable Windows Security Center Notifications\n      technique: T1112\n      atomic_guid: 45914594-8df6-4ea9-b3cc-7eb9321a807e\n"},{"path":"registry\\registry_set\\registry_set_disable_privacy_settings_experience.yml","content":"title: Disable Privacy Settings Experience in Registry\nid: 0372e1f9-0fd2-40f7-be1b-a7b2b848fa7b\nstatus: test\ndescription: Detects registry modifications that disable Privacy Settings Experience\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/9e5b12c4912c07562aec7500447b11fa3e17e254/atomics/T1562.001/T1562.001.md\nauthor: frack113\ndate: 2022-10-02\nmodified: 2023-08-17\ntags:\n    - attack.defense-evasion\n    - attack.t1562.001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: '\\SOFTWARE\\Policies\\Microsoft\\Windows\\OOBE\\DisablePrivacyExperience'\n        Details: 'DWORD (0x00000000)'\n    condition: selection\nfalsepositives:\n    - Legitimate admin script\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_disable_macroruntimescanscope.yml","content":"title: Disable Macro Runtime Scan Scope\nid: ab871450-37dc-4a3a-997f-6662aa8ae0f1\ndescription: Detects tampering with the MacroRuntimeScanScope registry key to disable runtime scanning of enabled macros\nstatus: test\ndate: 2022-10-25\nmodified: 2023-08-17\nauthor: Nasreddine Bencherchali (Nextron Systems)\nreferences:\n    - https://www.microsoft.com/en-us/security/blog/2018/09/12/office-vba-amsi-parting-the-veil-on-malicious-macros/\n    - https://admx.help/?Category=Office2016&Policy=office16.Office.Microsoft.Policies.Windows::L_MacroRuntimeScanScope\n    - https://github.com/S3cur3Th1sSh1t/OffensiveVBA/blob/28cc6a2802d8176195ac19b3c8e9a749009a82a3/src/AMSIbypasses.vba\ntags:\n    - attack.defense-evasion\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection:\n        TargetObject|contains|all:\n            - '\\SOFTWARE\\'\n            - '\\Microsoft\\Office\\'\n            - '\\Common\\Security'\n        TargetObject|endswith: '\\MacroRuntimeScanScope'\n        Details: DWORD (0x00000000)\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_disable_function_user.yml","content":"title: Disable Internal Tools or Feature in Registry\nid: e2482f8d-3443-4237-b906-cc145d87a076\nstatus: test\ndescription: Detects registry modifications that change features of internal Windows tools (malware like Agent Tesla uses this technique)\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1112/T1112.md\n    - https://www.mandiant.com/resources/unc2165-shifts-to-evade-sanctions\n    - https://blogs.vmware.com/security/2022/11/batloader-the-evasive-downloader-malware.html\n    - https://www.malwarebytes.com/blog/detections/pum-optional-nodispbackgroundpage\n    - https://www.malwarebytes.com/blog/detections/pum-optional-nodispcpl\n    - https://bazaar.abuse.ch/sample/7bde840c7e8c36dce4c3bac937bcf39f36a6f118001b406bfbbc25451ce44fb4/\nauthor: frack113, Nasreddine Bencherchali (Nextron Systems), CrimpSec\ndate: 2022-03-18\nmodified: 2025-06-04\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_set_1:\n        TargetObject|endswith:\n            - 'SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\DisableCMD'\n            - 'SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\NoControlPanel'\n            - 'SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\NoRun'\n            - 'SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\StartMenuLogOff'\n            - 'SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\DisableChangePassword'\n            - 'SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\DisableLockWorkstation'\n            - 'SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\DisableRegistryTools'\n            - 'SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\DisableTaskmgr'\n            - 'SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\NoDispBackgroundPage'\n            - 'SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\NoDispCPL'\n            - 'SOFTWARE\\Policies\\Microsoft\\Windows\\Explorer\\DisableNotificationCenter'\n            - 'SOFTWARE\\Policies\\Microsoft\\Windows\\System\\DisableCMD'\n        Details: 'DWORD (0x00000001)'\n    selection_set_0:\n        TargetObject|endswith:\n            - 'SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\ConsentPromptBehaviorAdmin'\n            - 'Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\InactivityTimeoutSecs'\n            - 'SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\shutdownwithoutlogon'\n            - 'SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\PushNotifications\\ToastEnabled'\n            - 'SYSTEM\\CurrentControlSet\\Control\\Storage\\Write Protection'\n            - 'SYSTEM\\CurrentControlSet\\Control\\StorageDevicePolicies\\WriteProtect'\n        Details: 'DWORD (0x00000000)'\n    condition: 1 of selection_set_*\nfalsepositives:\n    - Legitimate admin script\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_disable_defender_firewall.yml","content":"title: Disable Microsoft Defender Firewall via Registry\nid: 974515da-6cc5-4c95-ae65-f97f9150ec7f\nstatus: test\ndescription: Adversaries may disable or modify system firewalls in order to bypass controls limiting network usage\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.004/T1562.004.md#atomic-test-2---disable-microsoft-defender-firewall-via-registry\nauthor: frack113\ndate: 2022-01-09\nmodified: 2024-03-25\ntags:\n    - attack.defense-evasion\n    - attack.t1562.004\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        # HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\DomainProfile\\EnableFirewall\n        # HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\PublicProfile\\EnableFirewall\n        # HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\StandardProfile\\EnableFirewall\n        TargetObject|contains: '\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\'\n        TargetObject|endswith: '\\EnableFirewall'\n        Details: 'DWORD (0x00000000)'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: medium\nregression_tests_path: regression_data/rules/windows/registry/registry_set/registry_set_disable_defender_firewall/info.yml\nsimulation:\n    - type: atomic-red-team\n      name: Disable Microsoft Defender Firewall via Registry\n      technique: T1562.004\n      atomic_guid: afedc8c4-038c-4d82-b3e5-623a95f8a612\n"},{"path":"registry\\registry_set\\registry_set_disable_autologger_sessions.yml","content":"title: Potential AutoLogger Sessions Tampering\nid: f37b4bce-49d0-4087-9f5b-58bffda77316\nstatus: test\ndescription: Detects tampering with autologger trace sessions which is a technique used by attackers to disable logging\nreferences:\n    - https://twitter.com/MichalKoczwara/status/1553634816016498688\n    - https://thedfirreport.com/2021/10/18/icedid-to-xinglocker-ransomware-in-24-hours/\n    - https://i.blackhat.com/EU-21/Wednesday/EU-21-Teodorescu-Veni-No-Vidi-No-Vici-Attacks-On-ETW-Blind-EDRs.pdf\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-08-01\nmodified: 2025-10-07\ntags:\n    - attack.defense-evasion\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_main:\n        TargetObject|contains: '\\System\\CurrentControlSet\\Control\\WMI\\Autologger\\'\n    selection_values:\n        TargetObject|contains: # We only care about some autologger to avoid FP. Add more if you need\n            - '\\EventLog-'\n            - '\\Defender'\n        TargetObject|endswith:\n            - '\\Enable'\n            - '\\Start'\n        Details: DWORD (0x00000000)\n    filter_main_wevtutil:\n        Image: 'C:\\Windows\\system32\\wevtutil.exe'\n    filter_main_defender:\n        Image|startswith:\n            - 'C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\'\n            - 'C:\\Program Files\\Windows Defender\\'\n            - 'C:\\Program Files (x86)\\Windows Defender\\'\n        Image|endswith: '\\MsMpEng.exe'\n        TargetObject|contains:\n            - '\\DefenderApiLogger\\'\n            - '\\DefenderAuditLogger\\'\n    condition: all of selection_* and not 1 of filter_main_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_disable_administrative_share.yml","content":"title: Disable Administrative Share Creation at Startup\nid: c7dcacd0-cc59-4004-b0a4-1d6cdebe6f3e\nstatus: test\ndescription: Administrative shares are hidden network shares created by Microsoft Windows NT operating systems that grant system administrators remote access to every disk volume on a network-connected system\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1070.005/T1070.005.md#atomic-test-4---disable-administrative-share-creation-at-startup\nauthor: frack113\ndate: 2022-01-16\nmodified: 2024-03-25\ntags:\n    - attack.defense-evasion\n    - attack.t1070.005\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\Services\\LanmanServer\\Parameters\\'\n        TargetObject|endswith:\n            - '\\AutoShareWks'\n            - '\\AutoShareServer'\n        Details: 'DWORD (0x00000000)'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: medium\nregression_tests_path: regression_data/rules/windows/registry/registry_set/registry_set_disable_administrative_share/info.yml\nsimulation:\n    - type: atomic-red-team\n      name: Disable Administrative Share Creation at Startup\n      technique: T1070.005\n      atomic_guid: 99c657aa-ebeb-4179-a665-69288fdd12b8\n"},{"path":"registry\\registry_set\\registry_set_disabled_tamper_protection_on_microsoft_defender.yml","content":"title: Disable Tamper Protection on Windows Defender\nid: 93d298a1-d28f-47f1-a468-d971e7796679\nstatus: test\ndescription: Detects disabling Windows Defender Tamper Protection\nreferences:\n    - https://www.tenforums.com/tutorials/123792-turn-off-tamper-protection-microsoft-defender-antivirus.html\nauthor: Austin Songer @austinsonger\ndate: 2021-08-04\nmodified: 2023-08-17\ntags:\n    - attack.defense-evasion\n    - attack.t1562.001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\Microsoft\\Windows Defender\\Features\\TamperProtection'\n        Details: DWORD (0x00000000)\n    filter_msmpeng_client: # only disabled temporarily during updates\n        Image|startswith: 'C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\'\n        Image|endswith: '\\MsMpEng.exe'\n    filter_msmpeng_domain_controller: # only disabled temporarily during updates\n        Image: 'C:\\Program Files\\Windows Defender\\MsMpEng.exe'\n    condition: selection and not 1 of filter_*\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_disabled_pua_protection_on_microsoft_defender.yml","content":"title: Disable PUA Protection on Windows Defender\nid: 8ffc5407-52e3-478f-9596-0a7371eafe13\nstatus: test\ndescription: Detects disabling Windows Defender PUA protection\nreferences:\n    - https://www.tenforums.com/tutorials/32236-enable-disable-microsoft-defender-pua-protection-windows-10-a.html\nauthor: Austin Songer @austinsonger\ndate: 2021-08-04\nmodified: 2023-08-17\ntags:\n    - attack.defense-evasion\n    - attack.t1562.001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\Policies\\Microsoft\\Windows Defender\\PUAProtection'\n        Details: 'DWORD (0x00000000)'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_disabled_microsoft_defender_eventlog.yml","content":"title: Disabled Windows Defender Eventlog\nid: fcddca7c-b9c0-4ddf-98da-e1e2d18b0157\nstatus: test\ndescription: Detects the disabling of the Windows Defender eventlog as seen in relation to Lockbit 3.0 infections\nreferences:\n    - https://twitter.com/WhichbufferArda/status/1543900539280293889/photo/2\nauthor: Florian Roth (Nextron Systems)\ndate: 2022-07-04\nmodified: 2023-08-17\ntags:\n    - attack.defense-evasion\n    - attack.t1562.001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\Microsoft\\Windows\\CurrentVersion\\WINEVT\\Channels\\Microsoft-Windows-Windows Defender/Operational\\Enabled'\n        Details: 'DWORD (0x00000000)'\n    condition: selection\nfalsepositives:\n    - Other Antivirus software installations could cause Windows to disable that eventlog (unknown)\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_disabled_exploit_guard_net_protection_on_ms_defender.yml","content":"title: Disable Exploit Guard Network Protection on Windows Defender\nid: bf9e1387-b040-4393-9851-1598f8ecfae9\nstatus: test\ndescription: Detects disabling Windows Defender Exploit Guard Network Protection\nreferences:\n    - https://www.tenforums.com/tutorials/105533-enable-disable-windows-defender-exploit-protection-settings.html\nauthor: Austin Songer @austinsonger\ndate: 2021-08-04\nmodified: 2023-08-17\ntags:\n    - attack.defense-evasion\n    - attack.t1562.001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: 'SOFTWARE\\Policies\\Microsoft\\Windows Defender Security Center\\App and Browser protection\\DisallowExploitProtectionOverride'\n        Details: 'DWORD (00000001)'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_dhcp_calloutdll.yml","content":"title: DHCP Callout DLL Installation\nid: 9d3436ef-9476-4c43-acca-90ce06bdf33a\nstatus: test\ndescription: Detects the installation of a Callout DLL via CalloutDlls and CalloutEnabled parameter in Registry, which can be used to execute code in context of the DHCP server (restart required)\nreferences:\n    - https://blog.3or.de/mimilib-dhcp-server-callout-dll-injection.html\n    - https://technet.microsoft.com/en-us/library/cc726884(v=ws.10).aspx\n    - https://msdn.microsoft.com/de-de/library/windows/desktop/aa363389(v=vs.85).aspx\nauthor: Dimitrios Slamaris\ndate: 2017-05-15\nmodified: 2023-08-17\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1574.001\n    - attack.t1112\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith:\n            - '\\Services\\DHCPServer\\Parameters\\CalloutDlls'\n            - '\\Services\\DHCPServer\\Parameters\\CalloutEnabled'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_deviceguard_hypervisorenforcedpagingtranslation_disabled.yml","content":"title: Hypervisor Enforced Paging Translation Disabled\nid: 7f2954d2-99c2-4d42-a065-ca36740f187b\nstatus: test\ndescription: |\n    Detects changes to the \"DisableHypervisorEnforcedPagingTranslation\" registry value. Where the it is set to \"1\" in order to disable the Hypervisor Enforced Paging Translation feature.\nreferences:\n    - https://twitter.com/standa_t/status/1808868985678803222\n    - https://github.com/AaLl86/WindowsInternals/blob/070dc4f317726dfb6ffd2b7a7c121a33a8659b5e/Slides/Hypervisor-enforced%20Paging%20Translation%20-%20The%20end%20of%20non%20data-driven%20Kernel%20Exploits%20(Recon2024).pdf\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2024-07-05\ntags:\n    - attack.defense-evasion\n    - attack.t1562.001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: '\\DisableHypervisorEnforcedPagingTranslation'\n        Details: 'DWORD (0x00000001)'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_deviceguard_hypervisorenforcedcodeintegrity_disabled.yml","content":"title: Hypervisor Enforced Code Integrity Disabled\nid: 8b7273a4-ba5d-4d8a-b04f-11f2900d043a\nstatus: test\ndescription: |\n    Detects changes to the HypervisorEnforcedCodeIntegrity registry key and the \"Enabled\" value being set to 0 in order to disable the Hypervisor Enforced Code Integrity feature. This allows an attacker to load unsigned and untrusted code to be run in the kernel\nreferences:\n    - https://www.welivesecurity.com/2023/03/01/blacklotus-uefi-bootkit-myth-confirmed/\n    - https://github.com/redcanaryco/atomic-red-team/blob/04e487c1828d76df3e834621f4f893ea756d5232/atomics/T1562.001/T1562.001.md#atomic-test-43---disable-hypervisor-enforced-code-integrity-hvci\nauthor: Nasreddine Bencherchali (Nextron Systems), Anish Bogati\ndate: 2023-03-14\nmodified: 2024-07-05\ntags:\n    - attack.defense-evasion\n    - attack.t1562.001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith:\n            - '\\Control\\DeviceGuard\\HypervisorEnforcedCodeIntegrity'\n            - '\\Control\\DeviceGuard\\Scenarios\\HypervisorEnforcedCodeIntegrity\\Enabled'\n            - '\\Microsoft\\Windows\\DeviceGuard\\HypervisorEnforcedCodeIntegrity'\n        Details: 'DWORD (0x00000000)'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\nregression_tests_path: regression_data/rules/windows/registry/registry_set/registry_set_deviceguard_hypervisorenforcedcodeintegrity_disabled/info.yml\nsimulation:\n    - type: atomic-red-team\n      name: Disable Hypervisor-Enforced Code Integrity (HVCI)\n      technique: T1562.001\n      atomic_guid: 70bd71e6-eba4-4e00-92f7-617911dbe020\n"},{"path":"registry\\registry_set\\registry_set_devdrv_disallow_antivirus_filter.yml","content":"title: Antivirus Filter Driver Disallowed On Dev Drive - Registry\nid: 31e124fb-5dc4-42a0-83b3-44a69c77b271\nstatus: test\ndescription: |\n    Detects activity that indicates a user disabling the ability for Antivirus mini filter to inspect a \"Dev Drive\".\nreferences:\n    - https://twitter.com/0gtweet/status/1720419490519752955\nauthor: '@kostastsale, Nasreddine Bencherchali (Nextron Systems)'\ndate: 2023-11-05\nmodified: 2024-08-16\ntags:\n    - attack.defense-evasion\n    - attack.t1562.001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: '\\FilterManager\\FltmgrDevDriveAllowAntivirusFilter'\n        Details: 'DWORD (0x00000000)'\n    condition: selection\nfalsepositives:\n    - Unlikely\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_desktop_background_change.yml","content":"title: Potentially Suspicious Desktop Background Change Via Registry\nid: 85b88e05-dadc-430b-8a9e-53ff1cd30aae\nrelated:\n    - id: 8cbc9475-8d05-4e27-9c32-df960716c701\n      type: similar\nstatus: test\ndescription: |\n    Detects registry value settings that would replace the user's desktop background.\n    This is a common technique used by malware to change the desktop background to a ransom note or other image.\nreferences:\n    - https://www.attackiq.com/2023/09/20/emulating-rhysida/\n    - https://research.checkpoint.com/2023/the-rhysida-ransomware-activity-analysis-and-ties-to-vice-society/\n    - https://www.trendmicro.com/en_us/research/23/h/an-overview-of-the-new-rhysida-ransomware.html\n    - https://www.virustotal.com/gui/file/a864282fea5a536510ae86c77ce46f7827687783628e4f2ceb5bf2c41b8cd3c6/behavior\n    - https://admx.help/?Category=Windows_10_2016&Policy=Microsoft.Policies.WindowsDesktop::Wallpaper\n    - https://admx.help/?Category=Windows_10_2016&Policy=Microsoft.Policies.ControlPanelDisplay::CPL_Personalization_NoDesktopBackgroundUI\nauthor: Nasreddine Bencherchali (Nextron Systems), Stephen Lincoln @slincoln-aiq (AttackIQ)\ndate: 2023-12-21\nmodified: 2025-10-17\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.impact\n    - attack.t1112\n    - attack.t1491.001\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection_keys:\n        TargetObject|contains:\n            - 'Control Panel\\Desktop'\n            - 'CurrentVersion\\Policies\\ActiveDesktop'\n            - 'CurrentVersion\\Policies\\System'\n    selection_values_1:\n        TargetObject|endswith: 'NoChangingWallpaper'\n        Details: 'DWORD (0x00000001)' # Prevent changing desktop background\n    selection_values_2:\n        TargetObject|endswith: '\\Wallpaper'\n    selection_values_3:\n        TargetObject|endswith: '\\WallpaperStyle'\n        Details: '2' # Stretch\n    filter_main_svchost:\n        # Note: Excluding GPO changes\n        Image|endswith: '\\svchost.exe'\n    filter_main_empty:\n        TargetObject|endswith: '\\Control Panel\\Desktop\\Wallpaper'\n        Details: '(Empty)'\n    filter_main_explorer:\n        # Normally Explorer.exe is the process that changes the desktop background\n        Image|endswith: 'C:\\Windows\\Explorer.EXE'\n    filter_optional_ec2launch:\n        Image:\n            - 'C:\\Program Files\\Amazon\\EC2Launch\\EC2Launch.exe'\n            - 'C:\\Program Files (x86)\\Amazon\\EC2Launch\\EC2Launch.exe'\n        TargetObject|endswith: '\\Control Panel\\Desktop\\Wallpaper'\n    condition: selection_keys and 1 of selection_values_* and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Administrative scripts that change the desktop background to a company logo or other image.\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_defender_exclusions.yml","content":"title: Windows Defender Exclusions Added - Registry\nid: a982fc9c-6333-4ffb-a51d-addb04e8b529\nrelated:\n    - id: 1321dc4e-a1fe-481d-a016-52c45f0c8b4f\n      type: derived\nstatus: test\ndescription: Detects the Setting of Windows Defender Exclusions\nreferences:\n    - https://twitter.com/_nullbind/status/1204923340810543109\nauthor: Christian Burkard (Nextron Systems)\ndate: 2021-07-06\nmodified: 2023-08-17\ntags:\n    - attack.defense-evasion\n    - attack.t1562.001\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection2:\n        TargetObject|contains: '\\Microsoft\\Windows Defender\\Exclusions'\n    condition: selection2\nfalsepositives:\n    - Administrator actions\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_dbgmanageddebugger_persistence.yml","content":"title: Potential Registry Persistence Attempt Via DbgManagedDebugger\nid: 9827ae57-3802-418f-994b-d5ecf5cd974b\nstatus: test\ndescription: Detects the addition of the \"Debugger\" value to the \"DbgManagedDebugger\" key in order to achieve persistence. Which will get invoked when an application crashes\nreferences:\n    - https://www.hexacorn.com/blog/2013/09/19/beyond-good-ol-run-key-part-4/\n    - https://github.com/last-byte/PersistenceSniper\nauthor: frack113\ndate: 2022-08-07\nmodified: 2023-08-17\ntags:\n    - attack.privilege-escalation\n    - attack.defense-evasion\n    - attack.persistence\n    - attack.t1574\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: '\\Microsoft\\.NETFramework\\DbgManagedDebugger'\n    filter:\n        Details: '\"C:\\Windows\\system32\\vsjitdebugger.exe\" PID %d APPDOM %d EXTEXT \"%s\" EVTHDL %d'\n    condition: selection and not filter\nfalsepositives:\n    - Legitimate use of the key to setup a debugger. Which is often the case on developers machines\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_custom_file_open_handler_powershell_execution.yml","content":"title: Custom File Open Handler Executes PowerShell\nid: 7530b96f-ad8e-431d-a04d-ac85cc461fdc\nstatus: test\ndescription: Detects the abuse of custom file open handler, executing powershell\nreferences:\n    - https://news.sophos.com/en-us/2022/02/01/solarmarker-campaign-used-novel-registry-changes-to-establish-persistence/?cmp=30728\nauthor: CD_R0M_\ndate: 2022-06-11\nmodified: 2023-08-17\ntags:\n    - attack.defense-evasion\n    - attack.t1202\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: 'shell\\open\\command\\'\n        Details|contains|all:\n            - 'powershell'\n            - '-command'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_creation_service_susp_folder.yml","content":"title: Service Binary in Suspicious Folder\nid: a07f0359-4c90-4dc4-a681-8ffea40b4f47\nrelated:\n    - id: c0abc838-36b0-47c9-b3b3-a90c39455382\n      type: obsolete\nstatus: test\ndescription: Detect the creation of a service with a service binary located in a suspicious directory\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.001/T1562.001.md\nauthor: Florian Roth (Nextron Systems), frack113\ndate: 2022-05-02\nmodified: 2025-10-07\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_service_start:\n        TargetObject|startswith: 'HKLM\\System\\CurrentControlSet\\Services\\'\n        TargetObject|endswith: '\\Start'\n        Image|contains:\n            - '\\Users\\Public\\'\n            - '\\Perflogs\\'\n            - '\\ADMIN$\\'\n            - '\\Temp\\'\n        Details:\n            - 'DWORD (0x00000000)'  # boot\n            - 'DWORD (0x00000001)'  # System\n            - 'DWORD (0x00000002)'  # Automatic\n            # 3 - Manual , 4 - Disabled\n    selection_service_imagepath:\n        TargetObject|startswith: 'HKLM\\System\\CurrentControlSet\\Services\\'\n        TargetObject|endswith: '\\ImagePath'\n        Details|contains:\n            - '\\Users\\Public\\'\n            - '\\Perflogs\\'\n            - '\\ADMIN$\\'\n            - '\\Temp\\'\n    filter_optional_avast:\n        Image|contains|all: # Filter FP with Avast software\n            - '\\Common Files\\'\n            - '\\Temp\\'\n    filter_optional_mbamservice:\n        TargetObject|endswith: '\\CurrentControlSet\\Services\\MBAMInstallerService\\ImagePath'\n        Details|endswith: '\\AppData\\Local\\Temp\\MBAMInstallerService.exe\"'\n        Image: 'C:\\Windows\\system32\\services.exe'\n    condition: 1 of selection_* and not 1 of filter_optional_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_create_minint_key.yml","content":"title: Security Event Logging Disabled via MiniNt Registry Key - Registry Set\nid: 8839e550-52d7-4958-9f2f-e13c1e736838\nrelated:\n    - id: 1a4bd6af-99ac-4466-b5b2-7b72b4a05462 # Security Event Logging Disabled Via MiniNt Registry Key\n      type: similar\nstatus: experimental\ndescription: |\n    Detects the addition of the 'MiniNt' key to the registry. Upon a reboot, Windows Event Log service will stop writing events.\n    Windows Event Log is a service that collects and stores event logs from the operating system and applications. It is an important component of Windows security and auditing.\n    Adversary may want to disable this service to disable logging of security events which could be used to detect their activities.\nreferences:\n    - https://www.hackingarticles.in/defense-evasion-windows-event-logging-t1562-002/\nauthor: Swachchhanda Shrawan Poudel (Nextron Systems)\ndate: 2025-04-09\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1562.002\n    - attack.t1112\n    - car.2022-03-001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject: 'HKLM\\System\\CurrentControlSet\\Control\\MiniNt\\(Default)'\n    condition: selection\nfalsepositives:\n    - Highly Unlikely\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_crashdump_disabled.yml","content":"title: CrashControl CrashDump Disabled\nid: 2ff692c2-4594-41ec-8fcb-46587de769e0\nstatus: test\ndescription: Detects disabling the CrashDump per registry (as used by HermeticWiper)\nreferences:\n    - https://www.sentinelone.com/labs/hermetic-wiper-ukraine-under-attack/\nauthor: Tobias Michalski (Nextron Systems)\ndate: 2022-02-24\nmodified: 2023-08-17\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1564\n    - attack.t1112\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection:\n        TargetObject|contains: 'SYSTEM\\CurrentControlSet\\Control\\CrashControl'\n        Details: 'DWORD (0x00000000)'\n    condition: selection\nfalsepositives:\n    - Legitimate disabling of crashdumps\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_comhijack_sdclt.yml","content":"title: COM Hijack via Sdclt\nid: 07743f65-7ec9-404a-a519-913db7118a8d\nstatus: test\ndescription: Detects changes to 'HKCU\\Software\\Classes\\Folder\\shell\\open\\command\\DelegateExecute'\nreferences:\n    - http://blog.sevagas.com/?Yet-another-sdclt-UAC-bypass\n    - https://www.exploit-db.com/exploits/47696\nauthor: Omkar Gudhate\ndate: 2020-09-27\nmodified: 2023-09-28\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.privilege-escalation\n    - attack.t1546\n    - attack.t1548\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\Software\\Classes\\Folder\\shell\\open\\command\\DelegateExecute'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_cobaltstrike_service_installs.yml","content":"title: Potential CobaltStrike Service Installations - Registry\nid: 61a7697c-cb79-42a8-a2ff-5f0cdfae0130\nstatus: test\ndescription: |\n    Detects known malicious service installs that appear in cases in which a Cobalt Strike beacon elevates privileges or lateral movement.\nreferences:\n    - https://www.sans.org/webcasts/tech-tuesday-workshop-cobalt-strike-detection-log-analysis-119395\nauthor: Wojciech Lesicki\ndate: 2021-06-29\nmodified: 2024-03-25\ntags:\n    - attack.persistence\n    - attack.execution\n    - attack.privilege-escalation\n    - attack.lateral-movement\n    - attack.t1021.002\n    - attack.t1543.003\n    - attack.t1569.002\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_key:\n        - TargetObject|contains: '\\System\\CurrentControlSet\\Services'\n        - TargetObject|contains|all:\n              - '\\System\\ControlSet'\n              - '\\Services'\n    selection_details:\n        - Details|contains|all:\n              - 'ADMIN$'\n              - '.exe'\n        - Details|contains|all:\n              - '%COMSPEC%'\n              - 'start'\n              - 'powershell'\n    condition: all of selection_*\nfalsepositives:\n    - Unlikely\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_clickonce_trust_prompt.yml","content":"title: ClickOnce Trust Prompt Tampering\nid: ac9159cc-c364-4304-8f0a-d63fc1a0aabb\nstatus: test\ndescription: Detects changes to the ClickOnce trust prompt registry key in order to enable an installation from different locations such as the Internet.\nreferences:\n    - https://posts.specterops.io/less-smartscreen-more-caffeine-ab-using-clickonce-for-trusted-code-execution-1446ea8051c5\n    - https://learn.microsoft.com/en-us/visualstudio/deployment/how-to-configure-the-clickonce-trust-prompt-behavior\nauthor: '@SerkinValery, Nasreddine Bencherchali (Nextron Systems)'\ndate: 2023-06-12\nmodified: 2023-08-17\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\SOFTWARE\\MICROSOFT\\.NETFramework\\Security\\TrustManager\\PromptingLevel\\'\n        TargetObject|endswith:\n            - '\\Internet'\n            - '\\LocalIntranet'\n            - '\\MyComputer'\n            - '\\TrustedSites'\n            - '\\UntrustedSites'\n        Details: 'Enabled'\n    condition: selection\nfalsepositives:\n    - Legitimate internal requirements.\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_chrome_extension.yml","content":"title: Running Chrome VPN Extensions via the Registry 2 VPN Extension\nid: b64a026b-8deb-4c1d-92fd-98893209dff1\nstatus: test\ndescription: Running Chrome VPN Extensions via the Registry install 2 vpn extension\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1133/T1133.md#atomic-test-1---running-chrome-vpn-extensions-via-the-registry-2-vpn-extension\nauthor: frack113\ndate: 2021-12-28\nmodified: 2023-08-17\ntags:\n    - attack.initial-access\n    - attack.persistence\n    - attack.t1133\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    chrome_ext:\n        TargetObject|contains: 'Software\\Wow6432Node\\Google\\Chrome\\Extensions'\n        TargetObject|endswith: 'update_url'\n    chrome_vpn:\n        TargetObject|contains:\n            - fdcgdnkidjaadafnichfpabhfomcebme # ZenMate VPN\n            - fcfhplploccackoneaefokcmbjfbkenj # 1clickVPN\n            - bihmplhobchoageeokmgbdihknkjbknd # Touch VPN\n            - gkojfkhlekighikafcpjkiklfbnlmeio # Hola Free VPN\n            - jajilbjjinjmgcibalaakngmkilboobh # Astar VPN\n            - gjknjjomckknofjidppipffbpoekiipm # VPN Free\n            - nabbmpekekjknlbkgpodfndbodhijjem # Earth VPN\n            - kpiecbcckbofpmkkkdibbllpinceiihk # DotVPN\n            - nlbejmccbhkncgokjcmghpfloaajcffj # Hotspot Shield Free VPN\n            - omghfjlpggmjjaagoclmmobgdodcjboh # Browsec VPN\n            - bibjcjfmgapbfoljiojpipaooddpkpai # VPN-free.pro\n            - mpcaainmfjjigeicjnlkdfajbioopjko # VPN Unlimited Free\n            - jljopmgdobloagejpohpldgkiellmfnc # PP VPN\n            - lochiccbgeohimldjooaakjllnafhaid # IP Unblock\n            - nhnfcgpcbfclhfafjlooihdfghaeinfc # Surf VPN\n            - ookhnhpkphagefgdiemllfajmkdkcaim # iNinja VPN\n            - namfblliamklmeodpcelkokjbffgmeoo # Daily VPN\n            - nbcojefnccbanplpoffopkoepjmhgdgh # Hoxx VPN Proxy\n            - majdfhpaihoncoakbjgbdhglocklcgno # Free VPN\n            - lnfdmdhmfbimhhpaeocncdlhiodoblbd # VPN PROXY MASTER\n            - eppiocemhmnlbhjplcgkofciiegomcon # Urban Free VPN\n            - cocfojppfigjeefejbpfmedgjbpchcng # SaferVPN Proxy\n            - foiopecknacmiihiocgdjgbjokkpkohc # VPN Professional\n            - hhdobjgopfphlmjbmnpglhfcgppchgje # AdGuard VPN\n            - jgbaghohigdbgbolncodkdlpenhcmcge # Free VPN\n            - inligpkjkhbpifecbdjhmdpcfhnlelja # Free One Touch VPN\n            - higioemojdadgdbhbbbkfbebbdlfjbip # Unlimited VPN & Proxy by ibVPN\n            - hipncndjamdcmphkgngojegjblibadbe # RusVPN\n            - iolonopooapdagdemdoaihahlfkncfgg # Azino VPN\n            - nhfjkakglbnnpkpldhjmpmmfefifedcj # Pron VPN\n            - jpgljfpmoofbmlieejglhonfofmahini # Free Residential VPN\n            - fgddmllnllkalaagkghckoinaemmogpe # ExpressVPN\n            - ejkaocphofnobjdedneohbbiilggdlbi # Hotspot Shield Elite VPN Proxy\n            - keodbianoliadkoelloecbhllnpiocoi # Hide My IP VPN\n            - hoapmlpnmpaehilehggglehfdlnoegck # Tunnello VPN\n            - poeojclicodamonabcabmapamjkkmnnk # HMA VPN Proxy Unblocker\n            - dfkdflfgjdajbhocmfjolpjbebdkcjog # Free Avira Phantom VPN\n            - kcdahmgmaagjhocpipbodaokikjkampi # Hola VPN\n            - klnkiajpmpkkkgpgbogmcgfjhdoljacg # Free VPN for Chrome\n            - lneaocagcijjdpkcabeanfpdbmapcjjg # Hub VPN\n            - pgfpignfckbloagkfnamnolkeaecfgfh # Free Proxy VPN\n            - jplnlifepflhkbkgonidnobkakhmpnmh # Private Internet Access\n            - jliodmnojccaloajphkingdnpljdhdok # Turbo VPN for PC\n            - hnmpcagpplmpfojmgmnngilcnanddlhb # Windscribe\n            - ffbkglfijbcbgblgflchnbphjdllaogb # CyberGhost VPN\n            - kcndmbbelllkmioekdagahekgimemejo # VPN.AC\n            - jdgilggpfmjpbodmhndmhojklgfdlhob # Browser VPN\n            - bihhflimonbpcfagfadcnbbdngpopnjb # DEEPRISM VPN\n            - ppajinakbfocjfnijggfndbdmjggcmde # My Browser Vpn\n            - oofgbpoabipfcfjapgnbbjjaenockbdp # SetupVPN\n            - bhnhkdgoefpmekcgnccpnhjfdgicfebm # Wachee VPN\n            - knmmpciebaoojcpjjoeonlcjacjopcpf # Thunder Proxy\n            - dhadilbmmjiooceioladdphemaliiobo # Free Proxy VPN\n            - jedieiamjmoflcknjdjhpieklepfglin # FastestVPN Proxy\n            - mhngpdlhojliikfknhfaglpnddniijfh # WorkingVPN\n            - omdakjcmkglenbhjadbccaookpfjihpa # TunnelBear VPN\n            - npgimkapccfidfkfoklhpkgmhgfejhbj # BelkaVPN\n            - akeehkgglkmpapdnanoochpfmeghfdln # VPN Master\n            - gbmdmipapolaohpinhblmcnpmmlgfgje # Unblock Websites\n            - aigmfoeogfnljhnofglledbhhfegannp # Lethean Proxy VPN\n            - cgojmfochfikphincbhokimmmjenhhgk # Whoer VPN\n            - ficajfeojakddincjafebjmfiefcmanc # Best VPN USA\n            - ifnaibldjfdmaipaddffmgcmekjhiloa # FREE VPN DEWELOPMENT\n            - jbnmpdkcfkochpanomnkhnafobppmccn # apkfold free vpn\n            - apcfdffemoinopelidncddjbhkiblecc # Soul VPN\n            - mjolnodfokkkaichkcjipfgblbfgojpa # DotVPN\n            - oifjbnnafapeiknapihcmpeodaeblbkn # rderzh VPN Proxy\n            - plpmggfglncceinmilojdkiijhmajkjh # Red Panda VPN\n            - mjnbclmflcpookeapghfhapeffmpodij # Ultrareach VPN\n            - bblcccknbdbplgmdjnnikffefhdlobhp # FastStunnel VPN\n            - aojlhgbkmkahabcmcpifbolnoichfeep # VirtualShield VPN\n            - lcmammnjlbmlbcaniggmlejfjpjagiia # Adblock Office VPN Proxy Server\n            - knajdeaocbpmfghhmijicidfcmdgbdpm # Guru VPN & Proxy\n            - bdlcnpceagnkjnjlbbbcepohejbheilk # Malus VPN\n            - edknjdjielmpdlnllkdmaghlbpnmjmgb # Muscle VPN\n            - eidnihaadmmancegllknfbliaijfmkgo # Push VPN\n            - ckiahbcmlmkpfiijecbpflfahoimklke # Gom VPN\n            - macdlemfnignjhclfcfichcdhiomgjjb # Free Fast VPN\n            - chioafkonnhbpajpengbalkececleldf # BullVPN\n            - amnoibeflfphhplmckdbiajkjaoomgnj # HideAll VPN\n            - llbhddikeonkpbhpncnhialfbpnilcnc # ProxyFlow\n            - pcienlhnoficegnepejpfiklggkioccm # Cloud VPN\n            - iocnglnmfkgfedpcemdflhkchokkfeii # sVPN\n            - igahhbkcppaollcjeaaoapkijbnphfhb # Social VPN\n            - njpmifchgidinihmijhcfpbdmglecdlb # Trellonet Trellonet\n            - ggackgngljinccllcmbgnpgpllcjepgc # WindmillVPN\n            - kchocjcihdgkoplngjemhpplmmloanja # IPBurger Proxy & VPN\n            - bnijmipndnicefcdbhgcjoognndbgkep # Veee\n            - lklekjodgannjcccdlbicoamibgbdnmi # Anonymous Proxy Vpn Browser\n            - dbdbnchagbkhknegmhgikkleoogjcfge # Hideman VPN\n            - egblhcjfjmbjajhjhpmnlekffgaemgfh # Fornex VPN\n            - ehbhfpfdkmhcpaehaooegfdflljcnfec # WeVPN\n            - bkkgdjpomdnfemhhkalfkogckjdkcjkg # VPNMatic\n            - almalgbpmcfpdaopimbdchdliminoign # Urban Shield\n            - akkbkhnikoeojlhiiomohpdnkhbkhieh # Prime VPN\n            - gbfgfbopcfokdpkdigfmoeaajfmpkbnh # westwind\n            - bniikohfmajhdcffljgfeiklcbgffppl # Upnet\n            - lejgfmmlngaigdmmikblappdafcmkndb # uVPN\n            - ffhhkmlgedgcliajaedapkdfigdobcif # Nucleus VPN\n            - gcknhkkoolaabfmlnjonogaaifnjlfnp # FoxyProxy Standard\n            - pooljnboifbodgifngpppfklhifechoe # GeoProxy\n            - fjoaledfpmneenckfbpdfhkmimnjocfa # NordVPN\n            - aakchaleigkohafkfjfjbblobjifikek # ProxFlow\n            - dpplabbmogkhghncfbfdeeokoefdjegm # Proxy SwitchySharp\n            - padekgcemlokbadohgkifijomclgjgif # Proxy SwitchyOmega\n            - bfidboloedlamgdmenmlbipfnccokknp # PureVPN\n    condition: all of chrome_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_change_winevt_channelaccess.yml","content":"title: Change Winevt Channel Access Permission Via Registry\nid: 7d9263bd-dc47-4a58-bc92-5474abab390c\nstatus: test\ndescription: Detects tampering with the \"ChannelAccess\" registry key in order to change access to Windows event channel.\nreferences:\n    - https://app.any.run/tasks/77b2e328-8f36-46b2-b2e2-8a80398217ab/\n    - https://learn.microsoft.com/en-us/windows/win32/api/winevt/\n    - https://itconnect.uw.edu/tools-services-support/it-systems-infrastructure/msinf/other-help/understanding-sddl-syntax/\nauthor: frack113\ndate: 2022-09-17\nmodified: 2024-03-25\ntags:\n    - attack.defense-evasion\n    - attack.t1562.002\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\Microsoft\\Windows\\CurrentVersion\\WINEVT\\Channels\\'\n        TargetObject|endswith: '\\ChannelAccess'\n        # Add more interesting combinations if you found them\n        Details|contains:\n            - '(A;;0x1;;;LA)' # Local administrator having GENERIC ALL\n            - '(A;;0x1;;;SY)' # Local System having GENERIC ALL\n            - '(A;;0x5;;;BA)' # Built-in administrators having GENERIC ALL and  GENERIC WRITE\n    filter_main_trustedinstaller:\n        Image: 'C:\\Windows\\servicing\\TrustedInstaller.exe'\n    filter_main_tiworker:\n        Image|startswith: 'C:\\Windows\\WinSxS\\'\n        Image|endswith: '\\TiWorker.exe'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_change_sysmon_driver_altitude.yml","content":"title: Sysmon Driver Altitude Change\nid: 4916a35e-bfc4-47d0-8e25-a003d7067061\nstatus: test\ndescription: |\n    Detects changes in Sysmon driver altitude value.\n    If the Sysmon driver is configured to load at an altitude of another registered service, it will fail to load at boot.\nreferences:\n    - https://posts.specterops.io/shhmon-silencing-sysmon-via-driver-unload-682b5be57650\n    - https://youtu.be/zSihR3lTf7g\nauthor: B.Talebi\ndate: 2022-07-28\nmodified: 2024-03-25\ntags:\n    - attack.defense-evasion\n    - attack.t1562.001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\Services\\'\n        TargetObject|endswith: '\\Instances\\Sysmon Instance\\Altitude'\n    condition: selection\nfalsepositives:\n    - Legitimate driver altitude change to hide sysmon\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_change_security_zones.yml","content":"title: IE Change Domain Zone\nid: 45e112d0-7759-4c2a-aa36-9f8fb79d3393\nrelated:\n    - id: d88d0ab2-e696-4d40-a2ed-9790064e66b3\n      type: derived\nstatus: test\ndescription: Hides the file extension through modification of the registry\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1112/T1112.md#atomic-test-4---add-domain-to-trusted-sites-zone\n    - https://learn.microsoft.com/en-us/troubleshoot/developer/browsers/security-privacy/ie-security-zones-registry-entries\nauthor: frack113\ndate: 2022-01-22\nmodified: 2023-08-17\ntags:\n    - attack.persistence\n    - attack.t1137\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_domains:\n        TargetObject|contains: \\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ZoneMap\\Domains\\\n    filter:\n        Details:\n            - DWORD (0x00000000) # My Computer\n            - DWORD (0x00000001) # Local Intranet Zone\n            - '(Empty)'\n    condition: selection_domains and not filter\nfalsepositives:\n    - Administrative scripts\nlevel: medium\nregression_tests_path: regression_data/rules/windows/registry/registry_set/registry_set_change_security_zones/info.yml\nsimulation:\n    - type: atomic-red-team\n      name: Add Domain to Trusted Sites Zone\n      technique: T1112\n      atomic_guid: cf447677-5a4e-4937-a82c-e47d254afd57\n"},{"path":"registry\\registry_set\\registry_set_change_rdp_port.yml","content":"title: Default RDP Port Changed to Non Standard Port\nid: 509e84b9-a71a-40e0-834f-05470369bd1e\nstatus: test\ndescription: |\n    Detects changes to the default RDP port.\n    Remote desktop is a common feature in operating systems. It allows a user to log into a remote system using an interactive session with a graphical user interface.\n    Microsoft refers to its implementation of the Remote Desktop Protocol (RDP) as Remote Desktop Services (RDS).\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1021.001/T1021.001.md\nauthor: frack113\ndate: 2022-01-01\nmodified: 2024-03-25\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547.010\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: '\\Control\\Terminal Server\\WinStations\\RDP-Tcp\\PortNumber'\n    filter_main_port:\n        Details: DWORD (0x00000d3d) # 3389\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Unknown\nlevel: high\nregression_tests_path: regression_data/rules/windows/registry/registry_set/registry_set_change_rdp_port/info.yml\nsimulation:\n    - type: atomic-red-team\n      name: Changing RDP Port to Non Standard Port via Powershell\n      technique: T1021.001\n      atomic_guid: 2f840dd4-8a2e-4f44-beb3-6b2399ea3771\n    - type: atomic-red-team\n      name: Changing RDP Port to Non Standard Port via Command_Prompt\n      technique: T1021.001\n      atomic_guid: 74ace21e-a31c-4f7d-b540-53e4eb6d1f73\n"},{"path":"registry\\registry_set\\registry_set_bypass_uac_using_silentcleanup_task.yml","content":"title: Bypass UAC Using SilentCleanup Task\nid: 724ea201-6514-4f38-9739-e5973c34f49a\nstatus: test\ndescription: |\n    Detects the setting of the environement variable \"windir\" to a non default value.\n    Attackers often abuse this variable in order to trigger a UAC bypass via the \"SilentCleanup\" task.\n    The SilentCleanup task located in %windir%\\system32\\cleanmgr.exe is an auto-elevated task that can be abused to elevate any file with administrator privileges without prompting UAC.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1548.002/T1548.002.md#atomic-test-9---bypass-uac-using-silentcleanup-task\n    - https://www.reddit.com/r/hacking/comments/ajtrws/bypassing_highest_uac_level_windows_810/\n    - https://www.fortinet.com/blog/threat-research/enter-the-darkgate-new-cryptocurrency-mining-and-ransomware-campaign\nauthor: frack113, Nextron Systems\ndate: 2022-01-06\nmodified: 2024-01-30\ntags:\n    - attack.privilege-escalation\n    - attack.defense-evasion\n    - attack.t1548.002\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: '\\Environment\\windir'\n    filter_main_default:\n        Details: '%SystemRoot%'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Unknown\nlevel: high\nregression_tests_path: regression_data/rules/windows/registry/registry_set/registry_set_bypass_uac_using_silentcleanup_task/info.yml\nsimulation:\n    - type: atomic-red-team\n      name: Bypass UAC using SilentCleanup Task\n      technique: T1548.002\n      atomic_guid: 28104f8a-4ff1-4582-bcf6-699dce156608\n"},{"path":"registry\\registry_set\\registry_set_bypass_uac_using_eventviewer.yml","content":"title: Bypass UAC Using Event Viewer\nid: 674202d0-b22a-4af4-ae5f-2eda1f3da1af\nstatus: test\ndescription: Bypasses User Account Control using Event Viewer and a relevant Windows Registry modification\nreferences:\n    - https://enigma0x3.net/2016/08/15/fileless-uac-bypass-using-eventvwr-exe-and-registry-hijacking/\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1548.002/T1548.002.md#atomic-test-1---bypass-uac-using-event-viewer-cmd\nauthor: frack113\ndate: 2022-01-05\nmodified: 2023-08-17\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547.010\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: '_Classes\\mscfile\\shell\\open\\command\\(Default)'\n    filter:\n        Details|startswith: '%SystemRoot%\\system32\\mmc.exe \"%1\" %'\n    condition: selection and not filter\nfalsepositives:\n    - Unknown\nlevel: high\nregression_tests_path: regression_data/rules/windows/registry/registry_set/registry_set_bypass_uac_using_eventviewer/info.yml\nsimulation:\n    - type: atomic-red-team\n      name: Bypass UAC using Event Viewer (cmd)\n      technique: T1548.002\n      atomic_guid: 5073adf8-9a50-4bd9-b298-a9bd2ead8af9\n"},{"path":"registry\\registry_set\\registry_set_bypass_uac_using_delegateexecute.yml","content":"title: Bypass UAC Using DelegateExecute\nid: 46dd5308-4572-4d12-aa43-8938f0184d4f\nstatus: test\ndescription: Bypasses User Account Control using a fileless method\nreferences:\n    - https://learn.microsoft.com/en-us/windows/win32/api/shobjidl_core/nn-shobjidl_core-iexecutecommand\n    - https://devblogs.microsoft.com/oldnewthing/20100312-01/?p=14623\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1548.002/T1548.002.md#atomic-test-7---bypass-uac-using-sdclt-delegateexecute\nauthor: frack113\ndate: 2022-01-05\nmodified: 2023-08-17\ntags:\n    - attack.privilege-escalation\n    - attack.defense-evasion\n    - attack.t1548.002\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: '\\open\\command\\DelegateExecute'\n        Details: (Empty)\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\nregression_tests_path: regression_data/rules/windows/registry/registry_set/registry_set_bypass_uac_using_delegateexecute/info.yml\nsimulation:\n    - type: atomic-red-team\n      name: Bypass UAC using sdclt DelegateExecute\n      technique: T1548.002\n      atomic_guid: 3be891eb-4608-4173-87e8-78b494c029b7\n"},{"path":"registry\\registry_set\\registry_set_bginfo_custom_wmi_query.yml","content":"title: New BgInfo.EXE Custom WMI Query Registry Configuration\nid: cd277474-5c52-4423-a52b-ac2d7969902f\nrelated:\n    - id: 992dd79f-dde8-4bb0-9085-6350ba97cfb3\n      type: similar\nstatus: test\ndescription: Detects setting of a new registry value related to BgInfo configuration, which can be abused to execute custom WMI query via \"BgInfo.exe\"\nreferences:\n    - Internal Research\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-08-16\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\Software\\Winternals\\BGInfo\\UserFields\\'\n        Details|startswith: '6' # WMI\n    condition: selection\nfalsepositives:\n    - Legitimate WMI query\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_bginfo_custom_vbscript.yml","content":"title: New BgInfo.EXE Custom VBScript Registry Configuration\nid: 992dd79f-dde8-4bb0-9085-6350ba97cfb3\nrelated:\n    - id: cd277474-5c52-4423-a52b-ac2d7969902f\n      type: similar\nstatus: test\ndescription: Detects setting of a new registry value related to BgInfo configuration, which can be abused to execute custom VBScript via \"BgInfo.exe\"\nreferences:\n    - Internal Research\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-08-16\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\Software\\Winternals\\BGInfo\\UserFields\\'\n        Details|startswith: '4' # WMI\n    condition: selection\nfalsepositives:\n    - Legitimate VBScript\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_bginfo_custom_db.yml","content":"title: New BgInfo.EXE Custom DB Path Registry Configuration\nid: 53330955-dc52-487f-a3a2-da24dcff99b5\nstatus: test\ndescription: Detects setting of a new registry database value related to BgInfo configuration. Attackers can for example set this value to save the results of the commands executed by BgInfo in order to exfiltrate information.\nreferences:\n    - Internal Research\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-08-16\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: '\\Software\\Winternals\\BGInfo\\Database'\n    condition: selection\nfalsepositives:\n    - Legitimate use of external DB to save the results\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_asep_reg_keys_modification_wow6432node_currentversion.yml","content":"title: Wow6432Node Windows NT CurrentVersion Autorun Keys Modification\nid: 480421f9-417f-4d3b-9552-fd2728443ec8\nrelated:\n    - id: 17f878b8-9968-4578-b814-c4217fc5768c\n      type: obsolete\nstatus: test\ndescription: Detects modification of autostart extensibility point (ASEP) in registry.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1547.001/T1547.001.md\n    - https://learn.microsoft.com/en-us/sysinternals/downloads/autoruns\n    - https://gist.github.com/GlebSukhodolskiy/0fc5fa5f482903064b448890db1eaf9d # a list with registry keys\nauthor: Victor Sergeev, Daniil Yugoslavskiy, Gleb Sukhodolskiy, Timur Zinniatullin, oscd.community, Tim Shelton, frack113 (split)\ndate: 2019-10-25\nmodified: 2025-10-22\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547.001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_wow_nt_current_version_base:\n        TargetObject|contains: '\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows NT\\CurrentVersion'\n    selection_wow_nt_current_version:\n        TargetObject|contains:\n            - '\\Windows\\Appinit_Dlls'\n            - '\\Image File Execution Options'\n            - '\\Drivers32'\n    filter_main_empty:\n        Details: '(Empty)'\n    filter_main_null:\n        Details: null\n    filter_main_file_exec_options:\n        Details|endswith: '\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options'\n    condition: all of selection_* and not 1 of filter_main_*\nfalsepositives:\n    - Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reason\n    - Legitimate administrator sets up autorun keys for legitimate reason\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_asep_reg_keys_modification_wow6432node_classes.yml","content":"title: Wow6432Node Classes Autorun Keys Modification\nid: 18f2065c-d36c-464a-a748-bcf909acb2e3\nrelated:\n    - id: 17f878b8-9968-4578-b814-c4217fc5768c\n      type: obsolete\nstatus: test\ndescription: Detects modification of autostart extensibility point (ASEP) in registry.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1547.001/T1547.001.md\n    - https://learn.microsoft.com/en-us/sysinternals/downloads/autoruns\n    - https://gist.github.com/GlebSukhodolskiy/0fc5fa5f482903064b448890db1eaf9d # a list with registry keys\nauthor: Victor Sergeev, Daniil Yugoslavskiy, Gleb Sukhodolskiy, Timur Zinniatullin, oscd.community, Tim Shelton, frack113 (split)\ndate: 2019-10-25\nmodified: 2023-08-17\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547.001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    wow_classes_base:\n        TargetObject|contains: '\\Software\\Wow6432Node\\Classes'\n    wow_classes:\n        TargetObject|contains:\n            - '\\Folder\\ShellEx\\ExtShellFolderViews'\n            - '\\Folder\\ShellEx\\DragDropHandlers'\n            - '\\Folder\\ShellEx\\ColumnHandlers'\n            - '\\Directory\\Shellex\\DragDropHandlers'\n            - '\\Directory\\Shellex\\CopyHookHandlers'\n            - '\\CLSID\\{AC757296-3522-4E11-9862-C17BE5A1767E}\\Instance'\n            - '\\CLSID\\{ABE3B9A4-257D-4B97-BD1A-294AF496222E}\\Instance'\n            - '\\CLSID\\{7ED96837-96F0-4812-B211-F13C24117ED3}\\Instance'\n            - '\\CLSID\\{083863F1-70DE-11d0-BD40-00A0C911CE86}\\Instance'\n            - '\\AllFileSystemObjects\\ShellEx\\DragDropHandlers'\n            - '\\ShellEx\\PropertySheetHandlers'\n            - '\\ShellEx\\ContextMenuHandlers'\n    filter:\n        Details: '(Empty)'\n    condition: wow_classes_base and wow_classes and not filter\nfalsepositives:\n    - Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reason\n    - Legitimate administrator sets up autorun keys for legitimate reason\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_asep_reg_keys_modification_wow6432node.yml","content":"title: Wow6432Node CurrentVersion Autorun Keys Modification\nid: b29aed60-ebd1-442b-9cb5-16a1d0324adb\nrelated:\n    - id: 17f878b8-9968-4578-b814-c4217fc5768c\n      type: obsolete\nstatus: test\ndescription: Detects modification of autostart extensibility point (ASEP) in registry.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1547.001/T1547.001.md\n    - https://learn.microsoft.com/en-us/sysinternals/downloads/autoruns\n    - https://gist.github.com/GlebSukhodolskiy/0fc5fa5f482903064b448890db1eaf9d # a list with registry keys\n    - https://oddvar.moe/2018/03/21/persistence-using-runonceex-hidden-from-autoruns-exe/\nauthor: Victor Sergeev, Daniil Yugoslavskiy, Gleb Sukhodolskiy, Timur Zinniatullin, oscd.community, Tim Shelton, frack113 (split)\ndate: 2019-10-25\nmodified: 2025-10-07\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547.001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_wow_current_version_base:\n        TargetObject|contains: '\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion'\n    selection_wow_current_version_keys:\n        TargetObject|contains:\n            - '\\ShellServiceObjectDelayLoad'\n            - '\\Run\\'\n            - '\\RunOnce\\'\n            - '\\RunOnceEx\\'\n            - '\\RunServices\\'\n            - '\\RunServicesOnce\\'\n            - '\\Explorer\\ShellServiceObjects'\n            - '\\Explorer\\ShellIconOverlayIdentifiers'\n            - '\\Explorer\\ShellExecuteHooks'\n            - '\\Explorer\\SharedTaskScheduler'\n            - '\\Explorer\\Browser Helper Objects'\n    filter_main_empty:\n        Details: '(Empty)'\n    filter_main_ms_win_desktop_runtime:\n        Details|startswith: '\"C:\\ProgramData\\Package Cache\\{d21a4f20-968a-4b0c-bf04-a38da5f06e41}\\windowsdesktop-runtime-'\n    filter_main_vcredist:\n        Image|endswith: '\\VC_redist.x64.exe'\n        Details|endswith: '}\\VC_redist.x64.exe\" /burn.runonce'\n    filter_main_upgrades:\n        Image|startswith:\n            - 'C:\\ProgramData\\Package Cache'\n            - 'C:\\Windows\\Temp\\'\n        Image|contains:\n            - '\\winsdksetup.exe'\n            - '\\windowsdesktop-runtime-'  # C:\\WINDOWS\\Temp\\{751E2E78-46DC-4376-9205-99219CDC34AE}\\.be\\windowsdesktop-runtime-6.0.12-win-x86.exe\n            - '\\AspNetCoreSharedFrameworkBundle-'  # \"C:\\ProgramData\\Package Cache\\{b52191c1-a9c0-4b34-9a4e-930c2dd8a540}\\AspNetCoreSharedFrameworkBundle-x86.exe\" /burn.runonce\n        Details|endswith: ' /burn.runonce'\n    filter_main_uninstallers:\n        # This image path is linked with different uninstallers when running as admin unfortunately\n        Image|startswith: 'C:\\Windows\\Installer\\MSI'\n        TargetObject|contains: '\\Explorer\\Browser Helper Objects'\n    filter_main_msiexec:\n        Image: 'C:\\WINDOWS\\system32\\msiexec.exe'\n        TargetObject|contains: '\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\\'\n    filter_main_edge:\n        Image|contains|all:\n            - 'C:\\Program Files (x86)\\Microsoft\\EdgeUpdate\\Install\\{'\n            - '\\setup.exe'\n    filter_optional_msoffice1:\n        Image: 'C:\\Program Files\\Common Files\\Microsoft Shared\\ClickToRun\\OfficeClickToRun.exe'\n        TargetObject|contains: '\\Office\\ClickToRun\\REGISTRY\\MACHINE\\Software\\Wow6432Node\\'\n    filter_optional_msoffice2:\n        Image:\n            - 'C:\\Program Files\\Microsoft Office\\root\\integration\\integrator.exe'\n            - 'C:\\Program Files (x86)\\Microsoft Office\\root\\integration\\integrator.exe'\n        TargetObject|contains: '\\Explorer\\Browser Helper Objects\\{31D09BA0-12F5-4CCE-BE8A-2923E76605DA}\\'\n    filter_optional_dropbox:\n        - Details|endswith: '-A251-47B7-93E1-CDD82E34AF8B}'\n        - Details: 'grpconv -o'\n        - Details|contains|all:\n              - 'C:\\Program Files'\n              - '\\Dropbox\\Client\\Dropbox.exe'\n              - ' /systemstartup'\n    filter_optional_evernote:\n        TargetObject|endswith: '\\Explorer\\Browser Helper Objects\\{92EF2EAD-A7CE-4424-B0DB-499CF856608E}\\NoExplorer'\n    filter_optional_dotnet:\n        Image|contains: '\\windowsdesktop-runtime-'\n        TargetObject|endswith:\n            - '\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\{e2d1ae32-dd1d-4ad7-a298-10e42e7840fc}'\n            - '\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\{7037b699-7382-448c-89a7-4765961d2537}'\n        Details|startswith: '\"C:\\ProgramData\\Package Cache\\'\n        Details|endswith: '.exe\" /burn.runonce'\n    filter_optional_office:\n        Image|startswith:\n            - 'C:\\Program Files\\Common Files\\Microsoft Shared\\ClickToRun\\'\n            - 'C:\\Program Files\\Common Files\\Microsoft Shared\\ClickToRun\\Updates\\'\n        Image|endswith: '\\OfficeClickToRun.exe'\n    filter_optional_discord:\n        TargetObject|endswith: '\\SOFTWARE\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\\Discord'\n        Details|endswith: 'Discord.exe --checkInstall'\n    filter_optional_avira:\n        Details|endswith: '\\Avira.OE.Setup.Bundle.exe\" /burn.runonce'\n        Image|endswith: '\\Avira.OE.Setup.Bundle.exe'\n    filter_optional_avg_1:\n        Image|endswith: '\\instup.exe'\n        TargetObject|endswith: '\\SOFTWARE\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\AvRepair'\n        Details|endswith: 'instup.exe\" /instop:repair /wait'\n    filter_optional_avg_2:\n        Image|endswith: '\\instup.exe'\n        TargetObject|endswith:\n            - '\\SOFTWARE\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Explorer\\ShellIconOverlayIdentifiers\\00avg\\(Default)'\n            - '\\SOFTWARE\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Explorer\\ShellIconOverlayIdentifiers\\00asw\\(Default)'\n        Details:\n            - '{472083B1-C522-11CF-8763-00608CC02F24}'\n            - '{472083B0-C522-11CF-8763-00608CC02F24}'\n    condition: all of selection_* and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reason\n    - Legitimate administrator sets up autorun keys for legitimate reason\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_asep_reg_keys_modification_winsock2.yml","content":"title: WinSock2 Autorun Keys Modification\nid: d6c2ce7e-afb5-4337-9ca4-4b5254ed0565\nrelated:\n    - id: 17f878b8-9968-4578-b814-c4217fc5768c\n      type: derived\nstatus: test\ndescription: Detects modification of autostart extensibility point (ASEP) in registry.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1547.001/T1547.001.md\n    - https://learn.microsoft.com/en-us/sysinternals/downloads/autoruns\n    - https://gist.github.com/GlebSukhodolskiy/0fc5fa5f482903064b448890db1eaf9d # a list with registry keys\nauthor: Victor Sergeev, Daniil Yugoslavskiy, Gleb Sukhodolskiy, Timur Zinniatullin, oscd.community, Tim Shelton, frack113 (split)\ndate: 2019-10-25\nmodified: 2023-08-17\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547.001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    winsock_parameters_base:\n        TargetObject|contains: '\\System\\CurrentControlSet\\Services\\WinSock2\\Parameters'\n    winsock_parameters:\n        TargetObject|contains:\n            - '\\Protocol_Catalog9\\Catalog_Entries'\n            - '\\NameSpace_Catalog5\\Catalog_Entries'\n    filter:\n        - Details: '(Empty)'\n        - Image: 'C:\\Windows\\System32\\MsiExec.exe'\n        - Image: 'C:\\Windows\\syswow64\\MsiExec.exe'\n    condition: winsock_parameters_base and winsock_parameters and not filter\nfalsepositives:\n    - Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reason\n    - Legitimate administrator sets up autorun keys for legitimate reason\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_asep_reg_keys_modification_system_scripts.yml","content":"title: System Scripts Autorun Keys Modification\nid: e7a2fd40-3ae1-4a85-bf80-15cf624fb1b1\nrelated:\n    - id: 17f878b8-9968-4578-b814-c4217fc5768c\n      type: obsolete\nstatus: test\ndescription: Detects modification of autostart extensibility point (ASEP) in registry.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1547.001/T1547.001.md\n    - https://learn.microsoft.com/en-us/sysinternals/downloads/autoruns\n    - https://gist.github.com/GlebSukhodolskiy/0fc5fa5f482903064b448890db1eaf9d # a list with registry keys\nauthor: Victor Sergeev, Daniil Yugoslavskiy, Gleb Sukhodolskiy, Timur Zinniatullin, oscd.community, Tim Shelton, frack113 (split)\ndate: 2019-10-25\nmodified: 2023-08-17\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547.001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    scripts_base:\n        TargetObject|contains: '\\Software\\Policies\\Microsoft\\Windows\\System\\Scripts'\n    scripts:\n        TargetObject|contains:\n            - '\\Startup'\n            - '\\Shutdown'\n            - '\\Logon'\n            - '\\Logoff'\n    filter:\n        Details: '(Empty)'\n    condition: scripts_base and scripts and not filter\nfalsepositives:\n    - Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reason\n    - Legitimate administrator sets up autorun keys for legitimate reason\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_asep_reg_keys_modification_session_manager.yml","content":"title: Session Manager Autorun Keys Modification\nid: 046218bd-e0d8-4113-a3c3-895a12b2b298\nrelated:\n    - id: 17f878b8-9968-4578-b814-c4217fc5768c\n      type: obsolete\nstatus: test\ndescription: Detects modification of autostart extensibility point (ASEP) in registry.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1547.001/T1547.001.md\n    - https://learn.microsoft.com/en-us/sysinternals/downloads/autoruns\n    - https://gist.github.com/GlebSukhodolskiy/0fc5fa5f482903064b448890db1eaf9d # a list with registry keys\nauthor: Victor Sergeev, Daniil Yugoslavskiy, Gleb Sukhodolskiy, Timur Zinniatullin, oscd.community, Tim Shelton, frack113 (split)\ndate: 2019-10-25\nmodified: 2023-08-17\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547.001\n    - attack.t1546.009\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    session_manager_base:\n        TargetObject|contains: '\\System\\CurrentControlSet\\Control\\Session Manager'\n    session_manager:\n        TargetObject|contains:\n            - '\\SetupExecute'\n            - '\\S0InitialCommand'\n            - '\\KnownDlls'\n            - '\\Execute'\n            - '\\BootExecute'\n            - '\\AppCertDlls'\n    filter:\n        Details: '(Empty)'\n    condition: session_manager_base and session_manager and not filter\nfalsepositives:\n    - Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reason\n    - Legitimate administrator sets up autorun keys for legitimate reason\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_asep_reg_keys_modification_office.yml","content":"title: Office Autorun Keys Modification\nid: baecf8fb-edbf-429f-9ade-31fc3f22b970\nrelated:\n    - id: 17f878b8-9968-4578-b814-c4217fc5768c\n      type: obsolete\nstatus: test\ndescription: Detects modification of autostart extensibility point (ASEP) in registry.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1547.001/T1547.001.md\n    - https://learn.microsoft.com/en-us/sysinternals/downloads/autoruns\n    - https://gist.github.com/GlebSukhodolskiy/0fc5fa5f482903064b448890db1eaf9d # a list with registry keys\nauthor: Victor Sergeev, Daniil Yugoslavskiy, Gleb Sukhodolskiy, Timur Zinniatullin, oscd.community, Tim Shelton, frack113 (split)\ndate: 2019-10-25\nmodified: 2025-10-17\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547.001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_office_root:\n        TargetObject|contains:\n            - '\\Software\\Wow6432Node\\Microsoft\\Office'\n            - '\\Software\\Microsoft\\Office'\n    selection_office_details:\n        TargetObject|contains:\n            - '\\Word\\Addins'\n            - '\\PowerPoint\\Addins'\n            - '\\Outlook\\Addins'\n            - '\\Onenote\\Addins'\n            - '\\Excel\\Addins'\n            - '\\Access\\Addins'\n            - 'test\\Special\\Perf'\n    filter_main_empty:\n        Details: '(Empty)'\n    filter_main_known_addins:\n        Image|startswith:\n            - 'C:\\Program Files\\Microsoft Office\\'\n            - 'C:\\Program Files (x86)\\Microsoft Office\\'\n            - 'C:\\Windows\\System32\\msiexec.exe'\n            - 'C:\\Windows\\System32\\regsvr32.exe'\n        TargetObject|contains:\n            # Remove any unused addins in your environment from the filter\n            # Known addins for excel\n            - '\\Excel\\Addins\\AdHocReportingExcelClientLib.AdHocReportingExcelClientAddIn.1\\'\n            - '\\Excel\\Addins\\ExcelPlugInShell.PowerMapConnect\\'\n            - '\\Excel\\Addins\\NativeShim\\'\n            - '\\Excel\\Addins\\NativeShim.InquireConnector.1\\'\n            - '\\Excel\\Addins\\PowerPivotExcelClientAddIn.NativeEntry.1\\'\n            # Known addins for outlook\n            - '\\Outlook\\AddIns\\AccessAddin.DC\\'\n            - '\\Outlook\\AddIns\\ColleagueImport.ColleagueImportAddin\\'\n            - '\\Outlook\\AddIns\\EvernoteCC.EvernoteContactConnector\\'\n            - '\\Outlook\\AddIns\\EvernoteOLRD.Connect\\'\n            # - '\\Outlook\\Addins\\GrammarlyAddIn.Connect' # Uncomment if you use Grammarly\n            - '\\Outlook\\Addins\\Microsoft.VbaAddinForOutlook.1\\'\n            - '\\Outlook\\Addins\\OcOffice.OcForms\\'\n            - '\\Outlook\\Addins\\\\OneNote.OutlookAddin'\n            - '\\Outlook\\Addins\\OscAddin.Connect\\'\n            - '\\Outlook\\Addins\\OutlookChangeNotifier.Connect\\'\n            - '\\Outlook\\Addins\\UCAddin.LyncAddin.1'\n            - '\\Outlook\\Addins\\UCAddin.UCAddin.1'\n            - '\\Outlook\\Addins\\UmOutlookAddin.FormRegionAddin\\'\n            - 'AddinTakeNotesService\\FriendlyName'\n    filter_main_officeclicktorun:\n        Image|startswith:\n            - 'C:\\Program Files\\Common Files\\Microsoft Shared\\ClickToRun\\'\n            - 'C:\\Program Files\\Common Files\\Microsoft Shared\\ClickToRun\\Updates\\'\n        Image|endswith: '\\OfficeClickToRun.exe'\n    filter_optional_avg:\n        Image:\n            - 'C:\\Program Files\\AVG\\Antivirus\\RegSvr.exe'\n            - 'C:\\Program Files\\AVG\\Antivirus\\x86\\RegSvr.exe'\n        TargetObject|contains: '\\Microsoft\\Office\\Outlook\\Addins\\Antivirus.AsOutExt\\'\n    filter_optional_avast:\n        Image:\n            - 'C:\\Program Files\\Avast Software\\Avast\\RegSvr.exe'\n            - 'C:\\Program Files\\Avast Software\\Avast\\x86\\RegSvr.exe'\n        TargetObject|contains: '\\Microsoft\\Office\\Outlook\\Addins\\Avast.AsOutExt\\'\n    condition: all of selection_office_* and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reason\n    - Legitimate administrator sets up autorun keys for legitimate reason\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_asep_reg_keys_modification_internet_explorer.yml","content":"title: Internet Explorer Autorun Keys Modification\nid: a80f662f-022f-4429-9b8c-b1a41aaa6688\nrelated:\n    - id: 17f878b8-9968-4578-b814-c4217fc5768c\n      type: obsolete\nstatus: test\ndescription: Detects modification of autostart extensibility point (ASEP) in registry.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1547.001/T1547.001.md\n    - https://learn.microsoft.com/en-us/sysinternals/downloads/autoruns\n    - https://gist.github.com/GlebSukhodolskiy/0fc5fa5f482903064b448890db1eaf9d # a list with registry keys\nauthor: Victor Sergeev, Daniil Yugoslavskiy, Gleb Sukhodolskiy, Timur Zinniatullin, oscd.community, Tim Shelton, frack113 (split)\ndate: 2019-10-25\nmodified: 2023-08-17\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547.001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    ie:\n        TargetObject|contains:\n            - '\\Software\\Wow6432Node\\Microsoft\\Internet Explorer'\n            - '\\Software\\Microsoft\\Internet Explorer'\n    ie_details:\n        TargetObject|contains:\n            - '\\Toolbar'\n            - '\\Extensions'\n            - '\\Explorer Bars'\n    filter_empty:\n        Details: '(Empty)'\n    filter_extensions:\n        TargetObject|contains:\n            - '\\Extensions\\{2670000A-7350-4f3c-8081-5663EE0C6C49}'\n            - '\\Extensions\\{31D09BA0-12F5-4CCE-BE8A-2923E76605DA}'\n            - '\\Extensions\\{789FE86F-6FC4-46A1-9849-EDE0DB0C95CA}'\n            - '\\Extensions\\{A95fe080-8f5d-11d2-a20b-00aa003c157a}'\n    filter_toolbar:\n        TargetObject|endswith:\n            - '\\Toolbar\\ShellBrowser\\ITBar7Layout'\n            - '\\Toolbar\\ShowDiscussionButton'\n            - '\\Toolbar\\Locked'\n    condition: ie and ie_details and not 1 of filter_*\nfalsepositives:\n    - Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reason\n    - Legitimate administrator sets up autorun keys for legitimate reason\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_asep_reg_keys_modification_currentversion_nt.yml","content":"title: CurrentVersion NT Autorun Keys Modification\nid: cbf93e5d-ca6c-4722-8bea-e9119007c248\nrelated:\n    - id: 17f878b8-9968-4578-b814-c4217fc5768c\n      type: obsolete\nstatus: test\ndescription: Detects modification of autostart extensibility point (ASEP) in registry.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1547.001/T1547.001.md\n    - https://learn.microsoft.com/en-us/sysinternals/downloads/autoruns\n    - https://gist.github.com/GlebSukhodolskiy/0fc5fa5f482903064b448890db1eaf9d # a list with registry keys\nauthor: Victor Sergeev, Daniil Yugoslavskiy, Gleb Sukhodolskiy, Timur Zinniatullin, oscd.community, Tim Shelton, frack113 (split)\ndate: 2019-10-25\nmodified: 2025-10-22\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547.001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_nt_current_version_base:\n        TargetObject|contains: '\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion'\n    selection_nt_current_version:\n        TargetObject|contains:\n            - '\\Winlogon\\VmApplet'\n            - '\\Winlogon\\Userinit'\n            - '\\Winlogon\\Taskman'\n            - '\\Winlogon\\Shell'\n            - '\\Winlogon\\GpExtensions'\n            - '\\Winlogon\\AppSetup'\n            - '\\Winlogon\\AlternateShells\\AvailableShells'\n            - '\\Windows\\IconServiceLib'\n            - '\\Windows\\Appinit_Dlls'\n            - '\\Image File Execution Options' # Covered in better details in 36803969-5421-41ec-b92f-8500f79c23b0\n            - '\\Font Drivers'\n            - '\\Drivers32'\n            - '\\Windows\\Run'\n            - '\\Windows\\Load'\n    filter_main_empty:\n        Details: '(Empty)'\n    filter_main_null:\n        Details: null\n    filter_main_poqexec:\n        Image: 'C:\\Windows\\System32\\poqexec.exe'\n    filter_main_legitimate_subkey:  # Legitimately used subkeys of \\Image File Execution Options, which are not used for persistence (see https://pentestlab.blog/2020/01/13/persistence-image-file-execution-options-injection/)\n        TargetObject|contains: '\\Image File Execution Options\\'\n        TargetObject|endswith:\n            - '\\DisableExceptionChainValidation'\n            - '\\MitigationOptions'\n    filter_main_security_extension_dc:\n        Image: 'C:\\Windows\\system32\\svchost.exe'\n        TargetObject|contains:\n            - '\\Winlogon\\GPExtensions\\{827D319E-6EAC-11D2-A4EA-00C04F79F83A}\\PreviousPolicyAreas'\n            - '\\Winlogon\\GPExtensions\\{827D319E-6EAC-11D2-A4EA-00C04F79F83A}\\MaxNoGPOListChangesInterval'\n        Details:\n            - 'DWORD (0x00000001)'\n            - 'DWORD (0x00000009)'\n            - 'DWORD (0x000003c0)'\n    filter_main_runtimebroker:\n        Image: 'C:\\Windows\\System32\\RuntimeBroker.exe'\n        TargetObject|contains: '\\runtimebroker.exe\\Microsoft.Windows.ShellExperienceHost'\n    filter_optional_edge:\n        Image|startswith: 'C:\\Program Files (x86)\\Microsoft\\Temp\\'\n        Image|endswith: '\\MicrosoftEdgeUpdate.exe'\n    filter_optional_avguard:\n        Image|startswith:\n            - 'C:\\Program Files (x86)\\Avira\\Antivirus\\avguard.exe'\n            - 'C:\\Program Files\\Avira\\Antivirus\\avguard.exe'\n        TargetObject|contains: 'SOFTWARE\\WOW6432Node\\Avira\\Antivirus\\Overwrite_Keys\\HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\'\n        TargetObject|endswith:\n            - '\\userinit\\UseAsDefault'\n            - '\\shell\\UseAsDefault'\n        Details:\n            - 'explorer.exe'\n            - 'C:\\Windows\\system32\\userinit.exe,'\n    filter_optional_msoffice:\n        - TargetObject|contains:\n              - '\\ClickToRunStore\\HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\'\n              - '\\ClickToRun\\REGISTRY\\MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\'\n        - Image:\n              - 'C:\\Program Files\\Microsoft Office\\root\\integration\\integrator.exe'\n              - 'C:\\Program Files (x86)\\Microsoft Office\\root\\integration\\integrator.exe'\n    filter_optional_officeclicktorun:\n        Image|startswith:\n            - 'C:\\Program Files\\Common Files\\Microsoft Shared\\ClickToRun\\'\n            - 'C:\\Program Files\\Common Files\\Microsoft Shared\\ClickToRun\\Updates\\'\n        Image|endswith: '\\OfficeClickToRun.exe'\n    filter_optional_ngen:\n        Image|startswith: 'C:\\Windows\\Microsoft.NET\\Framework'\n        Image|endswith: '\\ngen.exe'\n    filter_optional_onedrive:\n        Image|endswith: '\\AppData\\Local\\Microsoft\\OneDrive\\StandaloneUpdater\\OneDriveSetup.exe'\n        TargetObject|endswith: '\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\Delete Cached Update Binary'\n        Details|startswith: 'C:\\Windows\\system32\\cmd.exe /q /c del /q \"C:\\Users\\'\n        Details|endswith: '\\AppData\\Local\\Microsoft\\OneDrive\\Update\\OneDriveSetup.exe\"'\n    condition: all of selection_* and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reason\n    - Legitimate administrator sets up autorun keys for legitimate reason\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_asep_reg_keys_modification_currentversion.yml","content":"title: CurrentVersion Autorun Keys Modification\nid: 20f0ee37-5942-4e45-b7d5-c5b5db9df5cd\nrelated:\n    - id: 17f878b8-9968-4578-b814-c4217fc5768c\n      type: obsolete\nstatus: test\ndescription: Detects modification of autostart extensibility point (ASEP) in registry.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1547.001/T1547.001.md\n    - https://learn.microsoft.com/en-us/sysinternals/downloads/autoruns\n    - https://gist.github.com/GlebSukhodolskiy/0fc5fa5f482903064b448890db1eaf9d # a list with registry keys\n    - https://oddvar.moe/2018/03/21/persistence-using-runonceex-hidden-from-autoruns-exe/\nauthor: Victor Sergeev, Daniil Yugoslavskiy, Gleb Sukhodolskiy, Timur Zinniatullin, oscd.community, Tim Shelton, frack113 (split)\ndate: 2019-10-25\nmodified: 2025-10-22\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547.001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_current_version_base:\n        TargetObject|contains: '\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion'\n    selection_current_version_keys:\n        TargetObject|contains:\n            - '\\ShellServiceObjectDelayLoad'\n            - '\\Run\\'\n            - '\\RunOnce\\'\n            - '\\RunOnceEx\\'\n            - '\\RunServices\\'\n            - '\\RunServicesOnce\\'\n            - '\\Policies\\System\\Shell'\n            - '\\Policies\\Explorer\\Run'\n            - '\\Group Policy\\Scripts\\Startup'\n            - '\\Group Policy\\Scripts\\Shutdown'\n            - '\\Group Policy\\Scripts\\Logon'\n            - '\\Group Policy\\Scripts\\Logoff'\n            - '\\Explorer\\ShellServiceObjects'\n            - '\\Explorer\\ShellIconOverlayIdentifiers'\n            - '\\Explorer\\ShellExecuteHooks'\n            - '\\Explorer\\SharedTaskScheduler'\n            - '\\Explorer\\Browser Helper Objects'\n            - '\\Authentication\\PLAP Providers'\n            - '\\Authentication\\Credential Providers'\n            - '\\Authentication\\Credential Provider Filters'\n    filter_main_generic_all:\n        - Details: '(Empty)'\n        - TargetObject|endswith: '\\NgcFirst\\ConsecutiveSwitchCount'\n        - Image|endswith:\n              - '\\AppData\\Local\\Microsoft\\OneDrive\\Update\\OneDriveSetup.exe' # C:\\Users\\*\\AppData\\Local\\Microsoft\\OneDrive\\Update\\OneDriveSetup.exe\n              - '\\AppData\\Roaming\\Spotify\\Spotify.exe'\n              - '\\AppData\\Local\\WebEx\\WebexHost.exe'\n        - Image:\n              - 'C:\\WINDOWS\\system32\\devicecensus.exe'\n              - 'C:\\Windows\\system32\\winsat.exe'\n              - 'C:\\Program Files\\Microsoft OneDrive\\StandaloneUpdater\\OneDriveSetup.exe'\n              - 'C:\\Program Files (x86)\\Microsoft OneDrive\\StandaloneUpdater\\OneDriveSetup.exe'\n              - 'C:\\Program Files\\Microsoft OneDrive\\Update\\OneDriveSetup.exe'\n              - 'C:\\Program Files (x86)\\Microsoft OneDrive\\Update\\OneDriveSetup.exe'\n              - 'C:\\Program Files\\Microsoft Office\\root\\integration\\Addons\\OneDriveSetup.exe'\n              - 'C:\\Program Files (x86)\\Microsoft Office\\root\\integration\\Addons\\OneDriveSetup.exe'\n              - 'C:\\Program Files\\KeePass Password Safe 2\\ShInstUtil.exe'\n              - 'C:\\Program Files\\Everything\\Everything.exe'\n              - 'C:\\Program Files (x86)\\Microsoft Office\\root\\integration\\integrator.exe'\n              - 'C:\\Program Files\\Microsoft Office\\root\\integration\\integrator.exe'\n    filter_main_null:\n        Details: null\n    filter_main_logonui:\n        Image: 'C:\\Windows\\system32\\LogonUI.exe'\n        TargetObject|contains:\n            - '\\Authentication\\Credential Providers\\{D6886603-9D2F-4EB2-B667-1971041FA96B}\\'  # PIN\n            - '\\Authentication\\Credential Providers\\{BEC09223-B018-416D-A0AC-523971B639F5}\\'  # fingerprint\n            - '\\Authentication\\Credential Providers\\{8AF662BF-65A0-4D0A-A540-A338A999D36F}\\'  # facial recognizion\n            - '\\Authentication\\Credential Providers\\{27FBDB57-B613-4AF2-9D7E-4FA7A66C21AD}\\'  # Trusted Signal (Phone proximity, Network location)\n    filter_main_edge:\n        Image|startswith:\n            - 'C:\\Program Files (x86)\\Microsoft\\EdgeUpdate\\Install\\'\n            - 'C:\\Program Files (x86)\\Microsoft\\EdgeWebView\\'\n            - 'C:\\Program Files (x86)\\Microsoft\\Edge\\Application\\msedge.exe'\n    filter_main_defender:\n        Image: 'C:\\Program Files\\Windows Defender\\MsMpEng.exe'\n    filter_main_teams:\n        Image|endswith: '\\Microsoft\\Teams\\current\\Teams.exe'\n        Details|contains: '\\Microsoft\\Teams\\Update.exe --processStart '\n    filter_main_ctfmon:\n        Image: 'C:\\Windows\\system32\\userinit.exe'\n        Details: 'ctfmon.exe /n'\n    filter_optional_dropbox:\n        Image: 'C:\\Windows\\system32\\regsvr32.exe'\n        TargetObject|contains: 'DropboxExt'\n        Details|endswith: 'A251-47B7-93E1-CDD82E34AF8B}'\n    filter_optional_opera_1:\n        TargetObject|endswith: '\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\Opera Browser Assistant'\n        Details: 'C:\\Program Files\\Opera\\assistant\\browser_assistant.exe'\n    filter_optional_opera_2:\n        TargetObject|endswith: '\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\Opera Stable'\n        Details:\n            - 'C:\\Program Files\\Opera\\launcher.exe'\n            - 'C:\\Program Files (x86)\\Opera\\launcher.exe'\n    filter_optional_itunes:\n        TargetObject|endswith: '\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\iTunesHelper'\n        Details: '\"C:\\Program Files\\iTunes\\iTunesHelper.exe\"'\n    filter_optional_zoom:\n        TargetObject|endswith: '\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\zoommsirepair'\n        Details: '\"C:\\Program Files\\Zoom\\bin\\installer.exe\" /repair'\n    filter_optional_greenshot:\n        TargetObject|endswith: '\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\Greenshot'\n        Details: 'C:\\Program Files\\Greenshot\\Greenshot.exe'\n    filter_optional_googledrive1:\n        TargetObject|endswith: '\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\GoogleDriveFS'\n        Details|startswith: 'C:\\Program Files\\Google\\Drive File Stream\\'\n        Details|contains: '\\GoogleDriveFS.exe'\n    filter_optional_googledrive2:\n        TargetObject|contains: 'GoogleDrive'\n        Details:\n            - '{CFE8B367-77A7-41D7-9C90-75D16D7DC6B6}'\n            - '{A8E52322-8734-481D-A7E2-27B309EF8D56}'\n            - '{C973DA94-CBDF-4E77-81D1-E5B794FBD146}'\n            - '{51EF1569-67EE-4AD6-9646-E726C3FFC8A2}'\n    filter_optional_onedrive:\n        Details|startswith:\n            - 'C:\\Windows\\system32\\cmd.exe /q /c rmdir /s /q \"C:\\Users\\'\n            - 'C:\\Windows\\system32\\cmd.exe /q /c del /q \"C:\\Users\\'\n        Details|contains: '\\AppData\\Local\\Microsoft\\OneDrive\\'\n    filter_optional_python:\n        TargetObject|contains: '\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\{'\n        Details|contains|all:\n            - '\\AppData\\Local\\Package Cache\\{'\n            - '}\\python-'\n        Details|endswith: '.exe\" /burn.runonce'\n    filter_optional_officeclicktorun:\n        Image|startswith:\n            - 'C:\\Program Files\\Common Files\\Microsoft Shared\\ClickToRun\\'\n            - 'C:\\Program Files (x86)\\Common Files\\Microsoft Shared\\ClickToRun\\'\n        Image|endswith: '\\OfficeClickToRun.exe'\n    filter_optional_teams:\n        Image|endswith: '\\Microsoft\\Teams\\current\\Teams.exe'\n        Details|contains: '\\Microsoft\\Teams\\Update.exe --processStart'\n    filter_optional_AVG_setup:\n        Image|contains:\n            - 'C:\\Program Files\\AVG\\Antivirus\\Setup\\'\n            - 'C:\\Program Files (x86)\\AVG\\Antivirus\\Setup\\'\n            - '\\instup.exe'\n        Details:\n            - '\"C:\\Program Files\\AVG\\Antivirus\\AvLaunch.exe\" /gui'\n            - '\"C:\\Program Files (x86)\\AVG\\Antivirus\\AvLaunch.exe\" /gui'\n            - '{472083B0-C522-11CF-8763-00608CC02F24}'\n            - '{472083B1-C522-11CF-8763-00608CC02F24}'\n    filter_optional_Avast:\n        Image|contains:\n            - 'C:\\Program Files\\Avast Software\\Avast\\Setup\\'\n            - 'C:\\Program Files (x86)\\Avast Software\\Avast\\Setup\\'\n            - '\\instup.exe'\n        Details:\n            - '\"C:\\Program Files\\Avast Software\\Avast\\AvLaunch.exe\" /gui'\n            - '\"C:\\Program Files (x86)\\Avast Software\\Avast\\AvLaunch.exe\" /gui'\n    filter_optional_AVG_avgtoolsvc:\n        Image:\n            - 'C:\\Program Files\\AVG\\Antivirus\\avgToolsSvc.exe'\n            - 'C:\\Program Files (x86)\\AVG\\Antivirus\\avgToolsSvc.exe'\n        TargetObject|contains: '\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\StartupApproved\\Run\\'\n        Details: 'Binary Data'\n    filter_optional_aurora_dashboard:\n        Image|endswith:\n            - '\\aurora-agent-64.exe'\n            - '\\aurora-agent.exe'\n        TargetObject|endswith: '\\Microsoft\\Windows\\CurrentVersion\\Run\\aurora-dashboard'\n        Details: 'C:\\Program Files\\Aurora-Agent\\tools\\aurora-dashboard.exe'\n    filter_optional_everything:\n        TargetObject|endswith: '\\Microsoft\\Windows\\CurrentVersion\\Run\\Everything'\n        Details|endswith: '\\Everything\\Everything.exe\" -startup' # We remove the starting part as it could be installed in different locations\n    filter_optional_discord:\n        TargetObject|endswith: '\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\Discord'\n        Details|endswith: '\\Discord\\Update.exe --processStart Discord.exe'\n    condition: all of selection_* and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reason\n    - Legitimate administrator sets up autorun keys for legitimate reason\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_asep_reg_keys_modification_currentcontrolset.yml","content":"title: CurrentControlSet Autorun Keys Modification\nid: f674e36a-4b91-431e-8aef-f8a96c2aca35\nrelated:\n    - id: 17f878b8-9968-4578-b814-c4217fc5768c\n      type: obsolete\nstatus: test\ndescription: Detects modification of autostart extensibility point (ASEP) in registry.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1547.001/T1547.001.md\n    - https://learn.microsoft.com/en-us/sysinternals/downloads/autoruns\n    - https://gist.github.com/GlebSukhodolskiy/0fc5fa5f482903064b448890db1eaf9d # a list with registry keys\nauthor: Victor Sergeev, Daniil Yugoslavskiy, Gleb Sukhodolskiy, Timur Zinniatullin, oscd.community, Tim Shelton, frack113 (split)\ndate: 2019-10-25\nmodified: 2023-08-17\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547.001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    system_control_base:\n        TargetObject|contains: '\\SYSTEM\\CurrentControlSet\\Control'\n    system_control_keys:\n        TargetObject|contains:\n            - '\\Terminal Server\\WinStations\\RDP-Tcp\\InitialProgram'\n            - '\\Terminal Server\\Wds\\rdpwd\\StartupPrograms'\n            - '\\SecurityProviders\\SecurityProviders'\n            - '\\SafeBoot\\AlternateShell'\n            - '\\Print\\Providers'\n            - '\\Print\\Monitors'\n            - '\\NetworkProvider\\Order'\n            - '\\Lsa\\Notification Packages'\n            - '\\Lsa\\Authentication Packages'\n            - '\\BootVerificationProgram\\ImagePath'\n    filter_empty:\n        Details: '(Empty)'\n    filter_cutepdf:\n        Image: 'C:\\Windows\\System32\\spoolsv.exe'\n        TargetObject|contains: '\\Print\\Monitors\\CutePDF Writer Monitor'\n        Details:\n            - 'cpwmon64_v40.dll'\n            - 'CutePDF Writer'\n    filter_onenote:\n        Image: C:\\Windows\\System32\\spoolsv.exe\n        TargetObject|contains: 'Print\\Monitors\\Appmon\\Ports\\Microsoft.Office.OneNote_'\n        User|contains: # covers many language settings\n            - 'AUTHORI'\n            - 'AUTORI'\n    filter_poqexec:\n        Image: 'C:\\Windows\\System32\\poqexec.exe'\n        TargetObject|endswith: '\\NetworkProvider\\Order\\ProviderOrder'\n    filter_realvnc:\n        Image: 'C:\\Windows\\System32\\spoolsv.exe'\n        TargetObject|endswith: '\\Print\\Monitors\\MONVNC\\Driver'\n        Details: 'VNCpm.dll'\n    condition: all of system_control_* and not 1 of filter_*\nfalsepositives:\n    - Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reason\n    - Legitimate administrator sets up autorun keys for legitimate reason\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_asep_reg_keys_modification_common.yml","content":"title: Common Autorun Keys Modification\nid: f59c3faf-50f3-464b-9f4c-1b67ab512d99\nrelated:\n    - id: 17f878b8-9968-4578-b814-c4217fc5768c\n      type: obsolete\nstatus: test\ndescription: Detects modification of autostart extensibility point (ASEP) in registry.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1547.001/T1547.001.md\n    - https://learn.microsoft.com/en-us/sysinternals/downloads/autoruns\n    - https://gist.github.com/GlebSukhodolskiy/0fc5fa5f482903064b448890db1eaf9d # a list with registry keys\n    - https://persistence-info.github.io/Data/userinitmprlogonscript.html # UserInitMprLogonScript\nauthor: Victor Sergeev, Daniil Yugoslavskiy, Gleb Sukhodolskiy, Timur Zinniatullin, oscd.community, Tim Shelton, frack113 (split), wagga (name)\ndate: 2019-10-25\nmodified: 2025-10-22\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547.001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains:\n            - '\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows CE Services\\AutoStart'\n            - '\\Software\\Wow6432Node\\Microsoft\\Command Processor\\Autorun'\n            - '\\SOFTWARE\\Wow6432Node\\Microsoft\\Active Setup\\Installed Components'\n            - '\\SOFTWARE\\Microsoft\\Windows CE Services\\AutoStartOnDisconnect'\n            - '\\SOFTWARE\\Microsoft\\Windows CE Services\\AutoStartOnConnect'\n            - '\\SYSTEM\\Setup\\CmdLine'\n            - '\\Software\\Microsoft\\Ctf\\LangBarAddin'\n            - '\\Software\\Microsoft\\Command Processor\\Autorun'\n            - '\\SOFTWARE\\Microsoft\\Active Setup\\Installed Components'\n            - '\\SOFTWARE\\Classes\\Protocols\\Handler'\n            - '\\SOFTWARE\\Classes\\Protocols\\Filter'\n            - '\\SOFTWARE\\Classes\\Htmlfile\\Shell\\Open\\Command\\(Default)'\n            - '\\Environment\\UserInitMprLogonScript'\n            - '\\SOFTWARE\\Policies\\Microsoft\\Windows\\Control Panel\\Desktop\\Scrnsave.exe'\n            - '\\Software\\Microsoft\\Internet Explorer\\UrlSearchHooks'\n            - '\\SOFTWARE\\Microsoft\\Internet Explorer\\Desktop\\Components'\n            - '\\Software\\Classes\\Clsid\\{AB8902B4-09CA-4bb6-B78D-A8F59079A8D5}\\Inprocserver32'\n            - '\\Control Panel\\Desktop\\Scrnsave.exe'\n    filter_main_empty:\n        Details: '(Empty)'\n    filter_main_null:\n        Details: null\n    filter_main_poqexec:\n        Image: 'C:\\Windows\\System32\\poqexec.exe'\n    filter_optional_msoffice:\n        - TargetObject|contains:\n              - '\\Office\\ClickToRun\\REGISTRY\\MACHINE\\Software\\Classes\\PROTOCOLS\\Handler\\'\n              - '\\ClickToRunStore\\HKMU\\SOFTWARE\\Classes\\PROTOCOLS\\Handler\\'\n        - Details:\n              - '{314111c7-a502-11d2-bbca-00c04f8ec294}'\n              - '{3459B272-CC19-4448-86C9-DDC3B4B2FAD3}'\n              - '{42089D2D-912D-4018-9087-2B87803E93FB}'\n              - '{5504BE45-A83B-4808-900A-3A5C36E7F77A}'\n              - '{807583E5-5146-11D5-A672-00B0D022E945}'\n    filter_optional_chrome:\n        TargetObject|contains: '\\SOFTWARE\\Microsoft\\Active Setup\\Installed Components\\{8A69D345-D564-463c-AFF1-A69D9E530F96}'\n    filter_optional_edge:\n        TargetObject|contains: '\\SOFTWARE\\Microsoft\\Active Setup\\Installed Components\\{9459C573-B17A-45AE-9F64-1857B5D58CEE}'\n    filter_optional_IE:\n        TargetObject|contains: '\\Software\\Microsoft\\Active Setup\\Installed Components\\{89820200-ECBD-11cf-8B85-00AA005B4383}'\n    filter_optional_integrator:\n        Image:\n            - 'C:\\Program Files (x86)\\Microsoft Office\\root\\integration\\integrator.exe'\n            - 'C:\\Program Files\\Microsoft Office\\root\\integration\\integrator.exe'\n    filter_optional_office:\n        Image|startswith:\n            - 'C:\\Program Files\\Common Files\\Microsoft Shared\\ClickToRun\\'\n            - 'C:\\Program Files\\Common Files\\Microsoft Shared\\ClickToRun\\Updates\\'\n        Image|endswith: '\\OfficeClickToRun.exe'\n    condition: selection and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reason\n    - Legitimate administrator sets up autorun keys for legitimate reason\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_asep_reg_keys_modification_classes.yml","content":"title: Classes Autorun Keys Modification\nid: 9df5f547-c86a-433e-b533-f2794357e242\nrelated:\n    - id: 17f878b8-9968-4578-b814-c4217fc5768c\n      type: obsolete\nstatus: test\ndescription: Detects modification of autostart extensibility point (ASEP) in registry.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1547.001/T1547.001.md\n    - https://learn.microsoft.com/en-us/sysinternals/downloads/autoruns\n    - https://gist.github.com/GlebSukhodolskiy/0fc5fa5f482903064b448890db1eaf9d # a list with registry keys\nauthor: Victor Sergeev, Daniil Yugoslavskiy, Gleb Sukhodolskiy, Timur Zinniatullin, oscd.community, Tim Shelton, frack113 (split)\ndate: 2019-10-25\nmodified: 2025-10-22\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547.001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection_classes_base:\n        TargetObject|contains: '\\Software\\Classes'\n    selection_classes_target:\n        TargetObject|contains:\n            - '\\Folder\\ShellEx\\ExtShellFolderViews'\n            - '\\Folder\\ShellEx\\DragDropHandlers'\n            - '\\Folder\\Shellex\\ColumnHandlers'\n            - '\\Filter'\n            - '\\Exefile\\Shell\\Open\\Command\\(Default)'\n            - '\\Directory\\Shellex\\DragDropHandlers'\n            - '\\Directory\\Shellex\\CopyHookHandlers'\n            - '\\CLSID\\{AC757296-3522-4E11-9862-C17BE5A1767E}\\Instance'\n            - '\\CLSID\\{ABE3B9A4-257D-4B97-BD1A-294AF496222E}\\Instance'\n            - '\\CLSID\\{7ED96837-96F0-4812-B211-F13C24117ED3}\\Instance'\n            - '\\CLSID\\{083863F1-70DE-11d0-BD40-00A0C911CE86}\\Instance'\n            - '\\Classes\\AllFileSystemObjects\\ShellEx\\DragDropHandlers'\n            - '\\.exe'\n            - '\\.cmd'\n            - '\\ShellEx\\PropertySheetHandlers'\n            - '\\ShellEx\\ContextMenuHandlers'\n    filter_main_drivers:\n        Image: 'C:\\Windows\\System32\\drvinst.exe'\n    filter_main_empty:\n        Details: '(Empty)'\n    filter_main_null:\n        Details: null\n    filter_main_svchost:\n        Image: 'C:\\Windows\\System32\\svchost.exe'\n        # If more targets are found from \"svchost\". Please exclude the whole image\n        TargetObject|contains: '\\lnkfile\\shellex\\ContextMenuHandlers\\'\n    filter_optional_msoffice:\n        Details: '{807583E5-5146-11D5-A672-00B0D022E945}'\n    condition: all of selection_* and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reason\n    - Legitimate administrator sets up autorun keys for legitimate reason\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_amsi_com_hijack.yml","content":"title: Potential AMSI COM Server Hijacking\nid: 160d2780-31f7-4922-8b3a-efce30e63e96\nstatus: test\ndescription: Detects changes to the AMSI come server registry key in order disable AMSI scanning functionalities. When AMSI attempts to starts its COM component, it will query its registered CLSID and return a non-existent COM server. This causes a load failure and prevents any scanning methods from being accessed, ultimately rendering AMSI useless\nreferences:\n    - https://enigma0x3.net/2017/07/19/bypassing-amsi-via-com-server-hijacking/\n    - https://github.com/r00t-3xp10it/hacking-material-books/blob/43cb1e1932c16ff1f58b755bc9ab6b096046853f/obfuscation/simple_obfuscation.md#amsi-comreg-bypass\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2023-01-04\nmodified: 2023-08-17\ntags:\n    - attack.defense-evasion\n    - attack.t1562.001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: '\\CLSID\\{fdb00e52-a214-4aa1-8fba-4357bb0072ec}\\InProcServer32\\(Default)'\n    filter:\n        Details: '%windir%\\system32\\amsi.dll'\n    condition: selection and not filter\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_set\\registry_set_allow_rdp_remote_assistance_feature.yml","content":"title: Allow RDP Remote Assistance Feature\nid: 37b437cf-3fc5-4c8e-9c94-1d7c9aff842b\nstatus: test\ndescription: Detect enable rdp feature to allow specific user to rdp connect on the targeted machine\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/40b77d63808dd4f4eafb83949805636735a1fd15/atomics/T1112/T1112.md\nauthor: frack113\ndate: 2022-08-19\nmodified: 2023-08-17\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: 'System\\CurrentControlSet\\Control\\Terminal Server\\fAllowToGetHelp'\n        Details: DWORD (0x00000001)\n    condition: selection\nfalsepositives:\n    - Legitimate use of the feature (alerts should be investigated either way)\nlevel: medium\nregression_tests_path: regression_data/rules/windows/registry/registry_set/registry_set_allow_rdp_remote_assistance_feature/info.yml\nsimulation:\n    - type: atomic-red-team\n      name: Allow RDP Remote Assistance Feature\n      technique: T1112\n      atomic_guid: 86677d0e-0b5e-4a2b-b302-454175f9aa9e\n"},{"path":"registry\\registry_set\\registry_set_aedebug_persistence.yml","content":"title: Add Debugger Entry To AeDebug For Persistence\nid: 092af964-4233-4373-b4ba-d86ea2890288\nstatus: test\ndescription: Detects when an attacker adds a new \"Debugger\" value to the \"AeDebug\" key in order to achieve persistence which will get invoked when an application crashes\nreferences:\n    - https://persistence-info.github.io/Data/aedebug.html\n    - https://learn.microsoft.com/en-us/windows/win32/debug/configuring-automatic-debugging\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-07-21\nmodified: 2023-08-17\ntags:\n    - attack.persistence\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AeDebug\\Debugger'\n        Details|endswith: '.dll'\n    filter:\n        Details: '\"C:\\WINDOWS\\system32\\vsjitdebugger.exe\" -p %ld -e %ld -j 0x%p'\n    condition: selection and not filter\nfalsepositives:\n    - Legitimate use of the key to setup a debugger. Which is often the case on developers machines\nlevel: medium\n"},{"path":"registry\\registry_set\\registry_set_add_port_monitor.yml","content":"title: Add Port Monitor Persistence in Registry\nid: 944e8941-f6f6-4ee8-ac05-1c224e923c0e\nstatus: test\ndescription: |\n    Adversaries may use port monitors to run an attacker supplied DLL during system boot for persistence or privilege escalation.\n    A port monitor can be set through the AddMonitor API call to set a DLL to be loaded at startup.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1547.010/T1547.010.md\nauthor: frack113\ndate: 2021-12-30\nmodified: 2024-03-25\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547.010\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\Control\\Print\\Monitors\\'\n        Details|endswith: '.dll'\n    filter_optional_cutepdf:\n        Image: 'C:\\Windows\\System32\\spoolsv.exe'\n        TargetObject|contains: '\\Control\\Print\\Monitors\\CutePDF Writer Monitor v4.0\\Driver'\n        Details: 'cpwmon64_v40.dll'\n        User|contains: # covers many language settings\n            - 'AUTHORI'\n            - 'AUTORI'\n    filter_optional_monvnc:\n        TargetObject|contains: '\\Control\\Print\\Monitors\\MONVNC\\Driver'\n    filter_optional_vnc:\n        TargetObject|contains|all:\n            - 'Control\\Print\\Environments\\'\n            - '\\Drivers\\'\n            - '\\VNC Printer'\n    condition: selection and not 1 of filter_optional_*\nfalsepositives:\n    - Unknown\nlevel: medium\nregression_tests_path: regression_data/rules/windows/registry/registry_set/registry_set_add_port_monitor/info.yml\nsimulation:\n    - type: atomic-red-team\n      name: Add Port Monitor persistence in Registry\n      technique: T1547.010\n      atomic_guid: d34ef297-f178-4462-871e-9ce618d44e50\n"},{"path":"registry\\registry_set\\registry_set_add_load_service_in_safe_mode.yml","content":"title: Registry Persistence via Service in Safe Mode\nid: 1547e27c-3974-43e2-a7d7-7f484fb928ec\nstatus: test\ndescription: Detects the modification of the registry to allow a driver or service to persist in Safe Mode.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1112/T1112.md#atomic-test-33---windows-add-registry-value-to-load-service-in-safe-mode-without-network\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1112/T1112.md#atomic-test-34---windows-add-registry-value-to-load-service-in-safe-mode-with-network\nauthor: frack113\ndate: 2022-04-04\nmodified: 2025-10-22\ntags:\n    - attack.defense-evasion\n    - attack.t1564.001\nlogsource:\n    category: registry_set\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains:\n            - '\\Control\\SafeBoot\\Minimal\\'\n            - '\\Control\\SafeBoot\\Network\\'\n        TargetObject|endswith: '\\(Default)'\n        Details: 'Service'\n    filter_optional_sophos:\n        Image: 'C:\\WINDOWS\\system32\\msiexec.exe'\n        TargetObject|endswith:\n            - '\\Control\\SafeBoot\\Minimal\\SAVService\\(Default)'\n            - '\\Control\\SafeBoot\\Network\\SAVService\\(Default)'\n    filter_optional_mbamservice:\n        Image|endswith: '\\MBAMInstallerService.exe'\n        TargetObject|endswith: '\\MBAMService\\(Default)'\n        Details: 'Service'\n    filter_optional_hexnode:\n        Image: 'C:\\Hexnode\\Hexnode Agent\\Current\\HexnodeAgent.exe'\n        TargetObject|endswith:\n            - '\\Control\\SafeBoot\\Minimal\\Hexnode Updater\\(Default)'\n            - '\\Control\\SafeBoot\\Network\\Hexnode Updater\\(Default)'\n            - '\\Control\\SafeBoot\\Minimal\\Hexnode Agent\\(Default)'\n            - '\\Control\\SafeBoot\\Network\\Hexnode Agent\\(Default)'\n        Details: 'Service'\n    condition: selection and not 1 of filter_optional_*\nfalsepositives:\n    - Unknown\nlevel: high\nregression_tests_path: regression_data/rules/windows/registry/registry_set/registry_set_add_load_service_in_safe_mode/info.yml\nsimulation:\n    - type: atomic-red-team\n      name: Windows Add Registry Value to Load Service in Safe Mode without Network\n      technique: T1112\n      atomic_guid: 1dd59fb3-1cb3-4828-805d-cf80b4c3bbb5\n    - type: atomic-red-team\n      name: Windows Add Registry Value to Load Service in Safe Mode with Network\n      technique: T1112\n      atomic_guid: c173c948-65e5-499c-afbe-433722ed5bd4\n"},{"path":"registry\\registry_event\\registry_set_enable_anonymous_connection.yml","content":"title: Enable Remote Connection Between Anonymous Computer - AllowAnonymousCallback\nid: 4d431012-2ab5-4db7-a84e-b29809da2172\nstatus: test\ndescription: Detects enabling of the \"AllowAnonymousCallback\" registry value, which allows a remote connection between computers that do not have a trust relationship.\nreferences:\n    - https://learn.microsoft.com/en-us/windows/win32/wmisdk/connecting-to-wmi-remotely-starting-with-vista\nauthor: X__Junior (Nextron Systems)\ndate: 2023-11-03\ntags:\n    - attack.defense-evasion\n    - attack.t1562.001\nlogsource:\n    product: windows\n    category: registry_set\ndetection:\n    selection:\n        TargetObject|contains: '\\Microsoft\\WBEM\\CIMOM\\AllowAnonymousCallback'\n        Details: 'DWORD (0x00000001)'\n    condition: selection\nfalsepositives:\n    - Administrative activity\nlevel: medium\n"},{"path":"registry\\registry_event\\registry_event_susp_process_registry_modification.yml","content":"title: Registry Tampering by Potentially Suspicious Processes\nid: 7f4c43f9-b1a5-4c7d-b24a-b41bf3a3ebf2\nrelated:\n    - id: 2a0a169d-cc66-43ce-9ae2-6e678e54e46a\n      type: similar\n    - id: 921aa10f-2e74-4cca-9498-98f9ca4d6fdf\n      type: similar\nstatus: experimental\ndescription: |\n    Detects suspicious registry modifications made by suspicious processes such as script engine processes such as WScript, or CScript etc.\n    These processes are rarely used for legitimate registry modifications, and their activity may indicate an attempt to modify the registry\n    without using standard tools like regedit.exe or reg.exe, potentially for evasion and persistence.\nreferences:\n    - https://www.nextron-systems.com/2025/07/29/detecting-the-most-popular-mitre-persistence-method-registry-run-keys-startup-folder/\n    - https://www.linkedin.com/posts/mauricefielenbach_livingofftheland-redteam-persistence-activity-7344801774182051843-TE00/\nauthor: Swachchhanda Shrawan Poudel (Nextron Systems)\ndate: 2025-08-13\ntags:\n    - attack.defense-evasion\n    - attack.persistence\n    - attack.execution\n    - attack.t1112\n    - attack.t1059.005\nlogsource:\n    category: registry_event\n    product: windows\ndetection:\n    selection:\n        Image|endswith:\n            # Add more suspicious processes\n            - '\\mshta.exe'\n            - '\\wscript.exe'\n            - '\\cscript.exe'\n    condition: selection\nfalsepositives:\n    - Some legitimate admin or install scripts may use these processes for registry modifications.\nlevel: medium\n"},{"path":"registry\\registry_event\\registry_event_susp_mic_cam_access.yml","content":"title: Suspicious Camera and Microphone Access\nid: 62120148-6b7a-42be-8b91-271c04e281a3\nstatus: test\ndescription: Detects Processes accessing the camera and microphone from suspicious folder\nreferences:\n    - https://medium.com/@7a616368/can-you-track-processes-accessing-the-camera-and-microphone-7e6885b37072\nauthor: Den Iuzvyk\ndate: 2020-06-07\nmodified: 2022-10-09\ntags:\n    - attack.collection\n    - attack.t1125\n    - attack.t1123\nlogsource:\n    category: registry_event\n    product: windows\ndetection:\n    selection_1:\n        TargetObject|contains|all:\n            - '\\Software\\Microsoft\\Windows\\CurrentVersion\\CapabilityAccessManager\\ConsentStore\\'\n            - '\\NonPackaged'\n    selection_2:\n        TargetObject|contains:\n            - microphone\n            - webcam\n    selection_3:\n        TargetObject|contains:\n            - ':#Windows#Temp#'\n            - ':#$Recycle.bin#'\n            - ':#Temp#'\n            - ':#Users#Public#'\n            - ':#Users#Default#'\n            - ':#Users#Desktop#'\n    condition: all of selection_*\nfalsepositives:\n    - Unlikely, there could be conferencing software running from a Temp folder accessing the devices\nlevel: high\n"},{"path":"registry\\registry_event\\registry_event_susp_lsass_dll_load.yml","content":"title: DLL Load via LSASS\nid: b3503044-60ce-4bf4-bbcb-e3db98788823\nstatus: test\ndescription: Detects a method to load DLL via LSASS process using an undocumented Registry key\nreferences:\n    - https://blog.xpnsec.com/exploring-mimikatz-part-1/\n    - https://twitter.com/SBousseaden/status/1183745981189427200\nauthor: Florian Roth (Nextron Systems)\ndate: 2019-10-16\nmodified: 2022-04-21\ntags:\n    - attack.privilege-escalation\n    - attack.execution\n    - attack.persistence\n    - attack.t1547.008\nlogsource:\n    category: registry_event\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains:\n            - '\\CurrentControlSet\\Services\\NTDS\\DirectoryServiceExtPt'\n            - '\\CurrentControlSet\\Services\\NTDS\\LsaDbExtPt'\n    filter_domain_controller:\n        Image: 'C:\\Windows\\system32\\lsass.exe'\n        Details:\n            - '%%systemroot%%\\system32\\ntdsa.dll'\n            - '%%systemroot%%\\system32\\lsadb.dll'\n    condition: selection and not 1 of filter_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_event\\registry_event_susp_download_run_key.yml","content":"title: Suspicious Run Key from Download\nid: 9c5037d1-c568-49b3-88c7-9846a5bdc2be\nstatus: test\ndescription: Detects the suspicious RUN keys created by software located in Download or temporary Outlook/Internet Explorer directories\nreferences:\n    - https://app.any.run/tasks/c5bef5b7-f484-4c43-9cf3-d5c5c7839def/\n    - https://github.com/HackTricks-wiki/hacktricks/blob/e4c7b21b8f36c97c35b7c622732b38a189ce18f7/src/windows-hardening/windows-local-privilege-escalation/privilege-escalation-with-autorun-binaries.md\nauthor: Florian Roth (Nextron Systems), Swachchhanda Shrawan Poude (Nextron Systems)\ndate: 2019-10-01\nmodified: 2025-02-17\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547.001\nlogsource:\n    category: registry_event\n    product: windows\ndetection:\n    selection:\n        Image|contains:\n            - '\\AppData\\Local\\Packages\\Microsoft.Outlook_'\n            - '\\AppData\\Local\\Microsoft\\Olk\\Attachments\\'\n            - '\\Downloads\\'\n            - '\\Temporary Internet Files\\Content.Outlook\\'\n            - '\\Local Settings\\Temporary Internet Files\\'\n        TargetObject|contains:\n            - '\\Software\\Microsoft\\Windows\\CurrentVersion\\Run'\n            - '\\Software\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Run'\n            - '\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run'\n    condition: selection\nfalsepositives:\n    - Software installers downloaded and used by users\nlevel: high\n"},{"path":"registry\\registry_event\\registry_event_susp_atbroker_change.yml","content":"title: Atbroker Registry Change\nid: 9577edbb-851f-4243-8c91-1d5b50c1a39b\nstatus: test\ndescription: Detects creation/modification of Assistive Technology applications and persistence with usage of 'at'\nreferences:\n    - http://www.hexacorn.com/blog/2016/07/22/beyond-good-ol-run-key-part-42/\n    - https://lolbas-project.github.io/lolbas/Binaries/Atbroker/\nauthor: Mateusz Wydra, oscd.community\ndate: 2020-10-13\nmodified: 2023-01-19\ntags:\n    - attack.privilege-escalation\n    - attack.defense-evasion\n    - attack.t1218\n    - attack.persistence\n    - attack.t1547\nlogsource:\n    category: registry_event\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains:\n            - 'Software\\Microsoft\\Windows NT\\CurrentVersion\\Accessibility\\ATs'\n            - 'Software\\Microsoft\\Windows NT\\CurrentVersion\\Accessibility\\Configuration'\n    filter_atbroker:\n        Image: 'C:\\Windows\\system32\\atbroker.exe'\n        TargetObject|contains: '\\Microsoft\\Windows NT\\CurrentVersion\\Accessibility\\Configuration'\n        Details: '(Empty)'\n    filter_uninstallers:\n        Image|startswith: 'C:\\Windows\\Installer\\MSI'\n        TargetObject|contains: 'Software\\Microsoft\\Windows NT\\CurrentVersion\\Accessibility\\ATs'\n    condition: selection and not 1 of filter_*\nfalsepositives:\n    - Creation of non-default, legitimate at usage\nlevel: medium\n"},{"path":"registry\\registry_event\\registry_event_stickykey_like_backdoor.yml","content":"title: Sticky Key Like Backdoor Usage - Registry\nid: baca5663-583c-45f9-b5dc-ea96a22ce542\nstatus: test\ndescription: Detects the usage and installation of a backdoor that uses an option to register a malicious debugger for built-in tools that are accessible in the login screen\nreferences:\n    - https://blogs.technet.microsoft.com/jonathantrull/2016/10/03/detecting-sticky-key-backdoors/\n    - https://bazaar.abuse.ch/sample/6f3aa9362d72e806490a8abce245331030d1ab5ac77e400dd475748236a6cc81/\nauthor: Florian Roth (Nextron Systems), @twjackomo, Jonhnathan Ribeiro, oscd.community\ndate: 2018-03-15\nmodified: 2022-11-26\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1546.008\n    - car.2014-11-003\n    - car.2014-11-008\nlogsource:\n    category: registry_event\n    product: windows\ndetection:\n    selection_registry:\n        TargetObject|endswith:\n            - '\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\sethc.exe\\Debugger'\n            - '\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\utilman.exe\\Debugger'\n            - '\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\osk.exe\\Debugger'\n            - '\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\Magnify.exe\\Debugger'\n            - '\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\Narrator.exe\\Debugger'\n            - '\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\DisplaySwitch.exe\\Debugger'\n            - '\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\atbroker.exe\\Debugger'\n            - '\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\HelpPane.exe\\Debugger'\n    condition: selection_registry\nfalsepositives:\n    - Unlikely\nlevel: critical\n"},{"path":"registry\\registry_event\\registry_event_ssp_added_lsa_config.yml","content":"title: Security Support Provider (SSP) Added to LSA Configuration\nid: eeb30123-9fbd-4ee8-aaa0-2e545bbed6dc\nstatus: test\ndescription: |\n    Detects the addition of a SSP to the registry. Upon a reboot or API call, SSP DLLs gain access to encrypted and plaintext passwords stored in Windows.\nreferences:\n    - https://powersploit.readthedocs.io/en/latest/Persistence/Install-SSP/\n    - https://github.com/EmpireProject/Empire/blob/08cbd274bef78243d7a8ed6443b8364acd1fc48b/data/module_source/persistence/Install-SSP.ps1#L157\nauthor: iwillkeepwatch\ndate: 2019-01-18\nmodified: 2022-08-09\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547.005\nlogsource:\n    category: registry_event\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith:\n            - '\\Control\\Lsa\\Security Packages'\n            - '\\Control\\Lsa\\OSConfig\\Security Packages'\n    filter_main_msiexec:\n        Image:\n            - 'C:\\Windows\\system32\\msiexec.exe'\n            - 'C:\\Windows\\syswow64\\MsiExec.exe'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_event\\registry_event_silentprocessexit_lsass.yml","content":"title: Potential Credential Dumping Via LSASS SilentProcessExit Technique\nid: 55e29995-75e7-451a-bef0-6225e2f13597\nrelated:\n    - id: 36803969-5421-41ec-b92f-8500f79c23b0\n      type: similar\nstatus: test\ndescription: Detects changes to the Registry in which a monitor program gets registered to dump the memory of the lsass.exe process\nreferences:\n    - https://www.deepinstinct.com/2021/02/16/lsass-memory-dumps-are-stealthier-than-ever-before-part-2/\n    - https://oddvar.moe/2018/04/10/persistence-using-globalflags-in-image-file-execution-options-hidden-from-autoruns-exe/\nauthor: Florian Roth (Nextron Systems)\ndate: 2021-02-26\nmodified: 2022-12-19\ntags:\n    - attack.credential-access\n    - attack.t1003.001\nlogsource:\n    category: registry_event\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: 'Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit\\lsass.exe'\n    condition: selection\nfalsepositives:\n    - Unlikely\nlevel: critical\n"},{"path":"registry\\registry_event\\registry_event_shell_open_keys_manipulation.yml","content":"title: Shell Open Registry Keys Manipulation\nid: 152f3630-77c1-4284-bcc0-4cc68ab2f6e7\nstatus: test\ndescription: Detects the shell open key manipulation (exefile and ms-settings) used for persistence and the pattern of UAC Bypass using fodhelper.exe, computerdefaults.exe, slui.exe via registry keys (e.g. UACMe 33 or 62)\nreferences:\n    - https://github.com/hfiref0x/UACME\n    - https://winscripting.blog/2017/05/12/first-entry-welcome-and-uac-bypass/\n    - https://github.com/RhinoSecurityLabs/Aggressor-Scripts/tree/master/UACBypass\n    - https://tria.ge/211119-gs7rtshcfr/behavioral2 [Lokibot sample from Nov 2021]\nauthor: Christian Burkard (Nextron Systems)\ndate: 2021-08-30\nmodified: 2022-01-13\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.privilege-escalation\n    - attack.t1548.002\n    - attack.t1546.001\nlogsource:\n    category: registry_event\n    product: windows\ndetection:\n    selection1:\n        EventType: SetValue\n        TargetObject|endswith: 'Classes\\ms-settings\\shell\\open\\command\\SymbolicLinkValue'\n        Details|contains: '\\Software\\Classes\\{'\n    selection2:\n        TargetObject|endswith: 'Classes\\ms-settings\\shell\\open\\command\\DelegateExecute'\n    selection3:\n        EventType: SetValue\n        TargetObject|endswith:\n            - 'Classes\\ms-settings\\shell\\open\\command\\(Default)'\n            - 'Classes\\exefile\\shell\\open\\command\\(Default)'\n    filter_sel3:\n        Details: '(Empty)'\n    condition: selection1 or selection2 or (selection3 and not filter_sel3)\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_event\\registry_event_runonce_persistence.yml","content":"title: Run Once Task Configuration in Registry\nid: c74d7efc-8826-45d9-b8bb-f04fac9e4eff\nstatus: test\ndescription: Rule to detect the configuration of Run Once registry key. Configured payload can be run by runonce.exe /AlternateShellStartup\nreferences:\n    - https://twitter.com/pabraeken/status/990717080805789697\n    - https://lolbas-project.github.io/lolbas/Binaries/Runonce/\nauthor: 'Avneet Singh @v3t0_, oscd.community'\ndate: 2020-11-15\nmodified: 2024-03-25\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\nlogsource:\n    product: windows\n    category: registry_event\ndetection:\n    selection:\n        TargetObject|contains: '\\Microsoft\\Active Setup\\Installed Components'\n        TargetObject|endswith: '\\StubPath'\n    filter_optional_chrome:\n        Details|contains|all:\n            - 'C:\\Program Files\\Google\\Chrome\\Application\\'\n            - '\\Installer\\chrmstp.exe\" --configure-user-settings --verbose-logging --system-level' # In some cases the Details will contain an additional flag called \"--channel=stable\" at the end\n    filter_optional_edge:\n        Details|contains:\n            - 'C:\\Program Files (x86)\\Microsoft\\Edge\\Application\\'\n            - 'C:\\Program Files\\Microsoft\\Edge\\Application\\'\n        Details|endswith: '\\Installer\\setup.exe\" --configure-user-settings --verbose-logging --system-level --msedge --channel=stable'\n    condition: selection and not 1 of filter_optional_*\nfalsepositives:\n    - Legitimate modification of the registry key by legitimate program\nlevel: medium\n"},{"path":"registry\\registry_event\\registry_event_runkey_winekey.yml","content":"title: WINEKEY Registry Modification\nid: b98968aa-dbc0-4a9c-ac35-108363cbf8d5\nstatus: test\ndescription: Detects potential malicious modification of run keys by winekey or team9 backdoor\nreferences:\n    - https://www.fireeye.com/blog/threat-research/2020/10/kegtap-and-singlemalt-with-a-ransomware-chaser.html\nauthor: omkar72\ndate: 2020-10-30\nmodified: 2021-11-27\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547\nlogsource:\n    category: registry_event\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: 'Software\\Microsoft\\Windows\\CurrentVersion\\Run\\Backup Mgr'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_event\\registry_event_redmimicry_winnti_reg.yml","content":"title: RedMimicry Winnti Playbook Registry Manipulation\nid: 5b175490-b652-4b02-b1de-5b5b4083c5f8\nstatus: test\ndescription: Detects actions caused by the RedMimicry Winnti playbook\nreferences:\n    - https://redmimicry.com\nauthor: Alexander Rausch\ndate: 2020-06-24\nmodified: 2021-11-27\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\nlogsource:\n    product: windows\n    category: registry_event\ndetection:\n    selection:\n        TargetObject|contains: HKLM\\SOFTWARE\\Microsoft\\HTMLHelp\\data\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_event\\registry_event_portproxy_registry_key.yml","content":"title: New PortProxy Registry Entry Added\nid: a54f842a-3713-4b45-8c84-5f136fdebd3c\nstatus: test\ndescription: Detects the modification of the PortProxy registry key which is used for port forwarding.\nreferences:\n    - https://www.fireeye.com/blog/threat-research/2019/01/bypassing-network-restrictions-through-rdp-tunneling.html\n    - https://adepts.of0x.cc/netsh-portproxy-code/\n    - https://www.dfirnotes.net/portproxy_detection/\nauthor: Andreas Hunkeler (@Karneades)\ndate: 2021-06-22\nmodified: 2024-03-25\ntags:\n    - attack.lateral-movement\n    - attack.defense-evasion\n    - attack.command-and-control\n    - attack.t1090\nlogsource:\n    category: registry_event\n    product: windows\ndetection:\n    selection:\n        # Example: HKLM\\System\\CurrentControlSet\\Services\\PortProxy\\v4tov4\\tcp\\0.0.0.0/1337\n        TargetObject|contains: '\\Services\\PortProxy\\v4tov4\\tcp\\'\n    condition: selection\nfalsepositives:\n    - WSL2 network bridge PowerShell script used for WSL/Kubernetes/Docker (e.g. https://github.com/microsoft/WSL/issues/4150#issuecomment-504209723)\n    - Synergy Software KVM (https://symless.com/synergy)\nlevel: medium\n"},{"path":"registry\\registry_event\\registry_event_persistence_recycle_bin.yml","content":"title: Registry Persistence Mechanisms in Recycle Bin\nid: 277efb8f-60be-4f10-b4d3-037802f37167\nstatus: test\ndescription: Detects persistence registry keys for Recycle Bin\nreferences:\n    - https://github.com/vxunderground/VXUG-Papers/blob/751edb8d50f95bd7baa730adf2c6c3bb1b034276/The%20Persistence%20Series/Persistence%20via%20Recycle%20Bin/Persistence_via_Recycle_Bin.pdf\n    - https://persistence-info.github.io/Data/recyclebin.html\n    - https://www.hexacorn.com/blog/2018/05/28/beyond-good-ol-run-key-part-78-2/\nauthor: frack113\ndate: 2021-11-18\nmodified: 2022-12-06\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547\nlogsource:\n    category: registry_event\n    product: windows\ndetection:\n    selection_create:\n        EventType: RenameKey\n        NewName|contains: '\\CLSID\\{645FF040-5081-101B-9F08-00AA002F954E}\\shell\\open'\n    selection_set:\n        EventType: SetValue\n        TargetObject|contains: '\\CLSID\\{645FF040-5081-101B-9F08-00AA002F954E}\\shell\\open\\command\\(Default)'\n    condition: 1 of selection_*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_event\\registry_event_office_trust_record_modification.yml","content":"title: Windows Registry Trust Record Modification\nid: 295a59c1-7b79-4b47-a930-df12c15fc9c2\nrelated:\n    - id: a166f74e-bf44-409d-b9ba-ea4b2dd8b3cd\n      type: similar\nstatus: test\ndescription: Alerts on trust record modification within the registry, indicating usage of macros\nreferences:\n    - https://outflank.nl/blog/2018/01/16/hunting-for-evil-detect-macros-being-executed/\n    - http://az4n6.blogspot.com/2016/02/more-on-trust-records-macros-and.html\n    - https://twitter.com/inversecos/status/1494174785621819397\nauthor: Antonlovesdnb, Trent Liffick (@tliffick)\ndate: 2020-02-19\nmodified: 2023-06-21\ntags:\n    - attack.initial-access\n    - attack.t1566.001\nlogsource:\n    category: registry_event\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\Security\\Trusted Documents\\TrustRecords'\n    condition: selection\nfalsepositives:\n    - This will alert on legitimate macro usage as well, additional tuning is required\nlevel: medium\n"},{"path":"registry\\registry_event\\registry_event_office_test_regadd.yml","content":"title: Office Application Startup - Office Test\nid: 3d27f6dd-1c74-4687-b4fa-ca849d128d1c\nstatus: test\ndescription: Detects the addition of office test registry that allows a user to specify an arbitrary DLL that will be executed every time an Office application is started\nreferences:\n    - https://unit42.paloaltonetworks.com/unit42-technical-walkthrough-office-test-persistence-method-used-in-recent-sofacy-attacks/\nauthor: omkar72\ndate: 2020-10-25\nmodified: 2023-11-08\ntags:\n    - attack.persistence\n    - attack.t1137.002\nlogsource:\n    category: registry_event\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\Software\\Microsoft\\Office test\\Special\\Perf'\n    condition: selection\nfalsepositives:\n    - Unlikely\nlevel: medium\n"},{"path":"registry\\registry_event\\registry_event_new_dll_added_to_appinit_dlls_registry_key.yml","content":"title: New DLL Added to AppInit_DLLs Registry Key\nid: 4f84b697-c9ed-4420-8ab5-e09af5b2345d\nstatus: test\ndescription: DLLs that are specified in the AppInit_DLLs value in the Registry key HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows are loaded by user32.dll into every process that loads user32.dll\nreferences:\n    - https://eqllib.readthedocs.io/en/latest/analytics/822dc4c5-b355-4df8-bd37-29c458997b8f.html\nauthor: Ilyas Ochkov, oscd.community, Tim Shelton\ndate: 2019-10-25\nmodified: 2022-12-25\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1546.010\nlogsource:\n    category: registry_event\n    product: windows\ndetection:\n    selection:\n        - TargetObject|endswith:\n              - '\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\AppInit_Dlls'\n              - '\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\AppInit_Dlls'\n        # Key Rename\n        - NewName|endswith:\n              - '\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\AppInit_Dlls'\n              - '\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\AppInit_Dlls'\n    filter:\n        Details: '(Empty)'\n    condition: selection and not filter\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"registry\\registry_event\\registry_event_new_dll_added_to_appcertdlls_registry_key.yml","content":"title: New DLL Added to AppCertDlls Registry Key\nid: 6aa1d992-5925-4e9f-a49b-845e51d1de01\nstatus: test\ndescription: |\n  Dynamic-link libraries (DLLs) that are specified in the AppCertDLLs value in the Registry key can be abused to obtain persistence and privilege escalation\n  by causing a malicious DLL to be loaded and run in the context of separate processes on the computer.\nreferences:\n    - http://www.hexacorn.com/blog/2013/01/19/beyond-good-ol-run-key-part-3/\n    - https://eqllib.readthedocs.io/en/latest/analytics/14f90406-10a0-4d36-a672-31cabe149f2f.html\nauthor: Ilyas Ochkov, oscd.community\ndate: 2019-10-25\nmodified: 2021-11-27\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1546.009\nlogsource:\n    category: registry_event\n    product: windows\ndetection:\n    selection:\n        # Sysmon gives us HKLM\\SYSTEM\\CurrentControlSet\\.. if ControlSetXX is the selected one\n        - TargetObject: 'HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\AppCertDlls'\n        # key rename\n        - NewName: 'HKLM\\SYSTEM\\CurentControlSet\\Control\\Session Manager\\AppCertDlls'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: medium\n"},{"path":"registry\\registry_event\\registry_event_net_ntlm_downgrade.yml","content":"title: NetNTLM Downgrade Attack - Registry\nid: d67572a0-e2ec-45d6-b8db-c100d14b8ef2\nstatus: test\ndescription: Detects NetNTLM downgrade attack\nreferences:\n    - https://web.archive.org/web/20171113231705/https://www.optiv.com/blog/post-exploitation-using-netntlm-downgrade-attacks\n    - https://www.ultimatewindowssecurity.com/wiki/page.aspx?spid=NSrpcservers\nauthor: Florian Roth (Nextron Systems), wagga, Nasreddine Bencherchali (Splunk STRT)\ndate: 2018-03-20\nmodified: 2024-12-03\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1562.001\n    - attack.t1112\nlogsource:\n    product: windows\n    category: registry_event\ndetection:\n    selection_regkey:\n        TargetObject|contains|all:\n            - 'SYSTEM\\'\n            - 'ControlSet'\n            - '\\Control\\Lsa'\n    selection_value_lmcompatibilitylevel:\n        TargetObject|endswith: '\\lmcompatibilitylevel'\n        Details:\n            - 'DWORD (0x00000000)'\n            - 'DWORD (0x00000001)'\n            - 'DWORD (0x00000002)'\n    selection_value_ntlmminclientsec:\n        TargetObject|endswith: '\\NtlmMinClientSec'\n        Details:\n            - 'DWORD (0x00000000)' # No Security\n            - 'DWORD (0x00000010)' # Only Integrity\n            - 'DWORD (0x00000020)' # Only confidentiality\n            - 'DWORD (0x00000030)' # Both Integrity and confidentiality\n    selection_value_restrictsendingntlmtraffic:\n        # Note: The obvious values with issues are 0x00000000 (allow all) and 0x00000001 (audit).\n        # 0x00000002 can be secure but only if \"ClientAllowedNTLMServers\" is properly configured\n        # Hence all values should be monitored and investigated\n        TargetObject|endswith: '\\RestrictSendingNTLMTraffic'\n    condition: selection_regkey and 1 of selection_value_*\nfalsepositives:\n    - Services or tools that set the values to more restrictive values\nlevel: high\n"},{"path":"registry\\registry_event\\registry_event_narrator_feedback_persistance.yml","content":"title: Narrator's Feedback-Hub Persistence\nid: f663a6d9-9d1b-49b8-b2b1-0637914d199a\nstatus: test\ndescription: Detects abusing Windows 10 Narrator's Feedback-Hub\nreferences:\n    - https://giuliocomi.blogspot.com/2019/10/abusing-windows-10-narrators-feedback.html\nauthor: Dmitriy Lifanov, oscd.community\ndate: 2019-10-25\nmodified: 2022-03-26\ntags:\n    - attack.privilege-escalation\n    - attack.persistence\n    - attack.t1547.001\nlogsource:\n    category: registry_event\n    product: windows\ndetection:\n    selection1:\n        EventType: DeleteValue\n        TargetObject|endswith: '\\AppXypsaf9f1qserqevf0sws76dx4k9a5206\\Shell\\open\\command\\DelegateExecute'\n    selection2:\n        TargetObject|endswith: '\\AppXypsaf9f1qserqevf0sws76dx4k9a5206\\Shell\\open\\command\\(Default)'\n    # Add the payload in the (Default)\n    condition: 1 of selection*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_event\\registry_event_modify_screensaver_binary_path.yml","content":"title: Path To Screensaver Binary Modified\nid: 67a6c006-3fbe-46a7-9074-2ba3b82c3000\nstatus: test\ndescription: Detects value modification of registry key containing path to binary used as screensaver.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1546.002/T1546.002.md\n    - https://www.welivesecurity.com/wp-content/uploads/2017/08/eset-gazer.pdf\nauthor: Bartlomiej Czyz @bczyz1, oscd.community\ndate: 2020-10-11\nmodified: 2021-11-27\ntags:\n    - attack.persistence\n    - attack.privilege-escalation\n    - attack.t1546.002\nlogsource:\n    category: registry_event\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: '\\Control Panel\\Desktop\\SCRNSAVE.EXE' # HKEY_CURRENT_USER\\Control Panel\\Desktop\\SCRNSAVE.EXE\n    filter:\n        Image|endswith:\n            - '\\rundll32.exe'\n            - '\\explorer.exe'\n    condition: selection and not filter\nfalsepositives:\n    - Legitimate modification of screensaver\nlevel: medium\n"},{"path":"registry\\registry_event\\registry_event_mal_azorult.yml","content":"title: Registry Entries For Azorult Malware\nid: f7f9ab88-7557-4a69-b30e-0a8f91b3a0e7\nstatus: test\ndescription: Detects the presence of a registry key created during Azorult execution\nreferences:\n    - https://www.trendmicro.com/vinfo/us/threat-encyclopedia/malware/trojan.win32.azoruit.a\nauthor: Trent Liffick\ndate: 2020-05-08\nmodified: 2021-11-27\ntags:\n    - attack.defense-evasion\n    - attack.persistence\n    - attack.execution\n    - attack.t1112\nlogsource:\n    product: windows\n    category: registry_event\ndetection:\n    selection:\n        EventID:\n            - 12\n            - 13\n        TargetObject|contains: 'SYSTEM\\'\n        TargetObject|endswith: '\\services\\localNETService'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: critical\n"},{"path":"registry\\registry_event\\registry_event_malware_qakbot_registry.yml","content":"title: Potential Qakbot Registry Activity\nid: 1c8e96cd-2bed-487d-9de0-b46c90cade56\nstatus: test\ndescription: Detects a registry key used by IceID in a campaign that distributes malicious OneNote files\nreferences:\n    - https://www.zscaler.com/blogs/security-research/onenote-growing-threat-malware-distribution\nauthor: Hieu Tran\ndate: 2023-03-13\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\nlogsource:\n    category: registry_event\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: '\\Software\\firm\\soft\\Name'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_event\\registry_event_hybridconnectionmgr_svc_installation.yml","content":"title: HybridConnectionManager Service Installation - Registry\nid: ac8866c7-ce44-46fd-8c17-b24acff96ca8\nstatus: test\ndescription: Detects the installation of the Azure Hybrid Connection Manager service to allow remote code execution from Azure function.\nreferences:\n    - https://twitter.com/Cyb3rWard0g/status/1381642789369286662\nauthor: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)\ndate: 2021-04-12\nmodified: 2022-11-27\ntags:\n    - attack.resource-development\n    - attack.t1608\nlogsource:\n    category: registry_event\n    product: windows\ndetection:\n    selection1:\n        TargetObject|contains: '\\Services\\HybridConnectionManager'\n    selection2:\n        EventType: SetValue\n        Details|contains: 'Microsoft.HybridConnectionManager.Listener.exe'\n    condition: selection1 or selection2\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_event\\registry_event_hack_wce_reg.yml","content":"title: Windows Credential Editor Registry\nid: a6b33c02-8305-488f-8585-03cb2a7763f2\nstatus: test\ndescription: Detects the use of Windows Credential Editor (WCE)\nreferences:\n    - https://www.ampliasecurity.com/research/windows-credentials-editor/\nauthor: Florian Roth (Nextron Systems)\ndate: 2019-12-31\nmodified: 2021-11-27\ntags:\n    - attack.credential-access\n    - attack.t1003.001\n    - attack.s0005\nlogsource:\n    category: registry_event\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: Services\\WCESERVICE\\Start\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: critical\n"},{"path":"registry\\registry_event\\registry_event_esentutl_volume_shadow_copy_service_keys.yml","content":"title: Esentutl Volume Shadow Copy Service Keys\nid: 5aad0995-46ab-41bd-a9ff-724f41114971\nstatus: test\ndescription: Detects the volume shadow copy service initialization and processing via esentutl. Registry keys such as HKLM\\\\System\\\\CurrentControlSet\\\\Services\\\\VSS\\\\Diag\\\\VolSnap\\\\Volume are captured.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1003.002/T1003.002.md#atomic-test-3---esentutlexe-sam-copy\nauthor: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)\ndate: 2020-10-20\nmodified: 2022-12-25\ntags:\n    - attack.credential-access\n    - attack.t1003.002\nlogsource:\n    category: registry_event\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: 'System\\CurrentControlSet\\Services\\VSS'\n        Image|endswith: 'esentutl.exe' # limit esentutl as in references, too many FP to filter\n    filter:\n        TargetObject|contains: 'System\\CurrentControlSet\\Services\\VSS\\Start'\n    condition: selection and not filter\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_event\\registry_event_disable_wdigest_credential_guard.yml","content":"title: Wdigest CredGuard Registry Modification\nid: 1a2d6c47-75b0-45bd-b133-2c0be75349fd\nstatus: test\ndescription: |\n  Detects potential malicious modification of the property value of IsCredGuardEnabled from\n  HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest to disable Cred Guard on a system.\n  This is usually used with UseLogonCredential to manipulate the caching credentials.\nreferences:\n    - https://teamhydra.blog/2020/08/25/bypassing-credential-guard/\nauthor: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)\ndate: 2019-08-25\nmodified: 2021-11-27\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\nlogsource:\n    category: registry_event\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: '\\IsCredGuardEnabled'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_event\\registry_event_disable_security_events_logging_adding_reg_key_minint.yml","content":"title: Disable Security Events Logging Adding Reg Key MiniNt\nid: 919f2ef0-be2d-4a7a-b635-eb2b41fde044\nstatus: test\ndescription: Detects the addition of a key 'MiniNt' to the registry. Upon a reboot, Windows Event Log service will stop writing events.\nreferences:\n    - https://twitter.com/0gtweet/status/1182516740955226112\n    - https://www.hackingarticles.in/defense-evasion-windows-event-logging-t1562-002/\nauthor: Ilyas Ochkov, oscd.community\ndate: 2019-10-25\nmodified: 2021-11-27\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1562.002\n    - attack.t1112\n    - car.2022-03-001\nlogsource:\n    category: registry_event\n    product: windows\ndetection:\n    selection:\n    # Sysmon gives us HKLM\\SYSTEM\\CurrentControlSet\\.. if ControlSetXX is the selected one\n        - TargetObject: 'HKLM\\SYSTEM\\CurrentControlSet\\Control\\MiniNt'\n          EventType: 'CreateKey'    # we don't want deletekey\n    # key rename\n        - NewName: 'HKLM\\SYSTEM\\CurrentControlSet\\Control\\MiniNt'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_event\\registry_event_defender_threat_action_modified.yml","content":"title: Windows Defender Threat Severity Default Action Modified\nid: 5a9e1b2c-8f7d-4a1e-9b3c-0f6d7e5a4b1f\nrelated:\n    - id: 1e8a9b4d-3c2a-4f9b-8d1e-7c6a5b4f3d2e\n      type: similar\nstatus: experimental\ndescription: |\n    Detects modifications or creations of Windows Defender's default threat action settings based on severity to 'allow' or take 'no action'.\n    This is a highly suspicious configuration change that effectively disables Defender's ability to automatically mitigate threats of a certain severity level,\n    allowing malicious software to run unimpeded. An attacker might use this technique to bypass defenses before executing payloads.\nreferences:\n    - https://learn.microsoft.com/en-us/powershell/module/defender/set-mppreference\n    - https://learn.microsoft.com/en-us/windows-hardware/customize/desktop/unattend/security-malware-windows-defender-threatseveritydefaultaction\n    - https://research.splunk.com/endpoint/7215831c-8252-4ae3-8d43-db588e82f952\n    - https://gist.github.com/Dump-GUY/8daef859f382b895ac6fd0cf094555d2\n    - https://thedfirreport.com/2021/10/18/icedid-to-xinglocker-ransomware-in-24-hours/\nauthor: 'Matt Anderson (Huntress)'\ndate: 2025-07-11\ntags:\n    - attack.defense-evasion\n    - attack.t1562.001\nlogsource:\n    category: registry_event\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\Microsoft\\Windows Defender\\Threats\\ThreatSeverityDefaultAction\\'\n        TargetObject|endswith:\n            - '\\1' # Low severity\n            - '\\2' # Moderate severity\n            - '\\4' # High severity\n            - '\\5' # Severe severity\n        Details:\n            - 'DWORD (0x00000006)' # Allow\n            - 'DWORD (0x00000009)' # NoAction\n    condition: selection\nfalsepositives:\n    - Legitimate administration via scripts or tools (e.g., SCCM, Intune, GPO enforcement). Correlate with administrative activity.\n    - Software installations that legitimately modify Defender settings (less common for these specific keys).\nlevel: high\n"},{"path":"registry\\registry_event\\registry_event_cmstp_execution_by_registry.yml","content":"title: CMSTP Execution Registry Event\nid: b6d235fc-1d38-4b12-adbe-325f06728f37\nstatus: stable\ndescription: Detects various indicators of Microsoft Connection Manager Profile Installer execution\nreferences:\n    - https://web.archive.org/web/20190720093911/http://www.endurant.io/cmstp/detecting-cmstp-enabled-code-execution-and-uac-bypass-with-sysmon/\nauthor: Nik Seetharaman\ndate: 2018-07-16\nmodified: 2020-12-23\ntags:\n    - attack.defense-evasion\n    - attack.execution\n    - attack.t1218.003\n    - attack.g0069\n    - car.2019-04-001\nlogsource:\n    category: registry_event\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: '\\cmmgr32.exe'\n    condition: selection\nfalsepositives:\n    - Legitimate CMSTP use (unlikely in modern enterprise environments)\nlevel: high\n"},{"path":"registry\\registry_event\\registry_event_bypass_via_wsreset.yml","content":"title: UAC Bypass Via Wsreset\nid: 6ea3bf32-9680-422d-9f50-e90716b12a66\nstatus: test\ndescription: Unfixed method for UAC bypass from Windows 10. WSReset.exe file associated with the Windows Store. It will run a binary file contained in a low-privilege registry.\nreferences:\n    - https://www.bleepingcomputer.com/news/security/trickbot-uses-a-new-windows-10-uac-bypass-to-launch-quietly\n    - https://lolbas-project.github.io/lolbas/Binaries/Wsreset\nauthor: oscd.community, Dmitry Uchakin\ndate: 2020-10-07\nmodified: 2021-11-27\ntags:\n    - attack.defense-evasion\n    - attack.privilege-escalation\n    - attack.t1548.002\nlogsource:\n    category: registry_event\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: '\\AppX82a6gwre4fdg3bt635tn5ctqjf8msdd2\\Shell\\open\\command'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_event\\registry_event_add_local_hidden_user.yml","content":"title: Creation of a Local Hidden User Account by Registry\nid: 460479f3-80b7-42da-9c43-2cc1d54dbccd\nstatus: test\ndescription: Sysmon registry detection of a local hidden user account.\nreferences:\n    - https://twitter.com/SBousseaden/status/1387530414185664538\nauthor: Christian Burkard (Nextron Systems)\ndate: 2021-05-03\nmodified: 2025-10-31\ntags:\n    - attack.persistence\n    - attack.t1136.001\nlogsource:\n    product: windows\n    category: registry_event\ndetection:\n    selection:\n        TargetObject|contains: '\\SAM\\SAM\\Domains\\Account\\Users\\Names\\'\n        TargetObject|endswith: '$\\(Default)'\n        Image|endswith: '\\lsass.exe'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\nregression_tests_path: regression_data/rules/windows/registry/registry_event/registry_event_add_local_hidden_user/info.yml\nsimulation:\n    - type: atomic-red-team\n      name: Create Hidden User in Registry\n      technique: T1564.002\n      atomic_guid: 173126b7-afe4-45eb-8680-fa9f6400431c\n"},{"path":"registry\\registry_delete\\registry_delete_schtasks_hide_task_via_sd_value_removal.yml","content":"title: Removal Of SD Value to Hide Schedule Task - Registry\nid: acd74772-5f88-45c7-956b-6a7b36c294d2\nrelated:\n    - id: 526cc8bc-1cdc-48ad-8b26-f19bff969cec\n      type: similar\nstatus: test\ndescription: Remove SD (Security Descriptor) value in \\Schedule\\TaskCache\\Tree registry hive to hide schedule task. This technique is used by Tarrask malware\nreferences:\n    - https://www.microsoft.com/security/blog/2022/04/12/tarrask-malware-uses-scheduled-tasks-for-defense-evasion/\nauthor: Sittikorn S\ndate: 2022-04-15\nmodified: 2025-10-25\ntags:\n    - attack.defense-evasion\n    - attack.t1562\nlogsource:\n    product: windows\n    category: registry_delete\ndetection:\n    selection:\n        TargetObject|contains|all:\n            - '\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tree\\'\n            - 'SD'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: medium\nregression_tests_path: regression_data/rules/windows/registry/registry_delete/registry_delete_schtasks_hide_task_via_sd_value_removal/info.yml\n"},{"path":"registry\\registry_delete\\registry_delete_schtasks_hide_task_via_index_value_removal.yml","content":"title: Removal Of Index Value to Hide Schedule Task - Registry\nid: 526cc8bc-1cdc-48ad-8b26-f19bff969cec\nrelated:\n    - id: acd74772-5f88-45c7-956b-6a7b36c294d2\n      type: similar\n    - id: 5b16df71-8615-4f7f-ac9b-6c43c0509e61\n      type: similar\nstatus: test\ndescription: Detects when the \"index\" value of a scheduled task is removed or deleted from the registry. Which effectively hides it from any tooling such as \"schtasks /query\"\nreferences:\n    - https://blog.qualys.com/vulnerabilities-threat-research/2022/06/20/defending-against-scheduled-task-attacks-in-windows-environments\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-08-26\nmodified: 2025-10-25\ntags:\n    - attack.defense-evasion\n    - attack.t1562\nlogsource:\n    product: windows\n    category: registry_delete\ndetection:\n    selection:\n        TargetObject|contains|all:\n            - '\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tree\\'\n            - 'Index'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: medium\nregression_tests_path: regression_data/rules/windows/registry/registry_delete/registry_delete_schtasks_hide_task_via_index_value_removal/info.yml\n"},{"path":"registry\\registry_delete\\registry_delete_runmru.yml","content":"title: RunMRU Registry Key Deletion - Registry\nid: 3a9b8c1e-5b2e-4f7a-9d1c-2a7f3b6e1c55\nrelated:\n    - id: c11aecef-9c37-45a6-9c07-bc0782f963fd\n      type: similar\nstatus: experimental\ndescription: |\n    Detects attempts to delete the RunMRU registry key, which stores the history of commands executed via the run dialog.\n    In the clickfix techniques, the phishing lures instruct users to open a run dialog through (Win + R) and execute malicious commands.\n    Adversaries may delete this key to cover their tracks after executing commands.\nreferences:\n    - https://www.zscaler.com/blogs/security-research/coldriver-updates-arsenal-baitswitch-and-simplefix\nauthor: Swachchhanda Shrawan Poudel (Nextron Systems)\ndate: 2025-09-25\ntags:\n    - attack.defense-evasion\n    - attack.t1070.003\nlogsource:\n    category: registry_delete\n    product: windows\ndetection:\n    selection:\n        TargetObject|endswith: '\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\RunMRU'\n    condition: selection\nfalsepositives:\n    - Unknown\nlevel: high\nregression_tests_path: regression_data/rules/windows/registry/registry_delete/registry_delete_runmru/info.yml\n"},{"path":"registry\\registry_delete\\registry_delete_removal_com_hijacking_registry_key.yml","content":"title: Removal of Potential COM Hijacking Registry Keys\nid: 96f697b0-b499-4e5d-9908-a67bec11cdb6\nstatus: test\ndescription: |\n    Detects any deletion of entries in \".*\\shell\\open\\command\" registry keys.\n    These registry keys might have been used for COM hijacking activities by a threat actor or an attacker and the deletion could indicate steps to remove its tracks.\nreferences:\n    - https://github.com/OTRF/detection-hackathon-apt29/issues/7\n    - https://github.com/OTRF/ThreatHunter-Playbook/blob/2d4257f630f4c9770f78d0c1df059f891ffc3fec/docs/evals/apt29/detections/3.C.1_22A46621-7A92-48C1-81BF-B3937EB4FDC3.md\n    - https://learn.microsoft.com/en-us/windows/win32/shell/launch\n    - https://learn.microsoft.com/en-us/windows/win32/api/shobjidl_core/nn-shobjidl_core-iexecutecommand\n    - https://learn.microsoft.com/en-us/windows/win32/shell/shell-and-managed-code\nauthor: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)\ndate: 2020-05-02\nmodified: 2025-10-07\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1112\nlogsource:\n    product: windows\n    category: registry_delete\ndetection:\n    selection:\n        TargetObject|endswith: '\\shell\\open\\command'\n    filter_main_explorer:\n        Image|endswith: 'C:\\Windows\\explorer.exe'\n    filter_main_svchost:\n        Image: 'C:\\Windows\\system32\\svchost.exe'\n    filter_main_msiexec:\n        Image:\n            - 'C:\\Windows\\System32\\msiexec.exe'\n            - 'C:\\Windows\\SysWOW64\\msiexec.exe'\n    filter_main_generic_prorams:\n        Image|startswith:\n            - 'C:\\Program Files\\'\n            - 'C:\\Program Files (x86)\\'\n    filter_main_openwith:\n        Image: 'C:\\Windows\\System32\\OpenWith.exe'\n    filter_optional_dropbox:\n        Image|endswith: '\\Dropbox.exe'\n        # We don't use the HKCR anchor as it could be logged as a different variation (HKEY_CLASSES_ROOT)\n        TargetObject|contains: '\\Dropbox.'\n    filter_optional_wireshark:\n        Image|endswith: '\\AppData\\Local\\Temp\\Wireshark_uninstaller.exe'\n        # We don't use the HKCR anchor as it could be logged as a different variation (HKEY_CLASSES_ROOT)\n        TargetObject|contains: '\\wireshark-capture-file\\'\n    filter_optional_peazip:\n        Image|contains: 'peazip'\n        # We don't use the HKCR anchor as it could be logged as a different variation (HKEY_CLASSES_ROOT)\n        TargetObject|contains: '\\PeaZip.'\n    filter_optional_everything:\n        Image|endswith: '\\Everything.exe'\n        # We don't use the HKCR anchor as it could be logged as a different variation (HKEY_CLASSES_ROOT)\n        TargetObject|contains: '\\Everything.'\n    filter_optional_uninstallers:\n        # This image path is linked with different uninstallers when running as admin unfortunately\n        Image|startswith: 'C:\\Windows\\Installer\\MSI'\n    filter_optional_java:\n        Image|startswith: 'C:\\Program Files (x86)\\Java\\'\n        Image|endswith: '\\installer.exe'\n        TargetObject|contains: '\\Classes\\WOW6432Node\\CLSID\\{4299124F-F2C3-41b4-9C73-9236B2AD0E8F}'\n    filter_optional_edgeupdate:\n        Image|contains: '\\Microsoft\\EdgeUpdate\\Install'\n    filter_optional_avira:\n        Image:\n            - 'C:\\Program Files (x86)\\Avira\\Antivirus\\'\n            - 'C:\\Program Files\\Avira\\Antivirus\\'\n        TargetObject|endswith:\n            - '\\CLSID\\{305CA226-D286-468e-B848-2B2E8E697B74}\\Shell\\Open\\Command'\n            - '\\AntiVir.Keyfile\\shell\\open\\command'\n    filter_optional_installer_temp:\n        - Image|contains|all:\n              - 'AppData\\Local\\Temp'\n              - '\\setup.exe'\n        - Image|contains|all:\n              - '\\Temp\\is-'\n              - '\\target.tmp'\n    filter_optional_ninite:\n        Image|endswith: '\\ninite.exe'\n    filter_optional_discord:\n        Image|endswith: '\\reg.exe'\n        TargetObject|endswith: '\\Discord\\shell\\open\\command'\n    filter_optional_spotify:\n        Image|endswith: '\\Spotify.exe'\n        TargetObject|endswith: '\\Spotify\\shell\\open\\command'\n    filter_optional_eclipse:\n        Image|endswith: 'C:\\eclipse\\eclipse.exe'\n        TargetObject|contains: '_Classes\\eclipse+'\n    filter_optional_teamviewer:\n        Image|contains|all:\n            - '\\Temp'\n            - '\\TeamViewer'\n    condition: selection and not 1 of filter_main_* and not 1 of filter_optional_*\nfalsepositives:\n    - Legitimate software (un)installations are known to cause false positives. Please add them as a filter when encountered\nlevel: medium\n"},{"path":"registry\\registry_delete\\registry_delete_removal_amsi_registry_key.yml","content":"title: Removal Of AMSI Provider Registry Keys\nid: 41d1058a-aea7-4952-9293-29eaaf516465\nstatus: test\ndescription: Detects the deletion of AMSI provider registry key entries in HKLM\\Software\\Microsoft\\AMSI. This technique could be used by an attacker in order to disable AMSI inspection.\nreferences:\n    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.001/T1562.001.md\n    - https://seclists.org/fulldisclosure/2020/Mar/45\nauthor: frack113\ndate: 2021-06-07\nmodified: 2025-10-07\ntags:\n    - attack.defense-evasion\n    - attack.t1562.001\nlogsource:\n    product: windows\n    category: registry_delete\ndetection:\n    selection:\n        TargetObject|endswith:\n            - '{2781761E-28E0-4109-99FE-B9D127C57AFE}' # IOfficeAntiVirus\n            - '{A7C452EF-8E9F-42EB-9F2B-245613CA0DC9}' # ProtectionManagement.dll\n    filter_main_defender:\n        Image|startswith:\n            - 'C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\'\n            - 'C:\\Program Files\\Windows Defender\\'\n            - 'C:\\Program Files (x86)\\Windows Defender\\'\n        Image|endswith: '\\MsMpEng.exe'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Unlikely\nlevel: high\nregression_tests_path: regression_data/rules/windows/registry/registry_delete/registry_delete_removal_amsi_registry_key/info.yml\nsimulation:\n    - type: atomic-red-team\n      name: AMSI Bypass - Remove AMSI Provider Reg Key\n      technique: T1562.001\n      atomic_guid: 13f09b91-c953-438e-845b-b585e51cac9b\n"},{"path":"registry\\registry_delete\\registry_delete_mstsc_history_cleared.yml","content":"title: Terminal Server Client Connection History Cleared - Registry\nid: 07bdd2f5-9c58-4f38-aec8-e101bb79ef8d\nstatus: test\ndescription: Detects the deletion of registry keys containing the MSTSC connection history\nreferences:\n    - https://learn.microsoft.com/en-us/troubleshoot/windows-server/remote/remove-entries-from-remote-desktop-connection-computer\n    - http://woshub.com/how-to-clear-rdp-connections-history/\n    - https://www.trendmicro.com/en_us/research/23/a/vice-society-ransomware-group-targets-manufacturing-companies.html\nauthor: Christian Burkard (Nextron Systems)\ndate: 2021-10-19\nmodified: 2023-02-08\ntags:\n    - attack.persistence\n    - attack.defense-evasion\n    - attack.t1070\n    - attack.t1112\nlogsource:\n    category: registry_delete\n    product: windows\ndetection:\n    selection1:\n        EventType: DeleteValue\n        TargetObject|contains: '\\Microsoft\\Terminal Server Client\\Default\\MRU'\n    selection2:\n        EventType: DeleteKey\n        TargetObject|contains: '\\Microsoft\\Terminal Server Client\\Servers\\'\n    condition: 1 of selection*\nfalsepositives:\n    - Unknown\nlevel: high\n"},{"path":"registry\\registry_delete\\registry_delete_exploit_guard_protected_folders.yml","content":"title: Folder Removed From Exploit Guard ProtectedFolders List - Registry\nid: 272e55a4-9e6b-4211-acb6-78f51f0b1b40\nstatus: test\ndescription: Detects the removal of folders from the \"ProtectedFolders\" list of of exploit guard. This could indicate an attacker trying to launch an encryption process or trying to manipulate data inside of the protected folder\nreferences:\n    - https://www.microsoft.com/security/blog/2017/10/23/windows-defender-exploit-guard-reduce-the-attack-surface-against-next-generation-malware/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-08-05\nmodified: 2023-02-08\ntags:\n    - attack.defense-evasion\n    - attack.t1562.001\nlogsource:\n    category: registry_delete\n    product: windows\ndetection:\n    selection:\n        EventType: DeleteValue\n        TargetObject|contains: 'SOFTWARE\\Microsoft\\Windows Defender\\Windows Defender Exploit Guard\\Controlled Folder Access\\ProtectedFolders'\n    condition: selection\nfalsepositives:\n    - Legitimate administrators removing applications (should always be investigated)\nlevel: high\n"},{"path":"registry\\registry_delete\\registry_delete_enable_windows_recall.yml","content":"title: Windows Recall Feature Enabled - DisableAIDataAnalysis Value Deleted\nid: 5dfc1465-8f65-4fde-8eb5-6194380c6a62\nrelated:\n    - id: 75180c5f-4ea1-461a-a4f6-6e4700c065d4\n      type: similar\n    - id: 817f252c-5143-4dae-b418-48c3e9f63728\n      type: similar\nstatus: test\ndescription: |\n    Detects the enabling of the Windows Recall feature via registry manipulation. Windows Recall can be enabled by deleting the existing \"DisableAIDataAnalysis\" registry value.\n    Adversaries may enable Windows Recall as part of post-exploitation discovery and collection activities.\n    This rule assumes that Recall is already explicitly disabled on the host, and subsequently enabled by the adversary.\nreferences:\n    - https://learn.microsoft.com/en-us/windows/client-management/manage-recall\n    - https://learn.microsoft.com/en-us/windows/client-management/mdm/policy-csp-windowsai#disableaidataanalysis\nauthor: Sajid Nawaz Khan\ndate: 2024-06-02\ntags:\n    - attack.collection\n    - attack.t1113\nlogsource:\n    category: registry_delete\n    product: windows\ndetection:\n    selection:\n        # HKEY_CURRENT_USER\\Software\\Policies\\Microsoft\\Windows\\WindowsAI\\DisableAIDataAnalysis\n        # HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsAI\\DisableAIDataAnalysis\n        EventType: DeleteValue\n        TargetObject|endswith: '\\Microsoft\\Windows\\WindowsAI\\DisableAIDataAnalysis'\n    condition: selection\nfalsepositives:\n    - Legitimate use/activation of Windows Recall\nlevel: medium\n"},{"path":"registry\\registry_delete\\registry_delete_defender_context_menu.yml","content":"title: Delete Defender Scan ShellEx Context Menu Registry Key\nid: 72a0369a-2576-4aaf-bfc9-6bb24a574ac6\nrelated:\n    - id: b9e8c7d6-a5f4-4e3d-8b1a-9f0c8d7e6a5b\n      type: similar\nstatus: experimental\ndescription: Detects deletion of registry key that adds 'Scan with Defender' option in context menu. Attackers may use this to make it harder for users to scan files that are suspicious.\nreferences:\n    - https://research.splunk.com/endpoint/395ed5fe-ad13-4366-9405-a228427bdd91/\n    - https://winaero.com/how-to-delete-scan-with-windows-defender-from-context-menu-in-windows-10/\n    - https://thedfirreport.com/2021/10/18/icedid-to-xinglocker-ransomware-in-24-hours/\n    - https://blog.malwarebytes.com/malwarebytes-news/2021/02/lazyscripter-from-empire-to-double-rat/\nauthor: 'Matt Anderson (Huntress)'\ndate: 2025-07-11\nmodified: 2025-10-07\ntags:\n    - attack.defense-evasion\nlogsource:\n    category: registry_delete\n    product: windows\ndetection:\n    selection:\n        TargetObject|contains: 'shellex\\ContextMenuHandlers\\EPP'\n    filter_main_defender:\n        Image|startswith:\n            - 'C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\'\n            - 'C:\\Program Files\\Windows Defender\\'\n            - 'C:\\Program Files (x86)\\Windows Defender\\'\n        Image|endswith: '\\MsMpEng.exe'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Unlikely as this weakens defenses and normally would not be done even if using another AV.\nlevel: medium\n"},{"path":"registry\\registry_add\\registry_add_persistence_disk_cleanup_handler_entry.yml","content":"title: Potential Persistence Via Disk Cleanup Handler - Registry\nid: d4f4e0be-cf12-439f-9e25-4e2cdcf7df5a\nstatus: test\ndescription: |\n    Detects when an attacker modifies values of the Disk Cleanup Handler in the registry to achieve persistence.\n    The disk cleanup manager is part of the operating system. It displays the dialog box […]\n    The user has the option of enabling or disabling individual handlers by selecting or clearing their check box in the disk cleanup manager's UI.\n    Although Windows comes with a number of disk cleanup handlers, they aren't designed to handle files produced by other applications.\n    Instead, the disk cleanup manager is designed to be flexible and extensible by enabling any developer to implement and register their own disk cleanup handler.\n    Any developer can extend the available disk cleanup services by implementing and registering a disk cleanup handler.\nreferences:\n    - https://persistence-info.github.io/Data/diskcleanuphandler.html\n    - https://www.hexacorn.com/blog/2018/09/02/beyond-good-ol-run-key-part-86/\nauthor: Nasreddine Bencherchali (Nextron Systems)\ndate: 2022-07-21\nmodified: 2023-02-07\ntags:\n    - attack.persistence\nlogsource:\n    product: windows\n    category: registry_add\ndetection:\n    selection:\n        EventType: CreateKey\n        TargetObject|contains: '\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\VolumeCaches\\'\n    filter_main_default_keys:\n        # Default Keys\n        TargetObject|endswith:\n            - '\\Active Setup Temp Folders'\n            - '\\BranchCache'\n            - '\\Content Indexer Cleaner'\n            - '\\D3D Shader Cache'\n            - '\\Delivery Optimization Files'\n            - '\\Device Driver Packages'\n            - '\\Diagnostic Data Viewer database files'\n            - '\\Downloaded Program Files'\n            - '\\DownloadsFolder'\n            - '\\Feedback Hub Archive log files'\n            - '\\Internet Cache Files'\n            - '\\Language Pack'\n            - '\\Microsoft Office Temp Files'\n            - '\\Offline Pages Files'\n            - '\\Old ChkDsk Files'\n            - '\\Previous Installations'\n            - '\\Recycle Bin'\n            - '\\RetailDemo Offline Content'\n            - '\\Setup Log Files'\n            - '\\System error memory dump files'\n            - '\\System error minidump files'\n            - '\\Temporary Files'\n            - '\\Temporary Setup Files'\n            - '\\Temporary Sync Files'\n            - '\\Thumbnail Cache'\n            - '\\Update Cleanup'\n            - '\\Upgrade Discarded Files'\n            - '\\User file versions'\n            - '\\Windows Defender'\n            - '\\Windows Error Reporting Files'\n            - '\\Windows ESD installation files'\n            - '\\Windows Upgrade Log Files'\n    condition: selection and not 1 of filter_main_*\nfalsepositives:\n    - Legitimate new entry added by windows\nlevel: medium\n"}]