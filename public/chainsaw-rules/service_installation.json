[{"path":"service_installation\\tap0901.yml","content":"---\r\ntitle: OpenVPN TAP Driver Service Installation\r\ngroup: Service Installation \r\ndescription: An OpenVPN TAP Driver Service Was Installed\r\nauthors:\r\n  - reece394\r\n\r\n\r\nkind: evtx\r\nlevel: medium\r\nstatus: stable\r\ntimestamp: Event.System.TimeCreated\r\n\r\n\r\nfields:\r\n  - name: Event ID\r\n    to: Event.System.EventID\r\n  - name: Record ID\r\n    to: Event.System.EventRecordID\r\n  - name: Computer\r\n    to: Event.System.Computer\r\n  - name: Service Name\r\n    to: Event.EventData.ServiceName\r\n  - name: Service File Name\r\n    to: Event.EventData.ImagePath\r\n  - name: Service Type\r\n    to: Event.EventData.ServiceType\r\n  - name: Service Start Type\r\n    to: Event.EventData.StartType  \r\n  - name: Service Account\r\n    to: Event.EventData.AccountName  \r\n\r\nfilter:\r\n  condition: service_control_manager and (service_name or image_path)\r\n\r\n  service_control_manager:\r\n    Event.System.Provider: Service Control Manager\r\n    Event.System.EventID: 7045\r\n\r\n  service_name:\r\n    Event.EventData.ServiceName:\r\n      - 'i*TAP-Windows*'\r\n\r\n  image_path:\r\n    Event.EventData.ImagePath:\r\n      - 'i*tap0901.sys*'"},{"path":"service_installation\\sysinternals_psexec.yml","content":"---\r\ntitle: Sysinternals PsExec Service Installation\r\ngroup: Service Installation \r\ndescription: A Sysinternals PsExec Service Was Installed\r\nauthors:\r\n  - reece394\r\n\r\n\r\nkind: evtx\r\nlevel: medium\r\nstatus: stable\r\ntimestamp: Event.System.TimeCreated\r\n\r\n\r\nfields:\r\n  - name: Event ID\r\n    to: Event.System.EventID\r\n  - name: Record ID\r\n    to: Event.System.EventRecordID\r\n  - name: Computer\r\n    to: Event.System.Computer\r\n  - name: Service Name\r\n    to: Event.EventData.ServiceName\r\n  - name: Service File Name\r\n    to: Event.EventData.ImagePath\r\n  - name: Service Type\r\n    to: Event.EventData.ServiceType\r\n  - name: Service Start Type\r\n    to: Event.EventData.StartType  \r\n  - name: Service Account\r\n    to: Event.EventData.AccountName  \r\n\r\nfilter:\r\n  condition: service_control_manager and (service_name or image_path)\r\n\r\n  service_control_manager:\r\n    Event.System.Provider: Service Control Manager\r\n    Event.System.EventID: 7045\r\n\r\n  service_name:\r\n    Event.EventData.ServiceName:\r\n      - 'i*PSEXESVC*'\r\n\r\n  image_path:\r\n    Event.EventData.ImagePath:\r\n      - 'i*PSEXESVC.exe*'"},{"path":"service_installation\\suspicious_paths.yml","content":"---\r\ntitle: Suspicious Paths Service Installation\r\ngroup: Service Installation \r\ndescription: Suspicious Paths were found in a Service that Was Installed\r\nauthors:\r\n  - reece394\r\n\r\n\r\nkind: evtx\r\nlevel: medium\r\nstatus: stable\r\ntimestamp: Event.System.TimeCreated\r\n\r\n\r\nfields:\r\n  - name: Event ID\r\n    to: Event.System.EventID\r\n  - name: Record ID\r\n    to: Event.System.EventRecordID\r\n  - name: Computer\r\n    to: Event.System.Computer\r\n  - name: Service Name\r\n    to: Event.EventData.ServiceName\r\n  - name: Service File Name\r\n    to: Event.EventData.ImagePath\r\n  - name: Service Type\r\n    to: Event.EventData.ServiceType\r\n  - name: Service Start Type\r\n    to: Event.EventData.StartType  \r\n  - name: Service Account\r\n    to: Event.EventData.AccountName  \r\n\r\nfilter:\r\n  condition: service_control_manager and service_name\r\n\r\n  service_control_manager:\r\n    Event.System.Provider: Service Control Manager\r\n    Event.System.EventID: 7045\r\n\r\n  service_name:\r\n    Event.EventData.ImagePath:\r\n      - 'i*\\SystemRoot\\*' # Could Produce False Positives\r\n      - 'i*\\Perflogs\\*'\r\n      - 'i*\\Users\\Public\\*'\r\n      - 'i*\\Windows\\Temp\\*'\r\n      - 'i*\\AppData\\*'\r\n      - 'i*\\Temp\\*'\r\n      - 'i*\\Downloads\\*'\r\n      - 'i*\\Documents\\*'\r\n      - 'i*\\Music\\*'\r\n      - 'i*\\Desktop\\*'\r\n      - 'i*\\Favorites\\*'\r\n      - 'i*\\Links\\*'\r\n      - 'i*\\Favorites\\*'\r\n      - 'i*\\OneDrive\\*'\r\n      - 'i*\\Pictures\\*'\r\n      - 'i*\\Saved Games\\*'\r\n      - 'i*\\Videos\\*'\r\n      - 'i?^[a-zA-Z]:\\\\.{1,16}\\.exe$' # Could Produce False Positives\r\n      - 'i?^%SYSTEMROOT%\\\\.{1,16}\\.exe$' # Could Produce False Positives\r\n      - 'i?^[a-zA-Z]:\\\\.{1,9}\\.exe' # Could Produce False Positives\r\n      - 'i?^%SYSTEMROOT%\\\\.{1,9}\\.exe' # Could Produce False Positives"},{"path":"service_installation\\suspicious_commands.yml","content":"---\r\ntitle: Suspicious Commands Service Installation\r\ngroup: Service Installation \r\ndescription: Suspicious Commands were found in a Service that Was Installed\r\nauthors:\r\n  - reece394\r\n\r\n\r\nkind: evtx\r\nlevel: medium\r\nstatus: stable\r\ntimestamp: Event.System.TimeCreated\r\n\r\n\r\nfields:\r\n  - name: Event ID\r\n    to: Event.System.EventID\r\n  - name: Record ID\r\n    to: Event.System.EventRecordID\r\n  - name: Computer\r\n    to: Event.System.Computer\r\n  - name: Service Name\r\n    to: Event.EventData.ServiceName\r\n  - name: Service File Name\r\n    to: Event.EventData.ImagePath\r\n  - name: Service Type\r\n    to: Event.EventData.ServiceType\r\n  - name: Service Start Type\r\n    to: Event.EventData.StartType  \r\n  - name: Service Account\r\n    to: Event.EventData.AccountName  \r\n\r\nfilter:\r\n  condition: service_control_manager and service_name\r\n\r\n  service_control_manager:\r\n    Event.System.Provider: Service Control Manager\r\n    Event.System.EventID: 7045\r\n\r\n  service_name:\r\n    Event.EventData.ImagePath:\r\n      - 'i*cmd /c*'\r\n      - 'i*cmd /Q /c*'\r\n      - 'i*cmd.exe /c*'\r\n      - 'i*cmd.exe /Q /c*'\r\n      - 'i*%COMSPEC%*'"},{"path":"service_installation\\smbexec.yml","content":"---\r\ntitle: Impacket smbexec.py Service Installation\r\ngroup: Service Installation \r\ndescription: An Impacket smbexec Service Was Installed\r\nauthors:\r\n  - reece394\r\n\r\n\r\nkind: evtx\r\nlevel: critical\r\nstatus: stable\r\ntimestamp: Event.System.TimeCreated\r\n\r\n\r\nfields:\r\n  - name: Event ID\r\n    to: Event.System.EventID\r\n  - name: Record ID\r\n    to: Event.System.EventRecordID\r\n  - name: Computer\r\n    to: Event.System.Computer\r\n  - name: Service Name\r\n    to: Event.EventData.ServiceName\r\n  - name: Service File Name\r\n    to: Event.EventData.ImagePath\r\n  - name: Service Type\r\n    to: Event.EventData.ServiceType\r\n  - name: Service Start Type\r\n    to: Event.EventData.StartType  \r\n  - name: Service Account\r\n    to: Event.EventData.AccountName  \r\n\r\nfilter:\r\n  condition: service_control_manager and (service_name or image_path)\r\n\r\n  service_control_manager:\r\n    Event.System.Provider: Service Control Manager\r\n    Event.System.EventID: 7045\r\n\r\n  service_name:\r\n    Event.EventData.ServiceName:\r\n      - 'i*BTOBTO*'\r\n\r\n  image_path:\r\n    Event.EventData.ImagePath:\r\n      - 'i*.bat & del *'\r\n      - 'i*__output 2^>^&1 >*'"},{"path":"service_installation\\remote_access_tools.yml","content":"---\r\ntitle: Remote Access Tool Service Installation\r\ngroup: Service Installation \r\ndescription: A Remote Access Tool Service Was Installed\r\nauthors:\r\n  - reece394\r\n\r\n\r\nkind: evtx\r\nlevel: medium\r\nstatus: stable\r\ntimestamp: Event.System.TimeCreated\r\n\r\n\r\nfields:\r\n  - name: Event ID\r\n    to: Event.System.EventID\r\n  - name: Record ID\r\n    to: Event.System.EventRecordID\r\n  - name: Computer\r\n    to: Event.System.Computer\r\n  - name: Service Name\r\n    to: Event.EventData.ServiceName\r\n  - name: Service File Name\r\n    to: Event.EventData.ImagePath\r\n  - name: Service Type\r\n    to: Event.EventData.ServiceType\r\n  - name: Service Start Type\r\n    to: Event.EventData.StartType  \r\n  - name: Service Account\r\n    to: Event.EventData.AccountName  \r\n\r\nfilter:\r\n  condition: service_control_manager and (service_name or image_path)\r\n\r\n  service_control_manager:\r\n    Event.System.Provider: Service Control Manager\r\n    Event.System.EventID: 7045\r\n\r\n  service_name:\r\n    Event.EventData.ServiceName:\r\n      - 'i*AnyDesk*'\r\n      - 'i*Ammyy*'\r\n      - 'i*Atera*'\r\n      - 'i*GoTo Resolve*'\r\n      - 'i*GoToMyPC*'\r\n      - 'i*LMIGuardianSvc*'\r\n      - 'i*LogMeIn*'\r\n      - 'i*GoToAssist*'\r\n      - 'i*Parsec*'\r\n      - 'i*Remote Utilities - Host*'\r\n      - 'i*VPDAgent*' # Installed by Remote Utilities\r\n      - 'i*Client32*' # Installed by NetSupport Manager\r\n      - 'i*nskbfltr*' # Installed by NetSupport Manager\r\n      - 'i*Gateway32*' # Installed by NetSupport Manager if Connectivity Server is Selected During Install\r\n      - 'i*MeshCentral*'\r\n      - 'i*Mesh Agent*'\r\n      - 'i*RPCService*' # Installed by RemotePC\r\n      - 'i*ViewerService*' # Installed by RemotePC\r\n      - 'i*RemotePC Performance Service*' # Installed by RemotePC\r\n      - 'i*Splashtop*'\r\n      - 'i*TeamViewer*'\r\n      - 'i*TightVNC*'\r\n      - 'i*RealVNC*'\r\n      - 'i*Zoho Assist*'\r\n      - 'i*pcAnywhere*'\r\n      - 'i*UltraViewer*'\r\n      - 'i*Supremo*'\r\n      - 'i*ScreenConnect*'\r\n      - 'i*Chrome Remote Desktop*'\r\n      - 'i*N-central Take Control Service*'\r\n      - 'i*N-central Take Control Updater Service*'\r\n      - 'i*monblanking*'\r\n      - 'i*jumpcloud*'\r\n\r\n  image_path:\r\n    Event.EventData.ImagePath:\r\n      - 'i*AnyDesk.exe*'\r\n      - 'i*AA_v3.exe*'\r\n      - 'i*g2r-updater.exe*'\r\n      - 'i*g2svc.exe*'\r\n      - 'i*LMIGuardianSvc.exe*'\r\n      - 'i*ramaint.exe*'\r\n      - 'i*LogMeIn.exe*'\r\n      - 'i*RaMaint.exe*'\r\n      - 'i*LMIInfo.sys*'\r\n      - 'i*LMIRfsDriver.sys*'\r\n      - 'i*g2ax_service.exe*'\r\n      - 'i*pservice.exe*'\r\n      - 'i*rutserv.exe*'\r\n      - 'i*VPDAgent.exe*'\r\n      - 'i*client32.exe*'\r\n      - 'i*nskbfltr.sys*'\r\n      - 'i*Gateway32.exe*'\r\n      - 'i*meshcentral.exe*'\r\n      - 'i*MeshAgent.exe*'\r\n      - 'i*RemotePCService.exe*'\r\n      - 'i*ViewerService.exe*'\r\n      - 'i*RPCPerformanceService.exe*'\r\n      - 'i*SSUService.exe*'\r\n      - 'i*SRService.exe*'\r\n      - 'i*TeamViewer_Service.exe*'\r\n      - 'i*tvnserver.exe*'\r\n      - 'i*vncserver.exe*'\r\n      - 'i*ZohoURSService.exe*'\r\n      - 'i*awhost32.exe*'\r\n      - 'i*UltraViewer_Service.exe*'\r\n      - 'i*SupremoSystem.exe*'\r\n      - 'i*SupremoService.exe*'\r\n      - 'i*ScreenConnect.ClientService.exe*'\r\n      - 'i*remoting_host.exe*'\r\n      - 'i*AteraAgent.exe*'\r\n      - 'i*OpenHardwareMonitorLib.sys*'\r\n      - 'i*BASupSrvc.exe*'\r\n      - 'i*BASupSrvcUpdater.exe*'\r\n      - 'i*monblanking.sys*'\r\n      - 'i*jumpcloud-agent.exe*'"},{"path":"service_installation\\processhacker.yml","content":"---\r\ntitle: ProcessHacker Service Installation\r\ngroup: Service Installation \r\ndescription: A ProcessHacker Service Was Installed - Can Be Used to Elevate Privileges\r\nauthors:\r\n  - reece394\r\n\r\n\r\nkind: evtx\r\nlevel: critical\r\nstatus: stable\r\ntimestamp: Event.System.TimeCreated\r\n\r\n\r\nfields:\r\n  - name: Event ID\r\n    to: Event.System.EventID\r\n  - name: Record ID\r\n    to: Event.System.EventRecordID\r\n  - name: Computer\r\n    to: Event.System.Computer\r\n  - name: Service Name\r\n    to: Event.EventData.ServiceName\r\n  - name: Service File Name\r\n    to: Event.EventData.ImagePath\r\n  - name: Service Type\r\n    to: Event.EventData.ServiceType\r\n  - name: Service Start Type\r\n    to: Event.EventData.StartType  \r\n  - name: Service Account\r\n    to: Event.EventData.AccountName  \r\n\r\nfilter:\r\n  condition: service_control_manager and service_name\r\n\r\n  service_control_manager:\r\n    Event.System.Provider: Service Control Manager\r\n    Event.System.EventID: 7045\r\n\r\n  service_name:\r\n    Event.EventData.ServiceName:\r\n      - 'i*ProcessHacker*'"},{"path":"service_installation\\powershell.yml","content":"---\r\ntitle: PowerShell Script Service Installation\r\ngroup: Service Installation \r\ndescription: A PowerShell Script as a Service Was Installed\r\nauthors:\r\n  - reece394\r\n\r\n\r\nkind: evtx\r\nlevel: critical\r\nstatus: stable\r\ntimestamp: Event.System.TimeCreated\r\n\r\n\r\nfields:\r\n  - name: Event ID\r\n    to: Event.System.EventID\r\n  - name: Record ID\r\n    to: Event.System.EventRecordID\r\n  - name: Computer\r\n    to: Event.System.Computer\r\n  - name: Service Name\r\n    to: Event.EventData.ServiceName\r\n  - name: Service File Name\r\n    to: Event.EventData.ImagePath\r\n  - name: Service Type\r\n    to: Event.EventData.ServiceType\r\n  - name: Service Start Type\r\n    to: Event.EventData.StartType  \r\n  - name: Service Account\r\n    to: Event.EventData.AccountName  \r\n\r\nfilter:\r\n  condition: service_control_manager and service_name\r\n\r\n  service_control_manager:\r\n    Event.System.Provider: Service Control Manager\r\n    Event.System.EventID: 7045\r\n\r\n  service_name:\r\n    Event.EventData.ImagePath:\r\n      - 'i*powershell*'\r\n      - 'i*pwsh*'\r\n      - 'i*-encodedcommand*'"},{"path":"service_installation\\meterpreter_cobalt_strike_getsystem.yml","content":"---\r\ntitle: Meterpreter or Cobalt Strike Getsystem Service Installation\r\ngroup: Service Installation \r\ndescription: A Meterpreter or Cobalt Strike Getsystem Service Was Installed - https://speakerdeck.com/heirhabarov/hunting-for-privilege-escalation-in-windows-environment \r\nauthors:\r\n  - reece394\r\n\r\n\r\nkind: evtx\r\nlevel: critical\r\nstatus: stable\r\ntimestamp: Event.System.TimeCreated\r\n\r\n\r\nfields:\r\n  - name: Event ID\r\n    to: Event.System.EventID\r\n  - name: Record ID\r\n    to: Event.System.EventRecordID\r\n  - name: Computer\r\n    to: Event.System.Computer\r\n  - name: Service Name\r\n    to: Event.EventData.ServiceName\r\n  - name: Service File Name\r\n    to: Event.EventData.ImagePath\r\n  - name: Service Type\r\n    to: Event.EventData.ServiceType\r\n  - name: Service Start Type\r\n    to: Event.EventData.StartType  \r\n  - name: Service Account\r\n    to: Event.EventData.AccountName  \r\n\r\nfilter:\r\n  condition: service_control_manager and (cmd or rundll or share)\r\n\r\n  service_control_manager:\r\n    Event.System.Provider: Service Control Manager\r\n    Event.System.EventID: 7045\r\n\r\n  cmd:\r\n    all(Event.EventData.ImagePath):\r\n      - 'i*/c*'\r\n      - 'i*echo*'\r\n      - 'i*\\pipe*'\r\n    Event.EventData.ImagePath:\r\n        - 'i*cmd*'\r\n        - 'i*%COMSPEC%*'\r\n\r\n  rundll:\r\n    all(Event.EventData.ImagePath):\r\n      - 'i*rundll32*'\r\n      - 'i*.dll,a*'\r\n      - 'i*/p:*'\r\n\r\n  share:\r\n    Event.EventData.ImagePath:\r\n      - 'i\\\\\\\\127.0.0.1\\\\ADMIN$\\*'  "},{"path":"service_installation\\krbrelayup.yml","content":"---\r\ntitle: KrbRelayUp Service Installation\r\ngroup: Service Installation \r\ndescription: A KrbRelayUp Service Was Installed - a universal no-fix local privilege escalation in windows domain environments where LDAP signing is not enforced (the default settings).\r\nauthors:\r\n  - reece394\r\n\r\n\r\nkind: evtx\r\nlevel: critical\r\nstatus: stable\r\ntimestamp: Event.System.TimeCreated\r\n\r\n\r\nfields:\r\n  - name: Event ID\r\n    to: Event.System.EventID\r\n  - name: Record ID\r\n    to: Event.System.EventRecordID\r\n  - name: Computer\r\n    to: Event.System.Computer\r\n  - name: Service Name\r\n    to: Event.EventData.ServiceName\r\n  - name: Service File Name\r\n    to: Event.EventData.ImagePath\r\n  - name: Service Type\r\n    to: Event.EventData.ServiceType\r\n  - name: Service Start Type\r\n    to: Event.EventData.StartType  \r\n  - name: Service Account\r\n    to: Event.EventData.AccountName  \r\n\r\nfilter:\r\n  condition: service_control_manager and service_name\r\n\r\n  service_control_manager:\r\n    Event.System.Provider: Service Control Manager\r\n    Event.System.EventID: 7045\r\n\r\n  service_name:\r\n    Event.EventData.ServiceName:\r\n      - 'i*KrbSCM*'"},{"path":"service_installation\\csexec.yml","content":"---\r\ntitle: CSExec Service Installation\r\ngroup: Service Installation \r\ndescription: A CSExec Service Was Installed - https://github.com/malcomvetter/CSExec\r\nauthors:\r\n  - reece394\r\n\r\n\r\nkind: evtx\r\nlevel: medium\r\nstatus: stable\r\ntimestamp: Event.System.TimeCreated\r\n\r\n\r\nfields:\r\n  - name: Event ID\r\n    to: Event.System.EventID\r\n  - name: Record ID\r\n    to: Event.System.EventRecordID\r\n  - name: Computer\r\n    to: Event.System.Computer\r\n  - name: Service Name\r\n    to: Event.EventData.ServiceName\r\n  - name: Service File Name\r\n    to: Event.EventData.ImagePath\r\n  - name: Service Type\r\n    to: Event.EventData.ServiceType\r\n  - name: Service Start Type\r\n    to: Event.EventData.StartType  \r\n  - name: Service Account\r\n    to: Event.EventData.AccountName  \r\n\r\nfilter:\r\n  condition: service_control_manager and (service_name or image_path)\r\n\r\n  service_control_manager:\r\n    Event.System.Provider: Service Control Manager\r\n    Event.System.EventID: 7045\r\n\r\n  service_name:\r\n    Event.EventData.ServiceName:\r\n      - 'i*csexecsvc*'\r\n\r\n  image_path:\r\n    Event.EventData.ImagePath:\r\n      - 'i*csexecsvc.exe*'"},{"path":"service_installation\\credential_dumping_tools.yml","content":"---\r\ntitle: Credential Dumping Tools Service Installation\r\ngroup: Service Installation \r\ndescription: A Credential Dumping Tool Service Was Installed - https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment\r\nauthors:\r\n  - reece394\r\n\r\n\r\nkind: evtx\r\nlevel: critical\r\nstatus: stable\r\ntimestamp: Event.System.TimeCreated\r\n\r\n\r\nfields:\r\n  - name: Event ID\r\n    to: Event.System.EventID\r\n  - name: Record ID\r\n    to: Event.System.EventRecordID\r\n  - name: Computer\r\n    to: Event.System.Computer\r\n  - name: Service Name\r\n    to: Event.EventData.ServiceName\r\n  - name: Service File Name\r\n    to: Event.EventData.ImagePath\r\n  - name: Service Type\r\n    to: Event.EventData.ServiceType\r\n  - name: Service Start Type\r\n    to: Event.EventData.StartType  \r\n  - name: Service Account\r\n    to: Event.EventData.AccountName  \r\n\r\nfilter:\r\n  condition: service_control_manager and (service_name or image_path)\r\n\r\n  service_control_manager:\r\n    Event.System.Provider: Service Control Manager\r\n    Event.System.EventID: 7045\r\n\r\n  service_name:\r\n    Event.EventData.ServiceName:\r\n      - 'i*fgexec*'\r\n      - 'i*CacheDump*'\r\n      - 'i*mimikatz*'\r\n      - 'i*mimidrv*'\r\n      - 'i*mimikatzsvc*'\r\n      - 'i*WCESERVICE*'\r\n      - 'i*PWDump*'\r\n\r\n  image_path:\r\n    Event.EventData.ImagePath:\r\n      - 'i*cachedump*'\r\n      - 'i*dumpsvc*'\r\n      - 'i*fgexec*'\r\n      - 'i*gsecdump*'\r\n      - 'i*mimidrv*'\r\n      - 'i*pwdump*'\r\n      - 'i*servpw*'"}]