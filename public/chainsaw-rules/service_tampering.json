[{"path":"service_tampering\\xp_cmdshell_enabled.yml","content":"title: MSSQL XP_CMDSHELL Enabled\r\ngroup: Service Tampering\r\ndescription: MSSQL being modified to allow command execution\r\nauthors:\r\n  - 0xFFaraday\r\n\r\nkind: evtx\r\nlevel: high\r\nstatus: stable\r\ntimestamp: Event.System.TimeCreated\r\n\r\nfields:\r\n  - name: Event ID\r\n    to: Event.System.EventID\r\n  - name: Username\r\n    to: Event.System.Provider_attributes.Name\r\n  - name: Computer\r\n    to: Event.System.Computer\r\n  - name: Command\r\n    to: Event.EventData.Data[0]\r\n  - name: Old Value\r\n    to: Event.EventData.Data[1]\r\n  - name: New Value\r\n    to: Event.EventData.Data[2]\r\n\r\nfilter:\r\n  condition: server_configuration and command_arguments\r\n\r\n  server_configuration:\r\n    Event.System.EventID: 15457\r\n    Event.EventData.Data[0]: \"xp_cmdshell\"\r\n  command_arguments:\r\n    Event.EventData.Data[1]: \"0\"\r\n    Event.EventData.Data[2]: \"1\""},{"path":"service_tampering\\remote_registry_usage.yml","content":"title: Remote Registry Service Interaction\r\ngroup: Service Tampering\r\ndescription: Detects the possible usage of remote registry dumping via tools like Impacket-Secretsdump & CrackMapExec/NetExec\r\nauthors:\r\n  - 0xFFaraday\r\nreferences:\r\n  - https://github.com/fortra/impacket/blob/af91d617c382e1eb132506159debcbc10da7a567/examples/secretsdump.py#L12-L31\r\n\r\nkind: evtx\r\nlevel: medium\r\nstatus: stable\r\ntimestamp: Event.System.TimeCreated\r\n\r\nfields:\r\n  - name: Event ID\r\n    to: Event.System.EventID\r\n  - name: Computer\r\n    to: Event.System.Computer\r\n  - name: Service\r\n    to: Event.EventData.param1\r\n  - name: Old State\r\n    to: Event.EventData.param2\r\n  - name: New State\r\n    to: Event.EventData.param3\r\n  - name: SID\r\n    to: Event.System.Security_attributes.UserID\r\n\r\nfilter:\r\n  condition: selection_service and not filter_sid\r\n\r\n  selection_service:\r\n    Event.System.EventID: 7040\r\n    Event.EventData.param1: \"Remote Registry\"\r\n\r\n  filter_sid:\r\n    Event.System.Security_attributes.UserID: \"S-1-5-18\"\r\n"},{"path":"service_tampering\\mssql_sus_behavior.yml","content":"title: Potential MSSQL Suspicious Activity\r\ngroup: Service Tampering\r\ndescription: General commands that could involve threat actor behavior\r\nauthors:\r\n  - 0xFFaraday\r\n\r\nkind: evtx\r\nlevel: medium\r\nstatus: stable\r\ntimestamp: Event.System.TimeCreated\r\n\r\nfields:\r\n  - name: Event ID\r\n    to: Event.System.EventID\r\n  - name: Username\r\n    to: Event.System.Provider_attributes.Name\r\n  - name: Computer\r\n    to: Event.System.Computer\r\n  - name: Command\r\n    to: Event.EventData.Data\r\n\r\nfilter:\r\n  condition: eventid\r\n\r\n  eventid:\r\n    Event.System.EventID: 15457"},{"path":"service_tampering\\event_log.yml","content":"---\r\ntitle: Windows Event Log Stopped\r\ngroup: Service Tampering\r\ndescription: The Windows Event Log service has been stopped.\r\nauthors:\r\n  - FranticTyping\r\n\r\n\r\nkind: evtx\r\nlevel: critical\r\nstatus: stable\r\ntimestamp: Event.System.TimeCreated\r\n\r\n\r\nfields:\r\n  - name: Event ID\r\n    to: Event.System.EventID\r\n  - name: Record ID\r\n    to: Event.System.EventRecordID\r\n  - name: Computer\r\n    to: Event.System.Computer\r\n  - name: Service Name\r\n    to: Event.EventData.param1\r\n  - name: Action\r\n    to: Event.EventData.param2\r\n\r\n\r\nfilter:\r\n  Event.System.EventID: 7040\r\n  Event.EventData.param1: Windows Event Log\r\n  Event.EventData.param2: disabled\r\n"}]